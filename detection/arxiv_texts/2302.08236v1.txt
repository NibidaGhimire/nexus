Real-time adaptive sensing of nuclear spins by a single-spin quantum sensor
Jingcheng Wang,1, 2, 3Dongxiao Li,1, 2, 4,Ralf Betzholz,1, 2and Jianming Cai1, 2, 3, 5
1School of Physics, Institute for Quantum Science and Engineering,
International Joint Laboratory on Quantum Sensing and Quantum Metrology,
Huazhong University of Science and Technology, Wuhan 430074, China
2Hubei Key Laboratory of Gravitation and Quantum Physics,
Huazhong University of Science and Technology, Wuhan 430074, China
3Wuhan National High Magnetic Field Center, Huazhong University of Science and Technology, Wuhan 430074, China
4College of physics science and technology, Shenyang Normal University, Shenyang 110034, China
5State Key Laboratory of Precision Spectroscopy, East China Normal University, Shanghai, 200062, China
(Dated: February 17, 2023)
Quantum sensing is considered to be one of the most promising subÔ¨Åelds of quantum information to deliver
practical quantum advantages in real-world applications. However, its impressive capabilities, including high
sensitivity, are often hindered by the limited quantum resources available. Here, we incorporate the expected
information gain (EIG) and techniques such as accelerated computation into Bayesian experimental design
(BED) in order to use quantum resources more efÔ¨Åciently. A simulated nitrogen-vacancy center in diamond is
used to demonstrate real-time operation of the BED. Instead of heuristics, the EIG is used to choose optimal
control parameters in real-time. Moreover, combining the BED with accelerated computation and asynchronous
operations, we Ô¨Ånd that up to a tenfold speed-up in absolute time cost can be achieved in sensing multiple
surrounding13C nuclear spins. Our work explores the possibilities of applying the EIG to BED-based quantum-
sensing tasks and provides techniques useful to integrate BED into more generalized quantum sensing systems.
I. INTRODUCTION
Quantum sensing, based on unique phenomena like quan-
tum entanglement [1, 2], quantum coherence [3] and quantum
spin magnetometry [4], is used to measure physical quanti-
ties such as the electromagnetic [4, 5] and gravitational Ô¨Åeld
[2]. Compared to classical schemes, quantum sensing ex-
hibits multiple advantages, such as a sensitivity exceeding the
standard quantum limit [1, 2, 6‚Äì8] and a microscopic spatial
resolution [4, 5]. However, it is well known that the quan-
tum resources quantum sensors rely on are limited due to un-
wanted effects [9]. This, in turn, has encouraged a plethora
of efforts, such as the improvement of experimental appa-
ratus [10], the usage of dynamical decoupling [11‚Äì14] and
quantum heterodyne magnetometry [15], to enhance the ro-
bustness of the quantum sensors. Moreover, methods based on
machine learning have recently gained increasing attention.
BeneÔ¨Åting from specialized hardware [16], ever-growing
software support [17], and hyper-scale deep-learning mod-
els [18], machine learning is the building block of various
recent breakthroughs in technology, such as artiÔ¨Åcial intelli-
gence [19], natural language processing [20], and computer
vision [21]. It is, therefore, not surprising that it also provides
diverse applications in the Ô¨Åeld of quantum physics [22‚Äì25]
due to its high expressivity [26, 27]. In particular, as a re-
markable example of machine learning, Bayesian experimen-
tal designs (BED) have been employed, among others, in pro-
cessing the noisy readout of solid-state spins [28] and recon-
structing unknown quantum state of photonic systems [29].
On the other hand, the nitrogen-vacancy (NV) center
spin in diamond, as an extremely well controllable ambient-
condition quantum system, has been studied extensively in
lidongxiao414@hust.edu.cnbio-imaging [30‚Äì32], micro-scale magnetometry [4, 15], and
nuclear magnetic resonance [33‚Äì35] due to its Ô¨Çuorescence
brightness, good optical stability, high sensitivity to external
magnetic Ô¨Åelds, as well as low toxicity [9, 15, 36], and is
likewise a suitable platform to demonstrate frameworks not
limited to quantum sensing [37‚Äì44]. Notably, based on BED
and NV centers, an increasing amount of frontier work has
been put forward, such as static magnetic Ô¨Åeld magnetome-
try [28, 45], quantum Hamiltonian learning [46, 47], and un-
known quantum system learning [43]. However, for more
general quantum systems, conducting BED in real-time re-
mains unexplored owing to the high demand of simulation re-
sources and the lack of universally efÔ¨Åcient heuristics. Heuris-
tics that work well in one quantum sensing task could end up
with sub-optimal results when employed in a similar, albeit
different, setup. Besides, while it is well perceived that reduc-
ing the computational overhead in BED can free researchers
from using more complex optimization process, the efforts
spent in exploring this path are limited.
In this work, we apply real-time BED on a simulated sin-
gle NV-center spin interacting with a more generalized en-
vironment, such as multiple nearby nuclear spins and os-
cillating magnetic Ô¨Åelds. To avoid the difÔ¨Åculty of Ô¨Ånd-
ing suitable heuristics, we employ the expected information
gain (EIG) [48‚Äì51] as the utility function to obtain a system-
agnostic guidance, which allows to optimize the experimen-
tal parameters efÔ¨Åciently. Moreover, the number of single-
shot measurements required for the same uncertainty is re-
duced by a full order of magnitude, compared to non-adaptive
protocols [52]. In addition, by virtue of a single consumer-
grade general purpose graphical processing unit (GPGPU),
the lengthy simulation time during real-time adaptive exper-
iments can be substantially decreased in order to fulÔ¨Åll ex-
perimental requirements [28, 52]. To further reduce the time
overhead induced by the adaptive design, we introduce asyn-arXiv:2302.08236v1  [quant-ph]  16 Feb 20232
chronous operation into the BED. Combining the accelerated
computation and the asynchronous operation, we can trans-
late the reduction in number of single-shot measurements into
a speed-up in absolute time cost.
The article is organized as follows. We begin by intro-
ducing our BED scheme including the EIG in Sec. II. In
Sec. III A, we then simulate some experiments to detect in-
dividual nuclear spins coupled to an NV center electron spin.
We further test the protocol for the detection of oscillating
magnetic Ô¨Åelds using NV center as a magnetic sensor in
Sec. III B. In Sec. IV, the efforts in reducing the computational
overhead are discussed. Finally, we summarize our work in
Sec. V.
II. BAYESIAN EXPERIMENTAL DESIGN
Rigorous extensions of the concepts in BED have appeared
in Refs. [50, 53, 54]. In our BED treatment, without loss of
generality, we consider a two-level probe, initially prepared in
the statej0i, whose population in the basis states fj0i,j1ig
can be read [9]. The Hamiltonian of the system is denoted
by^H(x)with a set of parameters x= (x1;:::;xn)which are
being estimated [55]. In order to estimate xaccurately, repeti-
tive measurements are required. In an experiment, these repe-
titions are treated as a series of events E= (e1;:::;em). The
control parameters and the read-out result of the ith single-
shot eventeiare written as cianddi, respectively. The control
parametersci, which can, in principle, characterize any quan-
tity that can be controlled and adjusted in the experiment, can
be chosen fromC=fc1;:::; cpg.
According to the Bayes‚Äô theorem [56], we can construct the
probability distribution of xfrom a sequence of single-shot
measurements, i.e.,
Pr(xjD)/mY
i=1Pr(dijx;ci)Pr0(x); (1)
whereD= (d1;:::;dm)represents sequential experiment
data, Pr 0(x)is the prior distribution of x, and Pr (dijx;ci)
is the likelihood function [57, 58] for our experiment. The
probability that the state of the qubit probe of the experiment,
denoted byji, remains in the initial state j0iis given by
Pr(ji=j0i) =jh0j^U(x;ci)j0ij2, where ^U(x;ci)represents
the time-evolution operator during the ith run of the experi-
ment, where the evolution time itself is also included in the
control parameter ciof the run. For an ideal read-out detec-
tion, the likelihood function is
Prideal(dijx;ci) =jhdij^U(x;ci)jdiij2; (2)
wheredi2 f0;1gis the outcome of the ith single-shot
measurement. However, inefÔ¨Åciency and noise in measure-
ments are inevitable. Therefore, the likelihood function can
be rewritten as
Pr(0jx;ci) = (p0+p1 1)Prideal(0jx;ci) + (1 p1);(3)
Pr(1jx;ci) = 1 Pr(0jx;ci); (4)wherep0andp1represent the probabilities of a faithful de-
tection ofj0iandj1i, viz.,p0=Pr(d= 0jji=j0i)and
p1=Pr(d= 1jji=j1i). In order to improve the efÔ¨Åciency
of our experiment, it is necessary to optimally choose the con-
trol parameter ciin terms of a utility function [50]. Explicitly,
the EIG EDist KLis chosen as this utility function since it is
able to achieve D-optimal designs [48] without Ô¨Ånding spe-
ciÔ¨Åc heuristics for different models, even though the use of
EIG does require efÔ¨Åcient numerical realization to be suitable
for non-trivial models [51]. For an optimal ci, it corresponds
to the maxima of the EIG based on the previous measurements
D0= (d1;:::;di 1), i.e.,ci=argmaxc2CEDist KL(c;D0). In
our setting, the EIG can be written as
EDist KL(c;D0) = Pr(1jD0;c)Z
Pr(xjD0) log[ Pr(1jx;c)]dx
 [1 Pr(1jD0;c)]Z
Pr(xjD0) log[1 Pr(1jx;c)]dx;(5)
where Pr (1jD0;c) =R
Pr(1jx;c)Pr(xjD0)dxis the predicted
probability [53] of detecting the state j1ibased on the col-
lected intermediate results.
In summary, our real-time BED can be realized in the fol-
lowing steps: (i) Initially, we designate a suitable prior dis-
tribution Pr 0(x)to conduct the iterative measurements. (ii)
For each iteration eiinE, the optimal control parameter ci
is found via the EIG. (iii) With this optimized control param-
eter, we carry out the measurement and obtain the result di,
which can be further used to update the probability distribu-
tion Pr (xjD). (iv) Once our criteria are met, we stop the iter-
ation and conclude the results. In detail, during this whole
process, the numerical calculations necessary for the BED
are realized by employing the sequential Monte Carlo (SMC)
method [51, 59] and the simulations of the experiments are
performed using QuTiP [60].
III. APPLICATIONS OF THE BAYESIAN
EXPERIMENTAL DESIGN
A. NV center weakly coupled to nuclear spins
For the sake of providing evidence of the feasibility of our
scheme, we consider the application to a speciÔ¨Åc physical sys-
tem, namely a single NV-center spin in diamond as a sensing
probe. By applying an external magnetic Ô¨Åeld, one can lift the
degeneracy of the spin states ms=1of the ground-state
manifold and encode the probe-qubit basis fj0i,j1igin the
two sublevels ms= 0; 1. The entire system then consists of
this probe and multiple13C nuclear spins [52] in the vicinity of
the NV center. We consider the Larmor frequency of all these
nuclear spins to be !L=2= 429:4kHz and neglect the weak
interactions between different nuclear spins. Due to the oscil-
lating nature of the signal produced by the hyperÔ¨Åne interac-
tions, we adopt a quantum lock-in ampliÔ¨Åer protocol [52, 61].
Furthermore, we assume that the coherence time of the probe
qubit is extended to the value T2by employing an XY8-4
dynamical-decoupling sequence [62]. To take the residual de-
coherence due to environmental effects into account, in our3
FIG. 1. Simulation of the BED for sensing nC= 2 nuclear spins after Nshot= 1050 single-shot experiments are conducted. The exact
values of parameters to be estimated are !h=2= (47:0;83:8)kHz and= (30;21). (a) Results of the single-shot measurements: the
averaged measured results dversus(orange circles), a histogram of the number of measurements N
shotfor every(Green bars), and
the number of measurements N
shotper(green crosses). The dips of dcorrespond to the peaks of N
shot, showing that BED improves the
efÔ¨Åciency by spending most resources on a subset of favorable control parameter values. (b) and (d) Histogram of the posterior distribution
Pr(!h1;!h2jD)and Pr (1;2jD)in the form of marginal distributions based on the SMC method: Region with an approximately 68:27%
prediction conÔ¨Ådence (black dashed ellipse), results of the estimation parameters reported by the BED (purple circle), and the exact values of
the estimation parameters (gray cross). (c) Comparison between results of the BED and exact values in terms of the population of the probe:
Estimated population P0reported by the BED (blue solid line) and exact values of the population (orange dashed line).
simulations we add a pure dephasing to the coherent dynam-
ics. The resulting time evolution of the system density opera-
tor^is thereby described by ^(t) = exp(Lt)^(0), where the
action ofLis given by
L^=1
i~nCX
q=1[j0ih0j^H0q+j1ih1j^H1q;^]
+1
4T2(2^z^^y
z ^y
z^z^ ^^y
z^z); (6)
where a total of nCnuclear spins are taken into consideration.
The Hamiltonians of the hyperÔ¨Åne interaction have the form
^H0q=~!L^zq; (7)
^H1q=~[!hqcos(q) +!L]^zq+~!hqsin(q)^xq;(8)
where ^and^q(=x;y;z )denote the Pauli operators for
the qubit probe and the qth nuclear spin, respectively. In this
system, the magnitudes !h= (!h1;:::;! hnC)and the angles= (1;:::;nC)of the hyperÔ¨Åne interaction between the
NV-center electron spin and the nuclear spins are the param-
eters to be estimated. This means for the present scenario we
havex= (!h;). On the other hand, the control parameter
of the experiment is which corresponds to the free evolu-
tion time 2between the decoupling pulses (for details see
Appendix A).
In terms of the incoherent time evolution generated by
Eq. (6) and the dynamical-decoupling sequence XY8-4 [62]
with a total evolution time of 64, when assuming instanta-
neous pulses, the expression jh0j^U(x;ci)j0ij2is replaced by
h0j[exp(64Li)j0ih0j]j0i, where we keep in mind that the gen-
eratorLdepends on the parameters (!h;). The likelihood
function (3) of a single-shot measurement event can thereby4
be derived and has the form
Pr(0j(!h;);i) =p0 2p1+ 2
3
+p0+p1 1
2
M((!h;);i) +1
3
e (64i=T2);(9)
and Pr (1j(!h;);i) = 1 Pr(0j(!h;);i). Here,we have
deÔ¨Åned
M((!h;);i) =nCY
q=18
><
>:1 22
4sin(16q)
cos
q
23
52
2
4!hqsin(q) sin
~!qi
2
sin !Li
2
~!q3
529
>=
>;(10)
where the phases qare determined by
cos(q) = cos(~!qi) cos(!Li)
 !hqcos(q) +!L
~!qsin(~!qi) sin(!Li)(11)
and~!q= [!2
hq+!2
L+ 2!hq!Lcos(q)]1=2[52].
According to the SMC method, a probability distribution
can be represented by a set of npparticles [59, 63]. Utilizing
such a method combined with Eq. (1), one obtains
Pr((!h;)jD)npX
k=1wk((!h;) (!hk;k)); (12)
in whichwk, fulÔ¨ÅllingPnp
kwk= 1, and (!hk;k)are the
weight and location of the kth particle, respectively. Com-
bined with Eq. (5), the EIG can thereby be written as
EDist KL(;D0) = 
1 npX
k=1wkPr(0j(!hk;k);)
npX
k=1wklog[1 Pr(0j(!hk;k);)]
 npX
k=1wkPr(0j(!hk;k);)
npX
k=1wklog[Pr(0j(!hk;k);)]:(13)
Furthermore, by virtue of Eq. (13) and Eq. (1), for the ith run
of the experiment, we can Ô¨Ålter the optimal control parame-
teri=argmaxEDist KL(;D0)to accumulate measurement
eventsEand obtain the posterior distribution Pr ((!h;)jD).
Finally, the average of the parameters (!h;)can be calcu-
lated according to !h=Pnp
k=1wk!hkand=Pnp
k=1wkk.
The corresponding uncertainties !h= (!h1;:::; !hnC)
and= (1;:::; nC)can be derived from the particlesin the SMC method as
2!hq=X
kwk(!hqk !hq)2; (14)
2q=X
kwk(qk q)2: (15)
For the sake of evaluating the performance of our BED,
we Ô¨Årst set the number of nuclear spins to nC= 2 as an ex-
ample and simulate experiments based on these settings un-
der an XY8-4 dynamical-decoupling sequence with a deco-
herence time T2= 3ms. The control parameter takes val-
ues ranging from 1s to10s with a step size = 10 ns,
i.e.,C=f1;1:01;1:02;:::; 10gs, whereas the pulse ampli-
tudes satisfy the condition tpulse. To reduce the num-
ber of iterations before convergence, faithful read-out oper-
ations are used, viz., p0=p1= 1. The EIG is updated
once every 15 single-shot measurements to take full advan-
tage of the computational resources. Additional details of the
simulation setup are reported in Appendix A and the values
of the parameters to be estimated that we use are !h=2=
(47:0;83:8)kHz and= (30;21)based on realistic pa-
rameters reported in Ref. [52]. During this experiment, for
each single-shot event ei, we Ô¨Årst conduct the measurement
withi, record the result di, and then update Pr ((!h;)jD)
accordingly, where the choice of iis optimized via EDist KL.
AfterNshot= 1050 measurements, the number of measure-
mentsN
shotfor the control parameter inCare plotted in
Fig. 1(a) as crosses. From this, we obtain the averaged re-
sults d(empty circles) by d=PN
shot
jdj=N
shot, wheredj
is thejth result of all single-shot measurements conducted
at. It can be seen that the dips of dcorrespond to the
peaks ofN
shot. This indicates that our BED improves the
efÔ¨Åciency by spending most resources on measurements un-
der an optimized subset of control-parameter values. Further-
more, we plot the posterior distribution Pr ((!h;)jD)after
Nshot= 1050 in Fig. 1(b) and (d) in the form of marginal
distributions. Based on Pr ((!h;)jD), we obtain the Ô¨Ånal
estimation results of (!h;)and show the population of the
probeP0=h0j[exp(64L)j0ih0j]j0i, obtained under the dy-
namics generated by Eq. (6) in Fig. 1(c) as a blue solid line.
Moreover, we also depict the population P0derived by the
theoretical values of (!h;)in Fig. 1(c) as an orange dashed
line. The coinciding behavior of the two curves demonstrates
the validity of our scheme.
As a next step, in order to evaluate the relative accuracy
of our BED, we repeat this experiment 300 times. Dur-
ing thejth repetition, we record !hj,j,!hj, and j
against the number of single-shot measurements Nshot. Here,
we use the mean relative uncertainties given by 2!hj=PnC
q=12!hqj=nCand2j=PnC
q=12qj=nC. After 300
repetitions, we calculate the median !hRMS of the recorded
relative uncertainty (2!h1;:::; 2!h300)and compare the
results (empty squares) with those of the traditional non-
adaptive protocol without a control parameter optimization
(empty circles) in Fig. 2. At Nshot= 1050 (highlighted by
a dashed square), an averaged shot count per unique is1:17,
i.e., N
shot=Nshot=jCj 1:17. Here, we Ô¨Ånd that the non-
adaptive method has failed to meet a relative uncertainty goal5
FIG. 2. Comparison of the median of the averaged relative uncer-
tainty !hRMS between the BED and a non-adaptive protocol for
sensingnC= 2 nuclear spins with 300 runs of the experiment. Or-
ange squares: !hRMS for the BED in dependence of the number
of single-shot measurements Nshot. Blue empty circles: !hRMS for
a non-adaptive protocol versus Nshot. The exact values of (!h;)
are the ones from Fig. 1. At Nshot= 1050 (highlighted by the
dashed square), an averaged shot count per unique is1:17. The
non-adaptive method fails to meet a relative uncertainty goal of
!hRMS10% , whereas the BED achieves !hRMS<2%.
of!hRMS10% at such N
shot. In contrast, our BED can
achieve a relative uncertainty !hRMS<2%, which mani-
fests that our BED is capable of utilizing the limited experi-
mental resources efÔ¨Åciently.
Furthermore, in order to quantify the performance of the
BED in this model, we also randomly generate Nbench= 900
different combinations of (!h;)withnC= 2 . Instead
of repeating experiments under the same (!h;)multiple
times, we carry out one experiment for each combination of
(!h;)generated beforehand. After conducting the experi-
ments based on Nbench combinations, we denote the median of
the mean relative uncertainties (2!h1;:::; 2!hNbench)and
(21;:::; 2Nbench)as!hRMS andRMS. We then plot
!hRMS andRMS of our BED versus Nshotin Fig. 3 as
orange empty squares. For comparison, we simulate exper-
iments of using a non-adaptive protocol under the same set-
tings, and plot their scaling of the relative uncertainties in
Fig. 3 as blue empty circles. The general relative uncer-
tainty RMS= maxf!hRMS;RMSgbased on our method
is2:6%while for the non-adaptive method we Ô¨Ånd RMS=
13:8%atNshot= 1350 . Overall, by adopting our BED, a re-
duction of over 90% inNshotfor the same relative uncertainty
can be observed.
To further investigate the abilities of our BED, we repeat
the above test with nC= 3 neighboring nuclear spins and
plot!hRMS as well as RMS versusNshotin Fig. 4. For
!hRMS , a reduction of 65% is observed at Nshot= 9975 ,
while a reduction of 72% inRMScan be seen at the same
shot count. This shows that our BED signiÔ¨Åcantly improves
the estimation accuracy of the parameters and further demon-
FIG. 3. Comparison of the median of the averaged relative uncertain-
ties!hRMS andbetween the BED (orange squares) and a non-
adaptive protocol (blue circles) for sensing nC= 2 nuclear spins
based onNbench= 900 different combinations of (!h;). Top: De-
pendence of !hRMS on the number of single-shot measurements
Nshot. Bottom: Dependence of RMSonNshot. The set of exact
parameters can be found at Appendix A.
FIG. 4. Comparison of the performance of the BED (orange squares)
with a non-adaptive protocol (blue circles) for sensing nC= 3 nu-
clear spins based on Nbench= 1140 different combination of (!h;).
Top: Median of the averaged relative uncertainty !hRMS versus the
number of single-shot measurements Nshot. Bottom: Median of the
averaged relative uncertainty RMSversusNshot.
strates the feasibility of our scheme.
B. Oscillating magnetic Ô¨Åeld detection with NV center
Not only is our BED useful when an accurate likelihood
function is available, but it also has advantages over traditional
methods when combined with imperfect likelihood functions.
In this subsection, we discuss our BED in a scenario where6
a qubit probe encoded in a single NV-center spin is used to
sense an oscillating magnetic Ô¨Åeld.
The probe is subject to an external oscillating magnetic Ô¨Åeld
as well as additional sources of noise. In this case, the effec-
tive Hamiltonian of the probe after aligning the NV-center axis
with the magnetic Ô¨Åeld [64] can be written as
^Heff(t) =~B
2h(t) cos(!t+')^z+^Hnoise(t); (16)
in which=2= 28:03MHz/mT is the gyromagnetic ratio
of the electron spin and h(t)is the modulation function deter-
mined by the dynamical-decoupling pulses. In this case, the
parameters that have to be estimated in order to determine the
dynamics of the system are x= (B;!;' ), i.e., the magnitude,
frequency, and initial phase of the magnetic Ô¨Åeld to be mea-
sured. However, since we assume that we do not record times-
tamps for each measurement, we have to average over the
phase'(see Appendix B). Effectively, the parameters to be
estimated are thereby only (!;B). Furthermore, ^Hnoise(t)in
the above Hamiltonian represents the effective action of noise
on the probe and we apply an XY8 dynamical-decoupling
pulse sequence [61] in order to protect the probe from this un-
wanted environmental inÔ¨Çuence to some degree [9]. The dy-
namical decoupling sequences used here serve two purposes:
amplifying the oscillating magnetic Ô¨Åeld being measured and
extending the coherence time of the sensor. The time re-
lated to the free-evolution time of the pulse sequence, again,
is the control parameter. As shown in Appendix B, if we as-
sume a coherence time T2, the averaged ideal probability (2)
of preserving the initial state j0ireads
Prideal(0j(!;B);i) =1
2[1 +J0(ai)e (16i=T2)]; (17)
with the Bessel function J0and where we have deÔ¨Åned
ai=16B
!sin3!i
2X
k=3;5;11;13cos!i
2k
: (18)
However, to attain a suitable numerical efÔ¨Åciency in our im-
plementation, we truncate the series expansion of the Bessel
function at the sixth order. With the above ideal probability,
the likelihood function (3) then takes the form
Pr(0j(!;B);i) =p0 p1+ 1
2
+p0+p1 1
2
1 1
4a2
i+1
64a4
i 1
2304a6
i
e (16i=T2)
(19)
and Pr (1j(!;B);i) = 1 Pr(0j(!;B);i). Here, we men-
tion that this is a faithful modeling of the system only when
N
shot!1 due to the average over '. Using the SMC method
FIG. 5. Comparison of the performance of the BED (orange squares)
with a non-adaptive protocol (blue circles) for sensing an oscillating
magnetic Ô¨Åeld with Nbench= 400 different combinations of (!;B).
Top: Median of the relative uncertainty !versus the number of
single-shot measurements Nshot. Bottom: Median of the relative un-
certainty BversusNshot.
in the same manner as in Eq. (12), the EIG becomes
EDist KL(;D0) = 
1 npX
k=1wkPr(0j(!k;Bk);)
npX
k=1wklog[1 Pr(0j(!k;Bk);)]
 npX
k=1wkPr(0j(!k;Bk);)
npX
k=1wklog[Pr(0j(!k;Bk);)];(20)
and we choose Nbench= 400 different combinations of (!;B)
as well as the coherence time T2= 170s to simulate the
experiment. The set of possible values of the control pa-
rameterisC=f0:51;0:52;0:53;:::; 7gs. In order to
reduce the number of measurements before convergence we
setp0=p1= 1 and further details are presented in Ap-
pendix A. After the simulation, we plot the medians of the
relative uncertainty !andBversusNshotfor our BED (or-
ange squares) and the traditional non-adaptive method (blue
circles) in Fig. 5. Based on the benchmark, we Ô¨Ånd that our
BED outperforms the traditional method even with an imper-
fect likelihood function, showing its feasibility for this sce-
nario.
IV . ACCELERATED COMPUTATION
Despite the fact that BED can utilize experimental re-
sources efÔ¨Åciently, it remains a challenge to avoid adverse7
effects from the computational consumption. When applied
to the Ô¨Åeld of quantum sensing in actual laboratory settings,
one might Ô¨Ånd that the increase in computational time can
outweigh the time saved by using optimized measurements.
Therefore, several possible solutions have been put forward
to mitigate this issue, such as applying BED to simple sys-
tems with suitable heuristics [28, 47] and resorting to com-
puter clusters [43]. However, in more generalized systems,
previous efforts cannot reduce the time cost of a BED effec-
tively [43, 45]. Here, we propose that a single consumer-grade
GPGPU along with an asynchronous version of our BED can
greatly reduce or eliminate the computational overhead for
more general systems and demonstrate the feasibility within
the model introduced in Sec. III A.
A. GPGPU acceleration
We Ô¨Årst give an overview of the computing resources for
our BED. The computational resources required by our BED
scale linearly with the number of particles npused in the SMC
method. For the system discussed in Sec. III A, the averaged
time spent by the probe during a single-shot measurement is
t270s, excluding initialization and read-out. The like-
lihood function Eq. (9) is evaluated npjCj 1:95105times
per measurement based on our EIG usage and np= 3200 .
These parameters mean a throughput of roughly 7:2108
evaluations per second for the likelihood function, which can
easily overwhelm a CPU. Fortunately, the performance of a
single GPGPU can satisfy such requirements without the bur-
den of setting up a computer cluster. However, existing al-
gorithms utilizing GPGPUs [65] only have inefÔ¨Åcient imple-
mentations. To deal with this problem, we design the algo-
rithms and relevant programs in-house such that both the SMC
method and the EIG efÔ¨Åciently run on the GPGPU [66]. Vec-
torization [67], usage of mixed-precision arithmetic [68], as
well as other techniques are adopted to fully accommodate the
power of the GPGPU. In addition, the fragmented communi-
cation between the GPGPU and other parts of the instruments
is minimized to reduce the overhead. As a result, our GPGPU
implementation signiÔ¨Åcantly reduces the time cost of the BED
without requiring expensive equipment.
To demonstrate these improvements, we retest the exper-
iments shown in Fig. 1. For comparison, an eight-core In-
tel Core i7 CPU running at 4:6GHz and an NVIDIA RTX
2080 Ti GPGPU are used, respectively. Numba [69] is used
for the CPU, while CuPy [70] provides software access to
the GPGPU. The experiments are repeated 10times before
recording the averaged time spent by both types of hardware.
In each repetition, Nshot= 18000 measurements are con-
ducted, and the evolution time of the probe needs at least
Nshott4:8s. We Ô¨Ånd that the CPU spends 223:22s per ex-
perimental run and GPGPU completes the same computation
within merely 4:26s. The CPU can only achieve a throughput
of3:47107evaluations per second after ruling out overhead,
while the GPGPU can reach 7:18109evaluations per sec-
ond in throughput. Based on these results, hundreds of high
performance CPU cores are needed to match the performance
FIG. 6. Comparison of the performance between the normal (orange
squares) and asynchronous (red crosses) version of the BED for sens-
ingnC= 2 nuclear spins based on Nbench= 900 different combina-
tions of (!h;). The asynchronous version of the BED has a delay
ofTt4ms in terms of the collected measurement results. Top:
Median of relative uncertainty !hRMS versus the number of single-
shot measurements Nshot. Bottom: Median of the relative uncertainty
RMSversusNshot.
offered by a single GPGPU, which is consistent with the high
performance computer setups in Ref. [43]. This also proves
that the practicality of our BED can be signiÔ¨Åcantly improved
by our GPGPU implementation.
B. Asynchronous operation
While GPGPUs can reduce the computation time to lev-
els comparable to the time spent by the probe, the absolute
sensitivity of the BED is still vulnerable to computational
overhead. Traditionally, instruments need to wait for opti-
mized control parameters before measurements in the BED
setups, which decreases the utilization of experimental time.
As a result, improvements in the absolute sensitivity of the
BED are degraded as reported in Ref. [45]. Here, we pro-
pose an asynchronous version of a BED in an effort to hide
computation time. In our asynchronous BED setup, the in-
struments no longer wait for optimal controls inferred from
the EIG EDist KL(c;D0). The optimization process starts be-
fore the instruments complete their operation for the previ-
ous iteration, such that the optimized control parameters will
be available upon the beginning of the next iteration. As a
compromise, the control parameters of the instruments are
based on all but the most recent measurements, i.e., ci=
argmaxc2CEDist KL(c;D0
old). Here,D0old= (d1;:::;di 1 T)
signiÔ¨Åes that the results of the last Tmeasurements are ig-
nored during the optimization. As we will show, this tech-
nique has minimal negative impact on the relative uncertainty
of the parameter-estimation results.
To test the degradation introduced by this technique, we
rerun the test from Sec. III A with nC= 2 andT= 15 af-8
ter changing the EIG to EDist KL(c;D0
old). A sufÔ¨Åciently large
delay [28] of Tt4ms is in place. In Fig. 6, we com-
pare the !hRMS andRMSobtained from an asynchronous
operation to those from Fig. 3. It can be observed that the
comparison shows only minimal discrepancies and that the
degradation caused by our asynchronous operation is negligi-
ble. By combining our asynchronous operation with the use
of a GPGPU, we can eliminate the overhead of our BED and
obtain a reduction of up to 90% in the total time cost, as com-
pared with traditional methods.
V . CONCLUSION
In this work, we have proposed a practical real-time adap-
tive quantum-sensing protocol guided by Bayesian experi-
mental design. Instead of heuristics, the model-agnostic EIG
was used as the utility function. The performance of this pro-
tocol was analyzed for sensing nuclear spins and oscillating
magnetic Ô¨Åelds using an NV-center probe. Compared with
traditional methods, our protocol can signiÔ¨Åcantly reduce the
required experimental time and improve the sensitivity of the
measurements. Besides, we demonstrated two techniques to
reduce the overhead brought by computation and communica-
tion delay. We introduce a GPGPU acceleration and an asyn-
chronous operation to further enhance the performance of the
Bayesian experimental design and obtain a reduction of up to
90% in total time cost. With this signiÔ¨Åcant reduction, we be-
lieve the scheme presented here supplies viable prospects for
the improvement of quantum-sensing experiments.
VI. ACKNOWLEDGMENTS
This work is supported by the National Natural Sci-
ence Foundation of China (Grant No. 12161141011,
No. 11874024, and No. 11690032), the National Key R &D
Program of China (Grant No. 2018YFA0306600), the Fun-
damental Research Funds for the Central Universities, the
Open Project Program of the Shanghai Key Laboratory of
Magnetic Resonance, and the Interdisciplinary Program of
the Wuhan National High Magnetic Field Center (Grand No.
WHMFC202106). D.-X. Li is also funded by the China Post-
doctoral Science Foundation (Grant No. 2021M690062).
Appendix A: Simulation setup details
For all simulations done in this paper, the basic dynamical-
decoupling sequence with eight pulse units is given by
Ry(=2)  Rx() 2 Ry() 2 Rx() 2 
Ry() 2 Ry() 2 Rx() 2 Ry() 2 
Rx()  Ry(3=2), whereR()with=x;ydenotes
a rotation of the probe state around the axis of the Bloch
sphere about an angle , while the probe evolves freely be-
tween pulses. The optimized iare produced in small batches
Cbatch= (i;i+1;:::;i+nbatch 1). The elements of C batchare
sampled from the distribution Pr batch()/[EDist KL(;D0)]p,in whichp= 6is determined by empirical tests. For the sim-
ulations in Sec. III A we choose nbatch= 15 whilenbatch= 30
is set for the experiments in Sec. III B.
To generate exact values of parameters that we want to
estimate in Sec. III, a combination of sweeping and ran-
domization is used. In detail, for the exact values used in
Sec. III A, the hyperÔ¨Åne couplings !h=2are generated by
sweeping through 19:0 83:4kHz, and the angles are sam-
pled from a uniform distribution on [0;2]. In Sec. III B, on
the other hand, we Ô¨Årst generate 20different frequencies !=2
by sweeping from 111kHz to 1:27MHz and then we sweep
the magnetic-Ô¨Åeld strength Bfrom 0:031!= to0:169!= for
each value of !.
Finally, the technical aspects of our numerical simulation
setup work as follows. We use QInfer [65] with modiÔ¨Åcations
crucial for high throughput GPGPU operations. The bounds
for the estimation parameters are the same for both our BED
and the traditional method. In Sec. III A, for both methods the
upper and lower bounds for the elements of !h=2are given
by6kHz to 265kHz, respectively, and the prior distribution
given to our BED is a uniform distribution for both !hand
. In Sec. III B, B=! ranges from 0:013to0:177, while!
stays valid as long as 79:6kHz!=21:35MHz. We
note that while our use of the EIG as the utility function is not
sensitive to imprecise prior probabilities [71], imprecise pri-
ors might need non-trivial treatment for some tasks, such as
quantum-sensing tasks with few experimental runs. Discus-
sions on such topics can be found in Ref. [72]. In all simula-
tions, the number of particles used in the SMC method stays
constant throughout the experiment to simplify the discussion
related to computational resources in Sec. IV A. For experi-
ments conducted in Sec. III A, np= 6400 is used fornC= 3,
as the increase in computation time is tolerable (the com-
putation time increases 31% when compared with the time
recorded for nC= 2andnp= 3200 ). For other examples and
demonstrations, np= 3200 is used. As for resamplers used
in the SMC method, we chose the Liu-West resampler [73]
witha= 0:98and a naive remapping technique to mitigate
ambiguities in the particle distributions. We note that a differ-
ent resampler, such as the one proposed in Ref. [74], might be
more suitable for these models. The data of our simulations
are available in the [75].
For the traditional method being compared with, we use the
same SMC method and the same estimator as those used in the
BED. We do not use least-squared methods due to their fre-
quent divergence over the exact values (according to our test-
ing, least-squares-based estimations seldom converge to exact
values even when the exact population numbers are supplied).
This behavior of poor performance can be attributed to the
high dynamic-range and the non-convexity of our demonstra-
tions. In addition, the traditional method does not have ac-
cess to utility function. Instead, a random number generator
governs the control parameters used for each single-shot mea-
surement. Doing so can improve consistency in results when
averaged shot count per unique control parameter is small,
while having the same effects as parameter-scanning once suf-
Ô¨Åciently large amount of measurements are conducted.9
Appendix B: Likelihood function of the probe sensing AC
magnetic Ô¨Åeld
A rigorous formalism of the dynamics of the population of a
spin probe subject to an external signal and noise can be found
in Refs. [9, 76]. Here, we provide, for the sake of complete-
ness, an elementary yet self-contained derivation of Eq. (17).
Owing to the XY8 dynamical-decoupling pulse sequence, the
probe is protected from external noises with low frequencies,
and the modulation function becomes
h(t) =(
1; t2[(4k 1);(4k+ 1))
 1; t2[(4k+ 1);(4k+ 3)):(B1)
The probe is initialized in the state j0i, and if we neglect ad-
ditional decoherence, ^Hnoise(t)will effectively not contribute
to the probability of the probe preserving j0i. If we denote the
state at time t= 16, i.e., after the pulse sequence, by jiwe
thus Ô¨Ånd the probability
jh0jij2=1
2[1 + cos(acos(8!+'))] (B2)at the read-out, with agiven in Eq. (18).
As mentioned in the main text, no timestamps are recorded
for each measurement and the initial phase 'must there-
fore be averaged out. Assuming the intervals between
measurements to follow a uniform distribution, the aver-
aged probability can be obtained according to jh0jij2=R2
0jh0jij2d'=2and reads
jh0jij2=1
2[1 +J0(a)] (B3)
with the Bessel function J0. Equation (17) is then obtained
by adding an exponential decay toward a probability 1=2with
the coherence time T2to the expression above. Since in our
situation we have a1, we employ the truncated series ex-
pansion
J0(a) = 1 1
4a2+1
64a4 1
2304a6+O(a8) (B4)
of the Bessel function for the sake of numerical efÔ¨Åciency.
[1] D. Leibfried, M. D. Barrett, T. Schaetz, J. Britton, J. Chiaverini,
W. M. Itano, J. D. Jost, C. Langer, and D. J. Wineland, Toward
Heisenberg-limited spectroscopy with multiparticle entangled
states, Science 304, 1476 (2004).
[2] J. Aasi, J. Abadie, B. P. Abbott, et al. , Enhanced sensitivity of
the ligo gravitational wave detector by using squeezed states of
light, Nat. Photon. 7, 613 (2013).
[3] N. Huntemann, C. Sanner, B. Lipphardt, C. Tamm, and E. Peik,
Single-Ion Atomic Clock with 310 18Systematic Uncer-
tainty, Phys. Rev. Lett. 116, 063001 (2016).
[4] J. M. Taylor, P. Cappellaro, L. Childress, L. Jiang, D. Budker,
P. R. Hemmer, A. Yacoby, R. Walsworth, and M. D. Lukin,
High-sensitivity diamond magnetometer with nanoscale reso-
lution, Nat. Phys. 4, 810 (2008).
[5] C. Granata and A. Vettoliere, Nano Superconducting Quantum
Interference device: A powerful tool for nanoscale investiga-
tions, Phys. Rep. 614, 1 (2016).
[6] T. Gefen, A. Rotem, and A. Retzker, Overcoming resolution
limits with quantum sensing, Nat. Commun. 10, 1 (2019).
[7] C. Bonato, M. S. Blok, H. T. Dinani, D. W. Berry, M. L.
Markham, D. J. Twitchen, and R. Hanson, Optimized quan-
tum sensing with a single electron spin using real-time adaptive
measurements, Nat. Nanotechnol. 11, 247 (2016).
[8] Y . Chu, Y . Liu, H. Liu, and J. Cai, Quantum Sensing with a
Single-Qubit Pseudo-Hermitian System, Phys. Rev. Lett. 124,
020501 (2020).
[9] C. L. Degen, F. Reinhard, and P. Cappellaro, Quantum sensing,
Rev. Mod. Phys. 89, 035002 (2017).
[10] H. Vahlbruch, M. Mehmet, K. Danzmann, and R. Schnabel,
Detection of 15 dB Squeezed States of Light and their Appli-
cation for the Absolute Calibration of Photoelectric Quantum
EfÔ¨Åciency, Phys. Rev. Lett. 117, 110801 (2016).
[11] J. Du, X. Rong, N. Zhao, Y . Wang, J. Yang, and R. B. Liu, Pre-
serving electron spin coherence in solids by optimal dynamical
decoupling, Nature 461, 1265 (2009).
[12] M. Hirose, C. D. Aiello, and P. Cappellaro, Continuous dynami-cal decoupling magnetometry, Phys. Rev. A 86, 062320 (2012).
[13] N. Zhao, S.-W. Ho, and R.-B. Liu, Decoherence and dynamical
decoupling control of nitrogen vacancy center electron spins in
nuclear spin baths, Phys. Rev. B 85, 115303 (2012).
[14] L. M. Pham, N. Bar-Gill, C. Belthangady, D. Le Sage, P. Cap-
pellaro, M. D. Lukin, A. Yacoby, and R. L. Walsworth, En-
hanced solid-state multispin metrology using dynamical decou-
pling, Phys. Rev. B 86, 045214 (2012).
[15] S. Schmitt, T. Gefen, F. M. St√ºrner, T. Unden, G. Wolff,
C. M√ºller, J. Scheuer, B. Naydenov, M. Markham, S. Pezzagna,
J. Meijer, I. Schwarz, M. Plenio, A. Retzker, L. P. McGuinness,
and F. Jelezko, Submillihertz magnetic spectroscopy performed
with a nanoscale quantum sensor, Science 356, 832 (2017).
[16] N. Jouppi, C. Young, N. Patil, and D. Patterson, Motivation for
and Evaluation of the First Tensor Processing Unit, IEEE Micro
38, 10 (2018).
[17] A. Paszke, S. Gross, F. Massa, A. Lerer, J. Bradbury,
G. Chanan, T. Killeen, Z. Lin, N. Gimelshein, L. Antiga,
A. Desmaison, A. Kopf, E. Yang, Z. DeVito, M. Raison, A. Te-
jani, S. Chilamkurthy, B. Steiner, L. Fang, J. Bai, and S. Chin-
tala, Pytorch: An imperative style, high-performance deep
learning library, in Adv. Neural Inf. Process. Syst. , V ol. 32 (Cur-
ran Associates, Inc., 2019).
[18] J. Devlin, M.-W. Chang, K. Lee, and K. Toutanova, BERT: Pre-
training of deep bidirectional transformers for language under-
standing, in NAACL HLT 2019 (Association for Computational
Linguistics, Minneapolis, Minnesota, 2019) pp. 4171‚Äì4186.
[19] D. Silver, A. Huang, C. J. Maddison, A. Guez, L. Sifre, G. Van
Den Driessche, J. Schrittwieser, I. Antonoglou, V . Panneershel-
vam, M. Lanctot, S. Dieleman, D. Grewe, J. Nham, N. Kalch-
brenner, I. Sutskever, T. Lillicrap, M. Leach, K. Kavukcuoglu,
T. Graepel, and D. Hassabis, Mastering the game of Go with
deep neural networks and tree search, Nature 529, 484 (2016).
[20] T. Wolf, L. Debut, V . Sanh, J. Chaumond, C. Delangue,
A. Moi, P. Cistac, T. Rault, R. Louf, M. Funtowicz, J. Davi-
son, S. Shleifer, P. von Platen, C. Ma, Y . Jernite, J. Plu, C. Xu,10
T. Le Scao, S. Gugger, M. Drame, Q. Lhoest, and A. Rush,
Transformers: State-of-the-Art Natural Language Processing,
inProceedings of the 2020 Conference on Empirical Meth-
ods in Natural Language Processing: System Demonstrations
(Association for Computational Linguistics, Stroudsburg, PA,
USA, 2020) pp. 38‚Äì45.
[21] L. Bertinetto, J. Valmadre, J. F. Henriques, A. Vedaldi, and
P. H. S. Torr, Fully-convolutional siamese networks for object
tracking, in Computer Vision ‚Äì ECCV 2016 Workshops , edited
by G. Hua and H. J√©gou (Springer International Publishing,
Cham, 2016) pp. 850‚Äì865.
[22] V . Dunjko, J. M. Taylor, and H. J. Briegel, Quantum-Enhanced
Machine Learning, Phys. Rev. Lett. 117, 130501 (2016).
[23] J. Biamonte, P. Wittek, N. Pancotti, P. Rebentrost, N. Wiebe,
and S. Lloyd, Quantum machine learning, Nature 549, 195
(2017).
[24] M. R. Hush, Machine learning for quantum physics, Science
355, 580 (2017).
[25] G. Torlai and R. G. Melko, Machine-Learning Quantum States
in the NISQ Era, Annu. Rev. Condens. Matter Phys. 11, 325
(2020).
[26] M. Raghu, B. Poole, J. Kleinberg, S. Ganguli, and J. Sohl-
Dickstein, On the expressive power of deep neural networks, in
Proceedings of the 34th International Conference on Machine
Learning , PMLR, V ol. 70, edited by D. Precup and Y . W. Teh
(PMLR, 2017) pp. 2847‚Äì2854.
[27] M. I. Jordan and T. M. Mitchell, Machine learning: Trends,
perspectives, and prospects, Science 349, 255 (2015).
[28] R. Santagati, A. A. Gentile, S. Knauer, S. Schmitt, S. Pae-
sani, C. Granade, N. Wiebe, C. Osterkamp, L. P. McGuin-
ness, J. Wang, M. G. Thompson, J. G. Rarity, F. Jelezko, and
A. Laing, Magnetic-Ô¨Åeld learning using a single electronic spin
in diamond with one-photon readout at room temperature, Phys.
Rev. X 9, 021019 (2019).
[29] S. Yu, F. Albarr√°n-Arriagada, J. C. Retamal, Y . T. Wang,
W. Liu, Z. J. Ke, Y . Meng, Z. P. Li, J. S. Tang, E. Solano,
L. Lamata, C. F. Li, and G. C. Guo, Reconstruction of a Pho-
tonic Qubit State with Reinforcement Learning, Adv. Quantum
Technol. 2, 1 (2019).
[30] A. S. Barnard, Diamond standard in diagnostics: nanodiamond
biolabels make their mark, Analyst 134, 1751 (2009).
[31] D. Le Sage, K. Arai, D. R. Glenn, S. J. Devience, L. M. Pham,
L. Rahn-Lee, M. D. Lukin, A. Yacoby, A. Komeili, and R. L.
Walsworth, Optical magnetic imaging of living cells, Nature
496, 486 (2013).
[32] J. Cai, F. Jelezko, M. B. Plenio, and A. Retzker, Diamond-
based single-molecule magnetic resonance spectroscopy, New
J. Phys. 15, 013020 (2013).
[33] T. Staudacher, F. Shi, S. Pezzagna, J. Meijer, J. Du, C. A. Mer-
iles, F. Reinhard, and J. Wrachtrup, Nuclear Magnetic Reso-
nance Spectroscopy on a (5-Nanometer) 3 Sample V olume, Sci-
ence 339, 561 (2013).
[34] C. M√ºller, X. Kong, J.-M. Cai, K. Melentijevi ¬¥c, A. Stacey,
M. Markham, D. Twitchen, J. Isoya, S. Pezzagna, J. Meijer,
J. F. Du, M. B. Plenio, B. Naydenov, L. P. McGuinness, and
F. Jelezko, Nuclear magnetic resonance spectroscopy with sin-
gle spin sensitivity, Nat. Commun. 5, 4703 (2014).
[35] D. B. Bucher, D. R. Glenn, H. Park, M. D. Lukin, and R. L.
Walsworth, Hyperpolarization-Enhanced NMR Spectroscopy
with Femtomole Sensitivity Using Quantum Defects in Dia-
mond, Phys. Rev. X 10, 021053 (2020).
[36] R. Schirhagl, K. Chang, M. Loretz, and C. L. Degen, Nitrogen-
Vacancy Centers in Diamond: Nanoscale Sensors for Physics
and Biology, Annu. Rev. Phys. Chem. 65, 83 (2014).[37] P.-Y . Hou, L. He, F. Wang, X.-Z. Huang, W.-G. Zhang, X.-L.
Ouyang, X. Wang, W.-Q. Lian, X.-Y . Chang, and L.-M. Duan,
Experimental hamiltonian learning of an 11-qubit solid-state
quantum spin register, Chinese Phys. Lett. 36, 100303 (2019).
[38] Y . Liu, J. Tian, R. Betzholz, and J. Cai, Pulsed Quantum-State
Reconstruction of Dark Systems, Phys. Rev. Lett. 122, 110406
(2019).
[39] F. Shi, X. Rong, N. Xu, Y . Wang, J. Wu, B. Chong, X. Peng,
J. Kniepert, R.-S. Schoenfeld, W. Harneit, M. Feng, and J. Du,
Room-Temperature Implementation of the Deutsch-Jozsa Al-
gorithm with a Single Electronic Spin in Diamond, Phys. Rev.
Lett. 105, 040504 (2010).
[40] P. Yang, M. Yu, R. Betzholz, C. Arenz, and J. Cai, Complete
quantum-state tomography with a local random Ô¨Åeld, Phys.
Rev. Lett. 124, 010405 (2020).
[41] Y . Chu, P. Yang, M. Gong, M. Yu, B. Yu, M. B. Plenio, A. Ret-
zker, and J. Cai, Precise spectroscopy of high-frequency oscil-
lating Ô¨Åelds with a single-qubit sensor, Phys. Rev. Applied 15,
014031 (2021).
[42] J. Meinel, V . V orobyov, B. Yavkin, D. Dasari, H. Sumiya,
S. Onoda, J. Isoya, and J. Wrachtrup, Heterodyne sensing of
microwaves with a quantum sensor, Nat. Commun. 12, 2737
(2021).
[43] A. A. Gentile, B. Flynn, S. Knauer, N. Wiebe, S. Paesani, C. E.
Granade, J. G. Rarity, R. Santagati, and A. Laing, Learning
models of quantum systems from experiments, Nat. Phys. 17,
837 (2021).
[44] M. Jiao, M. Guo, X. Rong, Y .-F. Cai, and J. Du, Experimen-
tal Constraint on an Exotic Parity-Odd Spin- and Velocity-
Dependent Interaction with a Single Electron Spin Quantum
Sensor, Phys. Rev. Lett. 127, 010501 (2021).
[45] S. Dushenko, K. Ambal, and R. D. McMichael, Sequential
bayesian experiment design for optically detected magnetic res-
onance of nitrogen-vacancy centers, Phys. Rev. Applied 14,
054036 (2020).
[46] J. Wang, S. Paesani, R. Santagati, S. Knauer, A. A. Gen-
tile, N. Wiebe, M. Petruzzella, J. L. O‚ÄôBrien, J. G. Rarity,
A. Laing, and M. G. Thompson, Experimental quantum Hamil-
tonian learning, Nat. Phys. 13, 551 (2017).
[47] T. Joas, S. Schmitt, R. Santagati, A. A. Gentile, C. Bonato,
A. Laing, L. P. McGuinness, and F. Jelezko, Online adaptive
quantum characterization of a nuclear spin, npj Quantum Inf. 7,
56 (2021).
[48] D. V . Lindley, On a Measure of the Information Provided by an
Experiment, Ann. math. stat. 27, 986 (1956).
[49] J. M. Bernardo, Expected Information as Expected Utility, Ann.
Statist. 7, 686 (1979).
[50] K. Chaloner and I. Verdinelli, Bayesian Experimental Design:
A Review, Statist. Sci. 10, 273 (1995).
[51] E. G. Ryan, C. C. Drovandi, J. M. McGree, and A. N. Pettitt, A
review of modern computational algorithms for bayesian opti-
mal design, Int Stat Rev 84, 128 (2016).
[52] T. H. Taminiau, J. J. T. Wagenaar, T. van der Sar, F. Jelezko,
V . V . Dobrovitski, and R. Hanson, Detection and Control of In-
dividual Nuclear Spins Using a Weakly Coupled Electron Spin,
Phys. Rev. Lett. 109, 137602 (2012).
[53] C. E. Granade, C. Ferrie, N. Wiebe, and D. G. Cory, Robust
online Hamiltonian learning, New J. Phys. 14, 103013 (2012).
[54] X. Huan and Y . M. Marzouk, Simulation-based optimal
Bayesian experimental design for nonlinear systems, J. Com-
put. Phys. 232, 288 (2013).
[55] D. K. Oi and S. G. Schirmer, Quantum system characterization
with limited resources, Philos. Trans. Royal Soc. A 370, 5386
(2012).11
[56] S. S√§rkk√§, Bayesian Filtering and Smoothing , Institute of Math-
ematical Statistics Textbooks (Cambridge University Press,
2013).
[57] B. Carlin and T. Louis, Bayes and Empirical Bayes Methods for
Data Analysis, Second Edition , Chapman & Hall/CRC Texts in
Statistical Science (Taylor & Francis, 2000).
[58] D. J. MacKay, Information theory, inference and learning algo-
rithms (Cambridge university press, 2003).
[59] J. S. Liu and R. Chen, Sequential monte carlo methods for dy-
namic systems, J. Am. Stat. Assoc. 93, 1032 (1998).
[60] J. R. Johansson, P. D. Nation, and F. Nori, QuTiP 2: A Python
framework for the dynamics of open quantum systems, Com-
put. Phys. Commun. 184, 1234 (2013).
[61] S. Kotler, N. Akerman, Y . Glickman, A. Keselman, and R. Oz-
eri, Single-ion quantum lock-in ampliÔ¨Åer, Nature 473, 61
(2011).
[62] M. A. Ali Ahmed, G. A. √Ålvarez, and D. Suter, Robustness
of dynamical decoupling sequences, Phys. Rev. A 87, 042309
(2013).
[63] C. Andrieu, A. Doucet, and R. Holenstein, Particle Markov
chain Monte Carlo methods, J. R. Stat. Soc. Series B 72, 269
(2010).
[64] I. Jakobi, P. Neumann, Y . Wang, D. B. R. Dasari, F. El Hal-
lak, M. A. Bashir, M. Markham, A. Edmonds, D. Twitchen,
and J. Wrachtrup, Measuring broadband magnetic Ô¨Åelds on the
nanoscale using a hybrid quantum register, Nat. Nanotechnol.
12, 67 (2017).
[65] C. Granade, C. Ferrie, S. Casagrande, I. Hincks,
M. Kononenko, T. Alexander, and Y . Sanders, Qinfer:
Library for statistical inference in quantum information (2016).
[66] Source code is available upon reasonable request.
[67] J. M. Cebri√°n, L. Natvig, and J. C. Meyer, Performance and
energy impact of parallelization and vectorization techniquesin modern microprocessors, Computing 96, 1179 (2014).
[68] M. Baboulin, A. Buttari, J. Dongarra, J. Kurzak, J. Langou,
J. Langou, P. Luszczek, and S. Tomov, Accelerating scientiÔ¨Åc
computations with mixed precision algorithms, Comput. Phys.
Commun. 180, 2526 (2009).
[69] S. K. Lam, A. Pitrou, and S. Seibert, Numba: A llvm-based
python jit compiler, in Proceedings of the Second Workshop on
the LLVM Compiler Infrastructure in HPC , LLVM ‚Äô15 (Asso-
ciation for Computing Machinery, New York, NY , USA, 2015).
[70] R. Okuta, Y . Unno, D. Nishino, S. Hido, and C. Loomis, CuPy:
A NumPy-Compatible Library for NVIDIA GPU Calculations,
inProceedings of Workshop on Machine Learning Systems
(LearningSys) in The Thirty-Ô¨Årst Annual Conference on Neural
Information Processing Systems (NIPS) (2017).
[71] K. Genin and F. Huber, Formal Representations of Belief, in
The Stanford Encyclopedia of Philosophy , edited by E. N. Zalta
(Metaphysics Research Lab, Stanford University, 2022) Spring
2022 ed.
[72] J. Go and T. Isaac, Robust expected information gain for op-
timal bayesian experimental design using ambiguity sets, in
The 38th Conference on Uncertainty in ArtiÔ¨Åcial Intelligence
(2022).
[73] J. Liu and M. West, Combined parameter and state estimation in
simulation-based Ô¨Åltering, in Sequential Monte Carlo Methods
in Practice , edited by A. Doucet, N. de Freitas, and N. Gordon
(Springer New York, New York, NY , 2001) pp. 197‚Äì223.
[74] C. Granade and N. Wiebe, Structured Ô¨Åltering, New J. Phys. 19,
083014 (2017).
[75] See Supplemental Material at [URL will be inserted by pub-
lisher] for the data of the simulations.
[76] S. Pang and A. N. Jordan, Optimal adaptive control for quantum
metrology with time-dependent Hamiltonians, Nat. Commun.
8, 14695 (2017).