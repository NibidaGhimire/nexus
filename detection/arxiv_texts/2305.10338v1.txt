 
1
 

 
Abstract
—
 
Inertial
-
based navigation refers to the navigation 
methods or systems t
hat have inertial information or sensors as the 
core part and integrate a spectrum of 
other kinds of 
s
ensors for 
enhanced performance. 
Through 
a series of 
paper
s
, th
e authors 
attempt to explore information blending of inertial
-
based 
navigation by a 
polynomial optimization method. The basic idea is 
to model rigid motions as finite
-
order polynomials and then 
attacks the involved navigation problems by optimally solving 
their coefficients, taking into considerations the constraints posed 
by inertial sen
sors and others.
 
In 
the 
current 
paper
,
 
a 
continuous
-
time attitude
 
estimation
 
approach
 
is proposed, which transforms 
the
 
attitude
 
estimation into 
a constant parameter 
determination 
problem 
by
 
the polynomial 
optimization
. 
Specifically, the 
continuous attitud
e is first approximated by 
a 
Chebyshev 
polynomial, 
of which
 
the 
unknow
n
 
Chebyshev 
coefficient
s
 
are
 
determined 
by minimizing the weighted 
residual
s
 
of 
initial 
conditions, 
dynamics
 
and
 
measurement
s
.
 
W
e apply the 
derived
 
estimator 
to 
the 
attitude 
estimation with 
the magnetic and inertial 
sensors
.
 
Simulation and 
field 
tests show that the 
estimator 
has
 
much better 
stab
ility
 
and fast
er
 
converge
nce
 
than the traditional
 
extended Kalman filter
 
does
, especially in the 
challenging
 
l
arge 
initial state error 
scenarios
.
 
 
Index Terms
—
Attitude 
E
stimation, 
Chebyshev 
Polynomial, 
I
nertial 
Sensor, 
Extended Kalman 
Filter
, Polynomial 
Optimization
 
 
I.
 
I
NTRODUCTION
 
ttitude
 
estimation of a rigid body 
with
 
low
-
cost 
MEMS 
inertial 
measurement
 
unit (
MIMU
)
 
sensors has received 
numerous 
applications, including but not limited to robotics 
[1]
, 
aerospace 
[2]
, unmanned aerial vehicle 
[3]
 
and human motion 
tracking 
[4, 5]
. The MIMU usually integrates the three
-
axis 
gyroscope, accelerometer and magnetometer into a 
module
 
or 
chip
. The magnetometer measures the local magnetic fie
ld 
of 
the Earth
, while the gyroscope and accelerometer measure the 
angular velocity and specific force of the rigid body with 
respect to the inertial frame, respectively 
[6]
.
 
T
he 
inertial and magnetic attitude estimation
 
has witnessed 
about forty years’ endeavors 
in 
trying to 
optimally fus
e
 
gyroscope measurements 
with 
the 
valid 
accelerometer and 
magnetometer measurements 
[7, 8]
. Generally, the fusion 
 
This paper was support
ed in part by National Natural Science Foundation of 
China 
(
62273228
)
 
and Shanghai Jiao Tong University Scientific and 
Technological Innovation Funds.
 
algorithm
s
 
can be classified into three categories: 
complementary filter
-
based
 
methods
 
[9
-
12]
, 
Kalman filter
-
based methods 
[7, 13
-
16]
 
and optimization
-
based methods 
[17
-
19]
.
 
The complementary filter 
[20]
 
utilizes the accelerometer and 
magnetometer vector measurements to determine the 
attitude
 
and then combines with the 
time 
integration of gyroscope by a 
proper gain. The compl
ementary filter is a 
straightforward 
frequency
 
domain approach
 
with low computation burden. 
Though quite popular in low cost platforms 
[10]
, it does not 
consider the statistical 
characteristics 
of measurements.
 
As for the Kalman filter
-
based 
attitude
 
estimation, the most 
celebrated 
tool 
is the 
multiplicative extend
ed
 
Kalman filter
 
(EKF)
 
[21]
, which approximates the attitude nonlinearity by th
e 
first
-
order linearization. However, the 
local linearization at 
inaccurate 
estimate 
will degrade the filter performance, 
especially 
in the case of 
the large initial state error.
 
T
he 
invariant extended Kalman filter
 
[22, 23]
 
u
tilizes the 
Lie
 
group
 
affine property and 
derives 
the error state model independent of 
the attitude to improve the stability and robustness of the 
estimation. To address the linearization 
issue
, the unscented 
Kalman filter 
(UKF) 
is 
also applied 
for 
attitud
e 
estimation 
[24]
, 
which 
employs
 
a set of sigma points 
to 
approximate the
 
nonlinear
 
probability distribution
 
and 
propagate
s
 
the
 
statistical 
information of posteriori density. 
The
 
Monte Carlo
-
based 
particle filter
 
is
 
also
 
used
 
for
 
attitude
 
estimation
 
[25]
 
by 
draw
ing
 
a large number of random samples to approximate and
 
propagat
e
 
the probability distribution, which leads to a great 
computation burden
.
 
There are 
several 
early 
a
ttempt
s
 
to solve the 
attitude
 
estimation by the optimization
-
based method. 
The 
works 
[17, 
18, 26]
 
determine the 
attitude
 
by 
first 
optimizing the objecti
ve
 
function 
of
 
the magnetometer and accelerometer measurements 
and then 
incorporating
 
gyroscope 
measurements 
through
 
a 
fusion algorithm. 
Instead of numerically integrating the 
gyroscope measurements, a more accurate and direct method is 
to optimize all the available ine
rtial and magnetic 
measurements simultaneously 
[19, 27]
.
 
The paper 
[19]
 
proposes 
the moving
-
horizon estimation
 
method
, which utilizes 
all
 
measurements in a 
time 
window to solve the spacecraft 
at
titude estimation. However, 
approximating the 
attitude 
Author’s address: M. Zhu and Y. Wu are with Shanghai Key Laboratory of 
Navigation and
 
Location
-
based Services, School of Electronic Information and 
Electrical
 
Engineering, 
Shanghai Jiao Tong University, Shanghai 200240, 
China (email:
 
zhumaoran@sjtu.edu.cn, yuanx
_
wu@hotmail.com).
 
I
nertial
-
based Navigation by Polynomial 
Optimization: Inertial
-
Magnetic Attitude 
Estimation
 
Maoran Zhu, 
Student Member, IEEE
, Yuanxin Wu, 
Senior 
M
ember, IEEE
 
A
  
2
 
derivative 
by 
the 
f
irst
-
order difference 
therein 
is not accurate 
enough, especially for the high dynamic applications. A 
continuous
-
time batch attitude estimation using B
-
splines curve 
to approximate t
he 
attitude 
is proposed in 
[27]
, 
which
 
is not 
friendly to real time applications.
 
Inspired by the collocation method, we quite recently come 
up with a continuous
-
time state estimation method by the 
Chebyshev polynomial optimization for general problems 
[28]
. 
Through 
a
 
series of papers, we attempt to expl
ore information 
blending of inertial
-
based navigation by the polynomial 
optimization method. 
I
n 
[29]
,
 
we 
have introduce
d
 
the 
Chebyshev collocation method 
[30, 31]
 
into the 
strapdown 
inertial navigation
 
computation. 
This 
paper will further 
exploit 
the 
idea of 
the 
collocation method 
to 
derive 
polynomial 
optimization
-
based
 
attitude 
estimator
s
, which transform
s
 
the 
attitude 
estimation 
into a problem of Chebyshev coefficient 
optimization 
in a sliding window
.
 
Specifically, the attitude 
profile 
in the current window 
is represented by the Chebyshev 
polynomial 
and the unknown coefficients are 
then 
determined 
by minimizing the weighted residual
s
 
of
 
initial conditions
,
 
dynamics and measurements.
 
We apply the derived estimators 
to the attitude and bias estimation with the 
magnetic and inertial 
sensors
 
and find 
that 
they have 
much better stability and faster 
convergence than the traditional 
EKF
 
does
, especially in the 
large initial state error scenarios.
 
The 
rest 
of this paper is organized as
 
follows.
 
The inertial
-
magnetic 
sensor measurement model
s
 
are
 
first introduced 
in 
Section 
II
.
 
Section III 
derives the polynomial optimization
-
based 
inertial
-
magnetic 
attitude estimation in terms of the 
quaternion and Rodrigues vector
.
 
A
 
linear 
initial algorithm is
 
also
 
proposed to provide good initial value
s
 
for 
the
 
optimization
-
based methods
. The simulations and 
field
 
tests are 
conducted in Section IV. Finally, the conclusion is drawn in 
Section V
. 
 
II.
 
I
NERTIAL 
S
ENSOR 
M
EASUREMENT 
M
ODE
L
 
The gyroscope measures the angular v
elocity of the body 
with respect to the inertial axes as
 
 
b
g ib g g
  
y
ω
b n
 
 
(
1
)
 
where
 
the subscripts 
i
 
and
 
b
 
denote the inertial frame (
i
-
frame) 
and body frame (
b
-
frame), respectively. 
g
y
 
denotes the 
gyroscope measurement and 
b
ib
ω
 
denotes the 
true
 
angular 
velocity
 
in 
b
-
frame
. 


~ 0,
g g
N
n R
denotes the gyroscope 
measurement white noise, and 
g
b
 
denotes the gyroscope bias 
that is modeled as 
 
 
g bg

b n

 
 
(
2
)
 
where 
bg
n
 
is 
Gaussian white noise
. When the
 
non
-
gravitational
 
acceleration 
such as motion disturbance 
is small, 
When the non
-
gravitational acceleration such as motion disturbance is small, 
the accelerometer measurement roughly reflects the opposite 
direction of local gravity in the 
b
-
frame, 
i.e.,
 
 
*
b n b
a n n a a
  
y q
γ
q b n
 
 
 
(
3
)
 
where the subscript 
n
 
represents the navigation frame (
n
-
frame). 
Without 
the 
loss of generality, the navigation frame in this 
paper takes the definition of North
-
Up
-
East. 


~ 0,
a a
N
n R
 
denotes the measurement Gaussian noise and 
a
b
denotes the 
measurement noise that is modeled as
 
 
a ba

b n

 
 
(
4
)
 
where 
ba
n
 
is
 
a
 
Gaussian white noise. 


= 0 0
T
n
g

γ
 
denotes the gravity vector in 
n
-
frame and 
g
 
denotes the 
magnitude of the local gravity.
 
T
b T
n
s
 
 
q
η

 
encodes the unit 
attitude 
quaternion of 
b
-
frame relative to 
n
-
frame
,
 
where 
s
 
is 
the scale part and 
η
 
is the vector part of
 
b
n
q
.
 
The operator 

 
denotes the quaternion multiplication, defined as
 
 




2 1
1 2 1 2
2 1
s s
 
   
 
   
   
q q q q
η
η

 
 
(
5
)
 
T
he two quaternion multiplication matrices, 



q
 
and 



q
, are 
respectively defined by
 
 




3 3
,   
T T
s s
s s
 
   
 
   
   
   
η
η
q q
η
I
η
η
I
η
 
 
 
(
6
)
 
where 
n
I
 
denotes an 
n n

 
identity matrix. The skew 
symmetric matrix 



 
is defined that the cross product 


x y x y
  
 
is satisfied for arbitrary two vectors. The 
conjugate of the unit quaternion 
*
b
n
q
 
in 
(
3
)
 
is defined as 
*
T
b
n
T
s
 

 

η
q
.
 
The magnetometer triad measures the total magnetic flux 
density in 
b
-
frame, given as
 
 
*
b n b
m n n m
 
y q m q n
 
 
 
(
7
)
 
w
here
 
m
y
 
and 


~ 0,
m m
N
n R
 
denote the normalized 
magnetometer triad measurements (unit norm) and its noise, 
respectively. 
n
m
 
is the normalized magnetic field in 
n
-
frame, 
expressed as 
 
 
cos cos
sin
sin cos
m m
n
m
m m
 

 
 
 
 
 
 
 
m
 
 
(
8
)
 
where 
m

 
and 
m

 
are, respectively, the magnetic declination 
and inclination 
[6]
. It is noted that other sensor parameters, such 
as 
the 
scale factor and misalignment, are assumed having been 
well calibrated 
[32, 33]
. 
In this paper, t
he accelerometer and 
magnetometer measurements are only used when the external 
acceleration and magnetic disturbance retain small. Specifically, 
the norm
-
based detectors 
are
 
applied to select the feasible 
measurements 
[16]
 
 
a a
g

 
y
 
 
(
9
)
 
 
1
m m

 
y
 
 
(
10
)
 
where
 
t
he first inequality 
represents the accelerometer detector 
and 
the second inequality 
represents
 
the magnetometer detector
,
  
3
 

 
denotes the norm of a vector
, and
 
a

 
and 
m

 
denote the 
given thresholds of the 
two 
detectors. 
 
Considering the Earth rotation rate, the 
dynamics 
of the 
attitude quaternion satisfies 
[6]
 
 


2 2
b b b b b n b
n n nb n ib in n
  
q q
ω
q
ω
q
ω

  
 
 
(
11
)
 
where 
b
nb
ω
 
denotes the body angular velocity vector with 
respect to 
n
-
frame expressed in 
b
-
frame.
 
n n
in ie

ω
ω
 
for the low
-
speed vehicles and 


cos sin 0
T
n
ie
L L
  
ω
 
denotes the 
Earth’s angular velocity vector expressed in 
n
-
frame, among 
which 
 
is the norm of the 
E
arth rotation and 
L
 
is the latitude 
of the location. Substituting 
(
1
)
 
into 
(
11
)
 
and 
multiplying the 
conjugate of 
b
n
q
 
on both sides, the angular velocity 
measurements can be represented as 
a
 
function of quaternion 
and gyroscope bias, as
 
 
* *
2
b b b n b
g n n n ie n g g
   
ω
y q q q q b n

  
 
 
(
12
)
 
Ano
ther popular parameter to present the attitude is the 
R
odrigues vector
.
 
It has
 
only three components and no inherent 
constraint
, but 
is singular for a 
180

 
rotation
 
[21]
. 
Therefore, 
the Rodrigues vector is 
usually 
used to parameterize the attitude
 
update
 
in a short
 
time interval.
 
In this regard, t
he attitude in the 
time interval 
can be written as
 
 




,0
b b
n n
 


q q q

 
 
(
13
)
 
where 
,0
b
n
q
 
denotes the initial 
attitude 
quaternion at the start of 
the current time window and 

q
 
denotes the quaternion 
update, which is 
related with
 
the 
Rodrigues vector update
 
as
 
 
2
2
=
4+
T
T
 
 



g
q
g
 
 
(
14
)
 
r
eversely
,
 
 
 
2
s

 

g
η
 
 
(
15
)
 
where 
s

 
is the scale part and 

η
 
is the vector part of
 

q
.
 
Substituting 
(
13
)
 
and 
(
14
)
 
into 
(
12
)
, 
t
he
 
angular velocity 
measurement
s
 
can also be represented by the Rodrigues vector 
update
 
 


2
,0
4 2
4
b n
g n ie g g
 

  
    


g g g
y C g C
ω
b n
g
 
 
 
(
16
)
 
where 
,0
b
n
C
 
is the initial rotation matrix 
corresponding to the 
initial attitude quaternion 
,0
b
n
q
 
and 


 
C g
 
means a function 
that transforms the Rodrigues vector to the corresponding 
rotation matrix.
 
III.
 
I
NERTIAL
-
M
AGNETIC 
A
TTITUDE 
E
STIMATION
 
BY 
C
HEBYSHEV 
P
OLYNOMIAL 
O
PTIMIZATION 
(A
TT
E
ST
PO)
 
A.
 
Formulation of 
Attitude 
Estimation
 
Without 
the 
loss of 
the 
generality,
 
consid
er 
the attitude 
estimation on the time interval 


0
M
t t
, in which 
1
M

 
inertial
-
magnetic 
samples 
are available
 
at 
, 0,
k
t k M


 
.
 
Because the gyroscope and accelerometer biases are slow
ly 
changing
, it 
is reasonable to treat
 
them
 
as constant
s
 
in a 
short 
time 
window. 
Therefore, t
he state to be estimated 
in the time 
interval 
inclu
de
s
 
the continuous attitude
 
and
 
the constant 
gyroscope and accelerometer biases, which 
are
 
denoted as 




  
, ,  
T
T
b T T
n a g
t t
 
 
x q b b

. Assume 
the 
initial
 
state is given as 
0 0
  
0 ,0
, ,   
T
b T T T
n a g
 

 
x q b b
, where
,0
b
n
q
, 
0
a
b
and 
0
g
b
denote
 
the
 
quaternion, accerlerometer and gyroscope biase
s
 
at
 
the 
initial 
time 
0
t
, respectively.
 
In the least squares sense 
[34]
, an optimal 
continuous
-
discrete 
attitude 
estimation is to minimize the measurement 
residuals 
with 
respect to
 


t
x
 
 






0
min    s.t 1
t
J J J t
  
x v z
x
q
 
 
(
17
)
 
where 
the objective function
s
, 
0
J
x
, 
J
v
 
and 
J
z
, 
respectively 
denote the 
prior
, dynamics and measurement terms
. They are 
explicitly
 
given as follows
 
 




0 0 0
0
1 1
M
k k k k
T
t
T
t
p
s
T T
a a m m
k k
J
J d
J
  
 


 

 
x x x
v v v
z
e e
e e
e e e e
 
 
(
18
)
 
where 
p
 
and 
s
 
respectively
 
denote the number 
of valid
 
accelerometer and magnetometer
 
measurements
 
in the current 
time window 
that are 
selected by 
the detectors in 
(
9
)
 
and 
(
10
)
.
 
With
 
the measurement models 
(
3
)
,
 
(
7
)
 
and 
(
12
)
, the weighted 
residuals 
0
x
e
, 
v
e
, 
a
e
 
and 
m
e
 
are
 
given as
 
 






0 0 0 0
0
* *
*
*
    
2
T T T T T T
a a g g
T b b b n b
g g n n n ie n g
T b n b
a a a n n a
T b n b
m m m n n

 
  
 
   
  
 
x x
v
e W
ψ
b b b b
e W y q q q q b
e W y q g q b
e
ω
W y q m q

  
 
 
 
 
(
19
)
 
which are related to the 
prior, 
attitude 
dynamics and valid 
accelerometer and magnetometer measurements
,
 
respectively
, 
through their corr
esponding 
weight 
matrices
.
 
Specifically, 
regarding the residual of initial state, 
0

ψ
 
is the initial three
-
dimensional 
attitude 
error
 
that is 
roughly 
related to the attitude 
quaternion as
 
[6]
 
 
*
2 4
ˆ
2
b b
n n

 

 
ψ
q q

：
 
 
(
20
)
 
w
here
 
b
n
q
 
and 
ˆ
b
n
q
 
denote the true and error
-
contaminated 
quaternion
s
, respectively.
 
The operator 


2:4

 
extracts the 
second to the fourth rows
 
of a matrix.
 
The weight matrices
 
are 
obtained from the Cholesky factorization
 
of the 
inverse 
covariance matrix
,
 
namely
,
 
0 0 0
1
T


x x x
P W W
,
 
1
T
g g g


R W W
, 
1
T
a a a


R W W
,
1
T
m m m


R W W
.
 
It should be noted that 
the 
covariance matrix of the initial state
 
is defined as
 
4
 
0 0
1
1
,0 ,0
, ,
a g
b b
diag


 
 
x
ψ
P P P P

, where
 
0
ψ
P
, 
,0
a
b
P
and
 
,0
g
b
P
 
are 
t
he initial covariance
s
 
of the attitude, accelerometer and 
gyroscope biases, 
respectively.
 
B.
 
Attitude Estimation by Chebyshev 
P
olynomial Optimization
 
To solve the infinite
-
dimension optimization problem in 
(
17
)
, 
the Chebyshev collocation
 
method is introduced to represent 
the attitude by a finite
-
order Chebyshev polynomial and 
transform the continuous
-
time 
attitude estimation into a 
constant 
parameter optimization problem.
 
 
The 
Chebyshev polynomial of the first kind is defined over 
the int
ernal 
[ 1 1]

 
by the recurrence relation as
 
[30]
 
 










0 1
1 1
1,  ,  
2   for 1
i i i
F F
F F F i
  
   
 
 
  
 
 
(
21
)
 
where 


i
F

 
is the 
th
i
-
degree Chebyshev polynomial.
 
In order 
to apply the Chebyshev polynomial, the 
optimization 
in 
(
17
)
 
on 


0
  
M
t t t

 
needs to be
 
mapped 
into
 
[ 1 1]

 
 
by the affine 
transformation
 
as follows
 
 
0
0 0
2
  
M
M M
t t
t
t t t t


 
 
 
 
(
22
)
 
The attitude quaternion in the time interval is then 
approximated 
by a Chebyshev polynomial 
up to order 
q
N
 
as
 
 






0
q
N
b
n i i
i
F
  



q d DF

 
 
(
23
)
 
where 
i
d
 
denote the 
-
degree
 
Chebyshev coefficient
. The 
matrices
 


0 1
( ) ( ) ( )
q
T
N
F F F
   
 
 
F
 
 
and 
0
, ,
q
N
 
 
D d d
 
 
are defined for compact denotation
.
 
T
hen, the derivative of the attitude quaternion is given by
 
 






0
q
N
b
n i i
i
F
  



q d DF
 


 
 
(
24
)
 
where 


0 1
( ) ( ) ( )
q
T
N
F F F
   
 
 
F
   
 
 
and 
i
F

 
is 
the time 
derivative of 
 
that
 
is 
directly 
obtained by taking the 
derivative of
 
(
21
)
. That is to say
 
 












0 1
1 1
0,  1,  
2 2   for 1
i i i i
F F
F F F F i
 
    
 
 
   
 
  
 
 
(
25
)
 
The reason that the Chebyshev polynomial is selected as the 
basis function is 
for 
its high accuracy and efficacy in functional 
approximation. 
As a matter of fact, t
he Chebyshev polynomial 
is very close to the best polynomial approximation in the 

-
norm 
[30]
. The integral term 
J
v
 
in 
(
18
)
 
can be 
numerically 
solved 
by the 
Clenshaw
-
Curtis quadrature formula as 
[30]
 
 




0
N
T
i i i
i
J w
 



v v v
e e
 
 
(
26
)
 
where 
i

 
denotes 
the 
Chebyshev points
 
 


cos ,   0,1, ,
i
i N i N
 
  

 
 
(
27
)
 
and 
i
w
 
denotes the weight
 
that is 
determined by the integrals 
of the Lagrange polynomials 
[35]
 
and 
N
+1 is the nu
mber of 
Chebyshev points
. 
We see that 
(
26
)
 
requires the angular 
velocity at the Chebyshev points. In this paper, 
it is achieved by 
the 
way of 
the 
extended Floater and Hormann (EFH) 
interpola
tion
 
method 
[36]
, which
 
reconstruct
s
 
the angular 
velocity from the 
equally
-
spaced time sampled angular velocity 
measurement
s
 
[37]
. 
Readers are referred to 
[29]
 
for 
the details 
of
 
the
 
angular velocity reconstruction
.
 
Following the commonly used strategy to handle the 
constraints in the
 
collocation
-
based
 
optimal control
 
[38]
, 
the 
continuous unit quaternion constraint in 
(
17
)
 
is 
discretized at 
the
 
Chebyshev point
s as
 
 


1   0,1, ,
b
n k
k N

 
q

 
 
(
28
)
 
S
ubstituting the 
Chebyshev 
approximations 
(
23
)
, 
(
24
)
,
 
(
26
)
 
and 
the discretized constraints 
(
28
)
 
into 
(
17
)
, we can 
reformulate 
t
he
 
estimation 
task 
for the time window of interest 
as
 
 
 






0
, ,
min   
s.t. 1   0,1, ,
a g
b
n k
J J J
k N

 
 
x v z
D b b
q

 
 
(
29
)
 
w
here
 
the estimation parameters
 
include the Chebyshev 
coefficient
 
and the accelerometer/gyroscope biases.
 
Equation 
(
29
)
 
is a constrain
ed
 
nonlinear squares problem, which
 
can be 
transformed 
to 
an unconstrained nonlinear least squares by the 
augmented Lagrangian method and 
then 
solved by the 
Levenberg
-
Marquardt algorithm 
[39]
. Once 
t
he coefficients are 
determined, the continuous
 
attitude 
quaternion as a function of 
time will be finally acquired by 
(
23
)
.
 
It 
should be noted that
 
(
29
)
 
is a constrained optimization that 
is generally more time
-
consuming than an unconstrained 
optimization. 
On the other hand
, t
he above
 
optimization 
problem can be reformulated as an unconstrained one using the 
Rodrigues vector. 
To avoid 
its 
singularity at a 
180

 
rotation, 
however, 
we consider the Rodrigues vector 
update 
in the short
-
time window
. Specifically, the 
Rodrigues vector
 
update 
is
 
approximated by 
a 
Chebyshev polynomial 
up to order 
g
N
 
as
 
 


0
( ) ( )
g
N
i i
i
F
  




g h HF

 
 
(
30
)
 
where 
i
h
 
denote the 
-
degree
 
Chebyshev coefficient, 
and
0
, ,
g
N
 
 
H h h
 
 
denotes the combin
ed matrix
 
of Chebyshev 
coefficients
. 
T
hen, the derivative of the attitude quaternion is 
given by
 
 


0
( ) ( )
g
N
i i
i
F
  




g h HF
 


 
 
(
31
)
 
By analogy with the quaternion estimation, the
 
Rodrigues 
vector update estimation can be formulated as
 
 




0
, ,
min   
a g
J J J
 
x v z
H b b
 
 
(
32
)
 
where 
the estimation parameters include the Chebyshev 
coefficient and the accelerometer/gyroscope biases.
 
T
he 
weighted residuals of initi
al state and 
accelerometer/magnetometer measurements are obtained by 
th
i
i
F
th
i 
5
 
substituting 
(
13
)
 
and 
(
14
)
 
in
to
 
(
19
)
, 
and 
the weighted residual 
of 
attitude 
dynamics
 
is 
obtained from 
(
16
)
, given as
 


2
,0
4 2
4
T b n
g g n ie g
 

 
  
 
    
 


 
v
g g g
e W y C g C
ω
b
g
 
 
 
(
33
)
 
With the optimized Chebyshev 
coefficients
, t
he attitude 
quaternion 
in the window is readily obtained 
by
 
substituting 
(
30
)
 
into
 
(
13
)
 
and 
(
14
)
.
 
 
In summary, t
he approximations involved in the proposed 
batch 
estimators include the attitude profile
 
approximation
 
by 
the 
Chebyshev polynomial
 
in 
(
23
)
 
or 
(
30
)
, 
the 
Clenshaw
-
Curtis 
quadrature
 
in 
(
26
)
 
and the angular velocity interpolant by the 
EFH strategy. With the increased order of Chebyshev 
polynomial, the errors 
incurred by Chebyshev approximation 
and C
lenshaw
-
Curtis quadrature 
will decay towards zero 
[30]
. 
Additionally, the EFH interpolant is also likely ve
ry close to 
optimality for time
-
equispaced samples 
[40]
. In this regard, the 
proposed attitude estimator by 
polynomial optimization
 
(
A
ttEstPO
)
 
is nearly optimal in the least squares sense.
 
To meet the requirement o
f real
-
time applications, the above 
optimization
s
 
are
 
expected to be 
solved recursively on 
consecutive short
-
time windows. The estimation result at the 
end of the current window can serve as the 
prior 
for the next 
window
, 
but the required covariance estima
tion is not directly 
available. 
In view of
 
the strategy in the moving horizon 
estimation 
[41]
, 
t
he 
multiplicative EKF
,
 
with the linearized 
dynamics and measurements at the A
ttEstPO
 
estimate
,
 
can be 
resorted 
to compute the state 
covariance
. 
T
he multiplicative 
EKF
, also known as 
the 
error
-
state EKF,
 
estimates the
 
error
 
state 
(instead of the original state) 
to avoid the 
over
-
parameterization 
issue of the attitude
 
[6]
.
 
T
he 
error state 
is
 
defined as the estimate subtracting 
the 
truth, i.e., 
ˆ

 
x x x
, 
except that
 
the 
definition of 
attitude error follows 
(
20
)
. 
The 
linearized 
er
ror
-
state 
dynamics
 
is 
expressed 
as 
 
 
 
 
x B x Gw

 
 
(
34
)
 
where the 
error
 
state is 
a 9
-
dimensional vector 
T
a g
   
 
 
x
ψ
b b

, the 
dynamic noise is 
T
g ba bg
 
 
w n n n

 
and the matrices are
 
 
3 3
3 3
3 3 3
3 3 3
3 3 3
   
n
b
n
b
 

 

 
 
 
 
 
 
 
C 0 0
0 0 C
B G 0 I 0
0 0 0
0 0 I
 
 
(
35
)
 
where 
n
0
 
denotes an 
n n

 
zero matrix. 
T
he multiplicative 
EKF covariance prediction 
from 
1
k
t

 
to 
k
t
 
is given as
 
 




9 1 9
T
T
k k k k k k k
T


   
P I B P I B G Q G
 
 
(
36
)
 
where 
the covariance update interval is set to 
1
k k
T t t



. 
W
hen 
the 
measurement
 
at time 
k
t
 
comes
, the covariance is 
updated by
 
 


1
T T
k k k k k k k k k k

   
  
P P P
Η
H P H R H P
 
 
(
37
)
 
where
 
k
R
 
and 
k
H
 
denote the measurement 
noise
 
covariance
 
and 
linearized measurement
 
matri
ces
, respectively
. For the 
accelerometer and 
magnetometer, the
 
matri
x
 
k
H
 
is
 
respectively
 
written as
 
 
.
, 3 3
, 3 3
b n
k m n
b n
k a n
 
 
 
 
  
 
H C m 0 0
H C
γ
I 0
 
(
38
)
 
Note that the 
matrices
 
k
G
, 
k
H
 
and 
k
B
 
in 
(
36
)
 
and 
(
37
)
 
are 
calculated 
using 
the A
ttEstPO
 
estimate
.
 
In contrast, the 
covariance propagation of EKF is performed at the current state 
estimate
,
 
which
 
is usually inferior to that by AttEstPO because 
the latter is a kind of local smoothing 
using 
all information 
during the current time window 
and 
EKF only uses information 
up to the current time.
 
Taken as an example, F
ig
.
 
1 
illustrates 
the 
state and covari
ance propagation 
between two
 
adjacent 
window
s
, where the 
state 
estimate 
and 
its covariance 
at
 
the end 
time 
of
 
window
 
k
 
serve
 
as the 
initial condition 
for window 
k
 
+1
.
 
 
From the theoretical perspective, the proposed 
AttEstPO 
algorithm 
only makes a Gaussian assumption of the 
prior 
and 
does not introduce any approximation
s
 
of nonlinear dynamics 
and measurement
s
 
in the time interval of interest
. 
This
 
feature 
is 
a significant advantage over the well
-
known 
linearization
-
based 
EKF that
 
approximates the nonlinearity by successive 
Taylor expansion at current estimate
.
 
In this regard, 
the 
AttEstPO 
is promising to obtain a better estimation
 
at the price 
of time delay
, as shown in Section IV.
 
C.
 
Chebyshev Coefficient 
Initialization
 
A fine 
i
niti
alization 
of Chebyshev 
c
oefficient
s
 
is required for 
the above nonlinear optimization. In this 
sub
section,
 
we 
present 
a linear algorithm 
to acquire
 
the 
initial 
attitude 
Chebyshev 
coefficients
 
by assuming 
approximately 
known 
biases and 
correct
 
initial 
attitude
.
 
Multiplying 
b
n
q
 
on both sides of 
the 
attitude dynamics 
(
12
)
 
and the accelerometer
/
magnetometer 
measurement in 
(
3
)
 
and 
(
7
)
, ignoring the measurement noises
 
and using the quaternion multiplication property in
 
(
5
)
, we have
 
 














4 1
4 1
4 1
 
2
b
a n
b
m n
b b
g n n
t t
t t
t t t





 
ρ
q 0
ρ
q 0
ρ
q q 0

 
 
(
39
)
 
where the matrices are 
readily 
defined as
 
 


















 
n
a a a
n
m m
n
g g g ie
t t
t t
t t t






 
 
 
 
 
 

 
 
 
 
 
 
 
 
ρ
y b
γ
ρ
ω
y m
ρ
y b



 
 
(
40
)
 
 
Fig.
 
1.
 
Estimated state and its covariance propagation (the state and covariance 
at the end of Window 
k
 
are served as the initial condition for Window
 
k+
1
).
 
 
 
6
 
Substituting 
the 
quaternion Chebyshev polynomial
 
(
23
)
 
into 
(
39
)
 
yields
 
 












4 1
4 1
4 1
a
m
g
t vec
t vec
t vec






a D 0
a D 0
a D 0
 
 
(
41
)
 
where 


vec
D
 
is formed by stacking the columns of 
D
 
and the 
involved 
matrices are defined as
 
 




















4
2
T
a a
T
m m
T T
g g
t t t
t t t
t t t t
 

 
 

 
 
  
 
a F
ρ
a F
ρ
a F
ρ
F I




 
 
(
42
)
 
where 

 
denotes
 
the Kronecker product
.
 
Note that the identity 
property 






1 2 3 3 1 2
T
vec vec
 
A A A A A A
 
has been 
used 
in deriving
 
(
41
)
, where 
1
A
, 
2
A
,
3
A
 
are matrices of 
appropriate 
dimensions. 
Using the quaternion multiplication property and 
the definition of the attitude error in
 
(
20
)
, 
a correct 
initial 
attitude 
means
 
 




* *
0 0 ,0 ,0 0 3 1
2:4
2:4
2 2
b b b b
n n n n
  


 
   
   
 
   
 
ψ
q q q q 0
 
 
(
43
)
 
Approximating 
b
n
q
 
by Chebyshev polynomial
,
 
(
43
)
 
is 
written as
 
 


3 1
init
vec


A D 0
 
 
(
44
)
 
where 


*
0 ,0
2:4
2
T b
init n


 
 

 
 
 
A F q

.
 
Assume the initial 
biases are rough
l
y known
, the coefficient 
D
 
can be obtained 
by
 
using 
all available 
measurements and the initial attitude 
in 
the 
current 
time 
window
 
as
 
 




min    s.t.  =1
vec vec
D
A D B D
 
 
(
45
)
 
w
here 
the constraint term denotes the unit norm of the initial 
quaternion, which helps ensure a non
-
zero solution.
 
The 
matrices 
A
 
and 
B
 
are known matri
ces
 
as follows
 
 


0 4
T
T T T T
init g a m
T

 

 
 
A A A A A
B F I
 
 
(
46
)
 
TABLE
 
I
 
 
I
NERTIAL
-
M
AGNETIC 
A
TTITUDE ESTIMATION B
Y
 
P
OLYNOMIAL 
O
PTIMIZATION 
 
 
Qua
-
AttEstPO
 
Rod
-
AttEstPO
 
Input:
 
Chebyshev 
o
rder
 
q
N
 
or 
g
N
 
,
 
initial state 
0
x
 
with associated covariance 
0
P
,
 
inertial and magnetic measurements 






, ,    0,1 , ,
g i a i m i
t t t i M

y y y

 
and the measurement noise covariances 
, ,
g a m
R R R
 
 
S
tep 1:
 
Interpolate angular velocity measurement by EFH and obtain 
angular velocity at Chebyshev points
 


   0,1, ,
g i
i N


y

 
 
Step 2
:
 
Compute Chebyshev polynomial coefficients of quaternion 
b
n
q
 
by homogenous least squares (Eq. 
(
45
)
)
 




m in    s.t  =1
vec vec
D
A D B D
 
S
tep 3:
 
Obtain quaternion Chebyshev coefficients and sensor biases 
by solving constrained nonlinear least squares (Eq. 
(
29
)
)
 






0
, ,
min    
 s.t. 1   0,1, ,
a g
b
n k
J J J
k N

 
 
x v z
D b b
q

 
Acquire initial coefficients of the Rodrigues vector
 

g
 
using 
quaternion Chebyshev coefficients
 
(Eq. 
(
47
)
)
 




1
0
0
1/ 2 1 2
2
cos  cos
N
g
g g g
P
i
i
k
N N N
k i k
P P P
 



 
 
 

 
 
  
 
 
 
 

h g q
 
Compute Rodrigues vector Chebyshev polynomial coefficients 
and sensor biases by nonlinear least squares (Eq. 
(
32
)
)
 




0
, ,
min     
a g
J J J
 
x v z
H b b
 
S
tep 4:
 
Obtain attitude quaternion (Eq. 
(
23
)
)
 




0
   
q
N
b
n i i
i
F
 



q d
 
Obtain Rodrigues vector update and transform it to quaternion 
(Eqs. 
(
30
)
, 
(
13
)
 
and 
(
14
)
)
 
0
( ) ( )
g
N
i i
i
F
 

 

g h
 






0
 
b b
n n
 

 
q
q
q
g

，
 
 
S
tep 5:
 
Compute estimate covariance by 
multiplicative
 
EKF using 
AttEstPO 
estimate
d attitude (Eqs. 
(
36
)
-
(
37
)
)
 




9 1 9
T
T
k k k k k k k
T


   
P I B P I B G Q G
 


1
T T
k k k k k k k k k k

   
  
P P P
Η
H P H R H P
 
  
7
 
where 




0
T
T T
g g g N
 
 
 
A a a
 
 
is 
the matrix 
formed by 
the 
fitted angular velocit
y 
at Chebyshev points
,
 




T
T T
a a j a k
t t
 
 
A a a
 
and
 




T
T T
m m l m p
t t
 
 
A a a
 
 
respectively 
denote the 
matrices
 
from accelerometer and 
magnetometer measurements
 
and the 
time
stamp
 
in 
m
a
 
and 
a
a
 
denotes all the feasible measurement times that are detected by 
(
9
)
 
and 
(
10
)
. 
The minimization
 
in
 
(
45
)
 
is a homogenous 
least 
squares
 
problem 
of 
the quaternio
n
 
Chebyshev coefficients, 
which can be solved by 
the 
generalized singular value 
decomposition 
[42]
.
 
As for the
 
attitude
 
estimation 
problem in the form of
 
the 
Rodrigues vector
 
in
 
(
32
)
, the initial coefficients can be readily 
obtained by transforming the 
obtained 
quaternion coefficients 
in 
(
45
)
 
to 
the 
corresponding 
Rodrigues vector
 
update 
coefficients as
 




1
0
0
1/ 2 1 2
2
cos  cos
N
g
g g g
P
i
i
k
N N N
k i k
P P P
 



 
 
 

 
 
  
 
 
 
 

h g q
 
 
(
47
)
 
where 
0
i

 
is the Kronecker delta function, yielding 
1
 
for 
1
i

 
and zero otherwise.
 
The exact coefficients could be obtained 
only if the number of summation terms, 
g
N
P
, approaches 
infinity 
[35]
. 





 
g q
transforms the quaternion update to 
the Rodrigues vector update
 
as 
shown 
in 
(
15
)
, among which 




q
is obtained 
from
 
(
13
)
 
using the resultant 


b
n

q
 
by 
(
45
)
. 
 
Hereafter, we name the proposed attitude quaternion and 
Rodrigues vector estimation by polynomial optimization as 
Qua
-
AttEstPO and Rod
-
AttEstPO, respectively.
 
Table I lists 
the
ir 
main steps. The 
algorithm 
input 
includes 
the user
-
defined 
time
-
window size, the Chebyshev polynomial order 
for 
attitude
 
approximation
, the 
feasible 
sensor 
measurements in the current 
window a
nd the initial 
state 
with 
the associated 
covariance
. 
After the estimation
 
is complete
d
, the state and covariance at 
Fig.
 
2.
 
Euler angle errors of 
Qua
-
AttEstPO
,
 
Rod
-
AttEstPO
 
and
 
EKF 
across 100 
Monte
-
Caro runs
.
 
 
 
 
Fig.
 
3.
 
Gyroscope bias errors of 
Qua
-
AttEstPO, Rod
-
AttEstPO 
and
 
EKF 
across 
100 
Monte
-
Caro runs
.
 
 
 
Fig.
 
4.
 
Accelerometer bias errors of 
Qua
-
AttEstPO, Rod
-
AttEstPO and
 
EKF 
across 100 
Monte
-
Caro runs
.
 
 
Fig.
 
5.
 
A
verage attitude errors across 100 Monte
-
Caro runs 
for 
Qua
-
AttEstPO, 
Rod
-
AttEstPO and EKF
 
with the associated 2
-
standard deviation bound.
 
 
 
8
 
the 
end
 
of current 
time 
window 
are
 
exploited 
as the initial 
state 
and covariance 
for 
the 
next 
time 
window.
 
 
IV.
 
S
IMULATIONS AND EXPER
IMENTS
 
A.
 
Simulation Results
 
In this section, simulation
s
 
are
 
conducted to evaluate the 
proposed
 
Qua
-
AttEstP
O
 
and Rod
-
AttEstPO 
algorithm
s
, against
 
the 
popular 
multiplicative 
EKF
.
 
The estimate state in EKF 
includes the attitude, gyroscope and accelerometer biases. 
Interested readers 
are referred 
to 
[7]
 
for more details
 
about
 
the 
EKF implementation
.
 
Assum
e
 
a 9
-
axis 
M
IMU rotating at a fix position (longitude: 
112 deg, latitude: 28 deg height: 0 m) under the class
ic
 
coning 
motion for 20 seconds
.
 
The 
attitude 
time trajectory 
is described 
by the 
quaternion
 
as 








cos 2 sin 2 0 cos sin
T
b
n
t t
   
 
 
 
q
, where 
the 
coning frequency
 
0.74  rad/s
 

 
and 
the coning angle
 
10 deg


. 
T
he sampling frequency of the 
M
IMU is set to
 
100Hz
.
 
The biases of gyroscope
s
 
and accelerometer
s
 
are 
assumed 
to be 


0.5 0.3 0.2 deg
T

 
and 


2
0.1 0.2 0.2 m/s
T

, 
respectively
. The root power spectral density of the gyroscope 
measurement 
noise 
of 
each axis is set to 
1 h

,
 
and the noise 
standard deviation
s
 
of the normalized magnetometer and 
accelerometer measurement
s
 
in each axis are
 
set to 
0.02
 
and 
2
0.01 m s
, respectively
.
 
For all algorithms, t
he initial gyroscope and accelerometer 
biases 
are 
set to zero
s
 
and the statistics of the random noise
s
 
are
 
Fig.
 
6.
 
Average gyroscope and accelerometer bias errors across 100 Monte
-
Caro runs
 
for 
Qua
-
AttEstPO
, Rod
-
AttEstPO
 
and EKF with 
the associated 2
-
standard deviation bounds
.
 
 
 
Fig.
 
7.
 
Average attitude errors across 100 Monte
-
Caro runs
 
for Qua
-
AttEstPO
with different window sizes.
 
 
Fig.
 
8.
 
Average gyroscope and accelerometer bias errors across 100 Monte
-
Caro runs
 
for Qua
-
AttEstPO
 
with different window sizes.
 
 
 
Fig.
 
9.
 
A
verage attitude errors across 100 Monte
-
Caro runs
 
for 
Qua
-
AttEstPO
, 
Rod
-
AttEstPO
 
and EKF
 
with the associated 2
-
standard deviation bounds for 
small initial a
ttitude error
.
 
TABLE
 
I
I
 
 
RMSE
 
OF 
F
INAL 
A
TTITUDE 
E
STIMATES
 
 
R
oll (deg)
 
Yaw (deg)
 
Pitch (deg)
 
E
KF
 
4
.88
4
 
1
2.36
4
 
2
.23
3
 
Qua
-
AttEstPO
 
0
.026
 
0
.082
 
0
.026
 
R
od
-
AttEstPO
 
0
.026
 
0
.077
 
0
.015
 
  
9
 
assumed to be known. The Chebyshev 
polynomial 
order
s
 
of 
both 
quaternion and Rodrigues v
ector approximat
ion
 
are 
set to 
6
q g
N N
 
, 
the 
time 
window size is set to 0.1
 
seconds
 
and the 
number of Chebyshev points in the window is set to 
1 7
N
 
. 
In practical scenario
s
, the initial level angle (roll and pitch) 
can 
be 
readily obtained by the accelerometer leveling, but the yaw 
is 
more difficult
 
to 
determine 
by 
the magnetometer due to the 
magnetic disturbance
 
nearby
. Thus, 
a 
180 deg initial yaw error 
is 
assumed 
to 
fully assess 
the performance of different 
algorith
ms
. 
Specifically, t
he initial orientation error
s
 
of roll, 
yaw and pitch are 
assumed
 
as Gauss
ian
 
noise
s
 
with
 
zero
 
mean 
and
 
the standard derivation of 


5 180 5  deg
. 
 
Figure
s
 
2
-
4
 
plot the 
attitude
, gyroscope and accelerometer 
bia
s
 
error
s
 
across 
100 Monte Carlo runs. We see that the Qua
-
AttEstPO
 
and Rod
-
AttEstPO
 
are 
much 
superior to EKF in terms 
of stability and converg
ence
 
speed. 
The 
average of 
absolute 
estimation 
error
s
 
is
 
defined
 
to quantity the estimation accuracy
 
as
 
 










, ,
1
1
ˆ
L
l l
i
i k i k
l
k
L


 

x x
 
 
(
48
)
 
where 
L
 
denotes the number of Monte Carlo runs, 
and 
i
 
and 
k
 
denote the 
i
-
th state component at time
 
k
. For
 
brevity
, 
F
igs
.
 
5
-
6
 
respectively 
plot
 
the norm of the 
average 
errors 
for
 
attitude
 
and 
gyroscope
/
accelerometer biases. 
T
he 
2

 
bounds are 
calculated by twice the averaged square root of diagonal 
elements of the covariance matrix
.
 
For a consistent filter, the 
estimation error should stay below the 
2

 
derivation bounds 
with a possibility of 95% 
[43]
. Figures 
5
-
6
 
indicate that both 
Q
ua
-
AttEstPO
 
and Rod
-
AttEstPO
 
are consistent 
estimators
, 
while the EKF 
is
 
too optimistic. The RMSE of the estimate at 
the end of simulation
 
is
 
listed 
in Table I
I
. 
It shows
 
that the Rod
-
AttEstPO
 
is 
marginally 
better than Qua
-
AttEstPO
, which may 
be 
arguably 
owed to the fact 
that the 
parameter 
dimension 
of 
Qua
-
AttEstPO
 
is higher than 
that of 
Rod
-
AttEstPO
 
and solving 
the constrained optimization 
in Qua
-
AttEstPO
 
may 
be 
less 
accurate than 
the 
unconstrained optimization in Rod
-
AttEstPO
. 
However, due to the 
singularity 
of 
the 
Rodrigues 
vector at
 
a 
180

 
rotation, it is 
not recommended 
to utilize the Rod
-
AttEstPO
 
with 
a 
large 
window size. Therefore, we only use 
Qua
-
AttEstPO
 
for 
a 
large window 
computation
 
in the sequel
. 
Figures 
7
-
8
 
plot the 
average attitude and sensor bias error
s
 
of 
Qua
-
AttEstPO
 
with different window size
s
, namely,
 
0.1
/
1
/5/20 
seconds
. The Chebyshev polynomial order
s
 
are 
respectively 
set 
to
 
6, 40, 150, and 300
. 
We see that the 
estimation 
accuracy 
improves along with the increa
sed
 
window 
size. Larger window 
size 
means the algorithm employs 
more 
sensor 
information to 
estimate the state
,
 
which
 
causes a large
r
 
time delay
.
 
Since 
t
he 
algorithm can
not execute until all the measurements in the 
current window come in.
 
Note that the 
generalized singular 
value decomposition 
o
f a high
-
dimension matrix 
as 
in 
(
45
)
 
is 
time
-
consuming. 
Therefore
, 
the 
initialization
 
of Chebyshev 
coefficient
s
 
for 
AttEstPO
 
in a larger window 
is
 
carried out 
by 
fitting the states acquired by 
AttEstPO
 
of 
0.1s window size
.
 
All 
of 
the 
proposed
 
algorithms are 
implemented
 
with the 
function 
‘lsqnonlin’ 
on the MATLAB platform
. 
The average 
time cost across 100 Monte Carlo runs is listed in Table III. 
The 
time 
cost
s
 
of 
Rod
-
AttEstPO 
and Qua
-
At
tEstPO 
with 0.1s 
window size 
are
 
respectively 
about 3 and 10 times larger than 
that of 
EKF
, which can ensure 
a real
-
time 
algorithm 
execution
 
for 20
-
second data
. 
Although 
the 
computation burden
 
of
 
Qua
-
AttEstPO
 
increase
s
 
dramatically
 
along with the window size
,
 
it 
can 
still 
be used for
 
batch estimation.
 
 
The 
average attitude error 
across 
100 Mon
te 
Caro simulation 
runs 
for
 
small initial attitude error 
is
 
plotted in Fig. 
9
. The initial 
attitude error 
is
 
presumed as
 
Gaussian noise with zero mean and 


5 10 5  deg
 
standard deviation
,
 
the window size is 0.1s and 
the Chebyshev polynomial 
o
rder 
is 6
,
 
and 
other settings 
are 
the 
TABLE
 
I
II
 
C
OMPARISON OF 
C
OMPUTATION 
T
IME
 
A
lgorithm
 
(
Window Size)
 
R
od
-
AttEstPO
 
(0.1s)
 
Qua
-
AttEstPO
 
(0.1s)
 
Qua
-
AttEstPO
 
(1s)
 
Qua
-
AttEstPO
 
 
(5s)
 
Qua
-
AttEstPO
 
(20s)
 
E
KF
 
Time Cost
 
0
.91 s
 
3
.37 s
 
4
.93 s
 
25.4 s
 
5
2. 5 s
 
0
.35 s
 
 
 
Fig.
 
11.
 
The rough attitude trajectory obtained from the integration of the 
calibrated gyroscope measurements.
 
 
 
Fig.
 
10.
 
The MIMU installation in the experiment. The MIMU is placed in the 
center of the 
dodecahedron
 
and five Vicon markers are attached on the edges 
to acquire the true attitude of the 
dodecahedron
.
 
 
 
10
 
same with the above. 
T
he three 
algorithms 
achieve similar 
final 
accuracy
,
 
but
 
the convergence speed of 
Qua
-
AttEstPO
 
and 
Rod
-
AttEstPO
 
is 
faster than that of 
EKF
 
and t
he EKF appears 
inconsistent either in the first 
several seconds.
 
B.
 
Experiment Result
s
 
The experiment 
is
 
conducted using the Xsens M
TW
 
unit with 
the sample frequency of 100
 
Hz. 
The bias stabilit
ies
 
of 
gyroscope and accelerometer 
are
 
10
 
deg/h and 0.1
 
mg, 
respectively. The power spectrum densit
ies
 
of gyroscope, 
accelerometer and magnetometer 
noises 
are
 
respectively 
0.01 deg/s/ Hz
,
20 
μ
g/ HZ
 
and 
0.2 mGauss/ Hz
.
 
A Vicon 
motion capture system is used to provide the 
true 
attitude 
relative 
to 
its 
inherently
-
defined
 
reference frame
.
 
As 
shown 
in 
Fig
.
 
10
, the 
M
IMU is f
ixed 
at 
the cent
er
 
of a regular 
dodecahedron
, with 
five Vicon markers attached on the edge
s
 
of the dodecahedron. The Vicon system 
tracks 
the attitude 
change
 
by the markers. 
In view of
 
the magnetic material 
in
 
the 
dodecahedron, the magnetometer is calibrated before the 
exper
iment 
[32, 33]
. 
In the 
experiment, the unit stay
s
 
stationary 
on 
a
 
bench 
for 
about 90
 
s
econds
, then 
is picked up and rotated 
around itself 
for 
about 40
 
seconds
, and finally put back on the 
bench at the same attitude
. 
Two datasets are collected to test the 
proposed algorithms. 
T
he two datasets 
produce 
similar results, 
so 
we only show
 
one 
data
set 
result 
in this paper for 
brevity
. 
The 
rough 
attitude 
time 
trajectory is plotted in Fig. 
1
1
, which is 
obtained by integrating the 
gyroscope measurements 
with 
the 
gyroscope bias roughly calibrated by averaging the static 
gyroscope outputs before the 
rotation.
 
Due to the 
attitude 
misalignment between the 
MIMU 
and 
dodecahedron, the
ir
 
attitude
s
 
are not exactly the same
. However, 
the 
relative 
rotation angle 
of the 
MIMU 
body frame
, denoted by
 




0
b t
b

,
 
should be
 
identical
 
with 
that of 
the Vicon
. 
Specifically, 
the 
attitude
 
quaternion 
estimate 




b t
n t
q
 
of the MIMU 
is 
transform
ed
 
to
 
the relative 
attitude 
quaternion 




0
b t
b
q
 
by
 
multiplying the conjugate of the MIMU initial quaternion 
,0
b
n
q
, 
 
Fig.
 
14.
 
Gyroscope bias estimate result
s
 
across 100 Monte
-
Caro runs
 
for 
Qua
-
AttEstPO
, Rod
-
AttEstPO
, EKF
 
and the reference
 
in the experiment
.
 
 
Fig.
 
15.
 
A
verage 
of relative 
rotation angle error
s
 
acro
ss 100 Monte Carlo runs
for 
Qua
-
AttEstPO
, Rod
-
AttEstPO
 
and
 
EKF 
in the experiment
.
 
 
Fig.
 
12.
 
Relative rotation angle of the reference Vicon system 
in the experiment 
(Upper left is
 
the details of the first 10 seconds).
 
 
 
Fig.
13.
 
Relative 
rotation angle errors across 100 
Monte
-
Caro runs for 
Qua
-
AttEstPO
, Rod
-
AttEstPO
 
and
 
EKF
 
in the experiment
.
 
 
 
11
 
i.e.
,
 






*
,0
0
b t
b b
n n
b
t

q q q

.
 
Then, t
he 
relative 
rotation angle 
can be
 
com
puted 
by
 
 










0 0
1
2arccos
b t b t
b b

 

 
q
 
 
(
49
)
 
where 




0
1
b t
b
 
 
q
 
denotes the first element of 




0
b t
b
q
 
and t
he 
relative angle is defined on 


0

. 
The 
error
 
of the 
relative 
rotation angle 
is
 
defined
 
as
 
 




0
b t
vicon
b
  
  
 
 
(
50
)
 
w
here
 
vicon

 
is the relative rotation angle
 
of the Vicon system
, 
which 
is similarly computed from the Vicon’s 
attitude output
. 
Figure 1
2
 
plots the relative rotation angle 
from 
the 
Vicon 
system
, where 
the 
variation 
during the
 
first 10
-
second 
static 
outputs indicates that the accuracy of relative rotation angle is 
about 0.
3
 
deg.
 
The window size of Rod
-
AttEstPO
 
and Qua
-
AttEstPO
 
is 
0.1s and the Chebyshev 
polynomial 
order is 6. 
A set of 
Monte 
Carlo runs are also performed in the 
experiment
 
by 
intentionally 
randomizing the initial conditions
. 
Specifically, t
he initial 
gyroscope and accelerometer biases 
are
 
set to zero
s
 
and the 
initial attitude error is 
set to 
Gauss
ian 
noise 
with 
zero
 
mean 
and 


5 180 5  deg
 
standard dev
iation
. Figures 
1
3
-
1
4
 
plot the 
relative 
rotation 
angle 
error and the gyroscope bias 
across
 
100 
Monte Carlo runs
, where the reference gyroscope bias is 
roughly 
obtained
 
by averaging the static gyroscope outputs 
before the rotation
.
 
It can be seen that the results of 
Qua
-
AttEstPO
 
and Rod
-
AttEstPO
 
for 
different initial state value
s
 
are 
quite 
similar
 
in each run
, which 
demonstrates 
the 
superior 
stability of 
AttEstPO
 
in 
face of 
large initial attitude error
s
.
 
And, 
the average 
of relative 
rotation angle 
error
s
 
in Fig. 1
5
 
also 
highlight
s
 
the 
accuracy 
superiority of 
Qua
-
AttEstPO
 
and Rod
-
AttEstPO
 
over 
EKF.
 
The 
RMSE
s
 
of 
relative rotation angle at 
the end of experiment 
are
 
about 1.1, 0.03,
 
0.02
 
deg
rees
 
for 
EKF, 
Qua
-
AttEstPO and Rod
-
AttEstPO, 
res
pectively
.
 
V.
 
C
ONCLUSION
 
Attitude estimation by 
way of 
inertial
-
magnetic sensors 
is 
vital for
 
many
 
applications
. 
Traditional 
lineariz
ation
-
based 
EKF
 
is prone to diverg
ence
 
in 
the 
challenging scenarios with 
large initial state error
. 
To improve the 
estimation 
stability and 
convergence speed, 
t
his paper introduces the Chebyshev 
collocation method into the 
attitude estimation
, resulting in 
the 
so
-
called 
Qua
-
AttEstPO
 
and Rod
-
AttEstPO
 
algorithms
. They 
essentially 
transform 
the 
quaternion
/
Rodrigues vector 
estimation
 
into constrain
ed/
unconstrain
ed
 
least
 
square
s
 
problem
 
in a time window
 
of interest
.
 
Due to the 
inherent 
singularity of 
the 
Rodrigues vector, Rod
-
AttEstPO
 
is only 
suit
able
 
for 
a short time
 
window.
 
Simulation and field test 
results show that the 
Qua
-
AttEstPO
 
and Rod
-
AttEstPO
 
algorithms 
have similar accuracy 
with each other 
and 
perform 
quite 
well 
under large initial error
s
.
 
I
ncreasing the 
size of 
time 
window 
in 
Qua
-
AttEstPO
 
can further improve the 
estimation 
accuracy
 
yet 
at the 
price
 
of 
time delay. 
Therefore, 
Qua
-
AttEstPO
 
with 
a 
large window size can be treated as a batch 
attitude est
imation
 
method
.
 
Our future work will explore the 
advantage of 
the polynomial optimization
-
based estimation
 
in 
other 
navigation 
applications, e.g.
,
 
INS/GNSS integrated 
navigation.
 
 
A
CKNOWLEDGMENT
 
T
h
anks to M
iss
 
Miao
m
iao Yan and Dr. Boying Li, at 
Shanghai Jiao Tong University, for the
ir
 
test 
assistance
 
with the 
Vicon
 
tracking system
.
 
R
EFERENCES
 
[1]
 
H. Rehbinder, and X. Hu, “Drift
-
free attitude estimation for accelerated 
rigid bodies,” 
Automatica,
 
vol. 40, no. 4, pp. 653
-
659, 2004.
 
[2]
 
G. Vukovich, and H. Gui, “Robust adaptive tracking of rigid
-
body motion 
with applications to asteroid proximity opera
tions,” 
IEEE Transactions 
on Aerospace and Electronic Systems,
 
vol. 53, no. 1, pp. 419
-
430, 2017.
 
[3]
 
M. Hua, G. Ducard, T. Hamel, R. Mahony, and K. Rudin, 
“Implementation of a nonlinear attitude estimator for aerial robotic 
vehicles,” 
IEEE Transactions on
 
Control Systems Technology,
 
vol. 22, 
no. 1, pp. 201
-
213, 2013.
 
[4]
 
D. Roetenberg, H. Luinge, and P. Slycke, “Xsens MVN: Full 6DOF 
human motion tracking using miniature inertial sensors,” 
Xsens Motion 
Technologies BV, Tech. Rep,
 
vol. 1, 2009.
 
[5]
 
M. Zhu, Y
. Wu, and S. Luo, “f²IMU
-
R: pedestrian navigation by low
-
cost 
foot
-
mounted dual IMUs and interfoot ranging,” 
IEEE Transactions on 
Control Systems Technology,
 
vol. 30, no. 1, pp. 247
-
260, 2022.
 
[6]
 
P. D. Groves, 
Principles of GNSS, Inertial, and Multisensor
 
Integrated 
Navigation Systems
: Artech house, 2013.
 
[7]
 
J. Farrell, 
Aided Navigation: GPS with High Rate Sensors
: McGraw
-
Hill, 
Inc., 2008.
 
[8]
 
M. Nazarahari, and H. Rouhani, “40 years of sensor fusion for orientation 
tracking via magnetic and inertial meas
urement units: Methods, lessons 
learned, and future challenges,” 
Information Fusion,
 
vol. 68, pp. 67
-
84, 
2021.
 
[9]
 
R. Mahony, T. Hamel, and J.
-
M. Pflimlin, “Nonlinear complementary 
filters on the special orthogonal group,” 
IEEE Transactions on Automatic 
Co
ntrol,
 
vol. 53, no. 5, pp. 1203
-
1217, 2008.
 
[10]
 
J. Wu, Z. Zhou, F. H, R. Li, and M. Liu, “Generalized linear quaternion 
complementary filter for attitude estimation from multisensor 
observations: an optimization approach,” 
IEEE Transactions on 
Automation 
Science and Engineering,
 
vol. 16, no. 3, pp. 1330
-
1343, 2019.
 
[11]
 
J. F. Vasconcelos, B. Cardeira, C. Silvestre, P. Oliveira, and P. Batista, 
“Discrete
-
time complementary filters for attitude and position estimation: 
Design, analysis and experimental valid
ation,” 
IEEE Transactions on 
Control Systems Technology,
 
vol. 19, no. 1, pp. 181
-
198, 2010.
 
[12]
 
P. Marantos, Y. Koveos, and K. J. Kyriakopoulos, “UAV state estimation 
using adaptive complementary filters,” 
IEEE Transactions on Control 
Systems Technology,
 
vol. 24, no. 4, pp. 1214
-
1226, 2015.
 
[13]
 
A. M. Sabatini, “Quaternion
-
based extended Kalman filter for 
determining orientation by inertial and magnetic sensing,” 
IEEE 
Transactions on Biomedical Engineering,
 
vol. 53, no. 7, pp. 1346
-
1356, 
2006.
 
[14]
 
J. L. M
arins, X. Yun, E. R. Bachmann, R. B. McGhee, and M. J. Zyda, 
“An extended Kalman filter for quaternion
-
based orientation estimation 
using MARG sensors,” in Proceedings 2001 IEEE/RSJ International 
Conference on Intelligent Robots and Systems, 2001, pp. 2003
-
2011.
 
[15]
 
X. Yun, and E. R. Bachmann, “Design, implementation, and experimental 
results of a quaternion
-
based Kalman filter for human body motion 
tracking,” 
IEEE Transactions on Robotics,
 
vol. 22, no. 6, pp. 1216
-
1227, 
2006.
 
[16]
 
M. Zhu, W. Ouyang, and Y
. Wu, “Orientation estimation by partial
-
state 
updating Kalman filter and vectorial magnetic interference detection,” 
IEEE Transactions on Aerospace and Electronic Systems,
 
vol. 57, no. 3, 
pp. 1815 
-
 
1826, 2021.
 
[17]
 
S. O. Madgwick, A. J. Harrison, and R. 
Vaidyanathan, “Estimation of 
IMU and MARG orientation using a gradient descent algorithm,” in 2011 
IEEE international conference on rehabilitation robotics, 2011, pp. 1
-
7.
 
[18]
 
S. Wilson, H. Eberle, Y. Hayashi, S. O. Madgwick, A. McGregor, X. Jing, 
and R. 
Vaidyanathan, “Formulation of a new gradient descent MARG  
12
 
orientation algorithm: Case study on robot teleoperation,” 
Mechanical 
Systems and Signal Processing,
 
vol. 130, pp. 183
-
200, 2019.
 
[19]
 
J. Vandersteen, M. Diehl, C. Aerts, and J. Swevers, “Spacecraft
 
attitude 
estimation and sensor calibration using moving horizon estimation,”
 
Journal of Guidance Control and Dynamics,
 
vol. 36, no. 3, pp. 536
-
542, 
2013.
 
[20]
 
W. Higgins, “A comparison of complementary and Kalman filtering,” 
IEEE Transactions on Aerospace
 
and Electronic Systems,
 
vol. 11, no. 3, 
pp. 321
-
325, 1975.
 
[21]
 
F. L. Markley, and J. L. Crassidis, 
Fundamentals of Spacecraft Attitude 
Determination and Control
: Springer, 2014.
 
[22]
 
A. Barrau, and S. Bonnabel, “Intrinsic filtering on Lie groups with 
app
lications to attitude estimation,”
 
IEEE Transactions on Automatic 
Control 
vol. 60, no. 2, pp. 436 
-
 
449, 2015.
 
[23]
 
H. Gui, and A. H. J. d. Ruiter, “Quaternion invariant extended Kalman 
filtering for spacecraft attitude estimation,” 
Journal of Guidance Con
trol 
and Dynamics,
 
vol. 41, no. 4, pp. 863
-
878, 2018.
 
[24]
 
J. L. Crassidis, and F. L. Markley, “Unscented filtering for spacecraft 
attitude estimation,” 
Journal of Guidance Control and Dynamics,
 
vol. 26, 
no. 4, pp. 536
-
542, 2003.
 
[25]
 
Y. Cheng, and J. L. Crassidis, “Particle filtering for attitude estimation 
using a minimal local
-
error representation,” 
Journal of Guidance Control 
and Dynamics,
 
vol. 33, no. 4, pp. 1305
-
1310, 2010.
 
[26]
 
H. Fourati, N. Manamanni, L. Afilal, and Y. Handrich
, “Complementary 
observer for body segments motion capturing by inertial and magnetic 
sensors,” 
IEEE/ASME Transactions on Mechatronics,
 
vol. 19, no. 1, pp. 
149 
-
 
157, 2014.
 
[27]
 
H. Sommer, J. R. Forbes, R. Siegwart, and P. Furgale, “Continuous
-
time 
estimat
ion of attitude using B
-
splines on Lie groups,”
 
Journal of 
Guidance Control and Dynamics,
 
vol. 39, no. 2, 2016.
 
[28]
 
M. Zhu, and Y. Wu, “Continuous
-
time State Estimation by Chebyshev 
Polynomial Optimization,” 
IEEE Transactions on Signal Processing,
 
vol. 
70
, pp. 3136
-
3147, 2022.
 
[29]
 
M. Zhu, and Y. Wu, “Lightweight precision inertial computation based 
on chebyshev polynomial optimization,” in 29th Saint Petersburg 
International Conference on Integrated Navigation Systems, 2022, pp. 1
-
9.
 
[30]
 
L. N. Trefethen,
 
Approximation Theory and Approximation Practice
: 
SIAM, 2019.
 
[31]
 
J. P. Boyd, 
Chebyshev and Fourier Spectral Methods
, 2 ed.: Courier 
Corporation, 2001.
 
[32]
 
M. Zhu, Y. Wu, and W. Yu, “An efficient method for gyroscope
-
aided 
full magnetometer calibration,”
 
IEEE Sensors Journal,
 
vol. 19, no. 15, pp. 
6355 
-
 
6361, 2019.
 
[33]
 
Y. Wu, D. Zou, P. Liu, and W. Yu, “Dynamic magnetometer calibration 
and alignment to inertial sensors by Kalman filtering,” 
IEEE 
Transactions on Control Systems Technology,
 
vol. 26, no. 2,
 
pp. 716
-
723, 
2017.
 
[34]
 
A. H. Jazwinski, 
Stochastic Process and Filtering Theory
, NY, USA: 
Academic Press, 1970.
 
[35]
 
W. H. Press, S. A. Teukolsky, W. T. Vetterling, and B. P. Flannery, 
Numerical Recipes : the Art of Scientific Computing
, 3 ed.: Cambridge
 
University Press, 2007.
 
[36]
 
G. Klein, “An extension of the Floater
–
Hormann family of barycentric 
rational interpolants,” 
Mathematics of Computation,
 
vol. 82, pp. 2273
-
2292, 2013.
 
[37]
 
Y. Wu, and M. Zhu, “Attitude reconstruction from inertial measurement:
 
mitigating Runge effect for dynamic applications,” 
IEEE Transactions on 
Aerospace and Electronic Systems
, 2021.
 
[38]
 
I. M. Ross, and M. Karpenko, “A review of pseudospectral optimal 
control: From theory to flight,” 
Annual Reviews in Control,
 
vol. 36, no. 
2, pp. 182
-
197, 2012.
 
[39]
 
S. Boyd, and L. Vandenberghe, 
Introduction to Applied Linear Algebra: 
Vectors, Matrices, and Least Squares
: Cambridge University Press, 2018.
 
[40]
 
J. Berrut, and G. Klein, “Recent advances in linear barycentric rational 
interpola
tion,” 
Journal of Computational and Applied Mathematics,
 
vol. 
259, pp. 95
-
107, 2014.
 
[41]
 
C. V. Rao, J. B. Rawlings, and D. Q. Mayne, “Constrained state 
estimation for nonlinear discrete
-
time systems: stability and moving 
horizon approximations,”
 
IEEE Tran
sactions on Automatic Control,
 
vol. 
48, no. 2, pp. 246
-
258, 2003.
 
[42]
 
K. Inkilä, “Homogeneous least squares problem,” 
Photogrammetric  
Journal of Finland,
 
vol. 19, no. 2, pp. 34
-
42, 2005.
 
[43]
 
Y. Wu, D. Hu, M. Wu, and X. Hu, “A numerical
-
integration persp
ective 
on Gaussian filters,” 
IEEE Transactions on Signal Processing,
 
vol. 54, 
no. 8, pp. 2910
-
2921, 2006.
 
 