Prepared for submission to JCAP
Improving initialization and
evolution accuracy of cosmological
neutrino simulations
James M. Sullivan,a,b,1J.D. Emberson,cSalman Habib,c,d
Nicholas Frontierec,d
aDepartment of Astronomy, University of California, Berkeley, CA 94720, USA
bBerkeley Center for Cosmological Physics, University of California, Berkeley, CA 94720,
USA
cCPS Division, Argonne National Laboratory, 9700 South Cass Avenue, Lemont, IL 60439,
USA
dHEP Division, Argonne National Laboratory, 9700 South Cass Avenue, Lemont, IL 60439,
USA
E-mail: jmsullivan@berkeley.edu, jemberson@anl.gov, habib@anl.gov,
nfrontiere@anl.gov
Abstract. Neutrino mass constraints are a primary focus of current and future large-scale
structure (LSS) surveys. Non-linear LSS models rely heavily on cosmological simulations –
theimpactofmassiveneutrinosshouldthereforebeincludedinthesesimulationsinarealistic,
computationally tractable, and controlled manner. A recent proposal to reduce the related
computational cost employs a symmetric neutrino momentum sampling strategy in the initial
conditions. We implement a modified version of this strategy into the Hardware/Hybrid Ac-
celerated Cosmology Code ( HACC) and perform convergence tests on its internal parameters.
We illustrate that this method can impart O(1%)numerical artifacts on the total matter
field on small scales, similar to previous findings, and present a method to remove these ar-
tifacts using Fourier-space filtering of the neutrino density field. Moreover, we show that the
converged neutrino power spectrum does not follow linear theory predictions on relatively
large scales at early times at the 15%level, prompting a more careful study of systematics
in particle-based neutrino simulations. We also present an improved method for backscaling
linear transfer functions for initial conditions in massive neutrino cosmologies that is based
on achieving the same relative neutrino growth as computed with Boltzmann solvers. Our
self-consistent backscaling method yields sub-percent accuracy in the total matter growth
function. Comparisons for the non-linear power spectrum with the Mira-Titan emulator at a
neutrino mass of mν= 0.15 eVare in very good agreement with the expected level of errors
in the emulator and in the direct N-body simulation.
1Corresponding author.arXiv:2302.09134v2  [astro-ph.CO]  10 Jun 2024Contents
1 Introduction 1
2 Iterative Backscaling 3
3 Neutrino Initial Conditions and Evolution 10
4 Results 14
4.1 Convergence Study of Neutrino Initialization Parameters 14
4.2 Suppression of Neutrino Grid Artifacts 17
4.3 Emulator Comparison 21
4.4 Examination of Neutrino Growth 22
5 Conclusions 24
1 Introduction
The non-zero mass of neutrinos is perhaps the most well-established manifestation of beyond
Standard Model physics [1–3]. Constraints on total neutrino mass are available from terres-
trial experiments with a current upper limit of 0.8eV, which is expected to be eventually
reduced to a mass sensitivity of ∼0.2eV [4]. Current cosmological limits from the cosmic mi-
crowave background and large-scale structure (LSS) surveys have tighter bounds, at the level
of0.1eV [5, 6] with some sensitivity to the modeling of systematic effects. LSS observations
play an important role in constraining neutrino masses due to the characteristic suppression
of the matter power spectrum, Pm(k), below the neutrino free-streaming scale. This scale
is roughly kfs(z)≈(mν
eV)√ΩmahMpc−1in matter domination [7]. Since the free-streaming
scale is proportional to the neutrino mass, mν, and the total amplitude of suppression is
proportional to the neutrino energy density, Ων, observational probes of large-scale structure
afford the opportunity, at least in principle, to probe both the individual and total neutrino
masses.
The approach to constraining neutrino mass based on cosmological observations comple-
ments particle physics-based probes such as oscillation experiments [e.g., 8, 9] that are sen-
sitive to mass-squared differences between mass eigenstates and tritium β-decay experiments
[10–13] that aim to constrain the absolute neutrino mass scale. Although disentangling indi-
vidual neutrino masses from cosmological observations remains challenging in practice [14],
upper bounds placed on the total mass are becoming increasingly precise. For instance, DESI
is expected to measure the total mass with an error of 0.02 eV[15] or less when combined with
CMB-S4 [16], which is an order of magnitude improvement over the lower limit of Ref. [4].
The uncertainty on measurements of matter two-point statistics in modern surveys is
small enough that the effect of massive neutrinos needs to be included for accurate modeling
thereof as measured, e.g., by gravitational lensing or spectroscopic galaxy surveys [17–27].
The effect of neutrinos on LSS has also been highlighted through alternative probes such as
voids [28–32], which have been shown to be particularly sensitive to neutrinos in simulations
(however, see Ref. [33]), or through higher-order statistics like the bispectrum [34–36]. Accu-
rate modeling of the total matter density field over a wide range of scales is required to exploit
– 1 –these probes. In particular, it is well-known that neutrinos produce scale-dependent growth of
the matter field on scales below their free-streaming scale, which is of order kfs∼0.1hMpc−1
for a neutrino of mass mν∼0.1 eV(atz= 0). However, the detailed effect of massive neu-
trinos on the small-scale matter distribution remains less well understood due to non-linear
evolution at k≳0.1hMpc−1, especially for statistics beyond the matter power spectrum.
While halo model based approaches can be pursued [37, 38], more accurate modeling of the
matter field on these nonlinear scales is attainable, in principle, through N-body simulations
that model the growth of structure in the presence of massive neutrinos.
Cosmological simulations may account for the presence of massive neutrinos at several
levels of detail1. The simplest prescription is to treat massive neutrinos explicitly only at the
level of the homogeneous and isotropic background, and including the neutrino perturbations
through linear theory, effectively a leading-order expansion in the parameter fν= Ω ν/Ωm
[39–41]. This method has been used in the Mira-Titan power spectrum emulator [42], to
which we will compare our results in Section 4. At the next level, massive neutrino perturba-
tions are evolved on a mesh following linear theory and are added as a background component
to the gravitational potential during the cold matter (cold dark matter and baryons) force
calculation [43]. This approach is potentially problematic, as the choice to evolve cold matter
non-linearly while evolving massive neutrinos at the linear level violates momentum con-
servation [44], in addition to obviously discarding the impacts of non-linear neutrino growth.
Various classes of “linear response” methods [45–47] take this another step further by allowing
the background neutrino mesh to evolve perturbatively in response to the instantaneous non-
linear cold matter field of the simulation. Alternative simulation techniques have also been
proposed including the computationally ambitious approach of directly solving the Vlasov-
Poisson equation in phase space [48], or to solve the neutrino evolution with a Boltzmann
hierarchy expansion [49–51].
Perhaps the most accurate, yet still feasible, choice for non-linear LSS modeling is to
treat both cold species and massive neutrinos on equal footing in multi-species particle sim-
ulations. The idea of multi-species simulations, with separate particles for the cold matter
and neutrinos, is far from new [e.g., 52–64] and, while superficially straightforward, has a
number of subtleties leading to variations in its implementation. A comparison campaign
between a number of particle-based approaches as well as some approximate techniques has
been recently performed in Ref. [65]. Variations in the particle method typically stem from
numerical difficulties associated with modeling fast-moving thermal neutrino particles at early
times. One way to overcome this challenge is to adopt a “hybrid” approach [66–68] where
the mesh-based strategies described above are utilized at high redshift while switching to
particle-based schemes at later times when the neutrino thermal motion has been sufficiently
damped. Given the motivation to constrain neutrino masses via cosmological observations,
there has also been a recent effort to extend the physical fidelity of neutrino simulations by
including baryons as an additional species treated numerically with hydrodynamics [69–71].
One of the main challenges posed by neutrino particle simulations is that they are typi-
cally limited by shot noise effects due to the high thermal motion of neutrinos at early times.
These effects overwhelm the cosmological neutrino signal in the power spectrum unless an
extreme number of neutrino particles are simulated [60]. To address this issue, Ref. [72] intro-
duced a method of setting initial conditions for neutrino particles that involves a symmetric
sampling of the neutrino momenta across the simulation domain. This symmetry drastically
1The following techniques can be applied to any massive thermal relic species, but we will restrict our
attention to massive neutrinos.
– 2 –reduces the scale-independent shot noise that has plagued earlier simulations, allowing the
use of many fewer neutrino particle tracers. For this reason, a variant of this symmetric
scheme (hereafter “tiling”, to refer to the angular tiling of momenta on the sphere) has been
explored by other particle-based neutrino simulations (e.g., Refs. [61–63]). However, while
tiling succeeds in suppressing neutrino shot noise, it can also introduce numerical artifacts in
boththe neutrino and cold matter density fields, as well as their growth, as we will show.
Another challenge with neutrino simulations relates to how the Newtonian approxima-
tion complicates the construction of initial conditions. To initialize the cold matter and
neutrinos, linear theory transfer functions, generally computed using a Boltzmann solver,
must be provided to the simulation as input. To recover the correct observationally-relevant
linear matter power spectrum on large scales at low redshift, one cannot simply provide
the transfer functions at the initial redshift of the simulation. Boltzmann codes (correctly)
include non-negligible radiation and metric perturbation terms in the linear equations of mo-
tion of the evolved species, which are not included in the Newtonian simulation. It is possible
to include the radiation (and massive neutrino) perturbations explicitly when performing
the N-body simulation [73, 74], but usually some form of “backscaling” is employed instead
[75]. For simulations including massive neutrino particles, a linear two-fluid approximation
for backscaling transfer functions to account for scale-dependent growth of matter due to
neutrinos was developed in Ref. [76]. Massive neutrinos, however, do not constitute a fluid.
We address the benefits and shortcomings of treating them as such, and introduce our own
improved backscaling scheme.
In this paper, we focus on the two main challenges outlined above. First, we present an
iterativebackscalingmethodinSection2thatisdesignedtocreateaself-consistentinitialcon-
dition framework for massive neutrino cosmologies. Next, we follow the tiling approach [72],
by implementing it within the Hardware/Hybrid Accelerated Cosmology Code ( HACC; [77]).
We describe our custom implementation of the tiling scheme in Section 3 along with the extra
code modifications required to efficiently simulate neutrino particles in a high-performance
setting. We present a suite of neutrino simulations in Section 4 that are used to perform a
numerical convergence study on the internal parameters of the tiling scheme. We also show
results from a mitigation strategy used to remove numerical artifacts arising from the dis-
cretization of the initial condition neutrino grid. We compare our final results for the total
matter power spectrum with the Mira-Titan emulator and find good agreement. Furthermore,
we use our backscaled neutrino transfer functions to show that the simulated neutrino power
spectrum systematically deviates from linear theory at early times. We finish with concluding
remarks in Section 5.
2 Iterative Backscaling
Setting up the initial conditions of the cold matter and neutrino particles requires the density
and velocity fields at the starting redshift of the simulation, zini. These fields can be obtained
in linear theory using a Boltzmann solver such as CAMB[78] orCLASS[79]. The only caveat
is that cosmological simulations typically do not perform the correct linear evolution between
the time the species are initialized and the final simulation redshift, zfin. In particular,
simulations generally employ a Newtonian forward model that omits the radiation and metric
perturbations included in the evolution equations of Boltzmann codes. As such, the usual
convention is to construct the initial conditions in such a way that the final growth in density
perturbations matches the linear theory total matter power spectrum, Pm(zfin, k), at the end
– 3 –of the simulation. This process is referred to as “backscaling”. For z > z fin, the simulation
and Boltzmann code power spectra will disagree at the linear level, with this disagreement
greatestonlargescalesandearlytimes(seeFigure2foranexample). Intheabsenseofmassive
neutrinos, the growth of total matter density perturbations in the Newtonian forward model
will be scale-independent meaning that the zfinlinear transfer function can simply be rescaled
using a multiplicative factor, D, known as the growth factor.
The procedure for computing the scale-independent growth factor in a massless neu-
trino cosmology involves solving the coupled set of continuity, Euler, and Poisson equations,
expressed below at the linear level [e.g., 80]:
∂δm
∂a+θm
a2H= 0, (2.1)
∂θm
∂a+θm
a=−1
a2H∇2ϕ, (2.2)
∇2ϕ=3
2H2Ωma2δm, (2.3)
where θ≡ ∇ ·vmis the velocity divergence field and the subscript mdenotes the combined
matter field (cold dark matter plus baryons). The solution2to these equations is found by
assuming that δmcan be factored into a component that depends only on space and a com-
ponent that depends only on time. The time-dependent component is known as the growth
factor since it describes the growth of density perturbations in time: δm(a)∝D(a). It fol-
lows from the continuity equation that θm(a)∝a2H(a)dD/da. From the above expressions,
it is clear that the growth factor depends on the particular cosmology, via the background
expansion in the Hubble parameter H, as well as through the gravitational source term of
the Poisson equation, set by the total matter density, Ωm. For reasons made clear below, we
emphasize the latter dependence by writing the growth factor as D(a,Ωm).
Once the growth factor has been computed, backscaling is accomplished by rescaling
the transfer function that encodes the time evolution of matter perturbations in linear theory
obtained from the Boltzmann code at the final redshift, Tm(zfin, k), in the following manner:
Tbs
m(zini, k) =D(zini,Ωm)
D(zfin,Ωm)Tm(zfin, k), (2.4)
where the superscript “bs” denotes the backscaled transfer function used as an input to
the simulation initial conditions. In the event that cold dark matter and baryon particles
are treated as separate species (e.g., in hydrodynamics simulations) then their respective
backscaled transfer functions follow as:
Tbs
α(zini, k) =Fα(zini, k)D(zini,Ωm)
D(zfin,Ωm)Tm(zfin, k), (2.5)
where the subscript α∈ {c, b}denotes cold dark matter and baryons, respectively, and we
define the term
Fα(z, k)≡Tα(z, k)/Tm(z, k). (2.6)
It is important that Fαis used in this manner to ensure that each species is initialized with
the correct proportion relative to the total matter field at zini(i.e., backscaling by simply
2There are two independent solutions to this set of equations but we focus only on the “growing” mode
while ignoring the “decaying” mode that becomes subdominant at late times.
– 4 –replacing Tmin equation (2.4) with Tαwould be incorrect due to the fact that the individual
solutions for δc,bcannot be factored into spatial- and time-independent components as could
be done with δm). The initial particle velocities are computed by defining an initial velocity
transfer function, Tθ,α, for each species. This is computed from the continuity equation as
the time derivative of the backscaled density transfer function evaluated at the initial time:
Tbs
θ,α(zini, k) =−a2H(a)dTbs
α
da
z=zini. (2.7)
In practice, this can be computed using a finite difference of equation (2.4) evaluated at
zini±ϵ[54, 59] (here we use ϵ= 0.1). If only the combined matter field is desired, as is
the case in standard single-species simulations, then it follows from equation (2.4) that the
time derivative of Tbs
min equation (2.7) reduces to the time derivative of D, meaning that the
velocity transfer function is proportional to the density transfer function. For this reason,
single-speciessimulationsgenerallydonotuseanexplicitvelocitytransferfunction, butrather
just numerically evaluate the time derivative of D.
In the presence of massive neutrinos, backscaling is complicated by the fact that the
total matter field no longer evolves in a scale-independent manner, even in the Newtonian
forward model. The reason is related to the large thermal component of neutrino motion that
induces a characteristic free-streaming scale, kfs. In short, neutrinos cluster like cold matter
on scales k≪kfsbut possess sufficient kinetic energy to evade capture in the gravitational
potential sourced by cold matter on scales k≫kfs. In other words, neutrinos contribute to
the growth of density perturbations only on scales much larger than the free-streaming scale.
Hence, the usual backscaling prescription presented above would only be valid on the large
scales for which neutrinos contribute to the growth of density perturbations.
In principle, the solution to this problem is to solve the coupled set of growth equations
for both the cold matter and neutrinos in order to compute the scale-dependent growth
factor that can be used in equation (2.4). The difficulty with this approach is that the
neutrino Euler equation includes a pressure gradient term that is not trivially expressible in
an analytic framework. One strategy is to model neutrinos using the fluid approximation so
that a tractable solution can be obtained. This is the approach taken in the code REPS[76]
whichhasattainedwidespreadusageincosmologicalsimulations[33,34,62,63,65,69,81–87].
The drawback of this approach, however, is that the neutrino growth predicted by the fluid
approximation can result in ∼100%discrepancies compared to Boltzmann codes. This feeds
back as an error in the total matter growth function (albeit with a much smaller amplitude
that scales like fν) meaning that the initial conditions will not be seeded in a manner that is
consistentwiththeactualneutrinogrowthpredictedbytheBoltzmannsolver. Moreover, such
large discrepancies in the neutrino growth rate invalidate the use of the fluid approximation
in checking whether or not the neutrino particles end up growing correctly in the simulation.
We propose an alternative strategy that replaces the use of the fluid model with an
iterative scheme that assumes the neutrino growth relative to cold matter follows exactly
from the output of the Boltzmann code. The basic idea of our method is to replace the
value of Ωmin the gravitational source term of the Poisson equation with a scale-dependent
quantity, Ωeff
m(k), defining the total amount of matter contributing to the growth of density
perturbations on scale k. We make use of the known asymptotic limits for growth in massive
neutrino cosmologies: on large scales neutrinos contribute to growth so that Ωeff
m(k≪kfs)→
Ωcbνwhile on small scales neutrinos free-stream meaning that Ωeff
m(k≫kfs)→Ωcb. On
intermediate scales, we should observe a monotonic transition between the asymptotic limits.
– 5 –This is then used to compute a scale-dependent growth factor, D(z,Ωeff
m), that is calculated in
the same manner as is commonly done for massless neutrino cosmologies except that the Ωm
term in the gravitational source term is replaced with Ωeff
m(k). The determination of Ωeff
m(k)
is performed iteratively until we arrive at a self-consistent solution for all k. We circumvent
the use of approximate models for neutrino growth by interpolating from the direct output of
Boltzmann codes for the neutrino growth relative to cold matter. Of course, this method is
still approximate as we collapse the impact of the time-varying neutrino free-streaming length
into a single time-integrated quantity Ωeff
m(k)used to scale the growth between ziniandzfin.
However, as shown below, the errors introduced in this approximation are small and notably
improved compared to the commonly adopted approach.
The first step in each iteration of our scheme is to set up the initial densities and
velocities of the cold dark matter and baryons at the starting time, zini, of the simulation.
The densities are set by specifying δα=Tbs
αfollowing equation (2.5) with the growth factor
evaluatedusingthescale-dependent Ωeff
m(k)ofthatiteration. Notethatonlythe Ωmappearing
in the gravitational source term in the growth factor is replaced with Ωeff
mand not any of
the background terms in the Hubble factor. The velocities are set by specifying θα=Tbs
θ,α
following equation (2.7) with Tbs
αevaluated at zini±0.1using the scale-dependent D(z,Ωeff
m).
From here, we use a fourth-order Runge-Kutta method to evolve the coupled set of continuity,
Euler, and Poisson equations from aini= 1/(zini+ 1)toafin= 1/(zfin+ 1)with steps taken
inlna:
dδc,b
dlna=−θc,b
aH,
dθc,b
dlna=−
θc,b+3
2aHΩmδm
, (2.8)
where Ωm= Ω cbνandδm=fcδc+fbδb+fνδν(with fα≡Ωα/Ωm) is the total non-relativistic
matter contribution at time a. Note that Ωmin this expression is fixed as Ωcbνin order to
match how the gravitational forces are solved in the simulation. In other words, Ωeff
mis used
onlyin the calculation of the growth factor used to set the initial conditions and does not
appear anywhere else in the iterative procedure.
Obviously, evaluating the expression above in a self-consistent manner requires knowl-
edge of δν(a). The approach used in the REPScode of Ref. [76] is to couple the neutrinos
in the integration of equation (2.8) with an additional neutrino pressure term that is mod-
eled with the fluid approximation. Instead of attempting to directly model the growth of
neutrino perturbations we rather interpolate from the output of the Boltzmann code. More
specifically, we store the ratio Rν=Tν/TcbfromCAMBat a series of scale factors between
ainiandafin(the ratio is deliberately used – over interpolating only Tν– so as to cancel out
the scale-dependencies associated with the relativistic contributions ignored in the Newtonain
forward model). This is then used to set δν(a) =δcb(a)Rν(a)where δcb(a)is evaluated at
the instantaneous aof the time integrator and Rν(a)is linearly interpolated from the sample
points. In this way, we avoid the use of any approximations in the modeling of the neutrino
pressure term. More importantly, this method is self-consistent since the ultimate goal of the
simulation is to model the neutrinos in such a way that their growth relative to the total
matter follow the linear theory predictions of the Boltzmann code at early times.
The first iteration in our scheme involves setting Ωeff
m= Ω cbνfor all kin the backscaled
growth factor. At the end of the first iteration, we find that the final solution for δm(zfin, k)
matches with that expected from the unmodified CAMBdensity transfer function on large
– 6 –10−510−310−1101
k[hMpc−1]0.00.20.40.60.81.0(Ωeﬀ
m−Ωcb)/(Ωcbν−Ωcb)
mν= 0.45
mν= 0.15
mν= 0.05
zini= 40
zini= 20
zini= 10
kfs(z= 20)Figure 1 . Converged Ωeff
m(k)for various neutrino masses and initial redshifts (normalized so that
Ωcbνis unity and Ωcbis 0). For reference, the vertical shaded lines show the neutrino free-streaming
scale evaluated at z= 20for the corresponding neutrino mass.
scales. On smaller scales, however, we find that δm(zfin, k)is suppressed since the initial den-
sity perturbations were backscaled under the incorrect assumption that neutrinos contribute
to growth on those scales. At the end of the first iteration, we mark as sufficiently converged
anykfor which δm(zfin, k)is within ϵ= 10−6ofTm(zfin, k). In the second iteration, we set
Ωeff
m= Ω cbfor all remaining unconverged scales. The result at zfinis the opposite of the
first iteration: on small scales we find that δmmatches Tm(zfin, k)while on larger scales δm
is enhanced with respect to CAMBsince those scales were backscaled using an insufficiently
small value for the gravitational source term. We again mark as converged any scales kthat
are within ϵof the target solution. The result after two iterations is that the largest and
smallest scales are converged while the results on intermediate scales can be linearly inter-
polated to make a guess for Ωeff
m(k)on the next iteration. This procedure is continued with
each individual kupdating its bracketing bounds of Ωeff
m(k)around either side of the root of
the equation y=δm(zfin, k)/Tm(zfin, k)−1until convergence is reached. In practice, we find
that four iterations are usually sufficient to satisfy our convergence criteria for Ωeff
m(k).
We show in Figure 1 the converged result for Ωeff
m(k)for three different neutrino masses
(mν= 0.05, 0.15, and 0.45 eV) and three different initial redshifts ( zini= 40, 20, and 10). In
each case we set zfin= 0and use the cosmological parameters ( Ωc,Ωb,Ων,ΩΛ,h,Neff) =
(0.2684, 0.0491, mν/(93.14h2),1−Ωcbν, 0.6711, 2.046). For each case, we find the expected
result that Ωeff
m→Ωcbν(Ωcb)on large (small) scales with a smooth transition between these
limits on intermediate scales. The scales at which Ωeff
mmakes the transition between the two
asymptotic limits will roughly span the neutrino free-streaming scales covered between zini
andzfin. For reference, the vertical lines in Figure 1 show kfsevaluated for each neutrino mass
atz= 20. Note that the departure from the large-scale limit of Ωeff
m= Ω moccurs on larger
scales as ziniis increased with fixed neutrino mass. The reason is that kfs∝√ameaning that
the inclusion of earlier times will reflect neutrino suppression on progressively larger scales.
Hence, Ωeff
m(k)depends not only on mν, but also on the specific choices of ziniandzfin.
In Figure 2, we show the resulting backscaled total matter density transfer function,
evaluated using the converged Ωeff
m(k)in equation (2.4), at various redshifts for the mν=
0.15 eVcase with zini= 40. For reference, we show the backscaled transfer function divided
by the unmodified CAMBtransfer function evaluated at each redshift. By construction, our
– 7 –10−410−310−210−1100101
k[hMpc−1]1.001.011.021.03Tbs
m
TCAMBm(k)z=40.0
z=5.0
z=0.0
SONICC
REPS
mν= 0Figure 2 . Total matter transfer functions from our iterative backscaling procedure ( SONICC, solid
lines) normalized to the unmodified CAMBtransfer functions at various redshifts for a massive neu-
trino cosmology with mν= 0.15 eV,zini= 40, and zfin= 0. For comparison, the dashed lines show
corresponding results from REPSwhile the dotted lines show results from a massless neutrino cos-
mology. For the latter, we use the same cosmological parameters as the massive neutrino case except
that we absorb ΩνintoΩcand also increase Nefffrom 2.046 to 3.046.
transfer function matches exactly with CAMBatzfin= 0and deviates at higher redshift. In
order to get a rough idea of the level of disagreement we expect with CAMBat high redshift,
we also plot as dotted lines the ratio of backscaled transfer functions to CAMBfor a massless
neutrino cosmology. In this case, we use the same cosmological parameters as the massive
neutrino cosmology but absorb ΩνintoΩcand set Neff= 3.046. The backscaled transfer
function in this case uses the scale-independent growth factor evaluated with Ωm= Ω cb. We
donotexpectthesolidanddottedlinestoexactlymatch, giventhattheydonotcorrespondto
the same cosmology and have differing levels of relativistic neutrino contributions, but we do
observequalitativelysimilarbehaviorintermsofhowthebackscaledtransferfunctionsdeviate
fromCAMB. In particular, we find that most of the discrepancy appears as an enhancement
on large scales at early times. However, we do see slightly different behaviour in the range
of scales 10−2≲k/(Mpc−1h)≲10−1with a small enhancement (suppression) relative to
the massless neutrino result at z= 5(40). This difference reflects the approximate nature
of integrating the impact of the time-varying neutrino free-streaming scale into the quantity
Ωeff
m(k). Nevertheless, this error appears at only the ∼0.1%level and is confined to only
those scales in the known transition region around kfs.
To further illustrate the benefits of our approach, we add dashed lines in Figure 2 that
correspond to the backscaled transfer functions evaluated using REPSfor the same massive
neutrino cosmology3. It is clear that the backscaled REPStransfer functions are behaving in
a qualitatively different manner than both our iterative backscaling as well as the massless
neutrino cosmology. In particular, the REPStransfer function exhibits ∼1%enhancement on
3Following the choices made here, we use their “Scenario 4” method that assumes neutrino particles are
simulated with a constant mass throughout their evolution.
– 8 –scales 10−2≲k/(Mpc−1h)≲10−1atz= 40and seems to plateau to a different value on
large scales than would be expected from comparison with the massless neutrino result. These
features arise from the fluid approximation built into REPSwhich predicts neutrino growth
that deviates from Boltzmann codes at the ∼100%level (see Figure 3 of [76]). This feeds
back into the cold matter component, leading to the minor distortions seen in the effective
growth factor for the total matter on intermediate scales. An additional drawback from this
approach is that the inaccuracies of the fluid model in predicting neutrino growth make it
difficult to check if the neutrinos end up growing correctly in the simulation. In this work,
we use our backscaled transfer functions to perform a more careful analysis on how well the
simulated neutrino growth matches expectations from the Boltzmann code.
We finish this section by noting that many massive neutrino simulations initialize the
cold matter at an earlier redshift, zcb
ini, than is used for the neutrinos, zν
ini. In fact, this is the
default strategy used by HACCand employed in the simulations presented in the following
sections. In this case, the backscaling method requires an additional modification in order to
reflect the fact that the cold matter will grow in a scale-independent manner during the time
zν
ini≤z≤zcb
ini. The first step is to further backscale the cold dark matter and baryon transfer
functions obtained from the iterative method at zν
inito the earlier starting time:
Tbs
α(zcb
ini, k) =Fα(zcb
ini, k)D(zcb
ini,Ωm)
D(zν
ini,Ωm)Tbs
cb(zν
ini, k), (2.9)
where Tbs
cb(zν
ini, k)is obtained from the iterative backscaling procedure while Fα(zcb
ini, k)≡
Tα(zcb
ini, k)/Tcb(zcb
ini, k)is taken directly from CAMB. Similarly, for the velocity transfer function
we compute:
Tbs
θ,α(zcb
ini, k) =Fθ,α(zcb
ini, k)˙D(zcb
ini,Ωm)
˙D(zν
ini,Ωm)Tbs
θ,cb(zν
ini, k), (2.10)
where Tbs
θ,cb(zν
ini, k)isobtainedfromtheiterativebackscalingprocedure,thefactor Fθ,α(zcb
ini, k)≡
˙Tbs
α(zcb
ini, k)/˙Tbs
cb(zcb
ini, k)with the dots denoting that we apply the finite difference method
to the backscaled density transfer functions obtained with equation (2.9), and we define
˙D≡a2H(dD/da). Note that these equations preserve the familiar scale-independent rela-
tions Tcb∝DandTθ,cb∝˙Dseen for the cold matter field in massless neutrino cosmologies.
It is important to note that the Ωmused in equations (2.9) and (2.10) is set to Ωcbνfor
all scales even though the neutrinos are not simulated above zν
ini. In order for the simulation
to achieve consistent growth, this convention requires that Ωνbe absorbed into the cold
matter particle masses for z > zν
ini. We have chosen this setup since it guarantees that
the cold matter densities and velocities after evolution to zν
iniend up matching with the
backscaled transfer functions previously computed at zν
ini, but only on the large scales for
which Ωeff
m≃Ωcbν. On smaller scales, we incur an inconsistency with the cold matter densities
(velocities) being slightly suppressed (enhanced) at the sub-percent level compared to the
Tbs
α(zν
ini, k) [Tbs
θ,α(zν
ini, k)]previously computed from the iterative method. This is not an issue
since the total matter still converges to the same answer at zfin, but does mean that we end
up with a sub-percent inconsistency in the initial neutrino component as it is set using the
Tbs
ν(zν
ini, k)that assumed slightly different cold matter density and velocity amplitudes on
small scales. An alternative approach would be to set Ωm= Ω cbin equations (2.9) and (2.10)
withoutchangingthesimulationparticlemassesbetween zcb
iniandzν
ini,butthiswouldjustmean
that we incur a minor inconsistency on large scales instead of small scales. In general, starting
the cold matter at an earlier time than the neutrinos requires that we incur an inconsistency
– 9 –somewhere due to the discontinuous nature of transitioning from scale-independent to scale-
dependent growth at zν
ini. Pushing this inconsistency to small scales is preferable since these
will be the first to undergo non-linear growth that tend to wash out small errors in the initial
conditions. Either way, we stress that the inconsistency manifests at the sub-percent level in
the neutrino component meaning that its impact on the total matter is exceedingly small.
Forconvenience, wehavecreatedapubliccodenamed SONICC4(Scale-dependentOmega
for Neutrino Initial Condition Codes) that uses the iterative backscaling procedure pre-
sented above to generate initial density and velocity transfer functions for cold dark mat-
ter, baryons, and neutrinos for an arbitrary choice of cosmological parameters as well as
starting and stopping redshifts (including the ability to start the cold matter earlier than
neutrinos). The code is written in Python3 and uses the public cambmodule to compute
Boltzmann transfer functions at the initial and final times as well as interpolate the rel-
ative neutrino growth between these endpoints. It was shown in Ref. [50] that the neu-
trino transfer functions produced by CAMBare sensitive to the choice of accuracy settings
accuracy_boost andl_accuracy_boost . Our default choice is to take accuracy_boost = 4
andl_accuracy_boost = 5, which means that the neutrino transfer functions are accurate at
the few-percent level for k≳0.1hMpc−1. With these accuracy settings, the typical runtime
of the backscaling code is about 8 minutes, with the bulk of this coming from the computation
ofCAMBtransfer functions. This can be reduced to under a minute by decreasing the default
accuracy settings, but doing so comes at the expense of decreased accuracy in the neutrino
transfer functions as well as the resulting Ωeff
m(k).
3 Neutrino Initial Conditions and Evolution
Theoretical modeling of the growth of LSS in the presence of massive neutrinos will require
an equal or better level of precision as that of observational measurements. Cosmological
simulations of structure formation are vital in this regard. In this work, we extend the
codeHACC[77] to evolve neutrinos as an additional N-body particle species alongside the
cold matter. HACCis a cosmological simulation code designed to run performantly with
extreme computational loads on all modern supercomputing systems. This performance is
inherited here since the inclusion of neutrino particles mainly involves modifications to the
initial conditions while preserving the core code structure and algorithmic choices. Recently,
a hydrodynamic extension to HACC, known as CRK-HACC [88], was developed and we plan to
merge the work presented here with the hydrodynamic extension so that fully self-consistent
three-species (cold dark matter, baryons, neutrinos) simulations can be performed efficiently
at scale.
There are two main challenges associated with the cosmological simulation of neutrino
particles: 1) the ambiguities associated with properly backscaling massive neutrino cosmolo-
gies in a way that is consistent with the Newtonian forward model; 2) dealing with the high
thermal motion that tends to randomize neutrino particles across the simulation domain. To
overcome the first issue, we use the iterative backscaling procedure presented above to create
more accurate initial transfer functions that are valid for all three non-relativistic matter
species. For the second issue, we make use of the “tiling” procedure [72], which utilizes sym-
metries in the neutrino thermal momentum sampling in order to significantly reduce the level
of shot noise associated with randomization of the neutrino particles. We briefly describe this
4https://git.cels.anl.gov/hacc/sonicc
– 10 –method below and expand on the minor modifications to its implementation that were used
in this work.
In the standard picture, the cosmic neutrino background (CNB) constitutes a thermal
relic species from the early universe. More specifically, massive neutrinos decoupled from the
early plasma when the universe was roughly one second old and remained free of all interac-
tions save gravity until the present day. During this time, the temperature of the CNB cooled
with the expansion of the universe and has a current temperature Tν,0≃1.95 K. At early
times, the neutrinos behave as a relativistic radiation component while later transitioning into
a non-relativistic matter component when the temperature-to-mass ratio, (kBTν,0)/(amν),
drops below O(1). The massive neutrino comoving momentum magnitudes, q, are set by the
relativistic Fermi-Dirac distribution that describes the neutrino phase space after decoupling:
f0(q) =gs
2π2ℏ3q2
eq
kBTν+ 1, (3.1)
where q≡ap, with pthe neutrino momentum magnitude and gs, the spin factor.
It is common in cosmological simulations to initialize neutrino particles in an analogous
manner to cold matter. First, the neutrino particles are placed on a uniform lattice containing
N3
νpoints with gravitationally-induced displacements and peculiar velocities computed from
theinitialtransferfunctions. However, unlikethecoldmatter, athermalvelocityisalsoadded
to each neutrino particle with a random direction vector and random magnitude drawn from
the Fermi-Dirac distribution. Occasionally, this stage is modified so that each lattice site
initializes a pair of neutrino particles with the pair having random thermal velocities equal
in magnitude but opposite in direction [52]. In any event, the main drawback of this method
is that the thermal velocities are so large that using a random draw results in a density
field that is essentially a Poisson sampling of the spatial neutrino distribution, resulting in a
shot noise term in the power spectrum that is inversely proportional to the total number of
neutrino particles, Pshot∝N−3
ν. Since free-streaming suppresses neutrino perturbations on
small scales, a prohibitively large number of particles may be required to resolve the intrinsic
neutrino signal below the shot noise level.
In the “tiling” method [72], the shot noise is reduced by imposing symmetries on the
initial neutrino velocity distribution. To begin, this method preserves the use of a neutrino
grid containing N3
νpoints, but associates a total of NSHELL ×NDIRparticles to each grid
point. This collection of neutrino particles is viewed as a set of NSHELLindependent spherical
shells that each contain NDIRparticles. The thermal velocity magnitude is varied across the
different shells, but held fixed for all particles within the same shell. Hence, only a total of
NSHELLunique velocity magnitudes are used for the thermal velocities and these are chosen
in such a way as to optimize the sampling of the full Fermi-Dirac distribution. Within each
shell, thevelocitydirectionsarechosenbytakingasymmetricdiscretizationof NDIRpointson
the unit sphere. In the original implementation, these direction vectors are set using HEALPix
[89], though other variations including minimizing the Coulomb potential of point charges
on a sphere [61] and utilizing a Fibonacci grid [63] yield similar results. The crucial aspect
of the tiling method is that this discretization of the velocity magnitudes and directions is
replicated at each of the N3
νgrid points so that a constant flux of neutrino particles pass
through adjacent volumes in the simulation domain, thereby suppressing the shot noise.
In theHACCsimulations presented here, our general setup is to initialize a grid of N3
cb
cold matter particles with an N3
νneutrino grid that is maximally offset from the cold matter
grid in order to reduce the potential impact of artificial particle coupling [90]. We split the
– 11 –Fermi-Dirac distribution into NSHELLbins of equal probability mass and associate the mean
valuein each bin tothe neutrinoshells whoselimits {qmin
i, qmax
i}are determined by the inverse
Fermi-Dirac cumulative distribution function:
qi=vuuutRqmax
i
qmin
idqq2f0(q)
Rqmax
i
qmin
idqf0(q)(3.2)
In the simulations presented here, we use HEALPix to assign the NDIRinitial momentum
directions. We have also experimented with the use of a Fibonacci grid, but did not observe
any significant difference compared to HEALPix for a fixed number of directions. The HEALPix
directions are parameterized by the internal variable NSIDEwhich gives, e.g., NDIR=(12, 48,
192) for NSIDE=(1, 2, 4). Motivated by the results of Ref. [61], we modify the original tiling
scheme so that the direction vectors are rotated between shells. In particular, for shell i, we
rotate the NDIRdirection vectors by an amount (i/NSHELL )(π/2)about the symmetry axis
of theHEALPix discretization (which we align with the zaxis). As shown later, this method
helps to mitigate numerical effects associated with the tiling scheme symmetries, particularly
for smaller NSIDE. In the recent work of Ref. [63], the authors advocate for radially displacing
each shell from the grid site by an amount proportional to its momentum magnitude in order
to reduce a spurious coupling with the cold matter. We do not use this method here (meaning
that each shell is sourced at the same grid location), but rather apply a spectral filter in the
force solver, discussed below, in order to minimize the back-reaction of the neutrino grid on
the cold matter.
The initial displacements and (non-thermal) velocities of the cold matter and neutrino
particles are computed using the Zel’dovich approximation (ZA) evaluated on an N3
cbgrid
with the backscaled transfer functions of each respective species. The same random phases
are used for each species with a rotation applied in Fourier space for the neutrino particles
to account for their real-space offset from the cold matter grid where the displacement field
is sampled. We only consider the (unphysical) case of a single massive neutrino here, but
plan to accommodate multiple mass eigenstates, and the complexities therein, in future work.
By default, we initialize the cold matter at zini= 200while starting the neutrinos at a
lower redshift zν
ini(we consider zν
iniwithin a range of 10-40). There are competing effects to
consider when choosing the starting neutrino redshift, and the values used here are chosen as a
compromise between the two limiting regimes. On the one hand, starting neutrinos too early
is complicated by the fact that a significant fraction will still be relativistic – meaning that
both their initialization as a non-relativistic species as well as their subsequent evolution will
be incorrectly modeled within the Newtonian dynamics of the simulation [91]. On the other
hand, starting neutrinos too late means that they become less well-described by linear theory,
particularly for the slower-moving population. One way of pushing the starting redshift lower
would be with the use of higher-order Lagrangian perturbation theory for initializing both
species [92] (rather than just the ZA, or 1LPT). The impact of starting at lower redshift using
higher-order perturbation theory has been studied by several groups [e.g., 93, 94]; however, a
fully self-consistent multi-species approach is not currently available.
The gravitational force calculation in HACCis decomposed into two parts: (1) the long-
range force evaluated using a spectral particle-mesh (PM) method that solves the (filtered)
Poisson equation in Fourier space; (2) the short-range force evaluated using direct pairwise
interactions with an algorithm optimized for the given hardware (i.e., we employ a particle-
particle method on accelerated systems and a tree method on CPU platforms). The two
– 12 –components are delineated by the force-matching scale, rs, that is roughly equal to three
times the length of an individual cell in the PM mesh. Our default choice is to use a PM
mesh that is of the same size as the initial cold matter particle grid. The main time step
is governed by the PM force evaluation while the short-range force is evaluated on a shorter
“subcycled” time-scale. For the simulations presented here, we take 625 PM steps between zini
andzfinwith 4 short-range force evaluations per PM step, following the typical integration
procedure used in HACCgravity-only simulations [77].
The force decomposition and time-stepping remain unchanged with neutrinos except for
two minor modifications. Firstly, we have added the flexibility to exclude neutrino particles
from the short-range force calculation. This is simply achieved by sorting neutrinos to the
end of the particle arrays and only passing the cold matter portion of those arrays to the
short-range kernel. This reduces the computational cost of the short-range force calculation,
but implicitly assumes that the gravitational impact of neutrinos below the force-matching
scale can be safely ignored. We use this method for the simulations presented here, which
we justify by the fact that the force-matching scale rs∼1h−1Mpcwhile the free-streaming
scale 1/kfs≳10h−1Mpcfor the neutrino mass and box sizes considered here. The second
modification is that we have implemented an optional filter that smooths the neutrino density
field in Fourier space during the long-range PM force calculation. This is achieved using a
simple sharp- ksmoothing filter applied in Fourier space via the transformation:
ρsm
ν(k) = Θ( kcut− |k|)ρν(k), (3.3)
where ρν(k)istheFouriertransformoftheneutrinodensityfield, computedinrealspaceusing
a cloud-in-cell (CIC) interpolation to the PM mesh, and Θis the Heaviside step function with
kcut=πNν/Lchosen to be the the Nyquist frequency, kν
Nyq, of the neutrino grid. As shown in
Section 4, this is done to avoid potential imprinting of the neutrino grid onto the cold matter
density field, which we have found to occur if the neutrino mass resolution is sufficiently
coarse. Again, this smoothing assumes that neutrinos are not significantly clustering below
the cutoff scale, which we justify since kν
Nyq≳10kfsfor the main runs presented here.
Thefinalconsiderationthatwemakeisinregardstotheparticle“overloading” performed
inHACC. In general, the global simulation volume is subdivided across MPI ranks with each
rank assigned a subvolume with side lengths on the order of a few 10−100h−1Mpcalong
each axis. This “alive” zone of each rank is then extended 2−10h−1Mpcat the edge of each
boundary and filled with particle replicants from the alive zones of neighboring ranks. This is
done to ensure proper boundary conditions are utilized in the short-range force for particles
at the edge of the alive zone. The overload zone is refreshed at regular intervals (typically
every 1-20 PM steps) with the cadence chosen as a balance between minimizing the MPI
communication overhead and the propagation of gravitational force errors from the edge of
the overload zone inwards to the alive zone (see Ref. [77] for more details).
One of the challenges with neutrino simulations is that the higher momentum neutrinos
arestillmovingrelativelyfastneartheinitializationredshift. Theproblemisthatifaneutrino
particle is capable of moving further than the width of the overload zone during one refresh
cycle then it is possible that all of its replicants end up outside the alive zone at the next
refresh. The outcome is that the particle will be removed from the simulation and we may
end up carving out neutrinos near the boundaries of each MPI rank. The trivial solution is
to increase the refresh rate and/or increase the overload zone. For the simulations presented
here, we use a refresh every PM step and increase the overload to 20h−1Mpcat early times.
This choice adds a significant computational overhead and in the future we plan to avoid
– 13 –large overloads by implementing a method to manually pass neutrino particles across MPI
ranks when they would otherwise be removed from the simulation.
4 Results
We present here results from a suite of HACCruns that vary the internal parameters of the
neutrino tiling scheme as well as the simulation resolution. The full set of runs are enumerated
in Table 1. In addition to varying the two main parameters of the tiling scheme – the number
of momentum shells NSHELLand the number of directions per shell NDIR(as set by the
HEALPix parameter NSIDE) – we also vary the size of the neutrino grid Nν. This allows us
to check for numerical convergence in the power spectra as one parameter is varied while the
others are held fixed. The main set of runs use a simulation box of width L= 250 h−1Mpc
containing N3
cb= 5123cold matter particles though we also consider two other runs with a
larger box of L= 1000 h−1Mpc. We also explore the impact of the neutrino starting redshift
by varying zν
ini= (10 ,20,40)with zcb
iniheld fixed at 200.
In Section 4.1 we present a numerical convergence study for the neutrino tiling param-
eters. We then show in Section 4.2 that one challenge with the tiling method is that the
Fourier imprint of the neutrino grid can transfer onto the cold matter power spectrum if the
simulation resolution is sufficiently coarse. We proceed in Section 4.3 with a comparison of
the simulated total matter power spectrum to emulator predictions [42] and finish in Sec-
tion 4.4 with a closer look at the linear theory growth of neutrino power. In all of the further
analysis, we examine the power spectra of the cold matter and neutrino components which
are computed using a CIC interpolation of each species onto a mesh containing 5123cells.
4.1 Convergence Study of Neutrino Initialization Parameters
We begin by varying NDIRwith all other parameters held fixed. In Figure 3 we show the
cold matter and neutrino power spectra at redshifts z= 9, 1, and 0 for the fid_nophi ,fid,
med_NDIR , and hi_NDIR runs. All runs contain N3
cb= 5123cold matter particles with an
N3
ν= 1283neutrino particle grid consisting of NSHELL = 5momentum shells. In addition,
all of the runs except for fid_nophi use the method described in Section 3 of rotating the
direction vectors of each shell. Comparing the dashed orange and dot-dashed green lines in
Figure 3 show that this rotation has a significant impact on the neutrino power spectrum,
both at early and late times. This behavior was observed previously [61] and likely reflects
the fact that the rotation reduces the correlation in neutrino particle trajectories of adjacent
momentum shells. Though not shown here, we find that the relative impact of the rotation
decreases as we increase NDIR. This can be attributed to the fact that the direction vectors
become increasingly isotropic as the discretization is made increasingly fine.
Comparing the dot-dashed green, dotted red, and solid blue lines in Figure 3 shows that
the neutrino power spectrum is quite sensitive to the number of direction vectors. At z= 9,
theNDIR= 12and 48 runs are converged to the NDIR= 192run at the 10%level up to
k≃0.1and0.3hMpc−1, respectively. This improves at z= 0with the 10%agreement
extending to k≃0.3and0.7hMpc−1for the two runs. Hence, the NDIR= 192run appears
to be reasonably converged (at the ∼10%level) up to half the Nyquist frequency of the
neutrino grid at z= 0, though more directions may be required to reach a similar level of
convergence at higher redshift. Note, however, that as we increase NDIR, the neutrino power
spectrum on scales k≳0.1hMpc−1converges to a result at z= 9that is markedly below
the linear theory curve; we will discuss this discrepancy in Section 4.4. The large differences
– 14 –Name NcbNνNSHELL NDIR zν
iniFilter LRotate ϕ
fid_nophi 512128 51220Yes250 F
fid_nofil 512128 51220No250 T
fid 512128 51220Yes250 T
med_N ν512256 51220Yes250 T
hi_Nν 512512 51220No250 T
med_NDIR 512128 54820Yes250 T
hi_NDIR 512128 519220Yes250 T
med_NSH 512128 1019220Yes250 T
hi_NSH 512128 2019220Yes250 T
coarse_hi_NDIR 51264 519220Yes250 T
lo_z 512128 519210Yes250 T
hi_z 512128 519240Yes250 T
lb_loN_nofil 25664 51240No1000 T
lb_loN 25664 51240Yes1000 T
Table 1 . Simulation suite considered in this work. All simulations initialize the cold matter at
zcb
ini= 200in a box of side length Lwhile the neutrinos are initialized later, at zν
ini. In each case,
we use the cosmological parameters, ( Ωc,Ωb,Ων,ΩΛ,σ8,h,Neff) = (0.2684, 0.0491, mν/(93.14h2),
1-Ωcbν, 0.8, 0.6711, 2.046), for a single massive neutrino species with mν= 0.15 eV. The cold
matter contains N3
cbparticles while the total number of neutrino particles is given by the product
N3
ν×NSHELL ×NDIR. In each run, the long-range force is calculated using a PM mesh containing
Ng=Ncbcells per side; the short-range force is evaluated only on the cold matter and uses a Plummer
softening length of 0.1L/N g. The “Filter” column denotes whether the sharp- kforce filter in equation
(3.3) is applied to the neutrino density field during the long-range force evaluation. The “Rotate ϕ”
column indicates whether the momentum shells were individually rotated, as described in Section 3.
in neutrino power spectra for k > kν
Nyqsimply reflect different levels in the effective neutrino
shot noise of each run. The shot noise level is governed by the total particle count, as shown
by the horizontal line tracing Pshot=L3/(N3
νNSHELL NDIR)for the hi_NDIR run. This is also
the level at which the neutrino power spectrum saturates to in standard simulations that draw
random velocity magnitudes and directions. The fact that we are able to resolve the neutrino
power spectrum below Pshotfork≤kν
Nyqthus confirms the utility of the tiling method, as
also verified in Refs. [61, 63, 72]. Note that the neutrino power spectrum still saturates to
Pshotfork > kν
Nyqwith the presence of noticeable spikes observed at the Fourier modes of
the neutrino grid. We will explore this topic in more detail in Section 4.2.
Despite the large variance observed in neutrino power spectra with varying NDIR, we
see that the cold matter power spectra are relatively unchanged between each run. This is
particularly true at high redshift and linear scales though we do observe a ∼0.5%scatter
near the cold matter Nyquist frequency at z= 0. As further shown below, we generally find
that the neutrino power spectra exhibit systematic numerical convergence as one parameter
is varied while all others are held fixed. The cold matter power spectra, on the other hand,
mainly show small random noise on non-linear scales. We attribute this to the fact that
minor changes in the neutrino distribution are not strong enough to significantly alter the
cold matter on linear scales (since fνis small), but are able to seed noise, particularly in
the shot-noise dominated regime, that becomes amplified with non-linear growth. Given that
the noise is random in nature (i.e., it fluctuates between runs in a non-systematic manner)
and confined to highly non-linear scales, its presence does not indicate that the tiling scheme
– 15 –10−1100101102Pcb(k)z=9.1
101102103z=1.0
102103104z=0.0
NDIR,no−φ= 12
NDIR= 12
NDIR= 48
NDIR= 192
−0.010.000.01Pcb,X
Pcb,ref−1
−0.010.000.01
−0.010.000.01
10−510−310−1101103Pν(k)
10−510−310−1101103
10−510−310−1101103
10−1100101
k[hMpc−1]−0.20.00.2Pν,X
Pν,ref−1
10−1100101
k[hMpc−1]−0.20.00.2
10−1100101
k[hMpc−1]−0.20.00.2Figure 3 . Cold matter (upper two rows) and neutrino (lower two rows) power spectra for different
choices of number of neutrino particle velocity directions ( fid[green dash-dotted], med_NDIR [red
dotted], hi_NDIR [blue solid]), as well as without rotating HEALPix momentum shells ( fid_nophi
[orange dashed])). The ratio of the power spectrum at each choice of parameters relative to the
power spectrum of the hi_NDIR run ( NDIR= 192) is shown in the residual panels (second and fourth
rows). Shaded bands in the residual panels are at 0.5%for cold species and 10%for neutrinos. Plots
are shown at several redshifts in the different columns. Backscaled linear theory is also shown for
reference as the thin black curves. In the third row of panels, the dashed blue line corresponds to the
expected Poisson shot noise for the hi_NDIR run which contains the largest neutrino particle count.
The vertical dashed black line in the upper panels is the Nyquist mode of the initial cold species grid,
while the dash-dotted black line in the lower panels is the same for the initial neutrino grid.
fails to numerically converge, rather that care must be taken to understand the amplitude of
random error in the total matter distribution on small scales.
Next we consider the case where we vary NSHELLwhile keeping the other parameters
fixed. Similar to Figure 3, Figure 4 shows cold matter and neutrino power spectra at redshifts
z= 9,1,and 0for the fid,med_NSH, and hi_NSHruns, which have NSHELL = 5,10,20
respectively (all at NDIR= 1925). On the largest scales we find good agreement, with all
three runs following linear theory closely. On intermediate scales, the neutrino power in the
5We also found qualitatively similar results when varying NSHELLwhen the number of directions was fixed
toNDIR = 12.
– 16 –three runs starts to diverge at around k≈0.2hMpc−1at the 10%level. As expected,
theNSHELL = 10neutrino power agrees more with that of the NSHELL = 20run than the
NSHELL = 5run does, and this is true at all redshifts. For k > kν
Nyq, the difference between
the neutrino power spectra is due to a change in shot noise since the NSHELL = 20(10)
run has four times (twice) as many neutrino particles as the NSHELL = 5run. Meanwhile,
the cold species power is essentially unaffected by the change in NSHELLat the 0.1%level
for linear scales. At later times, we again see fluctuations in the cold matter power on the
non-linear scales near the Nyquist mode. The random nature of this noise is evident in the
flipping and reordering of the green and orange curves when comparing the z= 1andz= 0
residual panels. Overall, we find a less dramatic effect on the power spectra of both species
when varying the number of shells compared to the number of directions; in agreement with
the initial exploration of Ref. [72].
Having characterized how the cold species and neutrino power spectra change with NDIR
andNSHELL, we now consider varying the resolution of the neutrino grid Nνin Figure 5.
Following our earlier convention, we show the cold matter and neutrino power spectra for
several values of Nνin different colors, where solid (dashed) lines correspond to runs with
NDIR= 12(192) and NSHELL = 5held fixed in each case. Since all simulations have Ncb=
5123, we can consider this analysis to represent making different choices of the ratio Nν/Ncb.
In terms of the neutrino power spectra, the general trend of increasing Nν/Ncbis independent
of the value of NDIR. Namely, we find that the neutrino power spectrum is insensitive to the
choice of Nν/Ncbup until the Nyquist frequency of the neutrino particle grid. This is easily
seen in the bottom panel, where each line traces a residual of zero up until the vertical dotted
line indicating its Nyquist wavenumber. As mentioned before, comparing the two sets of
NDIRruns show that the neutrino power spectrum is significantly enhanced on intermediate
scales for NDIR= 12. Furthermore, Figure 5 shows that up until a comoving wavenumber of
k≈3.0hMpc−1(atz= 0), the Nν= 256andNν= 512neutrino power spectra agree at the
10% percent level. This comparison is important for considering the computational cost of
the tiling method, as the former run has a factor of 8 fewer neutrino particles than the latter.
We see the same general behavior in the cold matter power as was shown in the previous two
tests. Namely, the cold matter power displays random noise on small non-linear scales. As
before, the cold matter is relatively insensitive to changes in Nν/Ncbon linear scales.
The results presented above show that numerical convergence at the ∼10%level in the
neutrino power spectra requires NDIR≳100 direction vectors and NSHELL≳10momentum
shells. The cold matter power is not significantly impacted by choices in these parameters
on linear scales, but does exhibit random noise at the ∼1%level on non-linear scales at late
times. We suspect that this error is seeded by shot noise from the neutrinos on small scales
(which scales inversely with the total number of neutrino particles) and becomes amplified by
non-linear growth. The main challenge with the tiling method is that the requirement NDIR≳
100 and NSHELL≳10implies that Nν/Ncb≲1/10for the number of neutrino particles to not
significantly exceed the cold matter count. The coarseness of the neutrino particle grid limits
the smallest scale at which neutrinos are effectively resolved and, as shown below, requires
extra care to prevent discreteness effects from artificially back-reacting on the cold matter.
4.2 Suppression of Neutrino Grid Artifacts
The runs shown in Figure 5 display characteristic small-scale spikes in the neutrino power
spectra with locations that depend on the value of Nν. These spikes were also observed in
Ref. [61] and correspond to resonances in the neutrino particle grid which are picked up as
– 17 –10−1100101102Pcb(k)z=9.1
101102103z=1.0
102103104z=0.0
NSH= 20
NSH= 10
NSH= 5
linear
−0.010.000.01Pcb,X
Pcb,ref−1
−0.010.000.01
−0.050.000.05
10−510−310−1101103Pν(k)
10−410−2100102
10−410−2100102
10−1100101
k[hMpc−1]−0.250.000.25Pν,X
Pν,ref−1
10−1100101
k[hMpc−1]−0.250.000.25
10−1100101
k[hMpc−1]−0.250.000.25Figure 4 . Cold matter (upper two rows) and neutrino (lower two rows) power spectra for different
choices of number of neutrino momentum bins ( fid[green dash-dotted], med_NSH [orange dashed],
hi_NSH[blue solid]). All simulations have NDIR= 192. The ratio of the power spectra with respect to
thehi_NSHrun with NSHELL = 20is shown in the residual panels (second and fourth rows). Shaded
bands in the residual panels are at 0.5%for cold species and 10%for neutrinos. Plots are shown at
several redshifts in the different columns. The vertical dashed black line in the upper panels is the
Nyquist mode of the initial cold species grid, while the dash-dotted black line in the lower panels is
the same for the initial neutrino grid. Backscaled linear theory is also shown for reference as the thin
black curves.
essentially delta functions in Fourier space. More specifically, these spikes occur at multiples
of the Nyquist frequency of the neutrino particle grid (e.g., the first two spikes occur at 2kν
Nyq
and2√
2kν
Nyq). Of course, this is not a feature unique to the neutrino particles; if we were
to measure the cold matter power spectrum on a fine enough mesh then we would likewise
observe a series of spikes at the Fourier modes corresponding to the cold matter particle
grid [95]. In other words, single-species N-body simulations also contain the Fourier imprint
of the initial conditions grid that are subsequently captured in the force solver provided the
force resolution is finer than the particle grid separation. These grid features are generally
considered to insignificantly impact evolution in the single-species case due to the efficient
gravitational transfer of power from large to small scales [e.g., 96]. The result is that gravity
tends to broaden the spikes in Fourier space until the gravitational growth on small scales
– 18 –10−1100101102Pcb(k)z=9.1
Nν= 64
Nν= 128
Nν= 256
Nν= 512
linear
NDIR= 12101102103z=1.0
102103104z=0.0
−0.010.000.01Pcb,X
Pcb,ref−1
−0.010.000.01
−0.010.000.01
10−710−510−310−1101103Pν(k)
10−510−310−1101103
10−510−310−1101103
10−1100101
k[hMpc−1]−0.20.00.2Pν,X
Pν,ref−1
10−1100101
k[hMpc−1]−0.20.00.2
10−1100101
k[hMpc−1]−0.20.00.2Figure 5 . Cold matter (upper two rows) and neutrino (lower two rows) power spectra while varying
the resolution of the neutrino particle grid, Nν, for runs with NDIR= 12(solid lines) and NDIR= 192
(dashed lines). Residuals are shown with respect to the Nν= 512run (blue solid line, hi_Nν) for
theNDIR= 12runs, and with respect to the Nν= 128run (orange dashed line, coarse_hi_NDIR )
for the NDIR= 192runs (i.e., they are made with respect to the largest value of Nνfor each set
ofNDIRruns). Plots are shown at several redshifts in the different columns. Shaded bands in the
residual panels are at 0.5%for cold species and 10%for neutrinos. The vertical dashed black line in
the upper panels is the Nyquist mode of the initial cold species grid, while in the lower panels, the
dotted colored lines correspond to the Nyquist modes of the corresponding neutrino grid resolutions
(with colors indicated in the legend). Backscaled linear theory is also shown for reference as the thin
black curves.
surpasses the shot noise level, erasing the spikes altogether. This gravitational broadening can
be seen in the lower panels of Figure 5 for the neutrinos and is also examined more extensively
in Ref. [61]. However, it is not clear what impact these features may have in multi-species
simulations especially if the Nyquist frequencies of the particle grids are mismatched, as is
the general case here.
To study this issue more closely, we ran two simulations with Nν< N cband varying
mass resolutions to test whether we could clearly identify the imprint of the neutrino grid on
the cold matter. Indeed, we found that for sufficiently coarse resolutions, it is possible for
the neutrino grid to transfer its Fourier signal onto the cold matter power spectrum. This is
demonstrated in Figure 6 where we show the power spectrum at z= 5for the lb_loN_nofil
– 19 –simulation that contains N3
cb= 2563cold matter particles with an N3
ν= 643neutrino particle
grid in an L= 1000 h−1Mpcbox. First, we see the characteristic spikes in the neutrino power
spectrum which extend prominently above the neutrino shot noise level. Furthermore, we also
clearly observe a small spike in the cold matter power spectrum situated at the location of
the first neutrino spike, as shown in the plot inset. The presence of this spike unambiguously
demonstrates that the numerical imprint of the neutrino particle grid is being transferred
onto the cold matter density field via the force solver. We checked for similar spikes in the
cold matter power spectra of two other simulations, fid_nofil andfid, but did not observe
any, indicating that this imprinting depends on the simulation resolution. We suspect that
the probability of the neutrino grid imprinting on the cold matter field is enhanced when the
neutrino shot noise is more comparable to the amplitude of the cold matter power spectrum
at early times. In other words, care must be taken to control for this issue if the neutrino
mass resolution – which, like the shot noise, scales as L3/(N3
νNSHELL NDIR)– is too coarse.
Of course, the absence of spikes in the cold matter power spectrum of the other two
simulations does not mean that the cold matter was not still influenced by the neutrino shot
noiselevelonsmallscales. Thisisthemotivationbehindtheuseofthesharp- kfilterdescribed
in Section 3 that forcefully removes any contributions from the neutrino grid in the long-range
force solver. For reference, the dark red dashed line in Figure 6 shows the neutrino power
spectrum measured when this filter is applied. The abrupt truncation of the neutrino power
spectrum for k > kν
Nyqmeans that the numerical signal of the neutrino grid is completely
hidden from the long-range force calculation. To test the impact of this filter on the final
result, the right panels of Figure 6 compare PcbandPνfrom the original non-filtered run,
lb_loN_nofil , with its filtered counterpart, lb_loN. Here we observe that the cold matter
power spectrum of the filtered run is essentially unchanged below 2kNyq, the location of the
first neutrino grid spike. At higher wavenumbers, we see sharp spikes occurring at the Fourier
modes of the neutrino grid which correspond to the erasing of these signatures from the cold
matter field in the filtered run. At lower redshifts, gravitational broadening of the spikes in
the non-filtered run dissipates their signal on small scales. In the lower panel showing the
neutrino residuals, we see that the filtering leads to only precent-level changes in the evolution
of the neutrino density field. In other words, the filtering strategy effectively removes clear
numerical artifacts from the neutrino grid without strongly impacting the small-scale growth
of cold matter or neutrino density perturbations.
We reiterate that the sharp- kfilter is only justified if neutrinos are not contributing
to the growth of density perturbations beyond kν
Nyq. This assumption becomes increasingly
inaccurate the closer kν
Nyqgets to the neutrino free-streaming scale, and therefore should
only be applied if the resolution is such that kν
Nyq≫kfs. This condition can be somewhat
alleviated if the filter is turned off at lower redshift when both the free-streaming length
is smaller and the intrinsic neutrino power has grown closer or above the shot noise level.
We note that Ref. [63] uses an alternative method to mitigate impacts associated with the
neutrino grid which involves radially displacing each neutrino shell during the initialization
by an amount proportional to its momentum magnitude. We tried this method but did not
find it to be effective for the lb_loN_nofil run presented above. In any event, we consider
the sharp- kfilter to be a more direct method for preventing an artificial back-reaction from
the discretization of the neutrino grid. We also tested other functional forms for the filter, but
found that the smoothing required to adequately remove the neutrino spikes using obvious
candidates (Gaussian and Hann functions) was so broad that the filter artificially suppressed
cold matter growth on larger scales.
– 20 –10−210−1100
k[hMpc−1]10−210−1100101102103P(k) [h−1Mpc]3
Pcb,no−fil
Pν,no−fil
P(sharp−k)
ν,filPcb,fil
Pν,fil0.30.40.52030
0.000.01Pcb,ﬁl
Pcb,no−ﬁl−1
10−210−1100
k[hMpc−1]−0.050.000.05Pν,ﬁl
Pν,no−ﬁl−1 z=9.1 z=1.0 z=0.0Figure 6 .Left: Cold species (blue) and neutrino (red) power spectra for the lb_loN_nofil (thick
shaded lines) and lb_loN(thin solid lines) runs at z= 5. The vertical dotted black line denotes twice
the neutrino particle grid Nyquist frequency which corresponds to a prominent spike in the neutrino
power spectrum as well as the cold species power spectrum in the non-filtered case (see the inset for a
zoom-in on the cold species power spectra). The dashed red line shows the neutrino power spectrum
when the sharp- kfilter is applied. Right: The ratio of the cold species (top) and neutrino (bottom)
power spectra from these two runs at redshifts z= 9.1,1.0,0.0. Shaded regions are at ±0.1%for cold
species and ±1%for neutrinos.
4.3 Emulator Comparison
To make contact between this work and nonlinear growth in total matter power predictions,
we compare to the 2022 version of the Mira-Titan Cosmic Emulator [42] in Figure 7. The
simulations usedto train the emulatorvariedthe neutrinooverdensity parameter Ων, but were
not multi-species simulations, so the influence of neutrinos was incorporated only through
1) adding the linear massive neutrino density power spectrum to the cold species power
spectrum (as described in Refs. [97, 98]), 2) in the computation of σ8atz= 0, and 3) in
the rate of homogeneous and isotropic background expansion. As single-species simulations,
these computations neglected scale-dependent growth due to neutrinos in the evolution of
the N-body particles, so we do not expect our results for the total matter power to exactly
agree with the emulator predictions, aside from the errors intrinsic to the construction of the
emulator. Nevertheless, at small enough fν, there should be good agreement. Figure 7 shows
that this is indeed the case at the percent level (here fν≈1%forPmν= 0.15 eV, where it
should be noted that the method used to construct the emulator in the nonlinear regime is
effectively an expansion in the leading power of fν).
The total matter power spectra for the NSHELL = 20, NDIR= 192run at several redshifts
approximately match the emulator power spectra at the several percent level. However, the
growth in the emulator prediction is systematically higher than the power in our simulation
run for wavenumbers that are low enough that the grid does not impact the power spectrum.
This offset is at approximately the 5%level, which is larger than the <3%accuracy that
would be expected from the emulator test set error [42]. This effect is not the result of
our implementation of the neutrino N-body particle evolution, as a massless neutrino “no ν”
cosmology shows a similar level of disagreement in Figure 7 (green curve). This disagreement
can instead be explained as due to the small box sizes we consider here, as in one of our
larger box simulations (orange dotted curve), we see no such 5%offset, and any disagreement
between the simulation run and the emulator is at the expected level of <3%(below the grid
– 21 –101102103104Pmm(k)z=1.0
CosmicEmu
hi NSH
lb loN noﬁl
noν
102103104z=0.0
10−210−1100
k[hMpc−1]−0.2−0.10.00.10.2Pmm
Pmm,Emu−1
10−210−1100
k[hMpc−1]−0.2−0.10.00.10.2Figure 7 . Total matter power spectra in the hi_NSH(NSHELL = 20, NDIR= 192) run [blue solid],
thelb_loN_nofil (L= 1000 h−1Mpc) run [orange dotted], and the 2022 version of the Mira-Titan
CosmicEmu [42] [black dash-dotted] at several redshifts. We also show the matter power spectrum
fromaneutrino-lesscosmology(“no ν”, with Ων= 0,Ωcdm= 0.27201)[greendashed]thathasthesame
numerical parameters as the fid_nofil run. The orange vertical line shows the Nyquist wavenumber
for the lb_loN_nofil run. Lower panels show residuals with shaded bands between ±5%. The
residual for the “no ν” line is with respect to the CosmicEmu prediction for a neutrino-less cosmology
(not shown in the upper panel). See the text for a discussion of the finite-volume effects seen here
(the shift between the blue and orange curves).
scale of that simulation, which is k∼1.0hMpc−1). These types of finite-volume effects are
characterized in more detail in Section 3.3 of Ref. [99], and can be understood more broadly
as a combination of a super-sample mode effect [100–104], as the small-box simulation is
effectively missing large-scale power that is present in the larger simulation box (see e.g.
Fig. 6 of Ref. [102]) and increased variance in individual realizations at smaller box sizes.
The estimated variation from the results of Ref. [99] is consistent with that observed in the
comparison. In conclusion, Fig. 7 shows that the emulator results are consistent with the
direct simulations as performed here within the level of errors that are characteristic of both
methods.
4.4 Examination of Neutrino Growth
We complete this section with a closer look at how well the simulated neutrino growth com-
pares to linear theory expectations. In Figure 8, we compare the linear neutrino power spectra
– 22 –at various redshifts to the outputs from the fid,med_NDIR , and hi_NDIR runs (previously
shown in Figure 3). As discussed earlier, the neutrino power spectrum on scales approaching
kν
Nyqis very sensitive to the number of direction vectors. Ref. [61] attributed this to a coherent
sampling of the gravitational potential causing a spurious power generation that diminishes
as the number of direction vectors increases.6At high redshift, we would expect that the
simulated power spectra numerically converge to linear theory as the number of direction
vectors increases, and that this happens most readily on larger scales where the spurious
power is weakest. However, while we do observe clear numerical convergence as NDIRis in-
creased, the converged result is noticeably belowlinear theory for k≳0.1hMpc−1. This
systematic suppression is clear at z= 9and persists until late times when non-linear growth
eventually dominates the signal. While this discrepancy is relatively minor (the simulation
with NDIR= 192has neutrino power that is 15% smaller than linear theory), and therefore
unlikely to significantly impact the total matter field, it is worth considering any potential
systematic errors that could contribute to incorrect neutrino growth.
There are a number of approximations made in the simulations presented here. In the
first place, the momentum-integrated neutrino transfer function is used to set the initial
displacement and non-thermal velocities for all momentum shells. In principle, this could
be made more accurate by initializing each shell with its own momentum-dependent transfer
function. However, given that we do not observe a significant dependence on NSHELLseen in
Figure 4, we do not expect this to be a large source of bias in the neutrino power spectrum.
Another potential issue is that high thermal motion at early times enables neutrino particles
to quickly traverse large distances from their starting point. This behavior may smooth out
the power spectrum initially seeded in the displacement field as the neutrinos dynamically
readjust to their rapidly changing environments. In this case, we would expect the smoothing
to be enhanced with earlier starting times when the thermal motion is more extreme. Another
possible bias stems from the non-relativistic treatment of neutrino particles in the simulation;
an approximation that becomes increasingly inaccurate at higher redshift and conflicts with
the relativistic treatment used in the linear theory reference curves. Finally, the neutrino
initial conditions are set using the ZA which is known to be insufficient for cold matter at the
neutrino starting redshifts used here. It is unclear if the ZA is also problematic for neutrinos
at these redshifts despite their lower density amplitude, but it has been shown in Ref. [93]
that systematic power suppression occurs in cold matter simulations with late ZA starts.
We test the latter three possibilities more closely by running three simulations with
different neutrino initial redshifts. These are shown in the right panel of Figure 8 where the
lo_z,hi_NDIR, and hi_zruns differ only by their use of zν
ini= 10, 20, and 40, respectively.
Atz= 9, all three runs sit systematically below linear theory7atk∼0.2hMpc−1, with this
suppression persisting until non-linear growth dominates at z= 1. We do observe a small
dependence on zν
iniat high redshift, with the lo_zrun exhibiting tighter agreement with linear
theory compared to the other two simulations. However, this trend is quickly erased by z= 3
at which point all three runs show strong agreement on all but the smallest scales. On scales
approaching kν
Nyq, we still see a clear trend with zν
iniwhich we attribute to the earlier start
6Ref. [61] also found that this spurious power is more significant for higher momentum shells. By inspecting
q−dependent power spectra, we also find this to be the case, and that the higher- qshells are more sensitive
to the number of directions NDIR.
7The linear theory curves are calculated from the backscaling of the zν
ini= 20run. There are minor
differences in the backscaling for the different zν
ini(see Figure 1) but these are small in comparison to the
spread in the simulation curves seen here.
– 23 –10−910−710−510−310−1101103Pν(k) [h−1Mpc]3
z=9.1
z=3.0
z=1.0
z=0.0linear
NDIR= 12
NDIR= 48
NDIR= 192zν
ini= 20
zν
ini= 40
zν
ini= 10
10−1100
k[hMpc−1]−1.0−0.50.00.51.0∆Pν
Pν,lin(k)
10−1100
k[hMpc−1]Figure 8 . Neutrino power spectra from several simulation runs at several redshifts (colors) compared
to linear theory computed using our backscaled transfer functions (solid). Left:Neutrino power
for the fiducial neutrino initialization redshift ( zν
ini= 20), with a varying number of initial velocity
directions: NDIR= 12(dashed, fid),NDIR= 48(dash-dotted, mid_NDIR ), and NDIR= 192(dotted,
hi_NDIR).Right:Neutrino power for the highest number of initial velocity directions ( NDIR= 192)
at several choices of starting redshift for the neutrino particles: zν
ini= 20(dashed, hi_NDIR),zν
ini= 40
(dash-dotted„ hi_z),zν
ini= 10(dotted, lo_z). At each redshift, we show using a circle the non-linear
scale, knl, defined to be the largest scale for which the dimensionless total matter power spectrum,
∆2
m(z)≡k3Pm(k)/2π2, exceeds unity. Lower panels show residuals with respect to (backscaled) linear
theory neutrino power spectra and gray bands are between ±15%.
times allowing a greater accumulation of spurious power due to the angular discretization of
the tiling method. Hence, the systematic suppression in power does show minor dependence
on the neutrino initial redshift, but this is only evident at early times.
More careful tests would be required to determine the exact cause of the neutrino power
suppression seen on intermediate scales. Furthermore, it is not clear if this suppression is
specific to the tiling scheme or would also be observed in a simulation using the random draw
strategy (assuming a sufficient number of particles are used to resolve the neutrino power
below the shot noise level). We note that analogous findings have also been observed in
mixed cold dark matter plus baryon simulations where the cold dark matter (baryons) grow
systematically fast (slow) relative to linear theory expectations when the force resolution is
below the mean inter-particle separation [105–107]. It is conceivable that the same issue
manifests in neutrino simulations and may even be exacerbated when the neutrino particle
grid is made coarser than that of the cold matter. Even though the discrepancy with respect
to linear theory is relatively minor, it is still worth investigating this topic in the future so
that systematics in neutrino simulations are properly identified and resolved.
5 Conclusions
A standard approach for initializing cosmological simulations is to backscale the final redshift
transfer functions to the initial redshift in a manner that is consistent with the Newtonian
– 24 –forward model of the simulation. This procedure becomes complicated in massive neutrino
cosmologies since the simulated growth function acquires a scale dependence that is not easily
calculable. We have presented an improved backscaling method for massive neutrino cosmolo-
gies that uses an iterative procedure to converge on a self-consistent initialization strategy
that preserves the relative neutrino growth predicted by Boltzmann solvers. Our method
exploits the known asymptotic limits that the energy density contributing to growth on large
and small scales is set by ΩcbνandΩcb, respectively. When compared to the direct output of
Boltzmann solvers at high redshift, our backscaled transfer functions show qualitatively simi-
lar behavior to what is seen in massless neutrino cosmologies. This is a notable improvement
compared to the common approach where the scale-dependent growth is solved using a two-
fluid model that assumes a much different level of neutrino growth compared to Boltzmann
solvers. Since our approach maintains the neutrino growth predicted with Boltzmann codes,
an added benefit is that we can readily compare the simulated neutrino power spectra with
our backscaling model to check that neutrinos are evolving with linear theory expectations.
We applied this backscaling procedure to particle-based neutrino simulations performed
using the code HACC. The neutrino initial conditions follow the tiling framework presented
in Ref. [72] with a number of important modifications. First, we introduce a simple rotation
scheme between adjacent momentum shells which reduces spurious power arising from the
angular discretization of momentum directions. Second, we omit neutrinos from the short-
range gravitational force and apply a sharp truncation to the neutrino density field in Fourier
space during the long-range force calculation. This filter can easily be applied in any PM-
based force solver and prevents an artificial back-reaction of the initial condition neutrino grid
onto the cold matter field. Without any filter, we found perceptible spikes emerge in the cold
matter field if the neutrino mass resolution, and the corresponding neutrino shot noise level, is
sufficiently coarse. Since this filter completely removes neutrino power below the particle grid
Nyquist frequency, it should only be applied if the particle grid resolution is much finer than
the neutrino free-streaming length. More sophisticated treatments would involve applying
this filter only at high redshift when both the free-streaming length is larger and the neutrino
shot noise level is more comparable to the intrinsic cold matter power spectrum.
We performed a numerical convergence study on the internal parameters of the tiling
method. In agreement with Ref. [61], we find that the tiling method is highly sensitive to
the number of direction vectors and NDIR≳100is required to achieve ∼10%convergence
in the neutrino power spectrum on intermediate scales. The dependence on the number of
momentum shells is weaker and is generally converged at the ∼10%level with NSHELL≳10.
In order to prevent the total number of neutrino particles from heavily dominating the total
particle count, these findings require a relatively coarse neutrino grid with Ncb/Nν≳10.
The primary challenge is that the neutrino power spectrum saturates to the shot noise level
below the neutrino grid scale with prominent peaks at the grid resonance frequencies. This
issue is not unique to the tiling procedure per se, but becomes increasingly problematic as
a neutrino grid pushes the noise to larger scales. Hence, while the tiling method effectively
removes neutrino shot noise above the neutrino grid scale, the sacrifice is that care must be
taken to ensure that the number of neutrino particles per grid site is large enough to reach
numerical convergence and that the gravitational back-reaction from the grid is properly
handled. We found that the cold matter power spectrum is largely invariant to changes in
the tiling parameters on linear scales. On non-linear scales, however, we found that changes
in the tiling parameter choices lead to ∼1%random noise.
The simulations presented here converge to a neutrino power spectrum suppressed at
– 25 –the15%level compared to linear theory for scales k≳0.1hMpc−1and redshifts z≳1.
We have not determined the exact cause of this discrepancy nor is it clear if this result is
unique to the tiling method or would more generally be reproduced in other particle-based
methods. Obviously, there are a number of approximations made in the simulation that could
preclude accurate comparisons with linear theory. These include the use of the momentum-
integrated transfer function for all momentum bins in the initial conditions as well as the
fact that we omit all relativistic treatments of neutrinos. It is also possible that high thermal
motion at early times erases the initial condition power spectrum and/or that biases seen in
mixed dark matter plus baryon simulations extend to the neutrino case. The use of the ZA
in initializing the neutrinos at zν
ini= 10−40may also be problematic, due to the associated
power suppression characteristic of this approximation. Understandably, most studies have
focused only on numerical convergence in the total matter field, but it remains important to
isolate any errors directly impacting neutrino growth.
We compared the results from our N-body simulations for the total matter power spec-
trum with the predictions of the Mira-Titan emulator [42] for a neutrino mass sum of 0.15eV,
corresponding to fν≈1%. The results obtained are very encouraging, the agreement being
nicely within the estimated errors intrinsic to both methods.
Looking forward, there are several applications where the lessons of this work might
be useful. For example, the methods used for simulating the nonlinear effect of massive
neutrinos on probes of LSS can be repurposed to investigate similar effects due to light
massive relics (LiMRs, e.g. Ref. [108]). Most forecasts of the sensitivity of LSS observations
to the presence of LiMRs have been at the level of linear theory or modified perturbation
theory [109, 110], though Ref. [111] recently gave a fully-nonlinear treatment with simulations
(using a randomized initialization). It would be interesting to consider both the reduced
computational cost due to shot noise reduction and to explore the relative significance of the
numerical artifacts of the tiling initialization in the context of LiMR simulations. This work
also serves to inform how best to include massive neutrinos in a computationally efficient
manner in three-species simulations, for example, in conjunction with CRK-HACC [88]. Future
work will more completely characterize to what extent the tiling initialization can be reliably
applied to three-species simulations, in particular focusing on the interaction between baryons
and neutrinos.
Acknowledgments
We thank Matthew Becker for his role in the early stages of this project. We also thank
Arka Banerjee, Adrian Bayer, Michael Buehlmann, Emanuele Castorina, Joe DeRose, Katrin
Heitmann, Patricia Larsen, and Amol Upadhye for helpful conversations. We are grateful to
Michael Buehlmann for assistance packaging SONICC.
This material is based upon work supported by the U.S. Department of Energy, Of-
fice of Science, Office of Advanced Scientific Computing Research, Department of Energy
Computational Science Graduate Fellowship under Award Number DE-SC0019323. This ma-
terial is further based upon work supported by Laboratory Directed Research and Develop-
ment (LDRD) funding from Argonne National Laboratory, provided by the Director, Office
of Science, of the U.S. Department of Energy under Contract No. DE-AC02-06CH11357.
This research used resources of the National Energy Research Scientific Computing Center
(NERSC), a U.S. Department of Energy Office of Science User Facility located at Lawrence
Berkeley National Laboratory, operated under Contract No. DE-AC02-05CH11231. This
– 26 –research has made use of NASA’s Astrophysics Data System. This report was prepared as
an account of work sponsored by an agency of the United States Government. Neither the
United States Government nor any agency thereof, nor any of their employees, makes any
warranty, express or implied, or assumes any legal liability or responsibility for the accuracy,
completeness, or usefulness of any information, apparatus, product, or process disclosed, or
represents that its use would not infringe privately owned rights. Reference herein to any
specific commercial product, process, or service by trade name, trademark, manufacturer,
or otherwise does not necessarily constitute or imply its endorsement, recommendation, or
favoring by the United States Government or any agency thereof. The views and opinions
of authors expressed herein do not necessarily state or reflect those of the United States
Government or any agency thereof.
References
[1] A. B. Balantekin and B. Kayser, On the properties of neutrinos ,Annual Review of Nuclear
and Particle Science 68(2018) 313.
[2] A. De Gouvêa, Neutrino mass models ,Annual Review of Nuclear and Particle Science 66
(2016) 197.
[3] C. Dvorkin, M. Gerbino, D. Alonso, N. Battaglia, S. Bird, A. Diaz Rivero et al., Neutrino
Mass from Cosmology: Probing Physics Beyond the Standard Model , BAAS 51(2019) 64
[1903.03689 ].
[4] Katrin Collaboration, M. Aker, A. Beglarian, J. Behrens, A. Berlev, U. Besserer et al., Direct
neutrino-mass measurement with sub-electronvolt sensitivity ,Nature Physics 18(2022) 160.
[5] Planck Collaboration, N. Aghanim, Y. Akrami, M. Ashdown, J. Aumont, C. Baccigalupi
et al.,Planck 2018 results. VI. Cosmological parameters , A&A 641(2020) A6 [ 1807.06209 ].
[6] S. Alam, M. Aubert, S. Avila, C. Balland, J. E. Bautista, M. A. Bershady et al., Completed
SDSS-IV extended Baryon Oscillation Spectroscopic Survey: Cosmological implications from
two decades of spectroscopic surveys at the Apache Point Observatory , Phys. Rev. D 103
(2021) 083533 [ 2007.08991 ].
[7] J. Lesgourgues and S. Pastor, Massive neutrinos and cosmology , Phys. Rep. 429(2006) 307
[astro-ph/0603494 ].
[8] P. F. de Salas, D. V. Forero, C. A. Ternes, M. Tortola and J. W. F. Valle, Status of neutrino
oscillations 2018: first hint for normal mass ordering and improved CP sensitivity ,arXiv
e-prints (2017) arXiv:1708.01186 [ 1708.01186 ].
[9] I. Esteban, M. C. Gonzalez-Garcia, A. Hernandez-Cabezudo, M. Maltoni and T. Schwetz,
Global analysis of three-flavour neutrino oscillations: synergies and tensions in the
determination of θ23,δCP, and the mass ordering ,Journal of High Energy Physics 2019
(2019) 106 [ 1811.05487 ].
[10] R. G. H. Robertson, T. J. Bowles, J. Stephenson, G. J., D. L. Wark, J. F. Wilkerson and
D. A. Knapp, Limit on nu-bar emass from observation of the βdecay of molecular tritium ,
Phys. Rev. Lett. 67(1991) 957.
[11] V. M. Lobashev, V. N. Aseev, A. I. Belesev, A. I. Berlev, E. V. Geraskin, A. A. Golubev
et al.,Neutrino mass and anomaly in the tritium beta-spectrum. Results of the “Troitsk
ν-mass” experiment ,Nuclear Physics B Proceedings Supplements 77(1999) 327.
[12] C. Kraus, B. Bornschein, L. Bornschein, J. Bonn, B. Flatt, A. Kovalik et al., Final results
from phase II of the Mainz neutrino mass searchin tritium { β} decay,European Physical
Journal C 40(2005) 447 [ hep-ex/0412056 ].
– 27 –[13] M. Aker, M. Balzer, D. Batzler, A. Beglarian, J. Behrens, A. Berlev et al., KATRIN: status
and prospects for the neutrino mass and beyond ,Journal of Physics G Nuclear Physics 49
(2022) 100501 [ 2203.08059 ].
[14] M. Archidiacono, S. Hannestad and J. Lesgourgues, What will it take to measure individual
neutrino mass states using cosmology? , J. Cosmology Astropart. Phys. 2020(2020) 021
[2003.03354 ].
[15] DESI Collaboration, A. Aghamousa, J. Aguilar, S. Ahlen, S. Alam, L. E. Allen et al., The
DESI Experiment Part I: Science,Targeting, and Survey Design ,arXiv e-prints (2016)
arXiv:1611.00036 [ 1611.00036 ].
[16] W. L. Xu, N. DePorzio, J. B. Muñoz and C. Dvorkin, Accurately weighing neutrinos with
cosmological surveys , Phys. Rev. D 103(2021) 023503 [ 2006.09395 ].
[17] F. Beutler, S. Saito, J. R. Brownstein, C.-H. Chuang, A. J. Cuesta, W. J. Percival et al., The
clustering of galaxies in the SDSS-III Baryon Oscillation Spectroscopic Survey: signs of
neutrino mass in current cosmological data sets , MNRAS 444(2014) 3501 [ 1403.4599 ].
[18] N. Palanque-Delabrouille, C. Yèche, J. Baur, C. Magneville, G. Rossi, J. Lesgourgues et al.,
Neutrino masses and cosmology with Lyman-alpha forest power spectrum , J. Cosmology
Astropart. Phys. 2015(2015) 011 [ 1506.05976 ].
[19] A. J. Cuesta, V. Niro and L. Verde, Neutrino mass limits: Robust information from the power
spectrum of galaxy surveys ,Physics of the Dark Universe 13(2016) 77 [ 1511.05983 ].
[20] S. Alam, M. Ata, S. Bailey, F. Beutler, D. Bizyaev, J. A. Blazek et al., The clustering of
galaxies in the completed SDSS-III Baryon Oscillation Spectroscopic Survey: cosmological
analysis of the DR12 galaxy sample , MNRAS 470(2017) 2617 [ 1607.03155 ].
[21] S. Vagnozzi, E. Giusarma, O. Mena, K. Freese, M. Gerbino, S. Ho et al., Unveiling νsecrets
with cosmological data: Neutrino masses and mass hierarchy , Phys. Rev. D 96(2017) 123503
[1701.08172 ].
[22] C. Doux, M. Penna-Lima, S. D. P. Vitenti, J. Tréguer, E. Aubourg and K. Ganga,
Cosmological constraints from a joint analysis of cosmic microwave background and
spectroscopic tracers of the large-scale structure , MNRAS 480(2018) 5386 [ 1706.04583 ].
[23] T. M. C. Abbott, F. B. Abdalla, A. Alarcon, J. Aleksić, S. Allam, S. Allen et al., Dark Energy
Survey year 1 results: Cosmological constraints from galaxy clustering and weak lensing ,
Phys. Rev. D 98(2018) 043526 [ 1708.01530 ].
[24] A. Upadhye, Neutrino mass and dark energy constraints from redshift-space distortions , J.
Cosmology Astropart. Phys. 2019(2019) 041 [ 1707.09354 ].
[25] M. M. Ivanov, M. Simonović and M. Zaldarriaga, Cosmological parameters and neutrino
masses from the final P l a n c k and full-shape BOSS data , Phys. Rev. D 101(2020) 083504
[1912.08208 ].
[26] N. Palanque-Delabrouille, C. Yèche, N. Schöneberg, J. Lesgourgues, M. Walther, S. Chabanier
et al.,Hints, neutrino bounds, and WDM constraints from SDSS DR14 Lyman- αand Planck
full-survey data , J. Cosmology Astropart. Phys. 2020(2020) 038 [ 1911.09073 ].
[27] T. M. C. Abbott, M. Aguena, A. Alarcon, S. Allam, O. Alves, A. Amon et al., Dark Energy
Survey Year 3 results: Cosmological constraints from galaxy clustering and weak lensing ,
Phys. Rev. D 105(2022) 023520 [ 2105.13549 ].
[28] A. Banerjee, E. Castorina, F. Villaescusa-Navarro, T. Court and M. Viel, Weighing neutrinos
with the halo environment , J. Cosmology Astropart. Phys. 2020(2020) 032 [ 1907.06598 ].
[29] S. Vagnozzi, T. Brinckmann, M. Archidiacono, K. Freese, M. Gerbino, J. Lesgourgues et al.,
Bias due to neutrinos must not uncorrect’d go , J. Cosmology Astropart. Phys. 2018(2018)
001 [ 1807.04672 ].
– 28 –[30] N. Schuster, N. Hamaus, A. Pisani, C. Carbone, C. D. Kreisch, G. Pollina et al., The bias of
cosmic voids in the presence of massive neutrinos , J. Cosmology Astropart. Phys. 2019
(2019) 055 [ 1905.00436 ].
[31] C. D. Kreisch, A. Pisani, C. Carbone, J. Liu, A. J. Hawken, E. Massara et al., Massive
neutrinos leave fingerprints on cosmic voids , MNRAS 488(2019) 4413 [ 1808.07464 ].
[32] E. Massara, F. Villaescusa-Navarro, S. Ho, N. Dalal and D. N. Spergel, Using the Marked
Power Spectrum to Detect the Signature of Neutrinos in Large-Scale Structure ,
Phys. Rev. Lett. 126(2021) 011301 [ 2001.11024 ].
[33] A. E. Bayer, A. Banerjee and U. Seljak, Beware of fake ν’s: The effect of massive neutrinos
on the nonlinear evolution of cosmic structure , Phys. Rev. D 105(2022) 123510 [ 2108.04215 ].
[34] C. Hahn, F. Villaescusa-Navarro, E. Castorina and R. Scoccimarro, Constraining M νwith the
bispectrum. Part I. Breaking parameter degeneracies , J. Cosmology Astropart. Phys. 2020
(2020) 040 [ 1909.11107 ].
[35] R. Ruggeri, E. Castorina, C. Carbone and E. Sefusatti, DEMNUni: massive neutrinos and the
bispectrum of large scale structures , J. Cosmology Astropart. Phys. 2018(2018) 003
[1712.02334 ].
[36] W. R. Coulton, J. Liu, M. S. Madhavacheril, V. Böhm and D. N. Spergel, Constraining
neutrino mass with the tomographic weak lensing bispectrum , J. Cosmology Astropart. Phys.
2019(2019) 043 [ 1810.02374 ].
[37] K. Abazajian, E. R. Switzer, S. Dodelson, K. Heitmann and S. Habib, Nonlinear cosmological
matter power spectrum with massive neutrinos: The halo model , Phys. Rev. D 71(2005)
043507 [ astro-ph/0411552 ].
[38] S. Hannestad, A. Upadhye and Y. Y. Y. Wong, Spoon or slide? The non-linear matter power
spectrum in the presence of massive neutrinos , J. Cosmology Astropart. Phys. 2020(2020)
062 [ 2006.04995 ].
[39] S. Agarwal and H. A. Feldman, The effect of massive neutrinos on the matter power
spectrum , MNRAS 410(2011) 1647 [ 1006.0689 ].
[40] A. Upadhye, R. Biswas, A. Pope, K. Heitmann, S. Habib, H. Finkel et al., Large-scale
structure formation with massive neutrinos and dynamical dark energy , Phys. Rev. D 89
(2014) 103515 [ 1309.5872 ].
[41] N. A. Maksimova, L. H. Garrison, D. J. Eisenstein, B. Hadzhiyska, S. Bose and T. P.
Satterthwaite, ABACUSSUMMIT: a massive set of high-accuracy, high-resolution N-body
simulations , MNRAS 508(2021) 4017 [ 2110.11398 ].
[42] K. R. Moran, K. Heitmann, E. Lawrence, S. Habib, D. Bingham, A. Upadhye et al., The
Mira-Titan Universe IV. High Precision Power Spectrum Emulation ,arXiv e-prints (2022)
arXiv:2207.12345 [ 2207.12345 ].
[43] J. Brandbyge and S. Hannestad, Grid based linear neutrino perturbations in cosmological
N-body simulations , J. Cosmology Astropart. Phys. 2009(2009) 002 [ 0812.3149 ].
[44] D. Blas, M. Garny, T. Konstandin and J. Lesgourgues, Structure formation with massive
neutrinos: going beyond linear theory , J. Cosmology Astropart. Phys. 2014(2014) 039
[1408.2995 ].
[45] Y. Ali-Haïmoud and S. Bird, An efficient implementation of massive neutrinos in non-linear
structure formation simulations , MNRAS 428(2013) 3375 [ 1209.0461 ].
[46] J. Liu, S. Bird, J. M. Zorrilla Matilla, J. C. Hill, Z. Haiman, M. S. Madhavacheril et al.,
MassiveNuS: cosmological massive neutrino simulations , J. Cosmology Astropart. Phys. 2018
(2018) 049 [ 1711.10524 ].
– 29 –[47] J. Zhiyu Chen, A. Upadhye and Y. Y. Y. Wong, One line to run them all: SuperEasy massive
neutrino linear response in N-body simulations ,arXiv e-prints (2020) arXiv:2011.12504
[2011.12504 ].
[48] K. Yoshikawa, S. Tanaka, N. Yoshida and S. Saito, Cosmological VlasovPoisson Simulations
of Structure Formation with Relic Neutrinos: Nonlinear Clustering and the Neutrino Mass ,
ApJ904(2020) 159 [ 2010.00248 ].
[49] A. Banerjee and N. Dalal, Simulating nonlinear cosmological structure formation with massive
neutrinos , J. Cosmology Astropart. Phys. 2016(2016) 015 [ 1606.06167 ].
[50] J. Dakin, J. Brandbyge, S. Hannestad, T. HaugbØlle and T. Tram, νCONCEPT: cosmological
neutrino simulations from the non-linear Boltzmann hierarchy , J. Cosmology Astropart. Phys.
2019(2019) 052 [ 1712.03944 ].
[51] D. Inman and H.-R. Yu, Simulating the Cosmic Neutrino Background Using Collisionless
Hydrodynamics , ApJS 250(2020) 21 [ 2002.04601 ].
[52] A. Klypin, J. Holtzman, J. Primack and E. Regos, Structure Formation with Cold plus Hot
Dark Matter , ApJ 416(1993) 1 [ astro-ph/9305011 ].
[53] A. Gardini, S. Bonometto and G. Murante, Cluster mass function in mixed models ,The
Astrophysical Journal 524(1999) 510.
[54] J. Brandbyge, S. Hannestad, T. Haugbølle and B. Thomsen, The effect of thermal neutrino
motion on the non-linear cosmological matter power spectrum , J. Cosmology Astropart. Phys.
2008(2008) 020 [ 0802.3700 ].
[55] M. Viel, M. G. Haehnelt and V. Springel, The effect of neutrinos on the matter distribution as
probed by the intergalactic medium , J. Cosmology Astropart. Phys. 2010(2010) 015
[1003.2422 ].
[56] S. Bird, M. Viel and M. G. Haehnelt, Massive neutrinos and the non-linear matter power
spectrum , MNRAS 420(2012) 2551 [ 1109.4416 ].
[57] F. Villaescusa-Navarro, F. Marulli, M. Viel, E. Branchini, E. Castorina, E. Sefusatti et al.,
Cosmology with massive neutrinos I: towards a realistic modeling of the relation between
matter, haloes and galaxies , J. Cosmology Astropart. Phys. 2014(2014) 011 [ 1311.0866 ].
[58] E. Castorina, C. Carbone, J. Bel, E. Sefusatti and K. Dolag, DEMNUni: the clustering of
large-scale structures in the presence of massive neutrinos , J. Cosmology Astropart. Phys.
2015(2015) 043 [ 1505.07148 ].
[59] D. Inman, J. D. Emberson, U.-L. Pen, A. Farchi, H.-R. Yu and J. Harnois-Déraps, Precision
reconstruction of the cold dark matter-neutrino relative velocity from N -body simulations ,
Phys. Rev. D 92(2015) 023502 [ 1503.07480 ].
[60] J. D. Emberson, H.-R. Yu, D. Inman, T.-J. Zhang, U.-L. Pen, J. Harnois-Déraps et al.,
Cosmological neutrino simulations at extreme scale ,Research in Astronomy and Astrophysics
17(2017) 085 [ 1611.01545 ].
[61] J. Brandbyge, S. Hannestad and T. Tram, Momentum space sampling of neutrinos in N-body
simulations , J. Cosmology Astropart. Phys. 2019(2019) 047 [ 1806.05874 ].
[62] F. Villaescusa-Navarro, C. Hahn, E. Massara, A. Banerjee, A. M. Delgado, D. K. Ramanah
et al.,The Quijote Simulations , ApJS 250(2020) 2 [ 1909.05273 ].
[63] A. E. Bayer, A. Banerjee and Y. Feng, A fast particle-mesh simulation of non-linear
cosmological structure formation with massive neutrinos , J. Cosmology Astropart. Phys. 2021
(2021) 016 [ 2007.13394 ].
[64] W. Elbers, C. S. Frenk, A. Jenkins, B. Li and S. Pascoli, An optimal non-linear method for
simulating relic neutrinos , MNRAS 507(2021) 2614 [ 2010.07321 ].
– 30 –[65] J. Adamek, R. E. Angulo, C. Arnold, M. Baldi, M. Biagetti, B. Bose et al., Euclid: Modelling
massive neutrinos in cosmology – a code comparison ,arXiv e-prints (2022) arXiv:2211.12457
[2211.12457 ].
[66] J. Brandbyge and S. Hannestad, Resolving cosmic neutrino structure: a hybrid neutrino
N-body scheme , J. Cosmology Astropart. Phys. 2010(2010) 021 [ 0908.1969 ].
[67] S. Bird, Y. Ali-Haïmoud, Y. Feng and J. Liu, An efficient and accurate hybrid method for
simulating non-linear neutrino structure , MNRAS 481(2018) 1486 [ 1803.09854 ].
[68] J. Zhiyu Chen, M. R. Mosbech, A. Upadhye and Y. Y. Y. Wong, Hybrid multi-fluid-particle
simulations of the cosmic neutrino background ,arXiv e-prints (2022) arXiv:2210.16012
[2210.16012 ].
[69] F. Villaescusa-Navarro, A. Banerjee, N. Dalal, E. Castorina, R. Scoccimarro, R. Angulo et al.,
The Imprint of Neutrinos on Clustering in Redshift Space , ApJ 861(2018) 53 [ 1708.01154 ].
[70] B. O. Mummery, I. G. McCarthy, S. Bird and J. Schaye, The separate and combined effects of
baryon physics and neutrino free streaming on large-scale structure , MNRAS 471(2017) 227
[1702.02064 ].
[71] G. Rossi, The Sejong Suite: Cosmological Hydrodynamical Simulations with Massive
Neutrinos, Dark Radiation, and Warm Dark Matter , ApJS 249(2020) 19 [ 2007.15279 ].
[72] A. Banerjee, D. Powell, T. Abel and F. Villaescusa-Navarro, Reducing noise in cosmological
N-body simulations with neutrinos , J. Cosmology Astropart. Phys. 2018(2018) 028
[1801.03906 ].
[73] T. Tram, J. Brandbyge, J. Dakin and S. Hannestad, Fully relativistic treatment of light
neutrinos in N-body simulations , J. Cosmology Astropart. Phys. 2019(2019) 022
[1811.00904 ].
[74] J. Adamek, R. Durrer and M. Kunz, Relativistic N-body simulations with massive neutrinos ,
J. Cosmology Astropart. Phys. 2017(2017) 004 [ 1707.06938 ].
[75] C. Fidler, T. Tram, C. Rampf, R. Crittenden, K. Koyama and D. Wands, Relativistic initial
conditions for N-body simulations , J. Cosmology Astropart. Phys. 2017(2017) 043
[1702.03221 ].
[76] M. Zennaro, J. Bel, F. Villaescusa-Navarro, C. Carbone, E. Sefusatti and L. Guzzo, Initial
conditions for accurate N-body simulations of massive neutrino cosmologies , MNRAS 466
(2017) 3244 [ 1605.05283 ].
[77] S. Habib, A. Pope, H. Finkel, N. Frontiere, K. Heitmann, D. Daniel et al., HACC: Simulating
sky surveys on state-of-the-art supercomputing architectures , New A 42(2016) 49 [ 1410.2805 ].
[78] A. Lewis, A. Challinor and A. Lasenby, Efficient Computation of Cosmic Microwave
Background Anisotropies in Closed Friedmann-Robertson-Walker Models , ApJ 538(2000) 473
[astro-ph/9911177 ].
[79] D. Blas, J. Lesgourgues and T. Tram, The Cosmic Linear Anisotropy Solving System
(CLASS). Part II: Approximation schemes , J. Cosmology Astropart. Phys. 2011(2011) 034
[1104.2933 ].
[80] P. J. E. Peebles, Principles of Physical Cosmology . 2021, 10.1515/9780691206721.
[81] A. E. Bayer, F. Villaescusa-Navarro, E. Massara, J. Liu, D. N. Spergel, L. Verde et al.,
Detecting Neutrino Mass by Combining Matter Clustering, Halos, and Voids , ApJ 919(2021)
24 [2102.05049 ].
[82] C. Giocoli, M. Baldi and L. Moscardini, Weak lensing light-cones in modified gravity
simulations with and without massive neutrinos , MNRAS 481(2018) 2813 [ 1806.04681 ].
– 31 –[83] A. Raccanelli, L. Verde and F. Villaescusa-Navarro, Biases from neutrino bias: to worry or
not to worry? , MNRAS 483(2019) 734 [ 1704.07837 ].
[84] C. Fidler and A. Kleinjohann, Suitable initial conditions for Newtonian simulations with
massive neutrinos , J. Cosmology Astropart. Phys. 2019(2019) 018 [ 1810.12019 ].
[85] D. Valcin, F. Villaescusa-Navarro, L. Verde and A. Raccanelli, BE-HaPPY: bias emulator for
halo power spectrum including massive neutrinos , J. Cosmology Astropart. Phys. 2019(2019)
057 [ 1901.06045 ].
[86] G. Parimbelli, S. Anselmi, M. Viel, C. Carbone, F. Villaescusa-Navarro, P. S. Corasaniti
et al.,The effects of massive neutrinos on the linear point of the correlation function , J.
Cosmology Astropart. Phys. 2021(2021) 009 [ 2007.10345 ].
[87] S. Contreras, R. E. Angulo, M. Zennaro, G. Aricò and M. Pellejero-Ibañez, 3 per
cent-accurate predictions for the clustering of dark matter, haloes, and subhaloes, over a wide
range of cosmologies and scales , MNRAS 499(2020) 4905 [ 2001.03176 ].
[88] N. Frontiere, J. D. Emberson, M. Buehlmann, J. Adamo, S. Habib, K. Heitmann et al.,
Simulating Hydrodynamics in Cosmology with CRK-HACC , ApJS 264(2023) 34
[2202.02840 ].
[89] K. M. Górski, E. Hivon, A. J. Banday, B. D. Wandelt, F. K. Hansen, M. Reinecke et al.,
HEALPix: A Framework for High-Resolution Discretization and Fast Analysis of Data
Distributed on the Sphere , ApJ 622(2005) 759 [ astro-ph/0409513 ].
[90] N. Yoshida, N. Sugiyama and L. Hernquist, The evolution of baryon density fluctuations in
multicomponent cosmological simulations , MNRAS 344(2003) 481 [ astro-ph/0305210 ].
[91] C. B. d. S. Nascimento and M. Loverde, Neutrinos in N -body simulations , Phys. Rev. D 104
(2021) 043512 [ 2102.05690 ].
[92] A. Aviles and A. Banerjee, A Lagrangian perturbation theory in the presence of massive
neutrinos , J. Cosmology Astropart. Phys. 2020(2020) 034 [ 2007.06508 ].
[93] M. Michaux, O. Hahn, C. Rampf and R. E. Angulo, Accurate initial conditions for
cosmological N-body simulations: minimizing truncation and discreteness errors , MNRAS 500
(2021) 663 [ 2008.09588 ].
[94] W. Elbers, C. S. Frenk, A. Jenkins, B. Li and S. Pascoli, Higher order initial conditions with
massive neutrinos , MNRAS 516(2022) 3821 [ 2202.00670 ].
[95] M. Joyce and B. Marcos, Quantification of discreteness effects in cosmological N-body
simulations: Initial conditions , Phys. Rev. D 75(2007) 063516 [ astro-ph/0410451 ].
[96] M. Joyce, B. Marcos and T. Baertschiger, Towards quantitative control on discreteness error
in the non-linear regime of cosmological N-body simulations , MNRAS 394(2009) 751
[0805.1357 ].
[97] E. Lawrence, K. Heitmann, J. Kwan, A. Upadhye, D. Bingham, S. Habib et al., The
Mira-Titan Universe. II. Matter Power Spectrum Emulation , ApJ 847(2017) 50
[1705.03388 ].
[98] K. Heitmann, D. Bingham, E. Lawrence, S. Bergner, S. Habib, D. Higdon et al., The
Mira-Titan Universe: Precision Predictions for Dark Energy Surveys , ApJ 820(2016) 108
[1508.02654 ].
[99] K. Heitmann, E. Lawrence, J. Kwan, S. Habib and D. Higdon, The Coyote Universe Extended:
Precision Emulation of the Matter Power Spectrum , ApJ 780(2014) 111 [ 1304.7849 ].
[100] R. de Putter, C. Wagner, O. Mena, L. Verde and W. J. Percival, Thinking outside the box:
effects of modes larger than the survey on matter power spectrum covariance , J. Cosmology
Astropart. Phys. 2012(2012) 019 [ 1111.6596 ].
– 32 –[101] M. Takada and W. Hu, Power spectrum super-sample covariance , Phys. Rev. D 87(2013)
123504 [ 1302.6994 ].
[102] Y. Li, W. Hu and M. Takada, Super-sample signal , Phys. Rev. D 90(2014) 103530
[1408.1081 ].
[103] I. Mohammed and U. Seljak, Analytic model for the matter power spectrum, its covariance
matrix and baryonic effects , MNRAS 445(2014) 3382 [ 1407.0060 ].
[104] A. E. Bayer, J. Liu, R. Terasawa, A. Barreira, Y. Zhong and Y. Feng, Super-sample
covariance of the power spectrum, bispectrum, halos, voids, and their cross-covariances ,arXiv
e-prints (2022) arXiv:2210.15647 [ 2210.15647 ].
[105] R. E. Angulo, O. Hahn and T. Abel, How closely do baryons follow dark matter on large
scales?, MNRAS 434(2013) 1756 [ 1301.7426 ].
[106] S. Bird, Y. Feng, C. Pedersen and A. Font-Ribera, More accurate simulations with separate
initial conditions for baryons and dark matter , J. Cosmology Astropart. Phys. 2020(2020)
002 [ 2002.00015 ].
[107] O. Hahn, C. Rampf and C. Uhlemann, Higher order initial conditions for mixed baryon-CDM
simulations , MNRAS 503(2021) 426 [ 2008.09124 ].
[108] C. Dvorkin, J. Meyers, P. Adshead, M. Amin, C. A. Argüelles, T. Brinckmann et al., The
Physics of Light Relics ,arXiv e-prints (2022) arXiv:2203.07943 [ 2203.07943 ].
[109] W. L. Xu, J. B. Muñoz and C. Dvorkin, Cosmological constraints on light but massive relics ,
Phys. Rev. D 105(2022) 095029 [ 2107.09664 ].
[110] N. DePorzio, W. L. Xu, J. B. Muñoz and C. Dvorkin, Finding eV-scale light relics with
cosmological observables , Phys. Rev. D 103(2021) 023504 [ 2006.09380 ].
[111] A. Banerjee, S. Das, A. Maharana and R. K. Sharma, Signatures of Light Massive Relics on
non-linear structure formation , MNRAS 516(2022) 2038 [ 2202.09840 ].
– 33 –