The Theory of Gene Family Histories
Marc Hellmuth and Peter F. Stadler
Abstract Most genes are part of larger families of evolutionary related genes. The
history of gene families typically involves duplications and losses of genes as well as
horizontal transfers into other organisms. The reconstruction of detailed gene fam-
ily histories, i.e., the precise dating of evolutionary events relative to phylogenetic
tree of the underlying species has remained a challenging topic despite their impor-
tance as a basis for detailed investigations into adaptation and functional evolution
of individual members of the gene family. The identiÔ¨Åcation of orthologs, moreover,
is a particularly important subproblem of the more general setting considered here.
In the last few years, an extensive body of mathematical results has appeared that
tightly links orthology, a formal notion of best matches among genes, and horizon-
tal gene transfer. The purpose of this chapter is the broadly outline some of the key
mathematical insights and to discuss their implication for practical applications. In
particular, we focus on tree-free methods, i.e., methods to infer orthology or hori-
zontal gene transfer as well as gene trees, species trees and reconciliations between
them without using a priori knowledge of the underlying trees or statistical models
for the inference of phylogenetic trees. Instead, the initial step aims to extract binary
relations among genes.
Marc Hellmuth
Department of Mathematics, Faculty of Science, Stockholm University, SE - 106 91 Stockholm,
Sweden
Peter F. Stadler
Bioinformatics Group, Department of Computer Science, and Interdisciplinary Center for Bioin-
formatics, University of Leipzig, H ¬®artelstra√üe 16-18, D-04107, Leipzig, Germany. Max Planck
Institute for Mathematics in the Sciences, Inselstra√üe 22 D-04103 Leipzig, Germany. Fraunhofer
Institute for Cell Therapy and Immunology, Perlickstra√üe 1, D-04103 Leipzig, Germany. Institute
for Theoretical Chemistry, University of Vienna, W ¬®ahringerstra√üe 17, A-1090 Wien, Austria. Cen-
ter for non-coding RNA in Technology and Health, University of Copenhagen, Gr√∏nneg Àöardsvej 3,
DK-1870 Frederiksberg C, Denmark. Santa Fe Institute, 1399 Hyde Park Rd, Santa Fe, NM 87501,
USA
e-mail: marc.hellmuth@math.su.se,studla@bioinf.uni-leipzig.de
1arXiv:2304.11826v1  [q-bio.PE]  24 Apr 20232 Marc Hellmuth and Peter F. Stadler
Keywords: orthologs, paralogs, gene family, protein family, horizontal gene
transfer, best matches, phylogeny, tree-free methods.
1 Introduction
In a typical genome, most genes appear as members of larger families of homolo-
gous genes, i.e., genes that share a common ancestor. The evolutionary history of a
gene family involves speciations , where a gene is transmitted to each of the sepa-
rating lineages, duplications within a genome, loss, and sometimes also horizontal
transfer , either of individual genes or as a consequence of hybridization events.
These events give rise to homology relations : two genes are orthologs (resp., par-
alogs ) if their most recent ancestor is a speciation event (resp., duplication event).
Moreover, xenologous genes are genes that were separated by a horizontal transfer.
Such events tend to impact gene function. Selective pressures on genes may change
due to different environmental constraints following a speciation, but also following
gene duplications due to subfunctionalization or neofunctionalization [1] of the par-
alogous copies, and following gene loss [2]. As a consequence, orthologous genes
in closely related genomes often have approximately the same function. Paralogs,
in contrast, tend to have related, but clearly distinct functions [3‚Äì6], although ex-
ceptions are not uncommon [7]. As a consequence, the accurate distinction of or-
thologs and paralogs is a key task for functional genome annotation. The reliable
identiÔ¨Åcation of orthologs also plays a key role in comparative genomics analyses
[8]. Moreover, one-to-one orthologs are the characters of choice in molecular phy-
logenetics [6, 9].
Accurate knowledge of the evolutionary history of a gene family, thus, is the basis
for its comparative analysis and an understanding of the evolution of its functional
portfolio. Gene family histories, however, cannot be measured directly but have to
be inferred from present-day sequence data, i.e., from measurements of similari-
ties between genes and the genomes in which they reside. This requires a formal
framework in which the intertwined histories of genes and species can be studied
and the correctness, limits, and accuracy of computational methods can be assessed.
In this chapter we outline the framework of evolutionary scenarios , which com-
prises phylogenetic trees (or more generally phylogenetic networks) describing the
phylogenies of genes and species together with a reconciliation maps that embeds
the gene phylogeny into the species phylogeny. We will focus here on the case of
tree-like evolution and only brieÔ¨Çy comment the generalization to networks.
Evolutionary scenarios deÔ¨Åne event types that annotate vertices in gene phylo-
genies e.g. as speciation or duplication and edges as horizontal transfer. These sce-
narios in turn form the basis for the formal deÔ¨Ånitions for the different homology
relations among genes such as orthology, paralogy, or xenology [10‚Äì12], see Fig. 1
for an illustrative example. These three homology relations are not the only relations
of interest, however. The (reciprocal) best match relation describes all gene pairs
from distinct species that are evolutionary most closely related [13‚Äì16]. In contrastThe Theory of Gene Family Histories 3
a b1 c1c2 b2xa
c1b1 c2
b2
Fig. 1 An evolutionary scenario (left) consists of a species tree S(tube-like gray outline) into
which a gene tree T(black) is embedded by means of a reconciliation map that places each vertex
of the gene tree onto either an edge or a vertex of the species tree (gray horizontal lines). The rec-
onciliation deÔ¨Ånes the event types on the the species tree: Gene duplication events () are located
within edges of SandHGT-edges (arrow ‚Äú!‚Äù) in which direct offsprings are located in different
branches of S.Speciations events () are located at inner vertices of S. These have descendants
in each branch of the species tree, which however may not survive to the present day due to gene
loss(). Present-day genes are leaves of Tthat are mapped onto leaves of S(shown as leaves at
the bottom, colored by the species in which they reside, i.e., s(a) =A(red), s(b1) =s(b2) =B
(blue), and s(c1) =s(c2) =C(green).).
The event-labeled gene tree determines the homology relations (right). The orthology relation
comprises all pairs of genes that are connected by a thin solid black edge (without arrows) and
correspond to pairs of distinctly colored genes whose last common ancestor is a speciation event.
The paralogy relation comprises all pairs of genes that are connected by a thin dashed black edge
and correspond to pairs of genes whose last common ancestor is a duplication event. The Fitch
(xenology) relation comprises pairs of genes that are connected by thin black arrow-edges. The
later-divergence-time relation comprises pairs of genes whose divergence time is below the diver-
gence time of the corresponding species (dashed gray lines) and the reciprocal best match relation
comprises all pairs (x;y)of genes from distinct species XandY, respectively, for which there is no
closer relative x02Xforyandy02Yforx(solid gray lines).
to orthology and paralogy, whose deÔ¨Ånition depends on whether the last common
ancestor was a speciation or gene duplication event, it is possible to estimate best
matches directly from genomic sequence data. Similarly, the later-divergence-time
(LDT) relation comprising gene-pairs that have diverged only after the divergence
of the two species in which the genes reside [17‚Äì19] is informative about the xenol-
ogy relation, which records whether or not two genes are separated by a HGT event
in their evolutionary history. While xenology cannot be measured directed, the LDT
relation is accessible from practical data analysis.
The problem of reconstructing a gene family history can be approached in differ-
ent ways. Tree-based methods start with inferring the gene tree and the species tree
separately using well-established phylogenetic methods. This leaves the problem
of computing the reconciliation map as a separate optimization problem, typically
minimizing the number of loss and HGT events. A problematic issue with this ap-
proach is that it crucially depends on accurate tree reconstructions. However, it is4 Marc Hellmuth and Peter F. Stadler
difÔ¨Åcult to obtain reliable gene trees in particular for gene families with complicated
histories [20]. One remedy is to jointly infer gene trees and species trees, see e.g.
[21, 22]. An alternative approach are tree-free approaches, that estimate binary rela-
tions such as reciprocal best matches directly from sequence similarity data and then
further analyze these relations to extract orthology and paralogy relations without
explicitly constructing trees. It appears that there is no fundamental difference in
the accuracy of present-day tree-based and tree-free approaches [23, 24]. Methods
to infer HGT, reviewed in [25], fall into three major categories: (1) tree-based ap-
proaches that compute an optimal reconciliation w.r.t. some cost function [26‚Äì28],
parametric methods that use genomic signatures, i.e., sequence features speciÔ¨Åc to
a (group of) species identify horizontally inserted material [29, 30], and so-called
implicit or indirect methods use distances between genes that are very small or very
large compared to the evolutionary distances of the respective species as indicators
of HGT [17, 31]. In fact, these methods in essence estimate the LDT relation [18].
The purpose of this chapter is to give an introduction into the formal framework
of evolutionary scenarios and to review some key mathematical results describing
the relationships between binary relations that can be measured from similarity data
and the homology relation that are of interest in evolutionary biology. Moreover,
we will be concerned with the question how much, and which, information on the
gene family history is actually encoded in these binary relations. We shall see that
robust estimates of these binary relations already put tight constraints on gene trees,
species trees, and reconciliations.
2 Scenarios
2.1 Notation
Graphs Gare tuples (V;E)consisting of a vertex set V(G):=Vand edge set
E(G):=E. Graphs might be undirected (edges are 2-elementary subsets of V) or
directed (edges are subsets of VV). All graphs considered in this contribution are
loop-free, i.e., iffx;ygor(x;y)is an edge, then x6=y. For a directed graph Gwe
write Gsymfor its underlying undirected graph with V(Gsym) =V(G). In general, we
use the term ‚Äúgraph‚Äù for undirected graphs and, otherwise, explicitly write ‚Äúdirected
graph‚Äù. Moreover, we use the simpliÔ¨Åed notation xyfor edgesfx;ygin undirected
graphs or for the case that both (x;y)and(y;x)are edges in a directed graph. Iden-
tifying undirected graphs with symmetric directed graphs, furthermore, allows us
to make use of subgraph relationships between directed and undirected graphs. We
extensively make use of graphs (G;s)equipped with a vertex-coloring s. We say
that(G;s)isproperly colored ifs(x)6=s(y)for all adjacent vertices xandy.
Rooted Trees naturally describe the phylogenetic relationships both among genes
and among species. A rooted tree Twith vertex set V=V(T)and edge set E=
E(T)contains a unique vertex 0 T, called the root, that designates the earliest stateThe Theory of Gene Family Histories 5
b c e h i a d g f0
lca(L(T))
lca({a,d,f,g,h})
lca({a,d})T
g if a d
T‚Äô0
kxT[x]
Fig. 2 A planted phyloge-
netic tree has root 0 above
the last common ancestor
lca(L(T))of all leaves. The
tree T0on the leaf set
fa;d;f;g;igis displayed by
T. The gray outline shows
how T0is embedded in T.
The subtree T(x)rooted at
the inner node xis shown by
a blue shading. Figure taken
from Ô¨Årst edition of the this
book [32].
under consideration. Every path in Tthat originates in 0 Tthus implies a temporal
order and determines the ancestor-descendant relationship as follows: If ylies on the
unique path from the root to x6=ythen yis an ancestor ofx, and xis adescendant
ofy. In this case we write xTy. For the edges of Twe write e=xyand use the
convention that yTx. For an edge e=xy, we say that xis the parent ofyandyis
achild ofx. It will be useful to extend the ancestor relation to V(T)[E(T). For a
vertex x2V(T)and an edge e=uv2E(T)we set xTeif and only if xTv; and
eTxif and only if uTx. In addition, for edges e=uvand f=abinTwe put
eTfif and only if vTb. As usual, xTzis equivalent to xTzor=zfor
allx;z2V(T)[E(T). If neither xTznorzTxholds, we say that xandz
areT-incomparable. Note that the root 0 TofTis the uniqueT-maximal vertex.
The set L(T)of allTminimal vertices form the leaves ofT. The subtree T (x)
rooted at x2V(T)is deÔ¨Åned as the subgraph induced by the vertex set fy2V(T)j
yTxg. For any subset AV(T), the least common ancestor lca(A)is theT-
minimal vertex wthat is an ancestor of all y2A. In particular, we have lca (fxg) =x
for all x2V(T). For simplicity, we write lca (x;y)instead of lca (fx;yg). In addition,
we may use the subscript ‚Äú T‚Äù to indicate that lca Tis take w.r.t. the tree T. Moreover,
we set rT:=lca(L(T))and note that rT=0Tif and only if the root 0 Thas at least
two children. The set of inner vertices V0(T):= (V(T)n(L(T)[fOTg))[frTgofT
comprise V(T)nL(T)and excludes the root if 0 T6=rT. A rooted tree is phylogenetic
if all its inner vertices have at least two children, and binary if all its inner vertices
have exactly two children. We will assume throughout that Tis phylogenetic but not
necessarily binary.
AreÔ¨Ånement of a phylogenetic tree Tis a phylogenetic tree T0on the same leaf
set such that Tcan be obtained from T0by contracting edges. The restriction TjL0of
TtoL0is the phylogenetic tree with leaf set L0obtained from the tree Tby deleting
all vertices in LnL0and their incident edges and by additionally suppressing all inner
vertices of degree two except the root. A phylogenetic tree T0on some subset L0L
is said to be displayed byT(or equivalently that T displays T0) ifT0coincides with
TjL0, see Fig. 2.6 Marc Hellmuth and Peter F. Stadler
Rooted triples are binary rooted tree on three vertices. The rooted triple with leaf
set and lca (x;y)lca(x;z) =lca(y;z)will be denoted by xyjz. Triples xyjzoften can
be derived directly from sequence data and reÔ¨Çect the fact that the taxa xandyare
evolutionary closer related than compared to z. Hence, it is of interest to determine
as whether a given set Rof triples is consistent , i.e., there is a tree Tthat displays
all of the triples in R. Aho et al. [33] devised a polynomial-time algorithm, called
BUILD , that either constructs a uniquely deÔ¨Åned rooted tree Aho(R)that displays
Ror recognizes that Ris inconsistent. In some situations we also may have infor-
mation about triples that are notdisplayed by the tree of interest. A pair (R;F)of
two triple sets is consistent if there is a tree Tthat displays all of the triples in R
but none of the triples in F. The polynomial-time algorithm MTT (‚Äúmixed triplets
problem restricted to trees‚Äù) [34] tests consistency of pairs (R;F)of triple sets in
polynomial time.
Planted trees. Evolutionary events of interest may also pre-date the last common
ancestor of all species or genes. The latter can be accommodated by considering
planted trees , i.e., trees Tthat satisfy 0 T6=rT. In this case 0 Tis also called the
planted root. In a planted phylogenetic tree, 0 TandrTare connected by the edge
0TrT2E(T). The planted root can be thought of a representing the ‚Äúoutgroup(s)‚Äù,
while L(T)represents the ‚Äúin-group‚Äù, i.e., the species or genes under consideration.
A planted tree Talways displays the rooted tree T(rT)obtained by contracting the
edge 0 TrT.
Dated Trees. With each (planted) tree Twe can associate a time map tT:V(T)!R
such that xTyimplies tT(x)<tT(y). It is an easy task to verify that, for every tree,
such a time map exists. Even more, for every tree one can construct, in linear-time,
a time map such that leaves of the tree are assigned to particular time-points (e.g.
all leaves are mapped to the time-point 0 specifying extant taxa nowadays) [19]. It
is usually difÔ¨Åcult and often impossible to obtain reliable, accurate ‚Äútime stamps‚Äù
tT(x)for evolutionary relevant events [35, 36]. Such detailed information is not
needed for our purposes. The theoretical results will depend only on the existence
of relative timing, i.e., the knowledge as whether an event pre-dates, post-dates, or
is concurrent with another one; an information that is often much easier to extract
from data [37, 38].
Throughout this chapter we assume that all trees are planted and phylogenetic,
unless explicitly stated otherwise.
2.2 Reconciliation
Genes evolve within genomes, i.e., species. In order to understand the relationship
between genes and species, we need to describe how the gene tree T‚ÄúÔ¨Åts together‚Äù
with the species tree S. This idea is formalized by the notion of a reconciliation
map that locates the vertices of the gene tree, i.e., the evolutionary events in the
history of the genes, in the species tree. We model evolutionary events as preciseThe Theory of Gene Family Histories 7
point in time. This is, of course, an approximation. In reality, even punctual events
such as gene duplications require time to spread through a population and become
Ô¨Åxed. Similarly, speciation is also a population-based process that takes time [39]
and may also involve additional effects such as incomplete lineage sorting [40, 41].
Nevertheless, it is justiÔ¨Åed to view events as points-in-time in the context of macro-
evolutions, where population effects are neglected altogether.
In order to study reconciliation from a formal point of view, we start out with
only minimal requirements that are straightforward to argue:
DeÔ¨Ånition 1. LetTandSbe trees. A reconciliation ofTandSis a triple (T;S;m)
where m:V(T)!V(S)[E(S)is a map that satisÔ¨Åes the following conditions:
(R0)m(x) =0Sif and only if x=0T
(R1)m(x)2L(S)if and only if x2L(T)
(R2) If yTxandm(x);m(y)2V(S), then m(x)6=m(y)
(R3) If yTx, then m(x)6Sm(y)
While Condition (R0) is used to identify the planted roots, Condition (R1) ensures
that leaves of T, i.e., extant genes, are found in leaves of S, i.e., in extant species.
Condition (R2) ensures that temporally distinct speciation events cannot be mapped
to the same vertex in S, i.e., the same speciation event. Condition (R3), Ô¨Ånally en-
sures a weak form of temporal consistency by forbidding that a descendant of xinT
can be mapped to an ancestor of m(x)inS. Thus, if yTx, then either m(y)Sm(x)
orm(x)andm(y)areS-incomparable. For completeness we note that many au-
thors prefer reconciliation maps of the form g:V(T)!V(S), i.e., mappings from
vertices to vertices [26, 42, 43]. This can be easily translated, however: If m(x) =uv,
theng(x) =v, i.e., everything is mapped to the lower end of the edge in S. The other
direction is a bit more intricate. In essence, however, it sufÔ¨Åces to set m(x) =uvif
g(x) =vand there is a x0Txwithg(x0) =g(x) =v.
An important distinction in evolution is the difference between vertical and hor-
izontal inheritance. Vertical inheritance implies that the the descendants of a gene
are harbored by descendant species. In contrast, horizontal inheritance, i.e., horizon-
tal transfer consists in the relocation of a gene to a different lineage. Formally, this
situation can be captured by distinguishing vertical and Horizontal Gene Transfer
(HGT) edges in the gene tree T:
DeÔ¨Ånition 2. Let(T;S;m)be a reconciliation. An edge xy2E(T)is an HGT-edge if
m(x)andm(y)areS-incomparable. A reconciliation is HGT-free ifm(x)andm(y)
areS-comparable for all xy2E(T).
As a direct consequence of (R3), a reconciliation (S;T;m)is HGT-free if and only
if it satisÔ¨Åes
(R4) If yTxthenm(y)Sm(x).
In fact, (R4) states that all edges of Tcorrespond to vertical inheritance.
Usually, it is known a priori which gene is found in which species. That is, a
maps:L(T)!L(S)is given that assigns to each extant gene the extant species in
which it occurs.8 Marc Hellmuth and Peter F. Stadler
a b1 c1c2 b2xx x x x
xxxa b1c1c2 b2
S
A B C
Fig. 3 Illustration of the s-reconciliation S=
(T;S;m0;s)with m0deÔ¨Åned by Eq. (1). Genes
are colored w.r.t. the species in which they reside,
i.e.,s(a) =A(red), s(b1) =s(b2) =B(blue),
ands(c1) =s(c2) =C(green). Note that the
gene tree Tand the observable part of the gene
tree in Fig. 1 which is obtained by removing the
-edge and suppression of its two incident ver-
tices, coincide. Fig. 1 and the present Ô¨Ågure thus
show different reconciliations for the same trees
TandS. In particular, the reconciliations feature
very different numbers of gene losses: a single
one in Fig. 1 and 8 for m0.
DeÔ¨Ånition 3. LetTandSbe two trees and s:L(T)!L(S). Then (T;S;m;s)is a
s-reconciliation if (T;S;m)is a reconciliation and mjL(T)satisÔ¨Åes mjL(T)=s.
An early important observation in this Ô¨Åeld is that every gene tree can be recon-
ciled with any species tree even without the need to consider horizontal gene transfer
[44, 45]:
Theorem 1. For any two trees T and S and any map s:L(T)!L(S)there is a
HGT-free s-reconciliation (T;S;m;s).
To see this, it sufÔ¨Åces to consider the reconciliation map m0deÔ¨Åned by setting
m0(0T):=0S;
m0(x):=s(x)for all x2L(T); and
m0(x):=0SrSfor all inner vertices x2V0(T):(1)
Every reconciliation map mcan be used to imply gene loss events. To see this,
consider an edge xy2V(T)such that m(y)Sm(x)for a given reconciliation map
mand for which there is a vertex u2V(S)withm(y)SuSm(x), and thus u=2
L(S). During the speciation u2V0(S), a descendant of the each gene present in
the genome is transmitted to every descendant lineage, i.e., to every edge uw2
E(S). If no descendant of the gene is found in a species descending from w, then
the gene must have died out in the entire species subtree S(w). This is explained
most parsimoniously by a single loss event occurring already along the edge uw2
E(S). Fig. 3 shows that for the case of the reconciliation m0this reasoning implies
an unrealistically large number of gene loss events: for example, the Ô¨Åve paralogs
present at the earliest speciation give rise to a total of 10 genes, of which half are
subsequently lost again. This reconciliation m0will in general not be a plausible
biological explanation because it implies unreasonably large number of gene losses.
This observation led to the development of a number of alternative scoring functions
F(m):=F(T;S;m;s)for reconciliation maps with given trees TandSand a given
leaf assignment sthat count the number of duplication and/or gene losses. We refer
to [46] and the references therein for detailed discussion.The Theory of Gene Family Histories 9
We brieÔ¨Çy consider this optimization problem for the HGT-free case here.
Assume that we are given a leaf-assignment s. The task is then to Ô¨Ånd a s-
reconciliation that optimizes a given scoring function. By Thm. 1 we know that
a solution always exists. Since any vertex x2V(T)has to be mapped at or above
the last common ancestor of all the species in which the descendants of xare found,
every solution satisÔ¨Åes
lcaS(s(L(T(x))))Sm(x) (2)
The so-called LCA reconciliation mattains equality whenever possible. More pre-
cisely, we deÔ¨Åne mas follows. For each x2V(T), let w(x):=lcaS(s(L(T(x))))
andube the parent of w(x)inSwhich always exists in planted trees.
m(x):=(
w(x) whenever there is no ywith yTxandw(x) =w(y)
uw(x)otherwise.
The LCA-reconciliation mis the most parsimonious reconciliation w.r.t. to sev-
eral cost measures including the number of duplications and the number duplica-
tions and gene losses [46‚Äì48]. Corresponding maximum likelihood and Bayesian
methods is described in [49] and [50], respectively. Most parsimonious reconcili-
ations can still be computed in polynomial time if HGT events are included and
penalized [26, 42]. However, as we shall see in the following section, these recon-
ciliations are not always biologically feasible, see also [51].
2.3 Relaxed Scenarios
It was noted in [26, 42] that the deÔ¨Ånition of reconciliations in the previous section
is not sufÔ¨Åcient to ensure that (T;S;m)can be interpreted as series of events along
a linear time axis. To this end we consider evolutionary scenarios as reconciliations
of dated trees:
DeÔ¨Ånition 4. A(relaxed) scenario S= (T;S;m;tT;tS)consists of a dated gene tree
(T;tT), a dated species tree (S;tS), and a reconciliation map m:V(T)!V(S)[
E(S)such that
(S0)m(x) =0Sif and only if x=0T,
(S1)m(x)2L(S)if and only if x2L(T),
(S2)tS(m(x)) =tT(x)for all x2V(T)withm(x)2V(S), and
(S3)tS(v)<tT(x)<tS(u)for all x2V(T)withm(x) =uv2E(S).
Axioms (S0) and (S1) coincide with (R0) and (R1), respectively, in the deÔ¨Ånition
of a reconciliation. The remaining two axioms, (S2) and (S3), specify time consis-
tency . As for reconciliations in the previous section, we do not assume that a leaf-
maps:L(T)!L(S)is given, although this typically will be the case in practical
applications.10 Marc Hellmuth and Peter F. Stadler
A B C A B C0 time
Fig. 4 An event-annotated gene tree (left) where we replaced the event-labels of the leaves v
by vertices with color s(v)to indicate in which species vresides. In particular, we have s(x) =
s(x0) =Xfor(x;x0;X)2f(a;a0;A);(b;b0;B);(c;c0;C);(d;d0;D)g. Shown are two reconciliations
into the same species tree S(left and middle). The reconciliation shown in the middle is time-
consistent and, in particular, results in a relaxed scenario. Let us denote with canddthe species
that contain c;c0andd;d0, respectively and put u:=lcaS(c;d)The two reconciliations differ only
in the choice of placing the origin x2V(T)of the HGT-edge either on the edge ucor on the edge
rSu. In the Ô¨Årst case, however, we have yTxbuttT(x)<tT(y). Hence, the reconciliation shown
right does not give rise to a valid time map of Tand is, therefore, not time-consistent.
DeÔ¨Ånition 5. A tuple (T;S;m;tT;tS;s)is is a relaxed s-scenario if(T;S;m;tT;tS)
is a relaxed scenario and s:L(T)!L(S)satisÔ¨Åes s=mjL(T).
Relaxed scenarios can be seen as reconciliations for which a time axis is given ex-
plicitly. It is not difÔ¨Åcult to show that for a given a relaxed scenario (T;S;m;tT;tS),
the triple (T;S;m)is indeed a reconciliation (cf. Lemma 2 and 3 in [19]). The con-
verse, however, is not true in general, i.e., it is not always possible to Ô¨Ånd time
stamps that turn a reconciliation into a relaxed scenario cf. e.g. Fig. 2 in [52]. This
motivates the following
DeÔ¨Ånition 6. A reconciliation (T;S;m)istime consistent if there are dating maps
tTandtSsuch that (T;S;m;tT;tS)is a relaxed scenario.
A variety of different auxiliary graphs on V(S)[26, 43] or V(S)[V(T)[52, 53]
were introduced to summarize the temporal constraints. In each case, it was shown
that a reconciliation (T;S;m)is time consistent if and only if the corresponding aux-
iliary graph is acyclic. It can be shown, furthermore, that these auxiliary graphs are
acyclic in the special case of HGT-free reconciliations, i.e., every HGT-free recon-
ciliation is automatically time-consistent and can be extended to a relaxed scenario.
In the general case, the additional requirement of time-consistency also makes
the computation of maximum parsimony reconciliations difÔ¨Åcult. As shown in [26],
the problem then becomes NP hard.The Theory of Gene Family Histories 11
2.4 Event-Labels
From a biological point of view, the inner vertices V0(T)of the gene tree Tmodel
evolutionary events. In the case of HGT-free scenarios, i.e., reconciliations (T;S;m)
that satisfy (R4), there are only two fundamentally distinct events: gene duplications
and speciation events. Since speciation events are also modeled by the inner vertices
V0(S), it is natural to distinguish duplications and speciation by their image under
the reconciliation map m. This naturally leads to the following deÔ¨Ånition [13]:
DeÔ¨Ånition 7. Let(T;S;m)be a HGT-free reconciliation. Then the event labeling on
Tis the map `m:V(T)!f};; ;ggiven by:
`m(u) =8
>>><
>>>:} ifu=0T, i.e., m(u) =0S
 ifu2L(T), i.e., m(u)2L(S)
 ifm(u)2V0(S)(speciation)
 else, i.e., m(u)2E(S)(duplication)
The Ô¨Årst two cases, }and, distinguish the planted root and the leaves of T. The
remaining two cases identify speciation events with the u2V(T)that are mapped
to inner vertices in the species tree. In contrast, if m(u)2E(T), it does not corre-
spond to a speciation and thus corresponds to a gene duplication , denoted by.
The conditions on the reconciliation (T;S;m)considered so far, however, are not
sufÔ¨Åcient to ensure that x2V0(T)with`m(x) = represents a biologically mean-
ingful speciation event. Additional constraint on the evolutionary scenario need to
be introduced.
This is possibly best explained by assuming to have a binary gene tree T. In
this case, if `m(x) = , the two children v0andv00ofxshould be mapped via m
into two distinct lineages. Otherwise, if v0andv00are mapped into the same lineage
there is no clear historical trace that justiÔ¨Åes xto be a speciation vertex. In other
words, `m(x) = is biologically plausible, if for the two children v0andv00ofx
the images m(v0)andm(v00)areS-incomparable. Moreover, similar to Eq. 2 and
to accommodate most parsimonious reconciliation (LCA-reconciliation) one may
assume that m(x) =lcaS(m(v0);m(v00)). The latter discussion naturally translates to
the case of general not necessarily binary gene trees as follows:
(R5) Suppose m(x)2V(S)0for some x2V. Then
(i)m(x) =lcaS(m(v0);m(v00))for at least two distinct children v0;v00ofxinT.
(ii)m(v0)andm(v00)are incomparable in Sfor any two distinct children v0and
v00ofxinT.
As shown in [13, 52], the axioms (R0)-(R5) are equivalent to axioms that are
commonly used in the literature [54‚Äì58]. In particular, for any HGT-free s-
reconciliation (T;S;m;s), there is a LCA-reconciliation for TandS[58]. The latter
observation can easily be extended for s-reconciliations involving HGTs and by12 Marc Hellmuth and Peter F. Stadler
considering LCA-maps restricted to the HGT-free subtrees of T[58]. Thus, the ax-
iom set used here naturally corresponds to LCA-mappings and hence, to most parsi-
monious reconciliations. In addition, [13, Lem.2] shows that L(T(v0))\L(T(v00))6=
/ 0 for a pair of distinct children v0andv00ofximplies `m(x) =for all HGT-free
s-reconciliations that satisfy (R5). This is turn motivates to consider the extremal
event labeling ÀÜ`, which assume that these are the only duplications and thus assigns
ÀÜ`(x) = whenever m(L(T(v0)))\m(L(T(v00)) = / 0 for all pairs of children of x. It is
important to note that the extremal labeling ÀÜ`is deÔ¨Åned solely on the information of
Tand does not depend on the existence of a species tree Sor a reconciliation map
m.There is no a priori guarantee, therefore, that the extremal event labeling can be
realized by an actual biological scenario.
3 Best Match Graphs and Orthology
3.1 DeÔ¨Ånition and Characterization
Many of the combinatorial methods for determining orthology start from reciprocal
best ( blast ) hits. Here, we consider best matches as a basic evolutionary con-
cept that is approximated on sequence data by ‚Äúbest hits‚Äù. We therefore consider
best matches relative to an underlying phylogenetic tree, albeit this tree is usu-
ally unknown. Our starting point is therefore a gene tree Ttogether with a map
s:V(T)!Y, where Yis a set of species. It will be convenient to treat sas a
coloring of the leaves of tree Tby the species in which the extant genes reside.
DeÔ¨Ånition 8. Let(T;s)be a leaf-colored tree. A leaf y2L(T)is abest match of
the leaf x2L(T)ifs(x)6=s(y)and lca (x;y)Tlca(x;y0)holds for all leaves y0
from species s(y0) =s(y). The leaves x;y2L(T)arereciprocal best matches ify
is a best match for xandxis a best match for y.
Note that a gene xmay have two or more (reciprocal) best matches of the same color
r6=s(x). Some orthology detection tools, such as ProteinOrtho [59], explicitly
attempt to extract all reciprocal best matches from the sequence data.
A directed, vertex-labeled graph (G;s)is abest match graph (BMG) if there is a
leaf-labeled tree (T;s)such that (x;y)is a directed edge in (G;s)if and only if yis
best match of xin(T;s). Given (T;s)we write B(T;s)for its best match graph.
A key observation towards characterizing best match graphs is that some subsets
of vertices on two colors (species) yield constraints on triples displayed by any leaf-
colored tree that might explain a BMG.
DeÔ¨Ånition 9. Leta;b;b0be pairwise distinct vertices in a colored digraph (G;s)
such that s(a)6=s(b) =s(b0)and(a;b)2E(G). Then the triple abjb0isinforma-
tiveif(a;b0)=2E(G)andforbidden if(a;b0)2E(G).
The sets R(G;s)andF(G;s)denotes the set of all informative and forbidden
triples, respectively. It is shown in [13] that, if (G;s) =B(T;s), then TdisplaysThe Theory of Gene Family Histories 13
all triples in R(G;s)and none of the triples in F(G;s). The sets R(G;s)and
F(G;s)also give rise to convenient characterizations of BMGs.
Theorem 1 A properly colored digraph (G;s)is a BMG if and only if one of the
following conditions is satisÔ¨Åed.
(i)R(G;s)is consistent and B(Aho(R(G;s));s) = ( G;s)[13, 60]
(ii)(R(G;s);F(G;s))is consistent and (G;s)is color-sinkfree, i.e., for every
x2V(G)and every color s6=s(x)there is a vertex y such that (x;y)2E(G)
and y2N(x)withs(y) =s. [61]
In particular, BMGs be be recognized in polynomial-time.
Intriguingly, every BMG (G;s)is associated with a unique least-resolved tree
(T;s). That is, (i) B(T;s) = ( G;s)and (ii) if B(T;s) = ( G;s)then Tdisplays
T. The least resolved tree Ttherefore captures the reliable phylogenetic informa-
tion about the gene tree Tthat is provided by the best matches. The least-resolved
tree for a BMG (G;s)is precisely the tree Aho(R(G;s))and can be constructed in
polynomial time.
While least-resolved trees serve as a scaffold to cover phylogenetic information
without making more assumptions on the evolutionary history than actually pro-
vided by the data, one is in many cases additionally interested to Ô¨Ånd binary trees
which can be considered as the most ‚Äúhighly‚Äù resolved histories. Binary trees are
of particular interest because true multifurcations are most likely rare, i.e., most
polytomies are a consequence of insufÔ¨Åcient resolution of the available data [62‚Äì
64]. However, not every BMG can be explained by a binary tree (cf. [65, Fig.6A]).
Binary explainable BMGs are characterized as those BMGs that do not contain a
certain colored graph on four vertices, termed hourglass , as induced subgraph [65].
Note that binary trees explaining a BMG are not necessarily unique, however, they
all display Aho(R(G;s))and can be constructed in polynomial time [66].
Binary explainable BMGs also have a convenient characterization in terms of
triple sets. Consider the following extension of the set of informative triples:
RB(G;s):=R(G;s)[
bb0ja:abjb02F(G;s)ands(b) =s(b0)	
(3)
As shown in [66], replacing R(G;s)byRB(G;s)in Thm. 1 yields a character-
ization of binary explainable BMGs. Moreover, if (G;s)is a binary explainable
BMG, then TB:=Aho(RB(G;s))has the property that a binary tree (T;s)satisÔ¨Åes
B(T;s) =B(TB;s) = ( G;s)if and only if Tis a reÔ¨Ånement of TB. We summarize
these results in the following
Theorem 2 The following statements are equivalent for every BMG (G;s):
(i)(G;s)is binary explainable.
(ii)(G;s)is hourglass-free [65].
(iii)RB(G;s)is consistent [66].
In this case, a binary tree that explains (G;s)can be constructed in polynomial
time. In particular, the BMG (G;s)is explained by every reÔ¨Ånement of the tree
(Aho(RB(G;s));s)[66].14 Marc Hellmuth and Peter F. Stadler
In practice, (G;s)is obtained empirically by comparing similarities of gene se-
quences. Most likely, (G;s)thus will not be a BMG but differ from the true best
match graph by both false positive and false negative edges. The arc modiÔ¨Åcation
problems for BMGs aim at correcting such errors. Like most graph editing prob-
lems, it is NP-complete [61, 66]. However, efÔ¨Åcient heuristics can be devised that
solve the problem with acceptable accuracy [67]
3.2 Orthology in the Absence of HGT
Walter Fitch [10] deÔ¨Åned orthology as homology deriving from a speciation event.
While later discussions qualiÔ¨Åed this simple concept in the presence of HGT (see
below), the notion is clear in a HGT-free setting. We assume throughout this section
that scenarios and reconciliations are HGT-free.
DeÔ¨Ånition 10. Let(T;t)be an event-labeled gene tree and let x;y2L(T)be two
distinct genes. Then xandyareorthologs ift(lcaT(x;y)) = ; they are paralogs if
t(lcaT(x;y)) =.
We write Q(T;t)for the orthology graph with vertex set L(T)and edges xy2
E(Q(T;t)whenever xandyare orthologs. Note that the corresponding ‚Äúparalogy
graph‚Äù is simply the complement graph of Q(T;t). Moreover, Q(T;t)is symmet-
ric but not necessarily transitive (edges xyandyzdo not imply that xzis an edge).
Orthology graphs feature a simple structure:
Theorem 3 ([68]) A graph G is an orthology graph for some event-labeled tree
(T;t), i.e. G =Q(T;t), if and only if G is a cograph.
A classical characterization of cographs is the following: Gis a cograph if and only
if it does not contain a P4, i.e, a path on four vertices, as an induced subgraph [69].
Given a reconciliation (T;S;m), orthology is therefore implied by the reconcilia-
tion maps, since, by Def. 7 above, mspeciÔ¨Åes the event labeling `m. The dependence
of orthology on mis crucial. In the extreme case of m0, we have m0(V(T0))E(S),
and thus all events are classiÔ¨Åed as duplications. Conversely, the LCA reconciliation
maps as many u2V0(T)to inner vertices of Sas possible, and thus can be expected
to result in a large number orthologous pairs.
The starting point for many algorithmic approaches to orthology detection is the
observation that two orthologs xandyare also reciprocal best matches. We are
therefore in particular interested in obtaining information on the orthology relation
starting from best match data only.
Writing Bsym(T;s)for the subgraph of the best match B(T;s)comprising the
reciprocal, i.e., bi-directional edges, and denoting by ÀÜ`Tthe extremal event labeling
forTintroduced in the previous section, we obtain the following key result:
Theorem 4 ([13]) Let(T;S;m;s)be a HGT-free s-reconciliation satisfying (R5).
Then Q(T;`m)Q(T;ÀÜ`T)Bsym(T;s)B(T;s).The Theory of Gene Family Histories 15
Theorem 4, in particular, shows that using the reciprocal best match graph
Bsym(T;s)as an approximation for the orthology relation does not yield false neg-
ative orthology assignments. In general, however, Q(T;`m)is a proper subgraph of
Bsym(T;s), i.e., reciprocal best match graphs may contain false-positive orthology
assignments. In particular, Bsym(T;s)does not need to be a cograph and thus may
contain induced P4s.
IfL(T(v0))\L(T(v00))6=/ 0 for some children v0andv00ofxthen`m(x) =
for all HGT-free s-reconciliations that satisfy (R5) (cf. [13, Lem.2]). [65, Lemma
10] characterizes false orthology assignments in best matches graphs and pro-
vides an even stronger results. In particular, it shows that ÀÜ`m(x) =precisely
ifL(T(v0))\L(T(v00))6=/ 0 for some children v0andv00ofx. Using the fact that
Q(T;`m)Q(T;ÀÜ`T)allows us to rephrase this result in following, more convenient
form:
Theorem 5 The following statements are equivalent for every tree (T;s)and any
two leaves x and y of T .
(i) x and y are paralogs in anyHGT-free s-reconciliation (T;S;m;s)
(ii) There are two children v0and v00oflcaT(x;y)such that L (T(v0))\L(T(v00))6=
/ 0.
(iii) xy are ‚Äúfalse orthologs‚Äù in case x and y are reciprocal best matches.
Note that Thm. 5 depends on the structure of the underlying tree (T;s)and trees
that explain a given BMG are not necessarily unique. Hence, there might be a tree
(T0;s)such that B(T;s) =B(T0;s)but for which an edge xyis a false-positive
orthology assignment w.r.t. (T;s)but not w.r.t. (T0;s). Hence, we are interested, in
particular, in those bi-directional edges xyof a BMG (G;s)that are false orthology
assignment for every tree(T;s)that satisÔ¨Åes B(T;s) = ( G;s). Such edges are
called unambiguously false orthology assignment in (G;s)and can be identiÔ¨Åed in
chains of overlapping hourglasses. For the details we refer to Def.14 and Def.16 in
[65] for the detailed speciÔ¨Åcation of all ‚Äúhug‚Äù-pairs and we obtain
Theorem 6 ([65, Thm.11 & 12]) An edge xy in a BMG (G;s)is an unambiguously
false orthology assignment if and only x and y is a ‚Äúhug‚Äù-pair. The set of all un-
ambiguously false orthology assignment in a BMG can be computed in polynomial
time.
The no-hug graph N(G;s)is the subgraph of (Gsym;s)(G;s)from which
all edges xythat are hug pairs have been removed. In particular, N(B(T;s))con-
tains the orthology graph for every HGT-free s-reconciliation satisfying (R5) mas
a subgraph (cf. [65, Cor. 5]):
Q(T;`m)Q(T;ÀÜ`T))N(B(T;s))Bsym(T;s) (4)
As shown in [65], N(B(T;s))is in fact an orthology graph. However, since only
unambiguously false orthology have been removed, N(B(T;s))may still contain
false orthologs. That is, reciprocal best matches xymight be paralogs in the true
scenario (T;`)but appear as orthologs in alternative scenarios that are consistent16 Marc Hellmuth and Peter F. Stadler
with the best match data. In fact, it is always possible to ‚Äúmove up‚Äù a speciation
event and to replace it by a duplication followed by losses. In this manner it is always
possible to explain best match without orthologs. The no-hug graphs N(B(T;s))
thus provides the ‚Äúmost parsimonious‚Äù explanation in the sense that it predicts an
orthology relationship whenever this is consistent with the best match data instead of
an alternative explanation, which would comprise a duplication event accompanied
by complementary losses. Thus, the reconciliation underlying N(B(T;s))is a least
conceptually related to LCA reconciliations. A closer inspection of this connection,
however, is a topic for future research.
In practice, one could obtain an accurate orthology assignment by estimating an
initial, species labeled graph (ÀúG;s)representing best ( blast ) hit data and then edit
these initial data to a BMG, i.e., a graph (G;s)that conforms to Def. 8. This step is,
in general, NP-hard [61, 70] and thus, will require an efÔ¨Åcient heuristic. From the
the BMG (G;s)we can then remove, in polynomial-time, all hug-pairs to obtain
the no-hug graph N(G;s)that is free of unambiguously false orthologs and also an
orthology graph.
Since orthology graphs are cographs, there is also a more direct, albeit less ac-
curate approach towards estimating the orthology graph. To this end, one extracts
the reciprocal best hits (ÀúGsym;s)from the initial estimated best ( blast ) hits (ÀúG;s)
and Ô¨Ånds the cograph Hthat differs by the fewest edge-insertions and edge-deletions
from ÀúGsym. This cograph editing problem is also NP-hard [71]. However, it remains
tractable if ÀúGsymis not too dissimilar from a cograph. Fast heuristics have become
available for this task in last years [72‚Äì74].
By Theorem 1, BMGs can be recognized in polynomial-time and the tree
(TAho;s):= (Aho(R(G;s));s)is the unique least resolved tree that explains a
BMG (G;s). However, it is not possible in general to equip TAhowith an event
labeling `such that Q(TAho;`) =N(G;s). Instead, TAhocan be augmented to a
uniquely deÔ¨Åned tree ÀÜ`Tthat is equipped with the extremal event labeling ÀÜ`T. The
event labeled tree (T;ÀÜ`T)satisÔ¨Åed
Q(T;ÀÜ`T) =N(B(T;s)) (5)
and can be obtained in polynomial time (cf. [65, Thm.10]). The extremal labeling
ÀÜ`Tis deÔ¨Åned solely on the information of Tand does not depend on the existence
of a species tree Sor a reconciliation map m.
In summary, therefore, it is possible to use the information of a BMG (G;s)to
get mathematically sound estimates G0of orthology relations and a resulting gene
tree(T;`)such that G0=Q(T;`)in polynomial time.
An intriguing observation is that the event labeled gene trees (T;`)have implica-
tions for the species tree irrespective of the details of the reconciliation map. To this
end, let S(T;`;s)denote the set of all triples s(x)s(y)js(z)that satisfy (i) s(x),
s(y), and s(z)are pairwise distinct species and (ii) `(lca(x;z)) = , i.e., the root of
xyjzis a speciation event.
Proposition 1 ([58, 75]). For a given event-labeled tree (T;`)and species map s
the following two statements are equivalent.The Theory of Gene Family Histories 17
sequence
(dis)similarity
informative triples
(from multiple
gene families)species tree reconciliation
b c c' a' b'asimilarity
comparisons(approximated)
Best Match Grapha
b
a' b'c
c'
graph editing No-Hug Graph
=
Orthology (HGT-free)a
b
a' b'c
c'
event-labeled 
gene tree 
a a' b b' c c'A B C
Fig. 5 Conceptual workÔ¨Çow for tree-free orthology detection and subsequent reconstruction
of event-labeled gene tree T, species tree S, and HGT-free s-reconciliation (T;S;m;s)un-
der the assumption that no HGT occurred. Here we have s(x) =s(x0) =Xfor(x;x0;X)2
f(a;a0;A);(b;b0;B);(c;c0;C)g. Sequence similarity data are used to obtain an initial estimate of
the BMG. This estimate is corrected to a mathematically sound BMG (G;s)and the no-hug graph
N(G;s)is extracted. The no-hug graph is free of any false-negative and unambiguously false-
positive orthology assignments. In particular, N(G;s)is an orthology graph and, based on this
information, an event-labeled gene tree can be reconstructed. This event labeled gene tree also
conveys information on the species tree. Integrating the latter information over many gene families
provides a reliable estimate of the species tree. Together with the event labeled gene event labeled
gene this implies a reconciliation, and thus a complete gene family history.
(i) There is a species tree S such that there is a HGT-free s-reconciliation
(T;S;m;s)with`=`m.
(ii) The triple set S(T;`;s)is consistent.
Note that the set of species triples in Prop. 1 depends on the event-labeling `ofT, but
not on the details of the reconciliation map mas long as mgives rise to correct event-
labeling. Several types of problems that are concerned with optimally editing a given
undirected graph to an orthology relation that, at the same time, satisÔ¨Åes additional
constraints (e.g. that the resulting event-labeled gene tree can be reconciled with
some (unknown) species tree) have been considered e.g. in [76]. While most of
the latter problems are NP-complete, certain types of problems that are related to
the correction of homology relations that provide only partial information about
orthologs and non-orthologs can be solved in polynomial-time [77, 78].
Although Prop. 1 is rather technical, it has signiÔ¨Åcant practical importance. An
estimate of (T;`), e.g. obtained directly from reciprocal best match data by means
of cograph editing provides a collection of species triples. Pooling these data over
a large number of gene families indeed yields sufÔ¨Åcient information to infer fully
resolved species trees [79].18 Marc Hellmuth and Peter F. Stadler
3.3 Clusters of Orthologous Genes
Orthologs are often summarized as clusters of orthologous groups (COGs) [80]. We
have seen, however, that orthologous genes form cographs, and hence orthology is in
general not a transitive relation. COGs are only an approximation that is particularly
useful if the the gene family history contains only a small number of duplications.
A special case is one-to-one orthology, where each gene has a unique ortholog in
every other species. In this case, the orthology relation becomes transitive and the
the orthology graph Qreduces to a disjoint union of cliques [81]. These clusters,
e.g. computed by OMA [81], are induced complete subgraphs, i.e., cliques in the
full orthology graph.
Most other approaches to computing COGs allow co-orthologs, i.e., clusters are
not restricted to cliques of the orthology graph and thus, may include orthologs and
paralogs [80]. A wide variety of clustering algorithms have been used to extract
COGs from sequence similarity data. The deÔ¨Ånition of such COGs necessarily de-
pends on stringency parameters that gauge the trade-off between size and stringency
of COGs. From a theoretical point of view transitivity clustering [82] is interesting
because of its conceptual similarity to co-graph editing: here the initial orthology
estimate is edited by insertion end deletion of edges to a transitive graph, i.e., a
partitioning into COGs. In [83], maximal T ¬¥uran (complete multipartite) graphs are
computed. These form a special class of co-graphs and accommodate so-called in-
paralogs [24, 84], i.e., duplicate gene that originated after the most recent speciation
event in each lineage. Complementarily, it is of interest to partition a gene set such
that out-paralogs (i.e., pairs of genes arising from duplications that pre-date all spe-
ciation events) are placed in different clusters. These correspond to the connected
components of the orthology graph Q.
4 Fitch Graphs and Horizontal Gene Transfer
4.1 DeÔ¨Ånition and Characterization
Fitch [11] deÔ¨Åned ‚Äútwo genes x and y as xenologs if their history, since their com-
mon ancestor, involves an interspecies (horizontal) transfer of the genetic material
for at least one of them. ‚Äù Two leaves in x;y2L(T)in a tree Tare thus xenologs
whenever the unique path connecting xandyinTcontains an HGT-edge. By Def. 2,
the subset of HGT-edges HmE(T), and thus xenology, depends explicitly on the
reconciliation (T;S;m). As in the previous sections, we are interested in inferring
xenology without Ô¨Årst computing a reconciliation (T;S;m). Again, we approach this
problem by studying properties of graphs that are implied by reconciliation or a re-
laxed scenario.
Let use Ô¨Årst consider the parts of a scenario that are unaffected by HGT events.
Deleting from Tall HGT-edges yields a forest and induces a partition of L(T) =The Theory of Gene Family Histories 19
L1[L2[:::[Lkof the leaf set such that the restriction TjLicontains no HGT-edges.
Consequently, one can perform the analysis of HGT-free systems outlined above for
each of the gene sets Liseparately. Note that in general, this does not amount to
simply considering the subgraph (G[Li];sjLi)of empirical BMGs (G;s)induced by
Li. In general the empirical BMGs (Gi;s)with V(Gi) =Liwill feature best matches
that might be worse than those best matches in (G[Li];sjLi)that are implied by Tand
the additional knowledge of HGT-edges. We shall return to the inference of HGT-
edges and the partitioning of the gene set into maximal HGT-free subsets below.
Mechanistically HGT is a inherently directional event. There is a clear distinction
between the horizontally transferred ‚Äùcopy‚Äù and the ‚Äúoriginal‚Äù that continues to
be transferred vertically. It is signiÔ¨Åcant, therefore, whether HGT-edges are found
along the path from lca (x;y)toy, the path from lca (x;y)tox, or along both paths.
Mathematically, this can be captured in the following manner.
DeÔ¨Ånition 11. LetTbe a rooted tree and HE(T)be a set of HGT-edges. Then
the (directed) Fitch graph F(T;H)has vertex set L(T)and(x;y)2E(F)if the path
from lca T(x;y)toycontains an edge e2H.
A graph Gis a (directed) Fitch graph if G=F(T;H)for some tree Tand edge set
HE(T). In [85] a characterization of Fitch graphs in terms of eight forbidden
subgraphs on three vertices is given.
Fitch graphs also have a surprisingly simple characterization in terms of their
‚Äúclosed complementary neighborhoods‚Äù. For a directed graph consider
N[x]:=fy2Lj(x;y)=2E(G)g; (6)
Since all graphs considered here are loop-free, we have x2N[x]. We write N(G):=
fN[y]jy2Lg.
Theorem 7 ([86]) G is a Fitch graph if and only if (i) N(G)is hierarchy-like, i.e.,
forN1;N22N(G)hold N1\N22fN1;N2;/ 0g, and (ii) for every N2N(G)and
every y2N holdsjN[y]jjNj.
IfGis a Fitch graph, then C(G):=N(G)[fLg[ff xgjx2Lg, i.e., the extension
of the closed complementary neighborhoods by the singleton sets and Litself forms
a hierarchy on L, which corresponds to a uniquely deÔ¨Åned rooted tree TG. This tree
TGis the unique least-resolved tree for Gand the set HGof HGT-edges in TGis
uniquely determined and consists of all edges xyinTGwith x;y2V0(TG)[85, 86].
The directed Fitch graph thus is also informative about the structure of the gene tree.
The pair (TG;HG)also immediately yields the partition of Linto HGT-free subsets.
The symmetric version Gsymof a directed Fitch graph G, called undirected Fitch
graph , contains all bi-directional edges xy2E(G). Thus, xy2E(Gsym)if and only if
the path between xandycontains a HGT-edge. Undirected Fitch graphs have been
studied in [87] and coincide with the complete multipartite graphs. Hence, undi-
rected Fitch graphs are completely deÔ¨Åned by their independent sets. This implies
that undirected Fitch graphs cannot convey much interesting phylogenetic informa-
tion because they are completely determined by the maximal subsets Liof taxa that
have not experienced any horizontal transfer events among them.20 Marc Hellmuth and Peter F. Stadler
The problem of Ô¨Ånding a common gene tree from which a given orthology graph
and Fitch graph can be derived has been considered in [88]. Moreover, given a leaf-
labeled tree (T;s)and HGT-edges HE(T), a result similar in spirit to Prop. 1 de-
termines a set triples that must be displayed the species tree Sin any s-reconciliation
(T;S;m;s)that satisÔ¨Åes (R4), (R5), and H=Hm[52, 58]. In [53], a polynomial-time
algorithm is provided that takes (T;s)andHas input and constructs the species tree
Sand a time-consistent reconciliation map m, if one exists.
4.2 LDT Graphs
Unfortunately, no practical way to infer the Fitch graph directly from sequence data
has become available so far. A promising approach starts from the observation that
if two genes xandyare more closely related than the species s(x)ands(y), then x
andymust be xenologs [17]. A statistical sound method for identifying such pairs
of genes is described in [31]. Although such indirect methods have been quite suc-
cessful, see [25] for a review, their mathematical properties have been studied only
very recently:
DeÔ¨Ånition 12 ([18]). Let(T;tT)and(S;tS)be two dates trees and s:L(T)!L(S).
Then the undirected graph L(T;S;tT;tS;s)has vertex set L(T)andabis an edge if
tT(lcaT(a;b))<tS(lcaS(s(a);s(b)).
A vertex-colored graph (G;s)is alater-divergence-time graph (LDT graph) if there
is a tuple of dated trees (T;tT)and(S;tS)and a map s:L(T)!L(S)such that
(G;s) =L(T;S;tT;tS;s). LDT graphs have a simple characterization. To this end,
consider the set S(G;s)of rooted triples s(x)s(y)js(z)where s(x),s(y), and
s(z)are pairwise distinct, xy;yz2E(G)andxy=2E(G).
Theorem 2 ([18]). A graph (G;s)is an LDT graph if and only if it is properly
colored cograph and the triple set S(G;s)is compatible.
A polynomial time algorithm to construct a relaxed s-scenario for a given LDT
graph is also described in [18]. Not surprisingly, the editing problem for LDT-graphs
is NP-complete.
An LDT-graph (G;s)is always a subgraph of the undirected Fitch graph
Fsym(T;Hm)for any relaxed s-scenario (T;S;m;tT;tS;s)that satisÔ¨Åes (G;s) =
L(T;S;tT;tS;s). Thus, LDT graphs cannot contain false-negative xenologous gene-
pairs, and the complement Gof an LDT graph (G;s)contains in particular all
edges between pairs of genes that are not separated by a HGT event. In order
to apply methods developed for HGT-free data, we need to Ô¨Ånd the partition
L=L1[L2[:::[Lkinto maximal HGT-free subsets of a given sets of genes L.
In practice, this can be done by using the solution of the so-called cluster deletion
problem applied on G, i.e., of deleting a minimum set of edges from Gsuch that
the resulting graph Gis a disjoint union of complete graphs [89]. DeÔ¨Åning Lias
the vertex set of the i-th clique in Gthen yields the desired partition of Linto max-
imal HGT-free subsets. If G(or equivalently G) is a cograph, cluster deletion canThe Theory of Gene Family Histories 21
be solved in linear time by a greedy algorithm [90]. The LDT graph thus can be
used to obtain a the partition of L(T)into HGT-free subsets. Compatibility of such
partitions with a given gene tree as well as inferring the directions of HGT-edges
using such partitions have been the topic in [91, 92]
4.3 Orthology in the presence of HGT
Most of the mathematical results concerning orthology have been obtained in an
HGT-free setting. In the presence of HGT, descendants of two genes that originate
from a speciation event may even eventually reside in the same species, where they
appear as paralogs. This has led to different proposals for the ‚Äúcorrect‚Äù deÔ¨Ånition of
orthology. A classiÔ¨Åcation of subtypes of xenology that, in line with [11], reserves
the terms ortholog andparalog to situations in which the path between xandydoes
not contain an HGT event was proposed in [12]. Similar to LDT graphs, ‚ÄúEqual Di-
vergence Time‚Äù (EDT) graphs capture that fact that the divergence time of two genes
xandymatches the divergence time of the species in which they reside. Similar to
LDT graphs, a vertex-colored undirected graph (G;s)is an EDT graph , if there are
for two dated trees (T;tT)and(S;tS)ands:L(T)!L(S)such that ab2E(G)pre-
cisely if tT(lcaT(a;b)) =tS(lcaS(s(a);s(b)). In this case, we also write (G;s) =
E(T;S;tT;tS;s). In general, EDT graph recognition is NP-hard [19], however, it
becomes polynomial-time solvable if information of the LDT graph is available.
To see this, observe that complementary graph of the union of the EDT and LDT
graph contains all edges abfor which tT(lcaT(a;b))>tS(lcaS(s(a);s(b))which
determines the so-called prior divergence time graph and we can apply [19, Cor. 8].
One easily veriÔ¨Åes that, in a HGT-free s-reconciliation (T;S;m;s)that satisÔ¨Åes
(R5), Axiom (R5)(i) implies that two genes xandyare orthologs if their last com-
mon ancestor lca T(x;y)coincides with the last common ancestor lca S(s(x);s(y))
of the two species in which xandyreside. In this case, there is an obvious connec-
tion between orthology and the EDT graphs. We summarize now results that shows
that EDT graphs are also closely connected to different notions of orthology in sce-
narios with HGT that have been discussed in the literature. Disagreements on the
deÔ¨Ånitions of orthology in the presence of HGT stem for the fact that, in general,
pairs of genes originating from a speciation event may be separated by HGT, and
thus become xenologs. At the same time, they may even eventually reside in the
same species and therefore appear as paralogs.
DeÔ¨Ånition 13. LetS= (T;S;m;tT;tS;s)be a relaxed s-scenario. Then, two dis-
tinct vertices x;y2L(T)are
‚Ä¢ weak quasi-orthologs ifm(lcaT(x;y))2V0(S).
‚Ä¢ weak orthologs ifm(lcaT(x;y))2V0(S)and there is no HGT-edge along the
path between xandyinT.
‚Ä¢ strict quasi-orthologs ifm(lcaT(x;y)) = lcaS(s(x);s(y)).22 Marc Hellmuth and Peter F. Stadler
‚Ä¢ strict orthologs ifm(lcaT(x;y)) = lcaS(s(x);s(y))and is no HGT-edge along
the path between xandyinT.
The undirected graphs Yw(S),Qw(S),Ys(S), andQs(S), resp., have vertex set
L(T)and edges xyprecisely if the genes xandyare weak quasi-orthologs, weak
orthologs, strict quasi-orthologs, resp., strict orthologs in S, see Table 1 for a sum-
mary.
Table 1 Summary of the alternative notions of orthology in the presence of HGT events for a given
relaxed s-scenario S.
Reconciliation condition HGT irrelevant HGT excluded
m(lcaT(x;y))2V0(S) Yw(S) Qw(S)
weak quasi-ortholog weak ortholog
m(lcaT(x;y)) = lcaS(s(x);s(y)) Ys(S) Qs(S)
strict quasi-ortholog (strict) ortholog
Weak quasi-orthologs are, in essence, Walter Fitch‚Äôs original, purely event-based
deÔ¨Ånition of orthology [10]. In later work, Fitch [11] emphasizes the condition that
‚Äúthe common ancestor lies in the cenancestor (i.e., the most recent common ances-
tor) of the taxa from which the two sequences were obtained‚Äù, which translates to
the notion of strict quasi-orthologs. Other deÔ¨Ånitions of orthology explicitly exclude
xenologs [11, 12, 93], which leads the concept of weak and strict orthologs.
As shown in [19], for every relaxed s-scenario S, we have
Qs(S)Ys(S)Yw(S)andQs(S)Qw(S)Yw(S); (7)
while Ys(S)andQw(S)are incomparable w.r.t. the subgraph relation. Moreover,
the weak quasi-orthology graph Yw(S), the weak orthology graph Qw(S)and the
strict orthology graph Qs(S)are cographs for every relaxed S. This is not true
in general for the strict quasi-orthology graph Ys(S). There is a close connection
between LDT and EDT graphs and weak and strict orthologs:
Proposition 2. [19, Prop. 5] Given two graphs G 1and G 2there is a relaxed s-
scenario Ssuch that G 1=L(S)and G 2=E(S)if and only if there is relaxed s-
scenario S0with G 1=L(S0)and G 2=E(S0)that in addition satisÔ¨Åes Qw(S0) =
Qs(S0).
That is, a pair of an LDT and EDT graph can be explained by a common relaxed
scenario, if there the two graphs can be explained a relaxed scenario for which weak
and strict orthology coincide.
In the generic case, unrelated evolutionary events happen at distinct time points:
DeÔ¨Ånition 14. A relaxed scenario is generic iftT(lcaT(x;y)) =tS(u)forx;y2L(T)
andu2V0(S), then m(lcaT(x;y)) = u.The Theory of Gene Family Histories 23
Fitch graphsequence
(dis)similarity(approximated)
Best Match Graph
indirect methods for
HGT detectionsimilarity
comparisons
informative triples
(from multiple
gene families)graph editing +
construction of the
tree representation
graph completion
to symmetrized
Fitch graph(approximated)
LDT graph
event-labeled
forestspecies treeHGT edges and
possibly reÔ¨Ånement
HGT-free subsets (     )
a
b
a' b'c
c'a
b
a' b'c
c'
c
c'
a' b'a
b(minor of the)
gene tree Ta a' b b' c c' a a' b b' c c'
a' b'a b c c'c
c'
a' b'a
b
reconciliation
b c c' a' b'a A B C
Fig. 6 Conceptual workÔ¨Çow for tree-free based orthology detection and reconstruction of event-
labeled gene tree T, species tree Sands-reconciliation (T;S;m;s)under the assumption that
HGT occurred. Here we have s(x) =s(x0) =Xfor(x;x0;X)2f(a;a0;A);(b;b0;B);(c;c0;C)g.
Sequence similarity data are used to obtain an initial estimate of the BMG. These are corrected to a
mathematically sound BMG and LDT graph. From these, a usually incompletely resolved gene tree
and the HGT-free subsets are obtained by means of polynomial-time algorithms. In the next step,
the workÔ¨Çow as outlined in Fig. 5 can be applied to the HGT-free subsets of genes which results in
event-labeled gene trees, which also convey information on the species tree. Integrating the latter
information over many gene families provides a reliable estimate of the species tree. Together with
the event labeled gene trees this implies a reconciliation, and thus a complete gene family history.
In generic scenarios, the EDT graph and the different notions of orthology are con-
nected as follows:
Qs(S)Ys(S) =EDTYw(S) (8)
In the HGT-free case all these graphs coincide if m(lcaT(x;y))2V0(S)implies
m(lcaT(x;y)) = lcaS(s(x);s(y). A full formal understanding of orthology and its
variants in the presence of HGT is still lacking, however.
5 Discussion and Open Problems
In this chapter we provided an overview of the current formal, mathematical un-
derstanding of gene family histories with a focus on ‚Äútree-free‚Äù methods. We delib-
erately excluded full-Ô¨Çedged probabilistic models from our discussion. These also
start from the idea of scenarios and use stochastic models of sequence evolution24 Marc Hellmuth and Peter F. Stadler
to assign probabilities, which are then used in maximum likelihood or Bayesian
setting to reconstruct scenarios [50, 94, 95]. While these detailed models promise
accurate results for small and medium data sets, it is unclear whether they scale to
very large problems. The combinatorial approach outlines here, on the other hand,
holds promise to be able to address gene family histories at global scales.
Taken together, Figs. 5 and 6 outline a common conceptual workÔ¨Çow for a com-
prehensive analysis of gene family histories in a ‚Äútree-free‚Äù setting. Instead of a gene
treeTand a species tree S, a BMG and LDT/EDT graphs are estimated from the
data. Together, these two graphs capture the salient information, as outlined in the
formal results in the previous sections. The main advantage of this approach over
the direct reconstruction of trees is that it can make use of the inherent redundan-
cies in the data. Following the independent estimate of the edges of the BMG and
LDT/EDT graphs, one can use the fact well-formed BMGs and LDT graphs belong
to highly restrictive, special graph classed, as means of data correction: the initial
estimates can be edited to the closest well-formed graphs of the respective type.
Unfortunately, these graph editing problems are NP-complete. However, workable
heuristics have already been developed for this purpose. The hardness of this data
correction task also does not amount to a conceptual argument against the workÔ¨Çow
proposed in Fig. 6; after all, both the multiple sequence alignment problem, see [96]
and the references therein, and the reconstruction of a phylogenetic tree by means of
maximum parsimony or maximum likelihood are also NP-complete [97‚Äì99]. From
the BMG and LDT/EDT graphs one can now obtain a not necessary fully resolved
gene tree, sufÔ¨Åcient information of the species, as well as a corresponding event
labeling that located all relevant evolutionary events. In a Ô¨Ånal step, the resolution
of the gene tree and the species could be improved by conventional phylogenetic
methods using the combinatorially inferred trees TandSas constraints. Although
the time of writing this chapter no full-Ô¨Çedged implementation have become avail-
able, the individual steps have been benchmarked using simulated data and shown
to be feasible in a realistic setting [100].
The notion of reconciliation generalizes beyond the scope of this chapter,
which focuses on genes as part of genomes, or, equivalently host-parasite systems
[45, 101]. The same structure arises when the evolution of domains in proteins
is considered. This naturally gives rise to a multi-level version of reconciliation
[51, 102]. In addition to speciation, gene duplication, gene loss, and horizontal trans-
fer, it is of interest to consider additional event types. Incomplete lineage sorting or
deep coalescence as well as hybridization, in particular, have received considerable
attention [40, 41, 43, 103, 104]. Interestingly, maximum parsimony reconciliation
becomes NP-hard in this setting [105]. Phylogenetic networks are natural gener-
alization of phylogenetic trees [106, 107]. The concept of reconciliation persists
in such models. In [108, 109], for instance, reconciliation of gene trees with a re-
stricted classes of species networks are considered. In The problem of reconciling
a gene network (motivated by recombination) with a species tree is investigated in
[110], introducing an analog of the LCA reconciliation that provides a solution for
so-called tree-child networks. To our knowledge, these extended models have notThe Theory of Gene Family Histories 25
been studied so far from a ‚Äútree/network-free‚Äù perspective that would extend the
results reviewed in this chapter.
Despite substantial progress since the Ô¨Årst edition of this book [32], a number
of key questions remain open, in particular in relation to the detection and local-
ization of HGT events. Most importantly, the empirically accessible relations (best
matches, lower/equal divergence time) provide independent constraints on the rec-
onciliation (T;S;m)and inferred orthology and xenology relations may impose ad-
ditional conditions. In most cases, at least part of the conditions for the existence
of an explaining scenario are expressed in terms of consistence of triple sets. This
suggests consider consistency of their union. In general this will lead to the NP-
complete problem of determining maximum consistent subset(s) of triple or one of
its variants [111]. A better understanding how conÔ¨Çicting constraints arise, how-
ever, may point to a more accurate and possibly computationally more efÔ¨Åcient way
of handling internal conÔ¨Çicts in the data. Complementarily, it will be of interest to
investigate how a trusted species tree could be used for the improvement of initial
estimated of best match graphs. The fact that information of this type can be helpful
has been demonstrated in a maximum-likelihood framework [112]. An interesting
variation on this theme are methods to infer species trees and reconciliation maps
from a set of gene trees [113]. It also remains unclear whether for given T,S, and s,
there exists a reconciliation with a prescribed set of reconciliation edges HE(T).
We conjecture that, in analogy with the HGT-free case, the answer is afÔ¨Årmative.
More generally, event labelings and their consequences are not full understood for
relaxed scenarios. While event labeling are implicitly deÔ¨Åned as part of reconcilia-
tion maps e.g. in [26, 42, 43], these deÔ¨Ånitions also restrict the scenarios to which
they pertain, see also [52, 53].
From a practical point of view, the most pressing issue is the development of
more efÔ¨Åcient heuristics for the graph-editing problems that naturally arise in any
real-life application of the tree-free methods. i.e., in the intermediate step of the
workÔ¨Çows outlined in Figs. 5 and 6. For both cographs [72‚Äì74] and BMGs [67]
signÔ¨Åcant progress has been reported in the recent past. Full-Ô¨Çedged bioinformatics
pipelines for large-scale applications focus primarily on COGs rather than a more
Ô¨Åne grained presentation of gene family histories, making only limited use of the
progress in mathematical phylogenetics. In conjunction, with much improved meth-
ods for genome-wide alignments [114], improved gene family histories may con-
stitute also an important step towards a comprehensive understanding of genome
evolution.
References
[1] Michael Lynch and John S. Conery. The evolutionary fate and consequences
of duplicate genes. Science , 290:1151‚Äì1155, 2000.
[2] Asher D. Cutter and Richard Jovelin. When natural selection gives gene
function the cold shoulder. Bioessays , 37(11):1169‚Äì1173, 2015.26 Marc Hellmuth and Peter F. Stadler
[3] H Innan and F Kondrashov. The evolution of gene duplications: classifying
and distinguishing between models. Nat Rev Genet , 11:97‚Äì108, 2010.
[4] Adrian M. Altenhoff, Romain A. Studer, Marc Robinson-Rechavi, and
Christophe Dessimoz. Resolving the ortholog conjecture: orthologs tend to
be weakly, but signiÔ¨Åcantly, more similar in function than paralogs. PLoS
Comp. Biol. , 8(e1002514), 2012.
[5] R. A. Studer and M. Robinson-Rechavi. How conÔ¨Ådent can we be that or-
thologs are similar, but paralogs differ? Trends in Genetics , 25(210-216),
2009.
[6] T. Gabald ¬¥on and E. V . Koonin. Functional and evolutionary implications of
gene orthology. Nat. Rev. Genet. , 14(5):360‚Äì366, 2013.
[7] N. L. Nehrt, W. T. Clark, P. Radivojac, and M. W. Hahn. Testing the ortholog
conjecture with comparative functional genomic data from mammals. PLoS
Comput. Biol. , 7(e1002073), 2011.
[8] Erik Sonnhammer, Toni Gabald ¬¥on, Alan Wilter Sousa da Silva, Maria Mar-
tin, Marc Robinson-Rechavi, Brigitte Boeckmann, Paul Thomas, Christophe
Dessimoz, and the Quest for Orthologs consortium. Big data and other chal-
lenges in the quest for orthologs. Bioinformatics , 30(21):2993‚Äì2998, 2014.
[9] Jes ¬¥us A. Ballesteros and Gustavo Hormiga. A new orthology assessment
method for phylogenomic data: Unrooted phylogenetic orthology. Mol. Biol.
Evol. , 33(8):2117‚Äì2134, 2016.
[10] Walter M Fitch. Distinguishing homologous from analogous proteins. Syst
Zool, 19:99‚Äì113, 1970.
[11] Walter M. Fitch. Homology: a personal view on some of the problems. Trends
Genet. , 16:227‚Äì231, 2000.
[12] Charlotte A Darby, Maureen Stolzer, Patrick J Ropp, Daniel Barker, and Dan-
nie Durand. Xenolog classiÔ¨Åcation. Bioinformatics , 33:640‚Äì649, 2017.
[13] Manuela Gei√ü, Marcos E. Gonz ¬¥alez LafÔ¨Åtte, Alitzel L ¬¥opez S ¬¥anchez, Dulce I.
Valdivia, Marc Hellmuth, Maribel Hern ¬¥andez Rosales, and Peter F. Stadler.
Best match graphs and reconciliation of gene trees with species trees. J.
Math. Biol. , 80:1459‚Äì1495, 2020.
[14] Manuela Gei√ü, Peter F. Stadler, and Marc Hellmuth. Reciprocal best match
graphs. J. Math. Biol. , 80:865‚Äì953, 2020.
[15] Peter F. Stadler, Manuela Gei√ü, David Schaller, Alitzel L ¬¥opez S ¬¥anchez,
Marcos Gonz ¬¥alez LafÔ¨Åtte, Dulce I. Valdivia, Marc Hellmuth, and Maribel
Hern ¬¥andez Rosales. From pairs of most similar sequences to phylogenetic
best matches. Algorithms for Molecular Biology , 15:5, 2020.
[16] Manuela Gei√ü, Edgar Ch ¬¥avez, Marcos Gonz ¬¥alez LafÔ¨Åtte, Alitzel
L¬¥opez S ¬¥anchez, B ¬®arbel M. R. Stadler, Dulce I. Valdivia, Marc Hell-
muth, Maribel Hern ¬¥andez Rosales, and Peter F. Stadler. Best match graphs.
Journal of Mathematical Biology , 78(7):2015‚Äì2057, 2019.
[17] Pavel S Novichkov, Marina V Omelchenko, S Gelfand Mikhail, Andrei A
Mironov, Yuri I Wolf, and Eugene V Koonin. Genome-wide molecular clock
and horizontal gene transfer in bacterial evolution. J. Bacteriol. , 186:6575‚Äì
6585, 2004.The Theory of Gene Family Histories 27
[18] David Schaller, Manuel Lafond, Peter F. Stadler, Nicolas Wiesecke, and Marc
Hellmuth. Indirect identiÔ¨Åcation of horizontal gene transfer. J. Math. Biol. ,
83:10, 2021. arXiv 2012.08897.
[19] David Schaller, Tom Hartmann, Manuel Lafond, Nicolas Wieseke, Marc
Hellmuth, and Peter F. Stadler. Relative timing information and orthology
in evolutionary scenarios. Technical Report 2212.02201, arXiv, 2023.
[20] V P Doyle, R E Young, G J Naylor, and J M Brown. Can we identify genes
with increased phylogenetic reliability? Syst Biol , 64(5):824‚Äì837, 2015.
[21] B Boussau, G J Sz ¬®ollÀùosi, L Duret, M Gouy, E Tannier, and V Daubin.
Genome-scale coestimation of species and gene trees. Genome Res. ,
23(2):323‚Äì330, 2013.
[22] Gergely J. Sz ¬®ollÀùosi, Eric Tannier, Vincent Daubin, and Bastien Boussau. The
inference of gene trees with species trees. Syst. Biol. , 64:e42‚Äìe62, 2015.
[23] Adrian M. Altenhoff and Christophe Dessimoz. Phylogenetic and functional
assessment of orthologs inference projects and methods. PLOS Comp. Biol. ,
5:e1000262, 2009.
[24] A. M. Altenhoff, N. M. Glover, and C. Dessimoz. Inferring orthology and
paralogy. In Evolutionary Genomics , volume 1910 of Methods in Molecular
Biology , pages 149‚Äì175. Humana, New York, NY , 2019.
[25] Matt Ravenhall, Nives ÀáSkunca, Florent Lassalle, and Christophe Dessimoz.
Inferring horizontal gene transfer. PLoS Comp. Biol. , 11:e1004095, 2015.
[26] Ali ToÔ¨Ågh, Michael Hallett, and Jens Lagergren. Simultaneous identiÔ¨Åcation
of duplications and lateral gene transfers. IEEE/ACM Trans. Comp. Biol.
Bioinf. , 8(2):517‚Äì535, 2011.
[27] Zhi-Zhong Chen, Fei Deng, and Lusheng Wang. Simultaneous identiÔ¨Åcation
of duplications losses and lateral gene transfers. IEEE/ACM Trans. Comp.
Biol. Bioinf. , 9, 2012.
[28] W Ma, D Smirnov, J Forman, A Schweickart, C. Slocum, S. Srinivasan,
and R. Libeskind-Hadas. DTL-RnB: Algorithms and tools for summariz-
ing the space of DTL reconciliations. IEEE/ACM Trans. Comp. Biol. Bioinf. ,
15:411‚Äì421, 2018.
[29] Christine Dufraigne, Bernard Fertil, Sylvain Lespinats, Alain Giron, and
Patrick Deschavanne. Detection and characterization of horizontal transfers
in prokaryotes using genomic signature. Nucleic Acids Res. , 33:e6, 2005.
[30] Jennifer Becq, C ¬¥ecile Churlaud, and Patrick Deschavanne. A benchmark of
parametric methods for horizontal transfers detection. PLoS ONE , 5:e9989,
2010.
[31] Aditi Kanhere and Martin Vingron. Horizontal gene transfers in prokaryotes
show differential preferences for metabolic and translational genes. BMC
Evol. Biol. , 9:9, 2009.
[32] Jo Àúao C. Setubal and Peter F. Stadler. Gene phylogenies and orthologous
groups. In Jo Àúao C. Setubal, Peter F. Stadler, and Jens Stoye, editors, Compar-
ative Genomics , volume 1704, pages 1‚Äì28. Springer, Heidelberg, 2018.28 Marc Hellmuth and Peter F. Stadler
[33] A. V . Aho, Y . Sagiv, T. G. Szymanski, and J. D. Ullman. Inferring a tree from
lowest common ancestors with an application to the optimization of relational
expressions. SIAM J. Comput. , 10:405‚Äì421, 1981.
[34] Ying-Jun He, Trinh N D Huynh, Jesper Jansson, and Wing-Kin Sung. Infer-
ring phylogenetic relationships avoiding forbidden rooted triplets. J. Bioinf.
Comp. Biol. , 4:59‚Äì74, 2006.
[35] Frank Rutschmann. Molecular dating of phylogenetic trees: A brief review of
current methods that estimate divergence times. Diversity and Distributions ,
12:35‚Äì48, 2006.
[36] Herv ¬¥e Sauquet. A practical guide to molecular dating. Comptes Rendus
Palevol , 12:355‚Äì367, 2013.
[37] Daniel Ford, Frederick A. Matsen, and Tanja Stadler. A method for investi-
gating relative timing information on phylogenetic trees. Systematic Biology ,
58:167‚Äì183, 2009.
[38] Gergely Sz ¬®ollÀùosi, Sebastian H ¬®ohna, Tom A Williams, Dominik Schrempf,
Vincent Daubin, and Bastien Boussau. Relative time constraints improve
molecular dating. Systematic Biology , 71:797‚Äì809, 2022.
[39] David A Marques, Joana I Meier, and Ole Seehausen. A combinatorial view
on speciation and adaptive radiation. Trends Ecol Evol , 34:531‚Äì544, 2019.
[40] Y Zheng and L. Zhang. Effect of incomplete lineage sorting on tree-
reconciliation-based inference of gene duplication. IEEE/ACM Trans Com-
put Biol Bioinform , 11:477‚Äì485, 2014.
[41] Y B Chan, V Ranwez, and C. J. Scornavacca. Inferring incomplete lineage
sorting, duplications, transfers and losses with reconciliations. Theor. Biol. ,
432:1‚Äì13, 2017.
[42] Mukul S. Bansal, Eric J. Alm, and Manolis Kellis. EfÔ¨Åcient algorithms for
the reconciliation problem with gene duplication, horizontal transfer and loss.
Bioinformatics , 28:i283‚Äìi291, 2012.
[43] Maureen Stolzer, Han Lai, Minli Xu, Deepa Sathaye, Benjamin Vernot, and
Dannie Durand. Inferring duplications, losses, transfers and incomplete lin-
eage sorting with nonbinary species trees. Bioinformatics , 28:i409‚Äìi415,
2012.
[44] Roderic Guig ¬¥o, I Muchnik, and T F Smith. Reconstruction of ancient molec-
ular phylogeny. Mol Phylogenet Evol , 6:189‚Äì213, 1996.
[45] Roderic D. M. Page and Michael A. Charleston. From gene to organismal
phylogeny: Reconciled trees and the gene tree/species tree problem. Mol.
Phylog. Evol. , 7:231‚Äì240, 1997.
[46] Louxin Zhang. On a Mirkin-Muchnik-Smith conjecture for comparing
molecular phylogenies. J. Comp. Biol. , 4:177‚Äì187, 1997.
[47] K. Chen, D Durand, and M Farach-Colton. NOTUNG: a program for dating
gene duplications and optimizing gene family trees. J. Comput. Biol. , 7:e429‚Äì
e447, 2000.
[48] C M Zmasek and S R Eddy. A simple algorithm to infer gene duplication and
speciation events on a gene tree. Bioinformatics , 17:821‚Äì828, 2001.The Theory of Gene Family Histories 29
[49] P G ¬¥orecki, G J Burleigh, and O Eulenstein. Maximum likelihood models
and algorithms for gene tree evolution with duplications and losses. BMC
Bioinformatics , 12:S15, 2011.
[50] L. Arvestad. Bayesian gene/species tree reconciliation and orthology analysis
using MCMC. Bioinformatics , 19:i7‚Äìi15, 2003.
[51] Hugo Menet, Vincent Daubin, and Eric Tannier. Phylogenetic reconciliation.
PLoS Comp. Biol. , 18:e1010621, 2022.
[52] Nikolai N√∏jgaard, Manuela Gei√ü, Daniel Merkle, Peter F. Stadler, Nicolas
Wieseke, and Marc Hellmuth. Time-consistent reconciliation maps and for-
bidden time travel. Alg. Mol. Biol. , 13:2, 2018.
[53] Manuel Lafond and Marc Hellmuth. Reconstruction of time-consistent
species trees. Alg. Mol. Biol. , 15:16, 2020.
[54] Pawe≈Ç G ¬¥orecki and Jerzy Tiuryn. DLS-trees: A model of evolutionary sce-
narios. Theor. Comp. Sci. , 359:378‚Äì399, 2006.
[55] B Vernot, M Stolzer, A Goldman, and D Durand. Reconciliation with non-
binary species trees. J Comput Biol. , 15:981‚Äì1006, 2008.
[56] J-P Doyon, V Ranwez, V Daubin, and V Berry. Models, algorithms and
programs for phylogeny reconciliation. Brief Bioinform. , 12:392‚Äì400, 2011.
[57] L. Y . Rusin, E. Lyubetskaya, K. Y . Gorbunov, and V . Lyubetsky. Reconcilia-
tion of gene and species trees. BioMed Res Int. , 2014:642089, 2014.
[58] M. Hellmuth. Biologically feasible gene trees, reconciliation maps and infor-
mative triples. Alg. Mol. Biol. , 12:23, 2017.
[59] Marcus Lechner, Sven Findei√ü, Lydia Steiner, Manja Marz, Peter F. Stadler,
and Sonja J. Prohaska. Proteinortho: detection of (co-)orthologs in
large-scale analysis. BMC Bioinformatics , 12:124, 2011.
[60] David Schaller, Manuela Gei√ü, Edgar Ch ¬¥avez, Marcos Gonz ¬¥alez LafÔ¨Åtte, Al-
itzel L ¬¥opez S ¬¥anchez, B ¬®arbel M. R. Stadler, Dulce I. Valdivia, Marc Hellmuth,
Maribel Hern ¬¥andez Rosales, and Peter F. Stadler. Corrigendum to ‚ÄúBest
Match Graphs‚Äù. J. Math. Biol. , 82:47, 2021.
[61] David Schaller, Peter F Stadler, and Marc Hellmuth. Complexity of modiÔ¨Å-
cation problems for best match graphs. Theor. Comp. Sci. , 865:63‚Äì84, 2021.
[62] W. Maddison. Reconstructing character evolution on polytomous clado-
grams. Cladistics , 5:365‚Äì377, 1989.
[63] R. DeSalle, R. Absher, and G. Amato. Speciation and phylogenetic resolu-
tion. Trends Ecol. Evol. , 9:297‚Äì298, 1994.
[64] H E Walsh, M G Kidd, T Moum, and V L Friesen. Polytomies and the power
of phylogenetic inference. Evolution , 53:932‚Äì937, 1999.
[65] David Schaller, Manuela Gei√ü, Peter F. Stadler, and Marc Hellmuth. Com-
plete characterization of incorrect orthology assignments in best match
graphs. J. Math. Biol. , 82:20, 2021. arXiv: 2006.02249.
[66] David Schaller, Manuela Gei√ü, Marc Hellmuth, and Peter F. Stadler. Best
match graphs with binary trees. In Carlos Mart ¬¥ƒ±n-Vide, Miguel A. Vega-
Rodr ¬¥ƒ±guez, and Travis Wheeler, editors, Algorithms for Computational Biol-
ogy, 8th AlCoB , volume 12715 of Lect. Notes Comp. Sci. , pages 82‚Äì93, 2021.30 Marc Hellmuth and Peter F. Stadler
[67] David Schaller, Manuela Gei√ü, Marc Hellmuth, and Peter F. Stadler. Heuristic
algorithms for best match graph editing. Alg. Mol. Biol. , 16:19, 2021.
[68] Marc Hellmuth, Maribel Hernandez-Rosales, Katharina T. Huber, Vincent
Moulton, Peter F. Stadler, and Nicolas Wieseke. Orthology relations, sym-
bolic ultrametrics, and cographs. J. Math. Biol. , 66:399‚Äì420, 2013.
[69] D. G. Corneil, H. Lerchs, and L. Stewart Burlingham. Complement reducible
graphs. Discr. Appl. Math. , 3(3):163‚Äì174, 1981.
[70] Marc Hellmuth, Manuela Gei√ü, and Peter F. Stadler. Complexity of mod-
iÔ¨Åcation problems for reciprocal best match graphs. Theoretical Computer
Science , 809:384‚Äì393, 2020.
[71] Yunlong Liu, Jianxin Wang, Jiong Guo, and Jianer Chen. Complexity and
parameterized algorithms for cograph editing. Theor. Comp. Sci. , 461:45‚Äì54,
2012.
[72] W. Timothy J. White, Marcus Ludwig, and Sebastian B ¬®ocker. Exact and
heuristic algorithms for cograph editing. Technical Report 1711.05839 v3,
arXiv, 2018.
[73] Marc Hellmuth, Adrian Fritz, Nicolas Wieseke, and Peter F. Stadler. Tech-
niques for the cograph editing problem: Module merge is equivalent to edit
P4‚Äôs.Art Discr. Appl. Math. , 3:#P2.01, 2020.
[74] Christophe Crespelle. Linear-time minimal cograph editing. In E. Bampis
and A. Pagourtzis, editors, Fundamentals of Computation Theory (FCT
2021) , volume 12867 of Lect. Notes Comp. Sci. , pages 176‚Äì189, Cham, CH,
2021. Springer.
[75] Maribel Hernandez-Rosales, Marc Hellmuth, Nick Wieseke, Katharina T.
Huber, Vincent Moulton, and Peter F. Stadler. From event-labeled gene trees
to species trees. BMC Bioinformatics , 13(Suppl. 19):S6, 2012.
[76] Manuel Lafond, Riccardo Dondi, and Nadia El-Mabrouk. The link between
orthology relations and gene trees: a correction perspective. Alg. Mol. Biol. ,
11:4, 2016.
[77] Manuel Lafond and Nadia El-Mabrouk. Orthology and paralogy constraints:
satisÔ¨Åability and consistency. BMC Genomics , 15 S6:S12, 2014.
[78] Nikolai N√∏jgaard, Nadia El-Mabrouk, Daniel Merkle, Nicolas Wieseke, and
Marc Hellmuth. Partial homology relations ‚Äì satisÔ¨Åability in terms of di-
cographs. In Lusheng Wang and Daming Zhu, editors, Computing and Com-
binatorics COCOON‚Äô18 , volume 10976 of Lect. Notes Comp. Sci. , pages
403‚Äì415, Cham, 2018. Springer International Publishing.
[79] Marc Hellmuth, Nicolas Wieseke, Marcus Lechner, Hans-Peter Lenhof, Mar-
tin Middendorf, and Peter F. Stadler. Phylogenetics from paralogs. Proc.
Natl. Acad. Sci. USA , 112:2058‚Äì2063, 2015.
[80] R L Tatusov, E V Koonin, and D J Lipman. A genomic perspective on protein
families. Science , 278:631‚Äì637, 1997.
[81] Alexander C J Roth, Gaston H Gonnet, and Christophe Dessimoz. Algorithm
of OMA for large-scale orthology inference. BMC Bioinformatics , 9:518,
2008.The Theory of Gene Family Histories 31
[82] Sven Rahmann, Tobias Wittkop, Jan Baumbach, Marcel Martin, Anke Tru√ü,
and Sebastian B ¬®ocker. Exact and heuristic algorithms for weighted cluster
editing. In Proceedings of the 6th LSS Conference on Computational Systems
Bioinformatics (CSB2007) , pages 391‚Äì401. Life Scienes Society, 2007.
[83] Craig Falls, Bradford Powell, and Jack Sn≈ìyink. Computing high-stringency
COGs using Tur ¬¥an-type graphs. Technical report, U. North Carolina, 2008.
[84] Olivier Tremblay-Savard and Krister M Swenson. A graph-theoretic ap-
proach for inparalog detection. BMC Bioinformatics , 13:S16, 2012.
[85] Manuela Gei√ü, John Anders, Peter F. Stadler, Nicolas Wieseke, and Marc
Hellmuth. Reconstructing gene trees from Fitch‚Äôs xenology relation. J. Math.
Biol. , 77(5):1459‚Äì1491, 2018.
[86] Marc Hellmuth and Carsten R. Seemann. Alternative characterizations of
Ô¨Åtch‚Äôs xenology relation. J. Math. Biol. , 79(3):969‚Äì986, 2019.
[87] Marc Hellmuth, Yangjing Long, Manuela Gei√ü, and Peter F. Stadler. A short
note on undirected Ô¨Åtch graphs. Art Discr. Appl. Math. , 1(1):#P1.08, 2018.
[88] Marc Hellmuth, Mira Michel, Nikolai N. N√∏jgaard, David Schaller, and Pe-
ter F. Stadler. Combining orthology and xenology data in a common phylo-
genetic tree. In Peter F. Stadler Stadler, Maria Em ¬¥ƒ±lia M. T. Walter, Maribel
Hern ¬¥andez-Rosales, and Marcelo M. Brigido, editors, Advances in Bioinfor-
matics and Computational Biology, 14th BSB , volume 13063 of Lect. Notes
Bioinf , pages 53‚Äì64, Cham, CH, 2021. Springer Nature.
[89] Ron Shamir, Roded Sharan, and Dekel Tsur. Cluster graph modiÔ¨Åcation prob-
lems. Discrete Appl. Math. , 144(1-2):173‚Äì182, 2004.
[90] Yong Gao, Donovan R. Hare, and James Nastos. The cluster deletion problem
for cographs. Discrete Math. , 313(23):2763‚Äì2771, 2013.
[91] Marc Hellmuth, David Schaller, and Peter F. Stadler. Compatibility of parti-
tions with trees, hierarchies, and split systems. Discr. Appl. Math. , 314:265‚Äì
283, 2022.
[92] David Schaller, Marc Hellmuth, and Peter F. Stadler. Orientation of Ô¨Åtch
graphs and detection of horizontal gene transfer in gene trees. CoRR ,
abs/2112.00403, 2023.
[93] G. S. Gray and W. M. Fitch. Evolution of antibiotic resistance genes: The
DNA sequence of a kanamycin resistance gene from Staphylococcus aureus .
Mol. Biol. Evol. , 1:57‚Äì66, 1983.
[94] ¬®Orjan ÀöAkerborg, Bengt Sennblad, Lars Arvestad, and Jens Lagergren. Simul-
taneous bayesian gene tree reconstruction and reconciliation analysis. Proc.
Natl. Acad. Sci. USA , 106(14):5714‚Äì5719, 2009.
[95] Bret R. Larget, Satish K. Kotha, Colin N. Dewey, and C ¬¥ecile An ¬¥e. BUCKy:
Gene tree/species tree reconciliation with bayesian concordance analysis.
Bioinformatics , 26(22):2910‚Äì2911, 2010.
[96] Isaac Elias. Settling the intractability of multiple alignment. J. Comp. Biol. ,
13:1323‚Äì1339, 2006.
[97] William H. E. Day. Computationally difÔ¨Åcult parsimony problems in phylo-
genetic systematics. J. Theor. Biol. , 103:429‚Äì438, 1983.32 Marc Hellmuth and Peter F. Stadler
[98] William H. E. Day. Computational complexity of inferring phylogenies from
dissimilarity matrices. Bull. Math. Biol. , 49:461‚Äì467, 1987.
[99] S Roch. A short proof that phylogenetic tree reconstruction by maximum
likelihood is hard. IEEE/ACM Trans. Comp. Biol. Bioinf. , 3:92‚Äì94, 2006.
[100] David Schaller, Marc Hellmuth, and Peter F. Stadler. AsymmeTree: A Ô¨Çexi-
ble Python package for the simulation of complex gene family histories. Soft-
ware , 1:276‚Äì298, 2022.
[101] D Merkle, M Middendorf, and N Wieseke. A parameter-adaptive dynamic
programming approach for inferring cophylogenies. BMC Bioinformatics ,
11(Suppl 1):S60, 2010.
[102] Simon Penel, Hugo Menet, Th ¬¥eo Tricou, Vincent Daubin, and Eric Tannier.
Thirdkind: displaying phylogenetic encounters beyond 2-level reconciliation.
Bioinformatics , 38(8):2350‚Äì2352, 2022.
[103] Peng Du and Luay Nakhleh. Species tree and reconciliation estimation under
a duplication-loss-coalescence model. In Proceedings of the 2018 ACM Inter-
national Conference on Bioinformatics, Computational Biology, and Health
Informatics , pages 376‚Äì385, 2018.
[104] J Ansarifar, A Markin, P G ¬¥orecki, and O. Eulenstein. Integer linear pro-
gramming formulation for the uniÔ¨Åed duplication-loss-coalescence model.
In Z. Cai, I. Mandoiu, G. Narasimhan, P. Skums, and X. Guo, editors, Bioin-
formatics Research and Applications (ISBRA 2020) , volume 12304 of Lect.
Notes Comp. Sci. , pages 229‚Äì242, Cham, 2020. Springer.
[105] Matthew LeMay, Yi-Chieh Wu, and Ran Libeskind-Hadas. The most parsi-
monious reconciliation problem in the presence of incomplete lineage sorting
and hybridization is NP-hard. In Alessandra Carbone and Mohammed El-
Kebir, editors, 21st International Workshop on Algorithms in Bioinformatics
(WABI 2021) , volume 201 of Leibniz International Proceedings in Informat-
ics (LIPIcs) , page 1, Dagstuhl, Germany, 2021. Schloss Dagstuhl ‚Äì Leibniz-
Zentrum f ¬®ur Informatik.
[106] Marc Hellmuth, Katharina T. Huber, and Vincent Moulton. Reconciling
event-labeled gene trees with mul-trees and species networks. J. Math. Biol. ,
79(5):1885‚Äì1925, 2019.
[107] Daniel H. Huson, Regula Rupp, and Celine Scornavacca. Phylogenetic Net-
works: Concepts, Algorithms and Applications . Cambridge University Press,
Cambridge, UK, 2010.
[108] Thu-Hien To and Celine Scornavacca. EfÔ¨Åcient algorithms for reconciling
gene trees and species networks via duplication and loss events. BMC Ge-
nomics , 16(Suppl 10):S6, 2015.
[109] Celine Scornavacca, Joan Carles Pons Mayol, and Gabriel Cardona. Fast
algorithm for the reconciliation of gene trees and LGT networks. J. Theor.
Biol. , 418:129‚Äì137, 2017.
[110] Yao-Ban Chan and Charles Robin. Reconciliation of a gene network and
species tree. J Theor Biol , 472:54‚Äì66, 2019.
[111] Jaroslaw Byrka, Sylvain Guillemot, and Jesper Jansson. New results on opti-
mizing rooted triplets consistency. Discr. Appl. Math. , 158:1136‚Äì1147, 2010.The Theory of Gene Family Histories 33
[112] Benoit Morel, Alexey M Kozlov, Alexandros Stamatakis, and Gergely J.
Sz¬®ollÀùosi. GeneRax: A tool for species-tree-aware maximum likelihood-based
gene family tree inference under gene duplication, transfer, and loss. Mol.
Biol. Evol. , 37(9):2763‚Äì2774, 2020.
[113] Benoit Morel, Paul Schade, Sarah Lutteropp, Tom A Williams, Gergely J.
Sz¬®ollÀùosi, and Alexandros Stamatakis. SpeciesRax: A tool for maximum like-
lihood species tree inference from gene family trees under duplication, trans-
fer, and loss. Mol. Biol. Evol. , 39(2):msab365, 2022.
[114] J Armstrong, G Hickey, M Diekhans, I T Fiddes, A M Novak, A Deran,
Q Fang, D Xie, S Feng, J Stiller, D Genereux, J Johnson, V D Marinescu,
J Alf ¬®oldi, R S Harris, K Lindblad-Toh, D Haussler, E Karlsson, E D Jarvis,
G Zhang, and B Paten. Progressive Cactus is a multiple-genome aligner for
the thousand-genome era. Nature , 587:246‚Äì251, 2020.