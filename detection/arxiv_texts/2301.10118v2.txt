Computing isogeny classes of typical principally polarized
abelian surfaces over the rationals
Raymond van Bommel, Shiva Chidambaram, Edgar Costa, and Jean Kieffer
Abstract. We describe an efficient algorithm which, given a principally polar-
ized (p.p.) abelian surface AoverQwith geometric endomorphism ring equal
toZ, computes all the other p.p. abelian surfaces over Qthat are isogenous to
A. This algorithm relies on explicit open image techniques for Galois repre-
sentations, and we employ a combination of analytic and algebraic methods
to efficiently prove or disprove the existence of isogenies. We illustrate the
practicality of our algorithm by applying it to 1440894 isogeny classes of
Jacobians of genus 2 curves.
1. Introduction
As a consequence of Faltings’ finiteness theorems for abelian varieties [Fal83],
the isogeny class of any abelian variety over a number field is finite. In the simplest
case of elliptic curves over Q, we have a good understanding of which shapes
of isogeny classes can arise. Mazur’s isogeny theorem for elliptic curves [Maz78]
provides the list of primes ℓappearing as degrees of isogenies over Q, namely ℓ≤19
orℓ∈ {37,43,67,163}. Furthermore, isogeny classes all have size at most 8[Ken82].
In fact, the possible isogeny graphs can be explicitly listed [CL21, §6].
The standard approach to computing isogeny classes of elliptic curves over Q
is the following. Given an elliptic curve E, it is enough to consider isogenies
E→E′of prime degree ℓwhere ℓappears in Mazur’s list. For each such ℓ,
computing the possible image curves E′is a finite problem. The computation can be
carried out either by factoring the ℓ-division polynomial of Eand applying Vélu’s
formulas [Vél71], or more efficiently using explicit parametrizations or equations for
the Hecke correspondence X0(ℓ)→X(1)×X(1)[Elk98; CW05]. This method was
used to generate the data currently contained in the L-functions and modular forms
database (LMFDB)1[LMFDB].
As one moves away from the case of elliptic curves over Q, very little is known
on the theoretical side. Nevertheless, by carrying out explicit computations, one can
hope to gain insight into the possible shapes of isogeny classes in higher dimensions.
In this paper, we make a first step in this direction: we describe an algorithm to
compute isogeny classes in the simplest higher-dimensional case, namely that of a
The first three authors were supported by Simons Foundation grant 550033. The fourth
author was supported by Simons Foundation grant 550031.
1Seehttps://www.lmfdb.org/EllipticCurve/Q/Source .
1arXiv:2301.10118v2  [math.NT]  26 Jul 20232 R. VAN BOMMEL, S. CHIDAMBARAM, E. COSTA, AND J. KIEFFER
principally polarized (p.p.) abelian surface AoverQ. We also make the simplifying
assumption that the geometric endomorphism ring of AisZ, in other words, Ais
typical, although we plan to address more endomorphism ring types in future work.
Our overall strategy is to generalize the above method of computing isogeny
classes to the case of abelian surfaces. However, several obstacles immediately arise:
(1) Isogenies no longer decompose into rational, prime-degree isogenies.
(2)There is no known analogue of Mazur’s theorem for higher-dimensional
abelian varieties.
(3)Division polynomials are too big to be efficiently computed, except for
very small values of ℓ. The same is true of explicit equations for higher-
dimensional analogues of the modular curve X0(ℓ)studied in [Mil15a]:
see [Mil15b] for examples for very small primes ℓ.
We address the first issue in Section 2, where we show that we only need to
consider two types of isogenies of degree ℓ2andℓ4respectively, where ℓis a prime.
We circumvent the second issue in the following way. From any given typical
abelian surface, Serre’s open image theorem for Galois representations [Ser99]
asserts that isogenies of the above types can exist over Qonly for a finite number of
primes ℓ(depending on the abelian surface). It is sufficient to consider these primes
to enumerate the “neighbors” of Ain the isogeny class. Further, Dieulefait [Die02]
describes how to efficiently compute a finite superset of this list. We review this
method in Section 3, and provide complete proofs for the reader’s convenience.
To address the third issue, we advantageously replace purely algebraic methods
by complex-analytic ones relying on the Siegel moduli space of complex p.p. abelian
surfaces. Concretely, given an abelian surface A, we enumerate images of its period
matrix under certain Hecke correspondences, and compute modular invariants at
these points analytically. By keeping track of the correct scaling factors, we can
actually compute these invariants as algebraic integers (embedded in C), and thus
provably recognize which of these tuples of complex invariants correspond to abelian
surfaces defined over Q. This algorithm is the subject of Section 4. It is significantly
less expensive than writing down equations for modular varieties or factoring division
polynomials, and is practical for isogeny degrees as large as 294= 707 281 , the
largest value we encountered in our computations.
The output invariants only specify the Q-isomorphism class of the abelian
surface A′isogenous to A. In Section 5, we explain how to obtain the correct Q-
isomorphism class using a well-known and completely algebraic process. First,
Mestre’s algorithm provides a genus 2 curve over Qwhose Jacobian is isomorphic
toA′overQ. We then identify which quadratic twist of that curve represents the
desired Q-isomorphism class.
The resulting algorithm has been implemented: our code and data is publicly
available at https://github.com/edgarcosta/genus2isogenies . Numerical
computations are performed using the C library HDME [Kie23], itself based on the
Arb library [Joh17] for high-precision arithmetic with certified error bounds.
We finally discuss applications of our algorithm in Section 6. We first present
an illustrative example where we found an isogeny of degree 312. We also report
on the results of running our algorithm on a large dataset of Jacobians of genus 2
curves that includes the current LMFDB data [LMFDB]. This dataset consists of
1743737 curves split among 1440894 isogeny classes. By completing these isogeny
classes, we find 600948 new curves.COMPUTING ISOGENY CLASSES OF TYPICAL P.P. ABELIAN SURFACES 3
Acknowledgements. We thank Fabien Cléry for communicating us references
on Siegel modular forms, Andrew Sutherland and Noam Elkies for providing us with
interesting genus 2curves to use as an input to our algorithm, and Bjorn Poonen
for helpful conversations.
2. Classification of isogenies
In this section, we describe two fundamental isogeny types that are sufficient to
exhaust isogeny classes of typical p.p. abelian surfaces. The essential ingredient in
this classification is that every isogeny between p.p. abelian varieties is compatible
with the given polarizations up to the action of an endomorphism fixed by the
Rosati involution, as we detail below.
2.1. Isogenies between p.p. abelian varieties. Letkbe a field. For
simplicity, we assume thoughout that khas characteristic zero: this allows us to
identify group schemes over kwith the groups of their k-points endowed with an
action of Gal(k/k). Unless otherwise specified, we only consider abelian varieties
and isogenies that are defined over k. Two isogenies are considered isomorphic if
they have the same domain and differ by an isomorphism on their targets.
LetAbe an abelian variety over k, and denote its dual by A∨. Apolarization on
Ais an isogeny λ:A→A∨of the shape a7→T∗
aL ⊗ L−1for some (not necessarily
k-rational) ample line bundle LonA, where Tais the translation by ainA. A
polarization is called principal if it is an isomorphism.
From now on, we assume that Ais principally polarized (p.p.), in other words A
is endowed with a principal polarization λA. We then have a Rosati involution
onEnd(A)given by φ7→λ−1
A◦φ∨◦λA. An endomorphism β∈End(A)is called
symmetric if it is invariant under this involution. If βis symmetric, then the roots
of its characteristic polynomial are real numbers [Mum70, Thm. 6 p.208], and we
further say that βistotally positive if these roots are positive.
ForAas above and any integer n, there exists a canonical symplectic pairing
A[n]×A[n]→µnknown as the Weil pairing . More generally, if β∈End(A)is
any endomorphism that is symmetric and totally positive, then λA◦βis another
polarization of A[Mum70, (3) p.190 and (IV) p.209]. As in [Mum70, Def. p.227],
we can also define a symplectic pairing on A[β]×A[β]that we also refer to as the
Weil pairing. We then have the following characterization of isogenies in terms of
maximal isotropic subgroups of torsion subgroups A[β]; see also [EGM, Prop. 11.25].
Lemma 2.1. Let(A, λ A)be a p.p. abelian variety over k. Then there is a one-to-one
correspondence between isomorphism classes of isogenies from Ato other p.p. abelian
varieties A′, and pairs (β, G), where βis a totally positive symmetric endomorphism
ofA, and Gis a subgroup of A[β]which is defined over kand maximal isotropic
with respect to the Weil pairing. Explicitly, an isogeny φ:A→A′corresponds to
the pair (β, G)such that kerφ=Gandβis the unique endomorphism satisfying
φ∨◦λA′◦φ=λA◦β.
Proof. First, we note that any isotropic subgroup of A[β]has cardinality at
mostp
#A[β], and is maximal if and only if equality holds [Mum70, Thm. 4 p.233].
Let(A′, λA′)be a p.p. abelian variety, and let φ:A→A′be an isogeny. Then
there is a unique endomorphism βofAsuch that φ∨◦λA′◦φ=λA◦β. This
βis fixed by the Rosati involution, and corresponds via the bijection of [Mum70,
Application III p.208] to an ample line bundle on A, namely the pullback by φof4 R. VAN BOMMEL, S. CHIDAMBARAM, E. COSTA, AND J. KIEFFER
the ample line bundle on A′defining the polarization λA′. Thus βis totally positive.
Moreover, the pairing on A[β]becomes trivial on kerφby [Mum70, (1) p.228]. As
deg(φ)2=deg(φ)deg(φ∨) =deg(β), it follows that kerφis a maximal isotropic
subgroup of A[β].
On the other hand, if βandGare given, then λA◦βis a polarization on A,
and the quotient A/Gis principally polarized by [Mum70, Cor. p.231]. □
2.2. Fundamental isogeny types. Assume now that kis a number field. An
abelian variety Aoverkis calledtypicalifEnd(AQ) =Z. IfAis typical, then only
a small number of isogeny types suffice in order to enumerate its isogeny class.
Lemma 2.2. Any isogeny between typical p.p. abelian varieties over a number
fieldkcan be decomposed into a chain of isogenies φ:A→A′defined over kwhose
kernels are maximal isotropic subgroups of either A[ℓ]orA[ℓ2], where ℓis a prime
number (depending on φ).
Proof. Letφ:A→A′be any isogeny. Since Ais typical, by Lemma 2.1,
there exists an integer n≥1such that K:=kerφ⊂A[n]is maximal isotropic.
Factor n=ℓe1
1·. . .·ℓerr. Then K∩A[ℓei
i]is maximal isotropic inside A[ℓei
i]for
alli= 1, . . . , r. Indeed, by [Mil86, Lemma 16.1] the subgroup is isotropic, and by
checking the cardinality, one sees that the subgroup is maximal isotropic. As each
subgroup K∩A[ℓei
i]is defined over k, we can decompose φas the composition of
isogenies whose degrees are prime powers.
Now suppose that n=ℓeis a prime power, and that e >2. Then we claim that
K′:=ℓK∩A[ℓe−2] =ℓK[ℓe−1]
is a maximal isotropic subgroup of A[ℓe−2]. We will then be able to decompose φ
into two isogenies of lower degree, namely A→A/K′andA/K′→A/K.
First, we prove that K′is isotropic: if ⟨·,·⟩ℓidenotes the Weil pairing on A[ℓi]
(for any i≥1), and ℓx1, ℓx2forx1, x2∈Kare arbitrary elements of K′, we have that
⟨ℓx1, ℓx2⟩ℓe−2=⟨x1, x2⟩ℓe= 1by [Mil86, Lemma 16.1]. To see that K′is maximal,
we determine its cardinality. Let r1andr2be the ranks of K[ℓ]andK/K [ℓe−1]as
Z/ℓZ-modules. We have an exact sequence
0→K[ℓ]→K[ℓe−1]ℓ→K′→0
and#K[ℓe−1] = # K/ℓr2. Hence
#K′= #K[ℓe−1]/#K[ℓ] = # K/ℓr1+r2=ℓeg−r1−r2.
On the other hand, we have r1+r2≤2gbecause the Weil pairing on A[ℓ]×A[ℓ]
vanishes on K[ℓ]×ℓe−1(K/K [ℓe−1]), and these subspaces have dimensions r1and
r2overZ/ℓZrespectively. Indeed, for x∈K[ℓ]andy∈ℓe−1(K/K [ℓe−1]), we can
write xasℓe−1x′for some x′∈A[ℓe]andyasℓe−1y′for some y′∈K, and then
⟨x, y⟩ℓ=⟨ℓe−1x′, ℓe−1y′⟩ℓ=⟨x′, y′⟩ℓe−1
ℓe=⟨ℓe−1x′, y′⟩ℓe=⟨x, y′⟩ℓe= 0,
by [Mil86, Lemma 16.1] and the fact that Kis isotropic.
Since K′is isotropic for the Weil pairing on A[ℓe−2]andr1+r2≤2g, we must
have r1+r2= 2gandK′is maximal isotropic in A[ℓe−2]. □
From now on, we focus on the case of typical p.p. abelian surfaces. Let ℓbe a
prime. We say that an isogeny φ:A→A′is
•a1-step ℓ-isogeny, ifker(φ)is maximal isotropic in A[ℓ], andCOMPUTING ISOGENY CLASSES OF TYPICAL P.P. ABELIAN SURFACES 5
•a2-step ℓ-isogeny, ifker(φ)is maximal isotropic in A[ℓ2]and isomorphic
to(Z/ℓZ)2×Z/ℓ2Zas an abstract abelian group.
Note that the terminology “2-step ℓ-isogeny” is slightly abusive, as the endomor-
phism βassociated with φvia Lemma 2.1 is actually ℓ2in that case.
Proposition 2.3. Any isogeny between typical p.p. abelian surfaces over a number
fieldkcan be decomposed into a chain of 1-step ℓ-isogenies, 2-step ℓ-isogenies, and
multiplication-by- ℓendomorphisms for a series of primes ℓ, all defined over k.
Proof. By Lemma 2.2, we only need to consider an isogeny φwhose kernel K
is maximal isotropic inside A[ℓ2]. Then #K=ℓ4, soKis isomorphic to (Z/ℓZ)4,
(Z/ℓZ)2×Z/ℓ2Zor(Z/ℓ2Z)2. In the first case, the isogeny φis multiplication by ℓ.
In the second case, φis 2-step. In the third case, the group K∩A[ℓ] =ℓKis a
maximal isotropic subgroup of A[ℓ]: it is isotropic by [Mil86, Lemma 16.1], and
maximal for cardinality reasons. We can thus decompose φinto two 1-step isogenies
A→A/ℓKandA/ℓK →A/K. □
Remark 2.4. A 2-step isogeny factors as a composition of two 1-step isogenies
overk, but these 1-step isogenies are not necessarily defined over k. Here is a more
detailed look into this situation. If Kis the kernel of a 2-step ℓ-isogeny, then ℓKis
a rational 1-dimensional subspace of A[ℓ]. We can extend ℓKinℓ+ 1ways to get a
maximal isotropic subgroup of A[ℓ]contained in K. These ℓ+ 1ways to factor the
2-step isogeny as a composition of two 1-step isogenies are permuted by Gal(k/k).
2.3. Computing an isogeny class. From now on, we assume that k=Q.
In the following sections, we will detect the existence of 1- or 2-step ℓ-isogenies
from Ato another p.p. abelian surface by studying the action of Gal(Q/Q)onA[ℓ].
LetL1(resp. L2) be the set of primes ℓsuch that A[ℓ]admits a 1-dimensional
(resp. 2-dimensional and isotropic) Galois-stable subspace. Then the existence of a
rational 1-step (resp. 2-step) isogeny implies that ℓ∈ L 2(resp. L1).
Summarizing, we use the following algorithm to compute the isogeny class of a
typical p.p. abelian surface AoverQ, defined as the set of isomorphism classes of
p.p. abelian surfaces A′such that there exists an isogeny φ:A→A′defined over Q.
These abelian surfaces all are the Jacobian of a genus 2 curve over Qby [Lau01,
Appendix, Thm. 4], and this is how we encode both the input and output.
Algorithm 2.5. Input:a genus 2 curve CoverQsuch that A= Jac( C).
Output: the list of all p.p. abelian surfaces over Qthat are isogenous to A.
Step 1. Use Dieulefait’s tests to find finite supersets of L2andL1(see §3).
Step 2. For each ℓin these sets, compute invariants for all abelian surfaces A′
overQobtained as the image of a 1-step (resp. 2-step) ℓ-isogeny with
domain A(see §4).
Step 3. Reconstruct each such A′as the Jacobian of a genus 2curve over Qby
applying Mestre’s algorithm and identifying the correct twist (see §5).
Step 4. Repeat this process on all the newly obtained abelian surfaces as needed.
3. Rational ℓ-torsion subgroups
LetAbe a typical p.p. abelian surface over Q, and let Nbe its conductor (see
[BK94, §6] for the definition of the conductor and further background). Let dbe the
maximal integer such that d2|N. Let Sdenote the set of primes of bad reduction
forA, i.e. the set of primes dividing N.6 R. VAN BOMMEL, S. CHIDAMBARAM, E. COSTA, AND J. KIEFFER
For each prime ℓ≥2, let ρℓ: Gal (Q/Q)→GSp(4,Zℓ)denote the Galois
representation on the ℓ-adic Tate module
Tℓ(A) = lim← −n≥1A[ℓn]≃Z4
ℓ,
where we fix a symplectic basis of Tℓ(A)for this last isomorphism. The Néron–Ogg–
Shafarevich criterion [ST68] states that ρℓis unramified away from ℓandS; in other
words, if p /∈S∪ {ℓ}is a prime, then the inertia group Ipatphas trivial image
under ρ. The prime-to- ℓpart of the conductor of ρℓequals Nwhen ℓis a prime of
good reduction [GRR72, Exposé IX, §4]. For each prime pof good reduction, we let
Qp(x):=x4−apx3+bpx2−papx+p2∈Z[x]denote the characteristic polynomial
ofρℓ(Frob p), which is independent of ℓ̸=p. The complex roots of Qp(x)all have
absolute value√p.
Considering all the ℓ-adic representations at the same time, we obtain the
adelic Galois representation ρ: Gal (Q/Q)→GSp(4,bZ)attached to A. Serre’s
open image theorem [Ser99] asserts that the image of ρis an open subgroup
ofGSp(4,bZ), or equivalently has finite index in it. Consequently, the mod- ℓGalois
representation ρℓ:=ρℓmod ℓ, attached to the Galois action on A[ℓ], is surjective
for all primes ℓoutside a finite set.
Dieulefait [Die02] describes an algorithm to explicitly determine a finite set of
primes containing all primes ℓat which ρℓis not surjective, using the classification of
maximal subgroups of GSp(4,Fℓ). For each type of maximal subgroup, one can give
necessary conditions on ℓfor the image of ρℓto be contained in a subgroup of this
type, and these conditions are satisfied by finitely many primes ℓ. The algorithm
has been implemented in SageMath [Sage] by the work of [BBKKMSV23].
In this work, we are only interested in two types of maximal subgroups, namely
the stabilizers of lines and two-dimensional isotropic subspaces in F4
ℓ[BBKKMSV23,
Lemma 2.3(1)]. Keeping notation from §2.3, we call L1(resp. L2) the finite set of
primes ℓfor which the image of ρℓstabilizes a line (resp. a 2-dimensional isotropic
subspace). A 1-step ℓ-isogeny with domain Aexists over Qif and only if ℓ∈ L 2.
Moreover, if a 2-step ℓ-isogeny with domain Aexists over Q, then ℓ∈ L 1as per
Remark 2.4. We now describe the associated Dieulefait criteria [Die02, §3.1, §3.2]
in more detail, assuming from now on that Ahas good reduction at ℓ.
3.1. Computing a finite superset of L1.Dieulefait’s tests rely on the
factorization of characteristic polynomials Qp(x)over finite fields, for a given list of
primes p. We include this list as part of the input of the following algorithm.
Algorithm 3.1. Input:
•a genus 2 curve CoverQsuch that A= Jac( C),
•the conductor NofA,
•and a non-empty finite set Pof primes of good reduction for C.
Output: a finite superset of L1.
Step 1. Compute the maximal integer dsuch that d2|N.
Step 2. Compute Qp∈Z[x]forp∈Pby computing the number of points on C
overFpandFp2.
Step 3. Compute M=gcdp∈PRes 
Qp(x), xf(p)−1
, where f(p)is the order of p
in(Z/dZ)×.
Step 4. Return the list of prime divisors of M.COMPUTING ISOGENY CLASSES OF TYPICAL P.P. ABELIAN SURFACES 7
Proposition 3.2. Algorithm 3.1 returns a finite superset of L1.
Proof. Suppose that there exists a 1-dimensional subrepresentation (π, V)
ofρℓ, induced by a stable line V⊂A[ℓ]. Let V⊥denote the subgroup of A[ℓ]that
pairs trivially with Vunder the Weil pairing. By Galois equivariance of the Weil
pairing, the 1-dimensional quotient representation on A[ℓ]/V⊥is given by π−1χℓ,
where χℓis the mod- ℓcyclotomic character. By results of Raynaud [Ray74, Cor.
3.4.4] and Serre [Ser72, §1.9], we know that πrestricted to the inertia group Iℓatℓ
is either trivial or equal to χℓ.
In any case, there exists a character ε, unramified away from N, such that
the semisimplification ρss
ℓadmits both εandε−1χℓas direct summands. Hence
the conductor of ρℓis divisible by the square of the conductor of ε, in other
words cond(ε)divides d. Class field theory then implies that εis a character
ofGal(Q(ζd)/Q)≃(Z/dZ)×. For each prime p∈L, since f(p)is the order
ofpin(Z/dZ)×, we have ε(Frob p)f(p)= 1. Therefore, ε(Frob p)is a root of the
characteristic polynomial of ρℓ(Frob p)and also of the polynomial xf(p)−1overFℓ.
Thus ℓdivides Res(Qp(x), xf(p)−1)and hence ℓdivides M.
Since the complex roots of Qp(x)have absolute value√p, they are distinct from
the roots of xf(p)−1which have absolute value 1. So the resultants and thus M
are guaranteed to be non-zero and the computed superset is finite. □
Remark 3.3. Building on results of Grothendieck [GRR72, Exposé IX, Prop. 3.5]
and Larson–Vaintrob [LV14, Thm. 7.2], the authors of [BBKKMSV23] introduce
the following strengthening of the above technique (Alg. 3.3). For p∈P, letr=
gcd(f(p),120). Let Rpbe the polynomial whose roots are the r-th powers of the
roots of Qp. Then each ℓ∈ L 1must divide p Rp(1). The original criterion by
Dieulefait, as presented above, was however sufficient for our purposes.
3.2. Computing a finite superset of L2.In the case of L2, the computation
of a finite superset might fail if the list of auxiliary primes pis too small, leading to
the following algorithm.
Algorithm 3.4. Input:
•a genus 2 curve CoverQsuch that A= Jac( C),
•the conductor NofA,
•and a non-empty finite set Pof primes of good reduction for C.
Output: a finite superset of L2, orfalse.
Step 1. Compute d.
Step 2. Forp∈P, compute Qp=x4−apx3+bpx2−papx+p2∈Z[x].
Step 3. Forp∈P, compute the polynomials
R1,p(x):= (bpx−1−p2x2)(px+ 1)2−a2
ppx2and
R2,p(x):= (bpx−p−px2)(x+ 1)2−a2
px2.
Step 4. Fori= 1and2, compute Mi=gcdp∈PRes 
Ri,p(x), xf(p)−1
, where f(p)
is the order of pin(Z/dZ)×. Let M=M1M2.
Step 5. IfMis nonzero, return the list of prime divisors of M, else return false.
Proposition 3.5. Algorithm 3.4 returns either falseor a finite superset of L2.
Proof. Suppose that ρℓadmits a 2-dimensional isotropic subrepresentation
denoted by (π, V). The quotient representation on A[ℓ]/Vis given by χℓ⊗(π−1)t.8 R. VAN BOMMEL, S. CHIDAMBARAM, E. COSTA, AND J. KIEFFER
By [Ray74, Cor. 3.4.4] and [Ser72, §1.9], we obtain as above that either det(π) =εχ2
ℓ
ordet(π) =εχℓfor some character εunramified away from N. The direct sum
decomposition ρss
ℓ≃π⊕χℓ⊗(π−1)tthen implies that cond( ε)still divides d.
Ifdet(π) =εχ2
ℓ, then for every prime pof good reduction, we have the following
factorization of Qp(x)into a product of two related quadratic polynomials modulo ℓ:
Qp(x) = 
x2−rx+p2ε(p)
x2−r
pε(p)x+ε−1(p)
.
Ifdet(π) =εχℓ, then for all such p, we have
Qp(x) = 
x2−rx+pε(p)
x2−r
ε(p)x+pε−1(p)
.
By comparing coefficients and eliminating r, one observes that the first kind of
factorization happens if and only if ε(p)is a root of the integral polynomial R1,p(x)
introduced in Algorithm 3.4 over Fℓfor all p. Similarly, the second kind of factor-
ization happens if and only if ε(p)is a root of R2,p(x)overFℓfor all p. Thus, there
is an i∈ {1,2}such that for all pof good reduction, Res 
Ri,p(x), xf(p)−1
= 0
mod ℓ. We deduce that ℓalways divides M=M1M2. □
We now show that Algorithm 3.4 returns a superset of L2provided that P
contains enough primes. In practice, failures are not an issue even for a small list P.
Proposition 3.6. ForBlarge enough and P={p≤B:pis a good prime for C},
Algorithm 3.4 returns a finite list of primes, in other words both M1andM2are
nonzero.
Proof. We first prove that M1̸= 0. For p= 1 mod d, we have
Res(R1,p(x), xf(p)−1) = R1,p(1) = ( bp−1−p2)(p+ 1)2−a2
pp.
Using the bounds |ap| ≤4√pand|bp| ≤6pcoming from the fact that the roots
ofQp(x)have absolute value√p, it follows that R1,p(1)<0ifpis large enough,
and thus M1̸= 0for large B.
Second, we prove that M2̸= 0. Consider all polynomials over Fℓwhich, over Fℓ,
admit a factorization of the form
(x2−rx+pη)(x2−r
ηx+pη−1),
where η∈Fℓis ad-th root of unity and r∈Fℓ. When ℓis sufficiently large,
these polynomials do not account for all characteristic polynomials of matrices
inGSp(4,Fℓ). By Serre’s open image theorem, we can further assume that the
representation ρℓis surjective. For such an ℓ, by the Chebotarev density theorem,
there must exist infinitely many psuch that Qp(x)does not factor over Fℓin
the above shape, and thus ℓ∤Res(R2,p(x), xf(p)−1). Therefore M2̸= 0ifBis
sufficiently large. □
Remark 3.7. Showing that M2̸= 0for a sufficiently large Bis non-trivial: indeed,
if the reduction of Amodulo pis isogenous to the square of an elliptic curve over Fp,
then Res(R2,p(x), xf(p)−1) = 0.
Remark 3.8. An improvement of a similar flavor to Remark 3.3 is also available
here: see [BBKKMSV23, §3.1.3].COMPUTING ISOGENY CLASSES OF TYPICAL P.P. ABELIAN SURFACES 9
3.3. Other tests for irreducibility. The output of Algorithms 3.1 and 3.4
usually consists of very short lists of primes, but might still contain extraneous
primes ℓ /∈ L 1∪ L 2. In order to further weed out some of these primes, one can
compute Qp(x)for a larger set of primes p, and eliminate any prime ℓwith the
property that one of these polynomials is irreducible modulo ℓ. In our computations,
we considered all primes p≤500of good reduction for C.
4. Invariants of isogenous abelian surfaces
In this section, we describe an efficient algorithm solving the following problem:
given a typical p.p. abelian surface AoverQand a prime number ℓ, compute the
complete list of p.p. abelian surfaces A′overQsuch that AandA′are linked by a
rational 1- or 2-step ℓ-isogeny.
Devising a polynomial-time algorithm for this task is straightforward: we can
write down equations for the torsion subgroups A[ℓ]orA[ℓ2], look for rational
subgroups of the correct shape by factoring these polynomials over Q, and apply al-
gorithms to compute quotients of p.p. abelian surfaces by isotropic subgroups [CE15;
LR23]. Such an algorithm would however be hopelessly slow in practice.
A more efficient approach is to use modular equations for p.p. abelian surfaces,
which are higher-dimensional analogues of elliptic modular polynomials: see [BL09]
for their definition in the case of 1-step isogenies, and [Mil15a] for an efficient
algorithm to compute them. Evaluating modular equations at Aprovides tuples
of modular invariants (for instance Igusa–Clebsch invariants) of abelian surfaces
isogenous to A, possibly defined over a number field. This evaluation can be done
within a reasonable complexity, namely eO(ℓ6h)bit operations2in the case of 1-step
ℓ-isogenies, where his the height of the invariants of A[Kie22b]. This algorithm
works by computing the invariants of isogenous abelian surfaces as complex numbers,
packagingthemintoapolynomial, andrecognizingitscoefficientsasrationalnumbers.
Then a rational isogeny from Aexists exactly when this polynomial has a rational
root (see Proposition 4.7 below).
Here we take this method one step further: we compute these invariants over C,
and directly recognize when they are attached to a p.p. abelian surface defined over Q.
In a sense, we detect rational roots of modular equations without computing the
number fields that other roots generate. When doing so, the cost is further lowered
toeO 
(n+ 1)ℓdh
bit operations, where d= 3(resp. 4) in the case of 1-step (resp. 2-
step) isogenies, and nis the number of roots “close to” being rational, in a precise
sense explained below. (We usually have n= 0, sometimes n= 1, and rarely more.)
Crucially, this analytic method allows for certification. The modular invariants we
compute provably correspond to p.p. abelian surfaces rationally isogenous to A, and
provably miss none of them.
The computations over Cmake use of structure theorems for Siegel modular
forms in dimension 2and explicit formulas for Hecke correspondences, recalled
in §4.1 and §4.2. Next, we explain why detecting rational isogenies reduces to
detecting invariants defined over Q(§4.3), and how to compute these invariants
as algebraic integers, which is the crucial idea behind certification (§4.4). Finally,
in §4.5 and §4.6, we describe the algorithm and sketch its complexity analysis.
2We use the notation eO(N)to denote O 
Nlogk(N)
for some value of k.10 R. VAN BOMMEL, S. CHIDAMBARAM, E. COSTA, AND J. KIEFFER
4.1. Siegel modular forms. OverC, every p.p. abelian surface Acan be
written as a complex torus C2/(Z2⊕τZ2), where τbelongs to the Siegel upper half
spaceH2, consisting of complex 2×2symmetric matrices with positive definite imag-
inary part. Such a τis called a (small) period matrix ofA. The group GSp(4,R)+
consisting of general symplectic matrices with positive similitude factor acts on H2
as follows:
γτ= (aτ+b)(cτ+d)−1,where γ=
a b
c d
in2×2blocks.
For later use, we also write
γ∗τ=cτ+d.
The period matrix of Ais unique up to the action of the modular group Sp(4,Z), so
the quotient Sp(4,Z)\H2is precisely the coarse moduli space of complex p.p. abelian
surfaces. In fact, this coarse moduli space A2exists as a quasi-projective variety
defined over Q, andA2(C)can be identified with Sp(4,Z)\H2.
A (scalar-valued) Siegel modular form onH2of weight k∈Z≥0(and level 1) is
a complex-analytic map f:H2→Csatisfying f(γτ) =det(γ∗τ)kf(τ)for all τ∈H2
andγ∈Sp(4,Z). See [Gee08] for more background on these objects. Siegel modular
forms admit Fourier expansions: writing τ∈H2as
τ=τ1τ3
τ3τ2
andqj= exp(2 πiτj)for1≤j≤3, the Fourier expansion of a Siegel modular form
belongs to the power series ring C[q3, q−1
3][[q1, q2]].
By the Baily–Borel theorem, Siegel modular forms with rational Fourier coeffi-
cients yield projective embeddings of A2that are defined over Q, and can thus be
used as rational coordinates on this moduli space. Igusa [Igu62] proved the following
fundamental theorem.
Theorem 4.1. The graded C-algebra of Siegel modular forms on H2of even weight
is free with four generators M4, M6, M10, M12of weights 4,6,10,12with integral
Fourier coefficients.
In this paper, we normalize these generators so that their Fourier expansions
are primitive and M10, M12are cusp forms. This defines them uniquely up to sign.
We can fix these signs by specifying their first few Fourier coefficients:
M4(τ) = 1 + 240( q1+q2) +O 
q2
1, q2
2, q1q2
,
M6(τ) = 1−504(q1+q2) +O 
q2
1, q2
2, q1q2
,
M10(τ) = 
q3−2 +q−1
3
q1q2+O(q2
1, q2
2),and
M12(τ) = 
q3+ 10 + q−1
3
q1q2+O 
q2
1, q2
2
.
We find this normalization more convenient than the ones usually considered in the
literature. In terms of Igusa’s notation in [Igu62], we have
M4=ψ4, M 6=ψ6, M 10= 4χ10,and M12= 12χ12.
In terms of the modular forms hkfork∈ {4,6,10,12}from [Str14, §7.1], we have
(4.2) M4= 2−2h4, M 6= 2−2h6, M 10=−2−12h10,and M12= 2−15h12.
From Theorem 4.1, we deduce that for each τ∈H2, at least one of the values Mk(τ)
fork∈ {4,6,10,12}does not vanish.COMPUTING ISOGENY CLASSES OF TYPICAL P.P. ABELIAN SURFACES 11
Igusa [Igu79] further determined an explicit set of fourteen generators for the
graded ring of Siegel modular forms with integral Fourier coefficients, which contains
the above forms Mk. The following easy corollary of Igusa’s result will play an
essential role in this paper.
Proposition 4.3 ([Kie22b, §2.1]) .Letfbe a Siegel modular form on H2of even
weight kwith integral Fourier coefficients. Then 12kf∈Z[M4, M6, M10, M12].
Iffis a Siegel modular form of weight kwith rational Fourier coefficients, then
we can also give fan algebraic meaning as follows [FC90, Def. 1.1 p.137]. Let Abe
a p.p. abelian surface over a number field Lembedded in C, and let ωbe a basis of
the1-dimensional L-vector space ∧2Ω1(A). Then f(A, ω)is a well-defined element
ofL, and satisfies f(A, tω ) =t−kf(A, ω)for all t∈L×.
The relation between f(A, ω)and the values of fon the Siegel half space H2is
the following [FC90, p.141]. Let τ∈H2be a period matrix of A, and choose an
isomorphism η:A(C)→C2/(Z2⊕τZ2). The basis of differentials (2πi dz 1,2πi dz 2)
induces a natural basis of ∧2Ω1on the complex torus; call this basis ω(τ). There is
a unique r∈C×such that ω=r·η∗ω(τ). Then f(A, ω) =r−kf(τ); one can check
that this quantity f(A, ω)does not depend on the choice of τorη.
Let now Abe a p.p. abelian surface over Q, and choose a basis ωof∧2Ω1(A).
Then the weighted projective point
(4.4) 
M4(A, ω) :M6(A, ω) :M10(A, ω) :M12(A, ω)
∈P4,6,10,12(Q)
is independent of ω, since scaling ωbyt−1∈Q×scales the above coordinates
by(t4, t6, t10, t12). We call this projective point the modular invariants ofA. This
projective point has a unique representative (m4, m6, m10, m12)∈Z4that is reduced
in the sense that no prime psatisfies pk|mkfor all k∈ {4,6,10,12}; by a slight
abuse of language, we also call this tuple of integers the modular invariants of A.
IfAis the Jacobian of a genus 2curve Cdefined over Q, then the modular
invariants of Acan be computed as follows. Let (I2:I4:I6:I10)∈P2,4,6,10(Q)be
the Igusa–Clebsch invariants of Cas defined in [Str14, §2.1]; these invariants are
also denoted by (A:B:C:D)in [Igu62] and (A′:B′:C′:D′)in [Mes91]. Then,
as a consequence of (4.2), the modular invariants of Aare
(4.5) (m4:m6:m10:m12) = 
2−2I4: 2−3(I2I4−3I6) :−2−12I10: 2−15I2I10
.
In particular, on the input of C, the modular invariants of Acan easily be computed
from the expression of I2, . . . , I 10as polynomials in the coefficients of C.
4.2. Hecke correspondences. Consider a period matrix τ∈H2attached to
a p.p. abelian surface AoverC. Then the period matrices of abelian surfaces linked
toAby an isogeny of a given type can be computed by letting certain symplectic
matrices act on τ. This precisely corresponds to analytic formulas for the action of
Hecke operators on spaces of Siegel modular forms [CG15, §10], [Kri90, Chap. VI,
§5]. The case of 1-step isogenies corresponds to the Hecke operator usually denoted
byT(ℓ), and 2-step isogenies correspond to the Hecke operator T1(ℓ2). Concretely,
we define the following collections of matrices:
(1)S(ℓ)consists of the ℓ3+ℓ2+ℓ+ 1matrices of the form
1 0a b
0 1b c
0 0ℓ0
0 0 0 ℓ
,ℓ0 0 0
−a1 0b
0 0 1 a
0 0 0 ℓ
,1 0a0
0ℓ0 0
0 0ℓ0
0 0 0 1
orℓ0 0 0
0ℓ0 0
0 0 1 0
0 0 0 1
where a, b, crun through {0, . . . , ℓ −1};12 R. VAN BOMMEL, S. CHIDAMBARAM, E. COSTA, AND J. KIEFFER
(2)S(ℓ2)consists of the ℓ4+ℓ3+ℓ2+ℓmatrices of the following form:
ℓ0 0 aℓ
−b1a ab+d
0 0ℓ bℓ
0 0 0 ℓ2
, 
1 0 d−a
0ℓ−ℓa0
0 0ℓ20
0 0 0 ℓ!
,ℓ20 0 0
−aℓ ℓ 0 0
0 0 1 a
0 0 0 ℓ
orℓ0 0 0
0ℓ20 0
0 0ℓ0
0 0 0 1
where a, brun through {0, . . . , ℓ −1}anddruns through {0, . . . , ℓ2−1};
as well as ℓ0a b
0ℓ b c
0 0ℓ0
0 0 0 ℓ
where a, b, crun through {0, . . . , ℓ −1}with the additional conditions
thatac=b2and(a, b, c )̸= (0,0,0).
Theset S(ℓ)(resp. S(ℓ2))consistsofmatricesin GSp(4,R)+withintegralcoefficients,
zero lower left block, and with the property that the determinant of their lower right
block divides ℓ2(resp. ℓ3).
Proposition 4.6. Letτ∈H2, letA=C2/(Z2⊕τZ2)be the p.p. complex abelian
surface attached to τ, and let ℓbe a prime number.
(1)The matrices γτforγ∈S(ℓ)are period matrices for the abelian sur-
faces A/Kwhere Kruns through the maximal isotropic subgroups of A[ℓ].
(2)The matrices γτforγ∈S(ℓ2)are period matrices for the abelian sur-
faces A/Kwhere Kruns through the maximal isotropic subgroups of A[ℓ2]
isomorphic to (Z/ℓZ)2×(Z/ℓ2Z).
Proof. First, we consider 1-step isogenies. Consider the subgroup Γ0(ℓ)of
Sp4(Z)defined as
Γ0(ℓ):=
a b
c d
∈Sp(4,Z) :b= 0 (mod ℓ)
.
The map
τ7→ 
C2/(Z2⊕τZ2),(Z2⊕1
ℓτZ2)/(Z2⊕τZ2)
is a bijection between Γ0(ℓ)\H2and the set of isomorphism classes of pairs (A, K),
where Ais a p.p. abelian surface over CandK⊂A[ℓ]is maximal isotropic for
the Weil pairing. (This is proved in an analogous way to [BL09, Thm. 3.2], which
uses the subgroup Γ0(ℓ)instead.) The quotient surface A/Kadmits1
ℓτas a period
matrix. The period matrices we wish to enumerate are therefore the1
ℓγτ, where γ
runs through a (finite) set of representatives of Γ0(ℓ)\Sp(4,Z).
We can rewrite these matrices using the action of GSp(4,Q)+, noting that for
allγ∈Sp(4,Z), 
Diag(1 ,1, ℓ, ℓ)γ
·τ=1
ℓ(γτ).
This leads us to the formalism of Hecke operators in terms of double cosets: we have
Γ0(ℓ) = Sp(4 ,Z)∩Diag(1 ,1, ℓ, ℓ)−1Sp(4,Z) Diag(1 ,1, ℓ, ℓ),
so the map γ7→Diag(1 ,1, ℓ, ℓ)γinduces a bijection
Γ0(ℓ)\Sp(4,Z)→Sp(4,Z)\Sp(4,Z) Diag(1 ,1, ℓ, ℓ) Sp(4 ,Z).
By [CG15, Prop. 10.1], the set S(ℓ)is a set of representatives for the coset space
on the right hand side (we acted on some representatives by elements of Sp4(Z)to
simplify them). This proves (1).
The 2-step case is similar. The reduction map Sp(4,Z)→Sp(4,Z/ℓ2Z)is
surjective (see [BL09, §3]), and we define Γ0(ℓ2)as the preimage in Sp(4,Z)ofCOMPUTING ISOGENY CLASSES OF TYPICAL P.P. ABELIAN SURFACES 13
the stabilizer of the maximal isotropic subgroup
(0, ℓ,0,0),(0,0,1,0),(0,0,0, ℓ)
in(Z/ℓ2Z)4. The map
τ7→ 
C2/(Z2⊕τZ2),(Z⊕1
ℓZ)⊕τ(1
ℓ2Z⊕1
ℓZ))/(Z2⊕τZ2)
is a bijection between Γ0(ℓ2)\H2and the set of isomorphism classes of pairs (A, K),
where Ais a p.p. abelian surface over CandK⊂A[ℓ2]is a maximal isotropic
subgroup for the Weil pairing and isomorphic to (Z/ℓZ)2×Z/ℓ2Z. A period
matrix for the quotient abelian surface A/Kis then Diag(1, ℓ, ℓ2, ℓ)τ. As above, a
reformulation in terms of double cosets will be convenient. We have
Γ0(ℓ2) = Sp(4 ,Z)∩Diag(1 , ℓ, ℓ2, ℓ)−1Sp(4,Z) Diag(1 , ℓ, ℓ2, ℓ),
so the map γ7→Diag(1 , ℓ, ℓ2, ℓ)γinduces a bijection
Γ0(ℓ2)\Sp(4,Z)→Sp(4,Z)\Sp(4,Z) Diag(1 , ℓ, ℓ2, ℓ) Sp(4 ,Z).
Combining [CG15, Prop. 10.5] with [Kri90, Chap. VI, Lem. 5.2], we find that S(ℓ2)
is exactly a set of representatives for the coset space on the right hand side. □
4.3. Rational invariants versus rational isogenies. Our algorithm will
enumerate period matrices γτusing Proposition 4.6 and evaluate the modular
forms Mkat these points. If γτcorresponds to an abelian surface A′that is
isogenous to AoverQ, then 
M4(γτ) :M6(γτ) :M10(γτ) :M12(γτ)
must be
rational as a weighted projective point, i.e. up to complex scaling with the correct
weights. In fact, the converse statement also holds.
Proposition 4.7. LetAbe a typical p.p. abelian surface over Q, letτbe a period
matrix of A, letℓbe a prime number, and let i∈ {1,2}. Then
(1)Asγruns through S(ℓi), the projective points 
M4(γτ) :···:M12(γτ)
inP4,6,10,12(C)are all distinct.
(2)Fixγ∈S(ℓi), and assume that there exists a scalar λ∈C×such that
λkMk(γτ)∈Qfor each k∈ {4,6,10,12}. Then γτis a period matrix of
a p.p. abelian surface A′, defined over Q, such that there exists an i-step
isogeny A→A′of degree ℓ2idefined over Q.
Proof. We first prove (1)by contradiction. If these projective points happen
to be equal for some γ1̸=γ2, then we have a (non-commutative) diagram
A A∨
A1 A2 A∨
2f1 f2λA
η
∼λA2f∨
2
where f1, f2are isogenies with distinct kernels, and ηis an isomorphism. Then
the compositions η◦f1◦λ−1
A◦f∨
2◦λA2andf2◦λ−1
A◦f∨
2◦λA2yield elements
ofEnd((A2)Q) =Zof the same degree ℓ2i. They must therefore be equal up to sign.
Thus η◦f1=±f2andkerf1= ker f2, a contradiction.
For(2), letKbe the subgroup of Aattached to γ. IfKis not defined over Q,
then the Galois orbit of Kconsists of several subgroups of A, and the associated
quotients have the same modular invariants, contradicting (1). Therefore Kand
the associated isogeny are defined over Q. □14 R. VAN BOMMEL, S. CHIDAMBARAM, E. COSTA, AND J. KIEFFER
4.4. Certification. By Proposition 4.7, evaluating modular invariants and
detecting when they are rational suffices to detect rational isogenies. In practice
however, we will have to manipulate these complex numbers up to some finite
precision. While rational invariants can still be detected heuristically and the
isogeny might be proved to exist by other methods, certifying the non-existence of a
rational isogeny is not immediate.
A key idea to achieve certification is to leverage the fact that we manipulate
modular forms with integral Fourier coefficients to compute algebraic integers
instead of just complex numbers. This technique is inspired from the description
of denominators for modular equations in [Kie22b], and allows us to rule out non-
rational isogenies. As a byproduct, we are also able to certify the existence of
rational isogenies using computations over Conly.
Concretely, let A, τandℓbe as in Proposition 4.7, and denote the modular
invariants of Aas defined in §4.1 by (m4, m6, m10, m12)∈Z4. Then there exists a
scalar λ∈C×, uniquely determined up to sign (but dependent on τ), such that
(4.8) λkMk(τ) =mkfor all k∈ {4,6,10,12}.
Letfbe a Siegel modular form of even weight kwith integral Fourier coefficients.
Forγ∈S(ℓi), we define
(4.9) N(f, γ):= (12 λ)k(ℓddet(γ∗τ)−1)kf(γτ).
with d= 2ifi= 1, and d= 3ifi= 2. (The central factor ℓddet(γ∗τ)−1is a power
ofℓindependent of τ.) We will show that the N(f, γ)are in fact algebraic integers.
The first step is to reinterpret the complex numbers N(f, γ)algebraically. Let ω
be a basis of ∧2Ω1(A)such that Mj(A, ω) =mjfor all j∈ {4,6,10,12}, and let K
be the subgroup of Acorresponding to γvia the correspondence of Proposition 4.6.
The subgroup Kis not necessarily defined over Q; letLbe its field of definition,
which is a number field embedded in C. Then pulling back differential forms along
the quotient isogeny A→A/Kinduces a bijection between the L-vector spaces
L⊗QΩ1(A)andΩ1(A/K). Under this bijection, ωcorresponds to an L-basis ω′
of∧2Ω1(A/K ).
Lemma 4.10. With the above notation, we have N(f, γ) = 12kf(A/K, ω′).
Proof. By [BL04, Rem. 8.1.4], for every τ′∈H2andγ∈Sp(4,Z), the map
z7→(γ∗τ′)−tzdefines an isomorphism between the abelian surfaces C2/(Z2⊕τ′Z2)
andC2/(Z2⊕(γτ′)Z2). Keeping the notation from above the lemma, we write
γ=δ2∆δ1where δ1, δ2∈Sp(4,Z)and∆is either Diag(1,1, ℓ, ℓ)orDiag(1, ℓ, ℓ2, ℓ)
depending on i. We then consider the commutative diagram
A A/K
C2/(Z2⊕τZ2) C2/(Z2⊕γτZ2)
C2/(Z2⊕δ1τZ2) C2/(Z2⊕∆δ1τZ2)η1 η2
ζ1
ξζ2
where ζ1(resp. ζ2) is the isomorphism z7→(δ∗
1τ)−tz(resp. z7→(δ∗
2(∆δ1τ))−tz),
double-tipped arrows denote natural quotient maps, η1is an isomorphism of complex
tori, and η2is another isomorphism that is determined by the choice of η1. We recall
thatω(τ)denotes the element 2πidz 1∧2πidz 2of∧2Ω1 
C2/(Z2⊕τZ2)
, where z1, z2
are the coordinates of C2. Let r∈C×be such that ω′=r η∗
2ω(γτ)as differentialCOMPUTING ISOGENY CLASSES OF TYPICAL P.P. ABELIAN SURFACES 15
forms on A/K. We have f(A/K, ω′) =r−kf(γτ). Using the bottom line of the
diagram, we find that
ω(τ) = det( δ∗
1τ)·det 
δ∗
2(∆δ1τ)
·(ζ2◦ξ◦ζ1)∗ω(γτ).
We can rewrite this equality using the following cocycle relation:
γ∗τ= (δ2∆δ1)∗τ=δ∗
2(∆δ1τ)·∆∗(δ1τ)·δ∗
1τ.
Asdet ∆∗(δ1τ) =ℓd, we have
ω(τ) =ℓ−ddet(γ∗τ)·(ζ2◦ξ◦ζ1)∗ω(γτ)
We deduce that ω=r ℓddet(γ∗τ)−1η∗
1ω(τ)as differential forms on A, and thus
λ=±r−1ℓ−ddet(γ∗τ). From (4.9), we finally obtain
N(f, γ) = 12kr−kf(γτ) = 12kf(A/K, ω′). □
Theorem 4.11. LetAbe a p.p. abelian surface defined over Q, letτ∈H2be a
period matrix of A, letℓbe a prime, and let i∈ {1,2}. For a Siegel modular form f
onH2of even weight with integral Fourier coefficients and γ∈S(ℓi)(cf. §4.2), we
define N(f, γ)as in equation (4.9). Then
(1)For each such modular form f, the set {N(f, γ) :γ∈S(ℓi)}is a Galois-
stable set of algebraic integers. Moreover, the action of Gal(Q/Q)on
this set corresponds to the Galois action on subgroups of A[ℓi]via the
correspondence of Proposition 4.6.
(2)Ifγ∈S(ℓi)corresponds to a subgroup KofAthat is defined over Q, then
 
N(M4, γ) :N(M6, γ) :N(M10, γ) :N(M12, γ)
∈P4,6,10,12(Q)
are the modular invariants of the quotient A/Kin the sense of §4.1.
Proof. By Lemma 4.10, the complex numbers N(f, γ)are in fact algebraic,
form a Galois-stable set, and the action of Gal(Q/Q)on them corresponds to the
Galois action on subgroups of A. We now show that the N(f, γ)are algebraic
integers. To this end, we construct the monic polynomial
P(X) =Y
γ∈S(ℓi) 
X−N(f, γ)
.
Letn=deg(P) = # S(ℓi). Expanding the product, we observe as in [Kie22b, Prop.
2.4] that for each 0≤j≤n, the coefficient of Xn−jinPtakes the form
(12λ)kj·gj(τ),
where gjis a Siegel modular form of weight kjwith integral Fourier coefficients. By
Proposition 4.3, the modular form 12kjgjis an element of Z[M4, M6, M10, M12]of
weight kj. Therefore
(12λ)kjgj(τ)∈Z[m4, m6, m10, m12] =Z.
Thus Phas integral coefficients, which concludes the proof of (1).
Item(2)is a direct consequence of Lemma 4.10: we showed the existence of a
basis ωof the Q-vector space ∧2Ω1(A/K)such that N(Mk, γ) = 12kMk(A/K, ω )
for all k∈ {4,6,10,12}, and absorbing the scalar factors 12kdoes not modify the
projective point. □16 R. VAN BOMMEL, S. CHIDAMBARAM, E. COSTA, AND J. KIEFFER
4.5. Outline of the algorithm. The theoretical background being set, we
describe the concrete computations over Cthat we perform to list the rational 1- or
2-step isogenies from a given typical p.p. abelian surface AoverQ. We take the
modular invariants of Aas input. If Ais given as the Jacobian of a genus 2curve C
overQas in Algorithm 2.5, then its modular invariants can be determined by
polynomial formulas in terms of the coefficients of C, as explained in §4.1. Similarly,
the output will consists of modular invariants of isogenous abelian surfaces: we refer
to Section 5 for the subsequent reconstruction of genus 2curve equations.
In the whole algorithm, we use interval arithmetic to keep track of precision
losses: each complex number is encoded as a ball that provably contains the exact
value. Of course, we need to assume more than mere correctness of the underlying
arithmetic for our algorithms to work, as we will not get far if every operation
returns the whole of C. A minimal assumption in this subsection is that any given
computation with exact input will output a complex ball whose radius tends to
zero as its working precision tends to infinity. This will ensure that our algorithms
terminate. In fact, we have a precise control on the precision losses incurred during
the computations: we postpone this discussion to the complexity analysis in §4.6.
There are two main stages in the algorithm. First, we use low-precision compu-
tations to filter out symplectic matrices γ∈S(ℓ)orS(ℓ2)whose associated N(f, γ),
seen as a ball, does not contain any rational integer. By Theorem 4.11, these matri-
cesγdo not correspond to rational isogenies with domain A. One expects that all
remaining subgroups correspond to rational isogenies. Second, we use high-precision
computations to either certify or disprove that the remaining subgroups are defined
overQ. We will use two black boxes, namely the computation of a period matrix
from modular invariants and the evaluation the Siegel modular forms Mkat a point
ofHg; we also refer to §4.6 for a discussion of these steps. In the first stage, we
proceed as follows.
Algorithm 4.12. Input:
•the modular invariants m4, m6, m10, m12of a p.p. abelian surface AoverQ,
•a prime ℓ, and i∈ {1,2}indicating either 1-step or 2-step isogenies.
Output:
•a period matrix τofA(to low precision),
•a list Lof symplectic matrices that provably contains all γ∈S(ℓi)associ-
ated with a rational subgroup of A[ℓi]for this choice of τ,
•for each γ∈Landk∈ {4,6,10,12}, a candidate value m′
k(γ)∈Zfor the
algebraic integer N(Mk, γ)satisfying |N(Mk, γ)−m′
k(γ)| ≤2−10;
•for each γ /∈Landk∈ {4,6,10,12}, a ball containing N(Mk, γ)of radius
at most 2−10.
Step 1. Compute a low-precision approximation of a period matrix τofA, see
Theorem 4.17.
Step 2. Evaluate the modular forms M4, . . . , M 12atτ, and deduce an approxima-
tion of the scaling factor λas defined in §4.4.
Step 3. For each γ∈S(ℓi)and each k∈ {4,6,10,12}, evaluate N(Mk, γ). If
the radius of one of these approximations is larger than 2−10, double the
working precision and restart.
Step 4. LetLbe the list of all γsuch that each of the balls N(Mk, γ)fork∈
{4,6,10,12}contains an integer m′
k(γ), and return the output listed above.COMPUTING ISOGENY CLASSES OF TYPICAL P.P. ABELIAN SURFACES 17
At the end of Algorithm 4.12, for each γ∈L, the integers m′
k(γ)are the only
possible values for the modular invariants of the isogenous abelian surface if it is
indeed defined over Q. One could stop here and certify the existence of an isogeny
by other methods. In order to certify that these likely isogenies indeed exist using
computations over Conly, we proceed as follows.
Lemma 4.13. Keep the notation of Algorithm 4.12. Let k∈ {4,6,10,12}, let
m∈Z, and let S0⊂S(ℓi)be a nonempty subset such that |N(Mk, γ)−m| ≤1for
allγ∈S0, and N(Mk, γ)̸=mfor all γ∈S(ℓi)\S0. Let
B=Y
γ∈S(ℓi)\S0|N(Mk, γ)−m|.
Then for each γ∈S0, the inequality |N(Mk, γ)−m|<1
Bholds if and only if
N(Mk, γ) =m.
Proof. LetS1⊂S0be the subset of matrices γsuch that the equality
N(Mk, γ) =mholds, and consider the polynomial
P=Y
γ∈S(ℓi) 
X−N(Mk, γ) +m
∈Z[X],by Theorem 4.11 .
The coefficient of XjinPis zero for 0≤j≤#S1−1, and the coefficient of X#S1
is, up to sign,
Y
γ∈S(ℓi)\S0 
N(Mk, γ)−m
·Y
γ∈S0\S1 
N(Mk, γ)−m
.
By construction, this integer is nonzero, hence at least 1in absolute value. Thus,
for every γ∈S0\S1, we have as claimed
|N(Mk, γ)−m| ≥1
B. □
Algorithm 4.14. Input:the input and output of Algorithm 4.12.
Output: the modular invariants of all the p.p. abelian surfaces linked to Aby an
i-step ℓ-isogeny, as a list of integer-valued tuples (m′
4, m′
6, m′
10, m′
12).
Step 1. For each γ0∈Landk∈ {4,6,10,12}, let S0⊂Lto be the set of all
matrices γsuch that m′
k(γ) =m′
k(γ0), and compute a low-precision upper
bound for the quantity Bas in Lemma 4.13. Let B0be their maximum
value ranging over all γ0andk.
Step 2. Choose a higher working precision (more on this below). Recompute the
period matrix τ, as well as N(Mk, γ)for each γ∈Landk∈ {4,6,10,12}.
Step 3. For each γ∈Landk∈ {4,6,10,12}, check whether N(Mk, γ)still contains
the candidate value m′
k(γ). If not, remove γfrom L. If yes, check whether
the inequality
|N(Mk, γ)−m′
k(γ)|<1
B0
holds; if this cannot be decided, double the working precision and go back
to Step 2.
Step 4. Output the list of tuples (m′
4(γ), . . . , m′
12(γ))for the remaining γ∈L.
As soon as all the radii of the balls containing N(Mk, γ)are less than1
2B0, there
will be no further doubling of the working precision in Step 3, thus Algorithm 4.14
terminates. Lemma 4.13 guarantees that the algorithm is correct.18 R. VAN BOMMEL, S. CHIDAMBARAM, E. COSTA, AND J. KIEFFER
Remark 4.15. In practice, increasing the working precision by pbits results in
output intervals whose radius is multiplied by roughly 2−p. Therefore a good guess
for the choice of high precision in Step 2 of Algorithm 4.14 is to add ⌈log2(B0)⌉bits
to the current working precision at the end of Algorithm 4.12. We then expect that
no further precision increases are needed in Step 3.
4.6. Implementation details and complexity analysis. We conclude this
section with a complexity analysis of the isogeny algorithm in terms of ℓ,iand the
height of the integers mkfork∈ {4,6,10,12}. First, we give an asymptotic upper
bound on the absolute values |N(Mk, γ)|: this will specify the necessary working
precisions in Algorithms 4.12 and 4.14. Then, we review previous works on the
computation of period matrices and the evaluation of modular forms in quasi-linear
time in terms of the required precision, filling in the two black boxes of §4.5.
We may fix a compact subset G ⊂H2∪ {∞}, where ∞denotes the cusp at
infinity, such that the period matrix τin Step 1 of Algorithm 4.12 always belongs
toG. For instance, we can take Gto be the set of points at a distance at most 2−10
from the Siegel fundamental domain F(see [Str14, §6.2]), plus the point ∞. Recall
that the modular forms Mkare bounded in a neighborhood of ∞, never vanish
simultaneously on H2, and that M4andM6take the value 1at∞. Thus there exist
two absolute constants 0< C 1< C 2<+∞such that Mk≤C2uniformly on Gfor
each k∈ {4,6,10,12}, and max
|Mk(τ)|:k∈ {4,6,10,12}	
≥C1for each τ∈ G.
Lemma 4.16. In Algorithm 4.12, assume that τ∈ G, and let
h= log max {|m4|, . . . ,|m12|}.
Then in Step 2 of that algorithm, we have log|λ|=O(h). In Step 3, we have
log|N(Mk, γ)|=O(h+logℓ)for each γ∈S(ℓi)andk∈ {4,6,10,12}. Both implied
constants are absolute.
Proof. For the first part, we have log|λ| ≤1
4(h−logC1). For the second part,
we need to estimate |Mk(γτ)|. The matrix γτ∈H2will not usually belong to G, but
its imaginary part is nevertheless “bounded below”: if a, b,0, ddenote the 2×2blocks
ofγ, we have Im(γτ) =aIm(τ)d−1, sodet Im (γτ)≥C3/ℓ2where C3is an absolute
constant. Let now η∈Sp(4,Z)be such that ηγτ∈ G, and let r=det(η∗(γτ)).
Then by [Kli90, Proof of Prop. 1.1], we have
det(Im( ηγτ)) =|r|−2det(Im( γτ))
so|r|−2≤C4ℓ2, where C4is an absolute constant. Finally we have
log|Mk(γτ)|= log|r−kMk(ηγτ)|=O(logℓ)
where the implied constant is absolute. □
With these estimates in hand, we focus on the two key computations left
aside in §4.5. From the data of modular invariants in Z, a corresponding period
matrix τ∈ Fcan be efficiently computed using arithmetic-geometric means, an
algorithm described in [Dup06, Chap. 9] and proved correct in [Kie22a]. (In the
first low-precision step, we could also use numerical integration [MN19], but the
dependency of this algorithm on hhas not been made explicit.)
Theorem 4.17 ([Kie22b, §4.1]) .There exists an algorithm which, given the modular
invariants m4, . . . , m 12∈Zof a typical p.p. abelian surface AoverQandp≥1,COMPUTING ISOGENY CLASSES OF TYPICAL P.P. ABELIAN SURFACES 19
computes an approximation of a period matrix τ∈ FofAup to an error of 2−pwithin
a running time of eO(p+h)binary operations, where h=log max {|m4|, . . . ,|m12|}.
In order to evaluate the modular forms Mkat a point γτ∈H2, we compute
a matrix η∈Sp(4,Z)such that ηγτis close to the fundamental domain Fand
evaluate Mk(ηγτ). The latter can be rewritten as polynomials in terms of theta
constants at ηγτ: see [Str14, §7.1] for explicit formulas. Following [Kie22b, §4.3],
we can control the cost of the reduction step in terms of the quantity
Λ(γτ) = log max {2,|γτ|,det(Im( γτ))−1},
where |γτ|denotes the largest absolute value of an entry of γτ. As a consequence
of [Str14, Cor. 7.8], we have |τ|=O(h), soΛ(γτ) =O(logh+logℓ)where the
implied constant is absolute. After the reduction step, the evaluation of theta
constants on Fcan be done in uniform quasi-linear time using arithmetic-geometric
means and Newton’s method. The following result summarizes this approach.
Theorem 4.18 ([Kie22b, §4.3]) .There exists an algorithm and an absolute con-
stant C5such that the following holds. Let τ∈H2andp≥1. Then, given an approx-
imation of τto precision p+C5Λ(τ), the algorithm computes a matrix γ∈Sp(4,Z)
such that log|γ|=O(Λ(τ)), a matrix τ′∈ Fsuch that |τ′−γτ| ≤2−p, and an
approximation of the squares of theta constants at γτup to an error of 2−p. Its
running time is eO(Λ(τ)2+p)binary operations.
We can now prove the complexity bound stated at the beginning of Section 4.
Corollary 4.19. LetAbe a typical p.p. abelian surface over Qwith modular
invariants m4, . . . , m 12, and let h=log max {|m4|, . . . ,|m12|}. Let ℓbe a prime,
leti∈ {1,2}, and let nbe the size of the list Lreturned by Algorithm 4.12 on this
input. Then one can run Algorithms 4.12 and 4.14 to detect i-step ℓ-isogenies with
domain Ausing a total of eO 
(n+ 1)ℓdh
binary operations, where d= 3when i= 1
andd= 4when i= 2.
Proof. By Lemma 4.16, in Step 3 of Algorithm 4.12, we must evaluate Mk(γτ)
toO(h+logℓ)bits of precision for each γ∈S(ℓi). By Theorems 4.17 and 4.18,
this can be done within eO(ℓdh)binary operations, as #S(ℓi) =O(ℓd). Similarly, in
Algorithm 4.14, we have log|B0|=O(ℓd(h+logℓ)), so we need to evaluate Mk(γτ)
toO 
ℓd(h+logℓ)
bits of precision for each γ∈L. This can be done in eO(nℓdh)
binary operations. □
5. Reconstructing genus 2 curves
5.1. Mestre’s algorithm. Given a quadruple of Igusa–Clebsch invariants
I= (I2:I4:I6:I10)overQ, there always exists a genus 2 curve over Qhaving
these invariants, but it cannot always be defined over Q. This phenomenon is
known as Mestre’s obstruction. Given I, Mestre [Mes91] constructs a conic L
overQtogether with an effective divisor Dof degree 6 on this conic with the
following properties. If L(Q)̸=∅and hence L∼=P1, then there exists a genus 2
curve over Qwith invariants Iwhose Weierstrass points correspond to the points
inD. IfL(Q) =∅, there is no genus 2 curve over Qhaving these invariants. This
reconstruction algorithm has been implemented in many computer algebra systems
and the reader is referred to [Mes91] for more details about the method.20 R. VAN BOMMEL, S. CHIDAMBARAM, E. COSTA, AND J. KIEFFER
In our setting, Mestre’s obstruction does not arise, and L(Q)is always non-
empty. Indeed, by Proposition 4.7, we only manipulate typical p.p. abelian surfaces
defined over Q. By [Lau01, Appendix, Thm. 4], these surfaces all are Jacobians of
genus 2 curves defined over Q.
Mestre’s algorithm usually produces curves with very large coefficients. Their
sizes can be reduced by applying [SC03], which has been implemented in [PARI/GP]
and [Magma]. Note that even this reduced model is not necessarily unique.
5.2. Identifying the correct twists. Having constructed a curve C′overQ
from the invariants output by Algorithm 4.14, we have no guarantee yet that Jac(C)
will be isogenous to Jac(C′)overQ: we can only say that Jac(C′)is a twist of the
abelian surface isogenous to Jac(C). Since End(Jac(C′)Q) =Z, the only possible
twists of Jac(C′)are quadratic twists, and correspond to quadratic twists of the
curve C′itself. Therefore, there will be a unique twist C′′ofC′(up to isomorphism
overQ) such that Jac(C)is isogenous to Jac(C′′).
We use the following method to find C′′. For a genus 2 curve Cand a prime of
good reduction ℓofJac(C), we denote by aℓ(C)∈Zthe trace of Frobenius on the
reduction on Jac(C)modulo ℓ.
Algorithm 5.1. Input:curves CandC′of genus 2 over Qwith typical Jacobians,
such that some twist of Jac(C′)is isogenous to Jac(C).
Output: the unique twist C′′ofC′such that Jac(C)is isogenous to Jac(C′′).
Step 1. Compute a set Bof primes containing the bad primes of CandC′. Let
G=⟨−1⟩ × ⟨b:b∈ B⟩ ⊂ Q∗/Q∗2.
Step 2. Find auxiliary primes ℓ1, . . . , ℓ ksuch that the Frobenius traces aℓi(C)are
nonzero and the map
µ:G→ {± 1}k, x7→x
ℓi
1≤i≤k
is injective.
Step 3. Identify the unique element g∈Gfor which the twist C′′ofC′byg
satisfies aℓi(C′′) =aℓi(C)for every 1≤i≤k, and return C′′.
Proposition 5.2. Algorithm 5.1 terminates and is correct.
Proof. First, we will prove the existence of the auxiliary primes ℓ1, . . . , ℓ k. By
[CDSS17, Theorem 1] and the fact that Jac(C)is typical, the equality aℓ(C) = 0
holds only for a density 0 subset of primes. Write B ∪ {− 1}={b1, . . . , b k}. For
each 1≤i≤k, by quadratic reciprocity, we can find congruence conditions on ℓ
guaranteeing that bi
ℓ
=−1and bj
ℓ
= 1for each j̸=i. By Dirichlet’s prime
number theorem and the fact that only a density 0 subset of the primes are excluded,
there exists a prime ℓi(in fact infinitely many) satisfying these congruence conditions
and such that aℓi(C)̸= 0. With this choice of ℓ1, . . . , ℓ k, the map µis injective.
Next, we recall the Néron–Ogg–Shafarevich criterion [ST68]: an abelian sur-
faceAhas good reduction at a prime pif and only if for all primes ℓ̸=p, the Galois
representation Tℓ(A)is unramified at p. Hence, if Ahas good reduction at pandA′
is the quadratic twist of Aby a squarefree integer Ddivisible by p, then A′has bad
reduction at p. Indeed, the Galois representation Tℓ(A′)is obtained from Tℓ(A)by
tensoring with the quadratic character associated with Q(√
D), which is ramifiedCOMPUTING ISOGENY CLASSES OF TYPICAL P.P. ABELIAN SURFACES 21
atp. On the other hand, any abelian surface isogenous to Amust have the same
primes of bad reduction.
As a consequence, the correct twist Jac(C′′)ofJac(C′)is given by a squarefree
integer Dthat can only be divisible by primes of bad reduction of Jac(C)orJac(C′).
These form a subset of B, so the correct twist is among those enumerated by G.
By the choice of the auxiliary primes ℓ1, . . . , ℓ k, the tuples of Frobenius traces
(aℓ1, . . . , a ℓk)take distinct values for all the twists enumerated by G, so there is a
unique output in Step 3. □
Algorithm 5.1 has an exponential complexity in terms of the number of bad
primes of CandC′, but this number is small in practice.
Remark 5.3. In the case of elliptic curves, an analogue of Algorithm 5.1 would not
be needed. Indeed, if Eis an elliptic curve over Qwith automorphism group {±1},
then the modular invariants of EinP4,6(Q)determine the Q-isomorphism class
ofE, as twisting Ebydmultiplies its invariants by d2andd3. Thus we would
obtain the correct twist as a direct result of the computations over C.
In genus 2however, quadratic twists have the same modular invariants: this
comes from the fact that twisting an abelian surface Abyd∈Q×acts on Ω1(A)
asDiag(√
d,√
d), hence on ∧2Ω1(A)as multiplication by d, which is a rational
number. Nevertheless, one would still be able to compute the correct twist directly
(and thus circumvent Algorithm 5.1) by considering vector-valued Siegel modular
forms, or equivalently by keeping track of big period matrices. This goes beyond
the scope of this paper, and Algorithm 5.1 was sufficient for our experiments.
6. Examples
We now give explicit illustrations of the methods developed above. First, we
discuss an example of a 1-step 31-isogeny; then, we report on the results of running
our algorithm on a large dataset of Jacobians of genus 2 curves that includes the
current LMFDB data [LMFDB]. The prime ℓ= 31is the largest prime for which
the Galois representation on A[ℓ]is not surjective among all the abelian surfaces A
in this dataset [BBKKMSV23].
All computations were ran on a server with an AMD EPYC 7713 2GHz CPU
and Sage 9.7 [Sage], Magma 2.28-2 [Magma], GP/PARI 2.15.0 [PARI/GP], and
pydhme v0.0.6 installed.3
6.1. A 1-step 31-isogeny. Consider the hyperelliptic curve
C:y2+ (x+ 1)y=x5+ 23x4−48x3+ 85x2−69x+ 45.
The conductor of Jac(C)is72·312. Combining this with the study of local Euler
factors at p∈ {3,5,11}, we see that L1=∅andL2⊆ {31}in the notation of §3.
The Igusa–Clebsch invariants (I2:I4:I6:I10)ofCinP2,4,6,10(Q)are
(−324608 : 7340502400 : −589129410429504 : 5306537926135312384) ,
from which we can deduce that Jac(C)has the following modular invariants:
(m4, m6, m10, m12) = (1909600 ,2582145496 ,45252529 ,−59231181184) .
3A Sage interface for [Kie23] is available at https://github.com/edgarcosta/pyhdme/ .22 R. VAN BOMMEL, S. CHIDAMBARAM, E. COSTA, AND J. KIEFFER
We apply Algorithm 4.12 with ℓ= 31andi= 1. After computing a period matrix
τ≈1.69708 i 0.31188 + 0 .84854 i
0.31188 + 0 .84854 i−0.18812 + 2 .09922 i
in the Siegel fundamental domain with 300 bits of precision, we conclude that there
is a unique coset representative
γ=
1 0 0 7
0 1 7 23
0 0 31 0
0 0 0 31
∈S(31)
such that N(M4, γ)contains an integer. Indeed, we have
|N(M4, γ)−α2·318972640 |<7.8×10−47
|N(M6, γ)−α3·1225361851336 |<5.5×10−39
|N(M10, γ)−α5·10241530643525839 |<1.6×10−29
|N(M12, γ) +α6·307105165233242232724 |<4.6×10−22
where α= 22·32·31. We then employ Algorithm 4.14, working with 4128800 bits
of precision, to certify that an abelian surface with projective invariants
(318972640 ,1225361851336 ,10241530643525839 ,−307105165233242232724)
is indeed isogenous to Jac(C)via a 1-step 31-isogeny.
Mestre’s algorithm and a reduction step (§5.1) yield the hyperelliptic curve
y2=−1624248 x6+5412412 x5−6032781 x4+876836 x3−1229044 x2−5289572 x−1087304 .
Applying Algorithm 5.1 we learn that the desired curve C′′is the quadratic twist of
this hyperelliptic curve by −83761, and is given by the equation
y2+xy=−x5+ 2573 x4+ 92187 x3+ 2161654285 x2+ 406259311249 x+ 93951289752862
with discriminant 72·313·8376112.
The overall computation took 175 minutes of CPU time and used 6.5 gigabytes
of ram, of which roughly 90% is spent certifying the existence of an isogeny between
these two curves, i.e. in Algorithm 4.14.
Given CandC′′, wecanalsoindependentlyproduceacertificatefortheexistence
of an isogeny of the correct degree [CMSV19]. It took about 6.5 CPU hours to
produce the 2.8 megabyte certificate.
6.2. LMFDB and beyond. We now report on the application of our algo-
rithms to a dataset of 1743737 genus 2 curves with trivial geometric endomorphism
algebra. These are all the typical abelian surfaces in a dataset of approximately
5 million curves with conductor up to 220provided to us by Andrew Sutherland
[Sut22]. This dataset expands the current set of genus 2 curves in the L-functions
and modular forms database (LMFDB) [LMFDB].
The 1743737 curves are split among 1440894 isogeny classes, while the LMFDB
subset contains 63107 curves split among 62600 isogeny classes. These isogeny
classes have been identified using Frobenius traces only [BSSVY16, §4.3], a heuristic
method whose results are confirmed by our computations.
We have applied our algorithms to one curve per isogeny class and found 600948
new curves in total. Table 1 lists the degrees of the irreducible isogenies that we
found (in other words we ignore 2-step isogenies arising as the composition of twoCOMPUTING ISOGENY CLASSES OF TYPICAL P.P. ABELIAN SURFACES 23
rational 1-step isogenies), and Table 2 shows the sizes of the 1440894 isogeny classes.
Most of the large classes only feature Richelot isogenies, i.e. 1-step 2-isogenies. In
total, however, only 242442 of the 600948 new curves can be reached from the
original dataset via Richelot isogenies.
dNumber of isogenies
of degree ddNumber of isogenies
of degree d
22419157 74246
24693519 1149
3211568 13220
3429742 1349
52415 1724
542440 3121
72154
Table 1. Number of isogenies of each degree in the extended dataset.
kNumber of isogeny
classes of size kkNumber of isogeny
classes of size k
1 1032456 12 52
2 116847 14 102
3 197253 16 1555
4 54543 18 706
5 15547 20 120
6 14323 22 99
7 430 24 6
8 5594 28 4
9 35 30 8
10 1214
Table 2. Distribution of isogeny class sizes in the extended dataset.
Remark 6.1. It is worth noting that 195806 of the 197253 isogeny classes of
size3and 15523 of the 15547 isogeny classes of size 5are only made up of 2-step
2-isogenies, of degree 16. The isogeny graphs in these two cases are a triangle △
and a bowtie ▷ ◁respectively. Moreover, there is no isogeny class of size 2made of a
single 2-step 2-isogeny.
These observations can be explained as follows: the existence of a 2-step
2-isogeny φ1:A1→A2always implies the existence of a triangle consisting of
three 2-step 2-isogenies. Indeed, assume that kerfis generated by e1,2e2,2f2,
where (e1, e2, f1, f2)is a symplectic basis of A1[4]. Then the subgroup generated
bye1+ 2f1,2e2,2f2is another rational maximal isotropic subgroup of A1[4], and
gives rise to an isogeny φ2:A1→A3. Furthermore, one can show that there exists
another 2-step 2-isogeny φ3:A2→A3such that φ2◦[2] = φ3◦φ1.
The whole computation took 111 days of CPU time and used 215 megabytes of
RAM on average per class. Only 30 classes taking more than 10 minutes. In these24 R. VAN BOMMEL, S. CHIDAMBARAM, E. COSTA, AND J. KIEFFER
29 cases, we had to search for and potentially certify isogenies of large degree. For
6 of the classes, it took on average 18 minutes to prove the nonexistence of 1 and
2-step 29-isogenies; one of them has LMFDB label 976.a, and contains a Jacobian
with a 29-torsion point. The remainder correspond to 23 = 9 + 9 + 4 + 1 isogeny
classes consisting of exactly two abelian surfaces linked by isogenies of degrees 114,
134,172, and 312respectively, as listed in Table 1. The only class that took more
than 1.5 hours is the example discussed in §6.1, featuring the isogeny of degree 312.
The largest degree of an irreducible isogeny was 134. For example, the class
349.a has two abelian surfaces connected by such an isogeny, namely the Jacobians
of the two curves
349.a.349.1:y2+ (x3+x2+x+ 1)y=−x3−x2
C:y2+y=x5−363x4−2517x3+ 151106 x2+ 487525 x−16355862 .
Table 3 continues our zoological study of isogeny graphs by listing all graphs on
at most four vertices that we observed. We label an edge by ℓ(resp. ℓ2) when it
corresponds to a 1-step (resp. 2-step) ℓ-isogeny.
nforn∈ {2,3,5,7,13,17,31,9,25,49,121,169}
n nforn∈ {3,5,7,9}
4
44
n n nforn∈ {3,5}
nn
m m for(m, n)∈ {(2,3),2,5),(2,9),(2,25),
(3,3),(5,9),(9,25)}
n
n nforn∈ {2,3}
Table 3. Observed isogeny graphs with 2 to 4 vertices.
The 1440894 isogeny classes represent 71 non-isomorphic graphs, the largest
having size 30 (see https://github.com/edgarcosta/genus2isogenies/tree/m
ain/data/graphs_2e20 ). In every class containing 18 or more abelian surfaces, the
only irreducible isogenies are Richelot isogenies.REFERENCES 25
Despite the size of our dataset, this list of graphs is not complete. The following
curve, suggested by Noam Elkies, gives rise to an isogeny graph consisting of 42
vertices connected by Richelot isogenies:
y2= (x+ 4)( x+ 11)(4 x−1)(12 x+ 13)(15 x−4).
Thiscurvehasconductor 224·33·52·72·13·172anddiscriminant 240·318·56·76·134·174.
Its isogeny graph is displayed in Figure 1.
Figure 1. Isogeny graph with 42 vertices.
6.3. Sanity checks. Running such a large scale computation allows us to
perform several sanity checks regarding the correctness of our implementation. For
each isogeny found, we heuristically confirmed that the Jacobians were isogenous in
two ways. First, we confirmed that all the traces of Frobenius agree for all primes up
to216, using [smalljac], that do not divide the discriminants of the curves involved.
Second, independent analytic computations based on [CMSV19] have confirmed the
isogeny degrees that we computed.
Regarding completeness of the isogeny classes, we ran two checks. As indicated
above, we started from only one curve in each of the 1440894 (heuristic) isogeny
classes in our dataset, and we checked that all the other curves in that class indeed
appeared in our result. We also confirmed that our isogeny classes are closed under
Richelot isogenies, using the function RichelotIsogenousSurfaces in [Magma]
based on algebraic formulas specific to this case.
References
[BBKKMSV23] Barinder S. Banwait, Armand Brumer, Hyun Jong Kim, Zev
Klagsbrun, Jacob Mayle, Padmavathi Srinivasan, and Isabel Vogt.
“Computing non-surjective primes associated to Galois represen-
tations of genus 2curves.” 2023 ( ↑6, 7, 8, 21).26 REFERENCES
[BL04] C. Birkenhake and H. Lange. “Complex abelian varieties.” Second.
Springer, 2004 ( ↑14).
[BSSVY16] Andrew R. Booker, Jeroen Sijsling, Andrew V. Sutherland, John
Voight, and Dan Yasaki. “A database of genus-2 curves over the
rational numbers.” In: LMS J. Comput. Math. 19 (2016), pp. 235–
254 (↑22).
[Magma] Wieb Bosma, John Cannon, and Catherine Playoust. “The Magma
algebra system. I. The user language.” In: J. Symbolic Comput.
24.3-4 (1997). Computational algebra and number theory (London,
1993), pp. 235–265 ( ↑20, 21, 25).
[BL09] Reinier Bröker and Kristin Lauter. “Modular polynomials for
genus 2.” In: LMS J. Comput. Math. 12 (2009), pp. 326–339 ( ↑9,
12).
[BK94] Armand Brumer and Kenneth Kramer. “The conductor of an
abelian variety.” In: Compositio Math. 92.2 (1994), pp. 227–248
(↑5).
[CL21] Garen Chiloyan and Álvaro Lozano-Robledo. “A classification of
isogeny-torsion graphs of Q-isogeny classes of elliptic curves.” In:
Trans. London Math. Soc. 8.1 (2021), pp. 1–34 ( ↑1).
[CG15] Fabien Cléry and Gerard van der Geer. “Constructing vector-
valued Siegel modular forms from scalar-valued Siegel modular
forms.” In: Pure Appl. Math. Q. 11.1 (2015), pp. 21–47 ( ↑11, 12,
13).
[CDSS17] Alina Carmen Cojocaru, Rachel Davis, Alice Silverberg, and
Katherine E. Stange. “Arithmetic properties of the Frobenius
traces defined by a rational abelian variety (with two appen-
dices by J-P. Serre).” In: Int. Math. Res. Not. IMRN 12 (2017),
pp. 3557–3602 ( ↑20).
[CMSV19] Edgar Costa, Nicolas Mascot, Jeroen Sijsling, and John Voight.
“Rigorous computation of the endomorphism ring of a Jacobian.”
In:Math. Comp. 88.317 (2019), pp. 1303–1339 ( ↑22, 25).
[CE15] Jean-Marc Couveignes and Tony Ezome. “Computing functions
on Jacobians and their quotients.” In: LMS J. Comput. Math. 18.1
(2015), pp. 555–577 ( ↑9).
[CW05] John E. Cremona and Mark Watkins. “Computing isogenies of
elliptic curves.” 2005 ( ↑1).
[Die02] Luis V. Dieulefait. “Explicit determination of the images of the
Galois representations attached to abelian surfaces with End (A) =
Z.” In:Experimental Mathematics 11.4 (2002), pp. 503–512 ( ↑2,
6).
[Dup06] Régis Dupont. “Moyenne arithmético-géométrique, suites de Bor-
chardt et applications.” PhD thesis. École Polytechnique. 2006
(↑18).
[EGM] Bas Edixhoven, Gerard van der Geer, and Ben Moonen. “Abelian
varieties.” Unpublished book ( ↑3).
[Elk98] Noam D. Elkies. “Elliptic and modular curves over finite fields
and related computational issues.” In: Computational perspectivesREFERENCES 27
on number theory (Chicago, IL, 1995) . Vol. 7. AMS/IP Stud. Adv.
Math. Amer. Math. Soc., Providence, RI, 1998, pp. 21–76 ( ↑1).
[Fal83] Gerd Faltings. “Endlichkeitssätze für abelsche Varietäten über
Zahlkörpern.” In: Invent. Math. 73.3 (1983), pp. 349–366 ( ↑1).
[FC90] Gerd Faltings and Ching-Li Chai. “Degeneration of abelian va-
rieties.” With an appendix by David Mumford. Springer-Verlag,
Berlin, 1990 ( ↑11).
[Gee08] Gerard van der Geer. “Siegel modular forms and their applica-
tions.” In: The 1-2-3 of modular forms . Universitext. Springer,
Berlin, 2008, pp. 181–245 ( ↑10).
[GRR72] A. Grothendieck, M. Raynaud, and D. S. Rim. “Groupes de mon-
odromie en géométrie algébrique. I.” In: Séminaire de Géométrie
Algébrique du Bois-Marie 1967–1969 (SGA 7 I). Springer-Verlag,
Berlin-New York, 1972 ( ↑6, 7).
[Igu62] Jun-ichi Igusa. “On Siegel modular forms of genus two.” In: Amer.
J. Math. 84 (1962), pp. 175–200 ( ↑10, 11).
[Igu79] Jun-ichi Igusa. “On the ring of modular forms of degree two over
Z.” In:Amer. J. Math. 101.1 (1979), pp. 149–183 ( ↑11).
[Joh17] Fredrik Johansson. “Arb: efficient arbitrary-precision midpoint-
radius interval arithmetic.” In: IEEE Trans. Comput. 66.8 (2017).
https://arblib.org/ , pp. 1281–1292 ( ↑2).
[smalljac] Kiran S. Kedlaya and Andrew V. Sutherland. “Computing L-series
of hyperelliptic curves.” In: Algorithmic number theory . Vol. 5011.
Lecture Notes in Comput. Sci. Springer, Berlin, 2008, pp. 312–326
(↑25).
[Ken82] M. A. Kenku. “On the number of Q-isomorphism classes of elliptic
curves in each Q-isogeny class.” In: J. Number Theory 15.2 (1982),
pp. 199–202 ( ↑1).
[Kie22a] J.Kieffer.“SignchoicesintheAGMforgenustwothetaconstants.”
In:Pub. Math. Besançon (2022), pp. 37–58 ( ↑18).
[Kie22b] Jean Kieffer. “Evaluating modular equations for abelian surfaces.”
2022 ( ↑9, 11, 14, 15, 18, 19).
[Kie23] Jean Kieffer. “HDME: a C library for the evaluation of higher-
dimensional modular equations.” https://github.com/j-kieff
er/hdme. 2023 ( ↑2, 21).
[Kli90] H Klingen. “Introductory lectures on Siegel modular forms.” Cam-
bridge University Press, 1990 ( ↑18).
[Kri90] Aloys Krieg. “Hecke algebras.” In: Mem. Amer. Math. Soc. 87.435
(1990) ( ↑11, 13).
[LV14] Eric Larson and Dmitry Vaintrob. “Determinants of subquotients
of Galois representations associated with abelian varieties.” In:
J. Inst. Math. Jussieu 13.3 (2014). With an appendix by Brian
Conrad, pp. 517–559 ( ↑7).
[Lau01] Kristin Lauter. “Geometric methods for improving the upper
bounds on the number of rational points on algebraic curves over
finite fields.” In: J. Algebraic Geom. 10.1 (2001). With an appendix
in French by J.-P. Serre, pp. 19–36 ( ↑5, 20).28 REFERENCES
[LMFDB] The LMFDB Collaboration. “The L-functions and modular forms
database.” http://www.lmfdb.org . 2022 ( ↑1, 2, 21, 22).
[LR23] David Lubicz and Damien Robert. “Fast change of level and
applications to isogenies.” In: Res. Number Theory 9.1 (2023),
Paper No. 7, 28 ( ↑9).
[Maz78] B. Mazur. “Rational isogenies of prime degree (with an appendix
by D. Goldfeld).” In: Invent. Math. 44.2 (1978), pp. 129–162 ( ↑1).
[Mes91] Jean-François Mestre. “Construction de courbes de genre 2à partir
de leurs modules.” In: Effective methods in algebraic geometry
(Castiglioncello, 1990) . Vol. 94. Progr. Math. Birkhäuser Boston,
1991, pp. 313–334 ( ↑11, 19).
[Mil15a] Enea Milio. “A quasi-linear time algorithm for computing modular
polynomials in dimension 2.” In: LMS J. Comput. Math. 18.1
(2015), pp. 603–632 ( ↑2, 9).
[Mil15b] Enea Milio. “Modular polynomials.” https://members.loria.fr
/EMilio/modular-polynomials/ . [Online; accessed 2-May-2023].
2015 ( ↑2).
[Mil86] J. S. Milne. “Abelian varieties.” In: Arithmetic geometry (Storrs,
Conn., 1984) . Springer, New York, 1986, pp. 103–150 ( ↑4, 5).
[MN19] Pascal Molin and Christian Neurohr. “Computing period matrices
and the Abel-Jacobi map of superelliptic curves.” In: Math. Comp.
88.316 (2019), pp. 847–888 ( ↑18).
[Mum70] David Mumford. “Abelian varieties.” Published for the Tata In-
stitute of Fundamental Research, Bombay by Oxford University
Press, London, 1970 ( ↑3, 4).
[PARI/GP] PARI/GP version 2.15.0. available from http://pari.math.u
-bordeaux.fr/ . The PARI Group. Univ. Bordeaux, 2022 ( ↑20,
21).
[Ray74] Michel Raynaud. “Schémas en groupes de type (p, . . . , p ).” In:Bull.
Soc. Math. France 102 (1974), pp. 241–280 ( ↑7, 8).
[Sage] The Sage Developers. SageMath, the Sage Mathematics Software
System (Version 9.7) .https://www.sagemath.org . 2022 ( ↑6,
21).
[Ser72] Jean-Pierre Serre. “Propriétés galoisiennes des points d’ordre fini
des courbes elliptiques.” In: Invent. Math. 15.4 (1972), pp. 259–331
(↑7, 8).
[Ser99] Jean-Pierre Serre. “Oeuvres – Collected Papers IV: 1985–1998.”
Oeuvres. Springer Berlin Heidelberg, 1999, pp. 1–55 ( ↑2, 6).
[ST68] Jean-Pierre Serre and John Tate. “Good reduction of abelian
varieties.” In: Ann. of Math. (2) 88 (1968), pp. 492–517 ( ↑6, 20).
[SC03] Michael Stoll and John E. Cremona. “On the reduction theory of
binary forms.” In: J. Reine Angew. Math. 565 (2003), pp. 79–99
(↑20).
[Str14] Marco Streng. “Computing Igusa class polynomials.” In: Math.
Comp.83.285 (2014), pp. 275–309 ( ↑10, 11, 18, 19).
[Sut22] Andrew V. Sutherland. “A database of genus 2curves over Qwith
conductor less than 220.”https://math.mit.edu/~drew/st2e2
0.txt. 2022 ( ↑22).REFERENCES 29
[Vél71] Jacques Vélu. “Isogénies entre courbes elliptiques.” In: C. R. Acad.
Sci. Paris Sér. A-B 273 (1971), A238–A241 ( ↑1).
Department of Mathematics, Massachusetts Institute of Technology, Cambridge,
MA 02139-4307, USA
Email address :bommel@mit.edu
URL:https://raymondvanbommel.nl
Department of Mathematics, Massachusetts Institute of Technology, Cambridge,
MA 02139-4307, USA
Email address :shivac@mit.edu
URL:https://math.mit.edu/~shivac
Department of Mathematics, Massachusetts Institute of Technology, Cambridge,
MA 02139-4307, USA
Email address :edgarc@mit.edu
URL:https://edgarcosta.org
Department of Mathematics, Harvard University, Cambridge, MA 02138, USA
Email address :kieffer@math.harvard.edu
URL:https://scholar.harvard.edu/kieffer