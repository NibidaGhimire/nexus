Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Yunlong Hou1Vincent Y. F. Tan1 2 3Zixin Zhong4
Abstract
Motivated by concerns about making online de-
cisions that incur undue amount of risk at each
time step, in this paper, we formulate the proba-
bly anytime-safe stochastic combinatorial semi-
bandits problem. In this problem, the agent is
given the option to select a subset of size at most
Kfrom a set of Lground items. Each item is
associated to a certain mean reward as well as a
variance that represents its risk. To mitigate the
risk that the agent incurs, we require that with
probability at least 1âˆ’Î´, over the entire hori-
zon of time T, each of the choices that the agent
makes should contain items whose sum of vari-
ances does not exceed a certain variance budget.
We call this probably anytime-safe constraint. Un-
der this constraint, we design and analyze an algo-
rithm PASC OMB UCB that minimizes the regret
over the horizon of time T. By developing ac-
companying information-theoretic lower bounds,
we show that under both the problem-dependent
and problem-independent paradigms, PASC OM-
BUCB is almost asymptotically optimal. Experi-
ments are conducted to corroborate our theoretical
findings. Our problem setup, the proposed PAS-
COMB UCB algorithm, and novel analyses are
applicable to domains such as recommendation
systems and transportation in which an agent is
allowed to choose multiple items at a single time
step and wishes to control the risk over the whole
time horizon.
1. Introduction
Audrey, a burgeoning social media influencer, makes profits
by posting advertisements (ads) under her account. The
1Department of Mathematics, National University of Singa-
pore, Singapore2Department of Electrical and Computer Engi-
neering, National University of Singapore, Singapore3Institute
of Operations Research and Analytics, National University of
Singapore, Singapore4Department of Computing Science, Uni-
versity of Alberta, Canada. Correspondence to: Zixin Zhong
<zzhong10@ualberta.ca >.
To be presented at ICML 2023. Copyright 2023 by the author(s).advertiser pays her only if an ad is clicked. Having taken
a class in online optimization, Audrey aims to leverage
the theory of bandit algorithms to design an exploration-
exploitation strategy to ensure that the expected number of
clicks of the ads she has posted is maximized. Since the
platform is space-limited, Audrey can only post no more
thanKout of Lavailable ads everyday. Some of these ads,
however, include an innocuous-looking lottery or voucher
that asks the viewer of the social media platform to provide
personal information that may lead to fraud or information
leakage. If a user clicks it and becomes a victim of fraud,
this may damage Audreyâ€™s reputation. Audrey thus has to
be circumspect in which and how many ads she posts.
On the one hand, Audrey wants to post as many ads that
she believes to have high click-through rates as possible;
theexpected reward she obtains is then the sum of expected
rewards of the individual ads. On the other hand, she should
balance this with the total risk of the ads that are posted over
a period of time; similarly, the risk of a set of ads posted is
modeled as the sum of the risks of the individual ads. How
should Audrey plan the posts of her ads over a period of
time to learn their individual expected rewards and risks to
ensure that her total expected reward is maximized and, at
the same time, with high probability, the risk incurred at
any point in time in her exploration-exploitation strategy is
bounded by some fixed permissible threshold?
In addition to influencers like Audrey, online platforms that
make profits by advertising such as YouTube and TikTok
also encounter similar problems. We are therefore motivated
to formulate the probably anytime-safe stochastic combina-
torial semi-bandits (PASSCSB) problem which is a regret
minimization problem with an anytime safety constraint.
More precisely, we aim to design and analyze the perfor-
mance of an algorithm that, with high probability, ensures
that the risk (as measured by the variance) at any time step
is below a given threshold and whose regret is minimized.
Literature review. There is a large body of works that take
risk into account while conducting the exploration and/or ex-
ploitation of the unknown reward distributions in the stochas-
tic multi-armed bandits (MABs) literature.
Under the risk-constrained pure exploration framework,
Hou et al. (2023) and David et al. (2018) attempted to iden-
tify the optimal arm within those low-risk (based on their
1arXiv:2301.13393v2  [cs.LG]  2 Jun 2023Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
variances or Î±-quantiles) arms with probability at least 1âˆ’Î´.
Under the risk-aware regret minimization setup, Sani et al.
(2012), Vakili & Zhao (2016) and Zhu & Tan (2020) con-
sider the mean-variance as the measure to be minimized
over a fixed time horizon. Cassel et al. (2018) provided a
general and systematic instruction to analyzing risk-aware
MABs, i.e., the risk was incorporated in the Empirical Dis-
tribution Performance Measure and the U-UCB algorithm
is adopted to perform â€œproxy regret minimizationâ€. While
these risk-aware algorithms reduce the overall risk during
the exploration and exploitation process, the risk is not
strictly enforced to be below a prescribed threshold; rather
the risk measure is penalized within the objective function,
similarly to a Lagrangian. Another setup similar to the risk-
aware setup is the constrained bandits regret minimization.
Mahdavi et al. (2012) required that the number of times
the constraint can only be violated is at most sublinear in
the horizon T. Kagrecha et al. (2023) proposed a CVaR
constraint and performed exploration on the feasible arm,
followed by exploration among the feasible arm set. Unlike
our formulation, these algorithm are permitted to sample
risky arms during exploration.
A more stringent constraint can be found in the literature on
conservative bandits (Wu et al., 2016), which requires the
cumulative return at any time step to be above a constant
fraction of the return resulting from repeatedly sampling
the base arm. Kazerouni et al. (2017) extended this setup to
conservative contextual linear bandits and this was further
improved by Garcelon et al. (2020). A similar problem is
bandits with knapsacks (Badanidiyuru et al., 2018), which
imposes a budget on the cumulative consumed resources
and the algorithm stops when the budget is depleted.
The most stringent constraint can be found in the safe ban-
ditsproblem. Khezeli & Bitar (2020) and Moradipari et al.
(2020) presented the SEGE ,SCLUCB , and SCLTS algo-
rithms to tackle this problem. This problem demands that
the expected reward of the pulled arm at each time step be
greater than a prescribed threshold with high probability,
i.e., the â€œstagewise safety constraintâ€ . The authors assumed
the convexity (continuity) of the arm set and performed
exploration around the explored safe arms, starting from a
baseline safe arm. This continuity of the (super) arm set
does not hold under the combinatorial semi-bandits setup.
More comparisons are presented in App. E.
For the (unconstrained) combinatorial semi-bandits (CSB)
setup, Chen et al. (2013) presented a UCB-type algorithm
COMUCB1 to balance the trade-off between exploration
and exploitation. Kveton et al. (2015) improved the analysis
ofCOMUCB1 and achieved a tight upper bound (within a
specific set of instances). Kveton et al. (2014) introduced
matroid structure to CSB and leveraged the matroid struc-
ture to design and analyze a greedy algorithm OMM . Therisk-aware CSB problem is less studied by the community.
Ayyagari & Dukkipati (2021) utilized CVaR as the risk-
aware measure within the CSB problem, where the risk
constraint was not explicitly specified.
We observe that the existing literature mentioned above are
not directly applicable to Audrey, while our setting (de-
scribed formally below) dovetails neatly with her problem.
Audrey can utilize our algorithm to sequentially and adap-
tively select different sets of ads everyday and almost al-
ways (i.e., with high probability) avoids sets of ads with
unacceptably high risks. Beyond any specific applications,
we believe that this problem is of fundamental theoretical
importance in the broad context of regret minimization in
combinatorial multi-armed bandits.
Main Contributions. Our first contribution lies at the for-
mulation of a novel PASSCSB problem. In the PASSCSB
problem, there are Litems with different reward distribu-
tions. At each time step, a random reward is generated from
each itemâ€™s distribution. Based on the previous observations,
the learning agent selects a solution at each time step. A
solution consists of at most Kitems. The expected return
(variance) of a solution is the summation of the reward (vari-
ance) of its constituents. Given TâˆˆN, the agent aims to
maximize the cumulative return over Ttime steps and en-
sure that with probability 1âˆ’Î´the variance of all selected
solutions are below a given threshold.
The key challenge of regret minimization under the PASS-
CSB lies in handling two distinct tasksâ€”we seek optimality
in the mean and safeness in the variance of each chosen
solution. Our second contribution is the design and analy-
sis of the Probably Anytime- SafeComb inatorial UCB (or
PASC OMB UCB) algorithm.
Thirdly, we also derive a problem-dependent upper bound on
the regret of PASC OMB UCB , which involves a hardness pa-
rameter H(âˆ†(Î›)) . We see that H(âˆ†(Î›)) characterizes the
effectiveness of ascertaining the safety of potential solutions
in the regret. To assess the optimality of PASC OMB UCB ,
we prove an accompanying problem-dependent lower bound
on the regret of any variance-constrained consistent algo-
rithm. The upper and lower problem-dependent bounds
match in almost all the parameters (except in K). Addi-
tionally, we show that if Î´Tdecays exponentially fast in T,
the problem-dependent regret cannot be logarithmic in T.
We further present a problem-independent upper bound on
the regret of PASC OMB UCB and a lower bound for any
algorithm. Just as the problem-dependent bounds, these
bounds also match in almost all the parameters.
Lastly, experiments are conducted to illustrate the empirical
performance and corroborate our theoretical findings.
In summary, this paper is the first to explore the regret mini-
mization problem in the combinatorial bandits with an any-
2Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
time constraint on the variance. When Î´â†’1andÂ¯Ïƒ2is large
(so that the optimal safe solution is the one with the highest
mean regardless of safety considerations), our problem re-
duces to the standard combinatorial semi-bandits (Kveton
et al., 2015), and the regret incurred by the safety constraint
vanishes, resulting in the same upper bound as the uncon-
strained case. Furthermore, the framework and analysis of
PASC OMB UCB can be extended to other risk measures
as long as there are appropriate concentration bounds, e.g.,
Bhat & Prashanth (2019) or Chang & Tan (2022) enables
us to use CVaR or certain continuous functions as risk mea-
sures within the generic PASC OMB UCB framework.
2. Problem Setup
FormâˆˆN, let[m] :={1,2, . . . , m }. An instance of a
variance-constrained stochastic combinatorial semi-bandit
is a tuple Î› = ( E,AK, Î½,Â¯Ïƒ2). We describe the four ele-
ments of Î›in the following. Firstly, the finite set E= [L]
is known as the ground set in which each iâˆˆEis known as
anitem. Secondly, the family AKâŠ‚ {Sâˆˆ2E:|S| â‰¤K}
is a collection of subsets of Ewith cardinality at most K.
Each element Sâˆˆ A Kis known as a solution andAK
satisfies the condition that all subsets of Sâˆˆ AKremain so-
lutions, i.e., AKis downward-closed. Thirdly, the vector of
probability distributions Î½= (Î½1, Î½2, . . . , Î½ L)contains Ïƒ2-
sub-Gaussian distributions {Î½i}iâˆˆEwith means {Âµi}iâˆˆE
and variances {Ïƒ2
i}iâˆˆE. The final element of an instance
Â¯Ïƒ2>0denotes the permissible upper bound on the variance.
To avoid trivialities, we assume that Â¯Ïƒ2> Ïƒ2andKâ‰¥2.
Thereturn of item iâˆˆEis the random variable Wiwith
distribution Î½i. The (stochastic) return of a solution Sâˆˆ
AKisP
iâˆˆSWiwhere Wiâˆ¼Î½i. The expected return and
variance ofSâˆˆ AKare
ÂµS:=X
iâˆˆSÂµiand Ïƒ2
S:=X
iâˆˆSÏƒ2
i
respectively. We further assume that every instance Î›sat-
isfies Ïƒ2
SÌ¸= Â¯Ïƒ2for all Sâˆˆ A Kand each distribution Î½iis
supported in the interval [0,1].
Define S:={Sâˆˆ AK:Ïƒ2
S<Â¯Ïƒ2}to be the safe set which
contains all the safesolutions. Let the complement of Sbe
theunsafe set Sc. Denote the optimal safe solution asSâ‹†:=
arg max {ÂµS:Sâˆˆ S} with return Âµâ‹†. For simplicity,
we assume that Sâ‹†is unique. Denote the suboptimal set
B:={Sâˆˆ A K:ÂµS< Âµâ‹†}and the risky set R:={Sâˆˆ
AK:ÂµSâ‰¥Âµâ‹†, SÌ¸=Sâ‹†}. For a solution S, let the mean
gapâˆ†S:=Âµâ‹†âˆ’ÂµSand the variance gap âˆ†v
S:=|Ïƒ2
Sâˆ’Â¯Ïƒ2|.
An instance Î›, time horizon TâˆˆNand confidence param-
eterÎ´âˆˆ(0,1)are specified. An agent, who knows E,AK
andÂ¯Ïƒ2but not the vector of probability distributions Î½, in-
teracts adaptively with the instance over Ttime steps as
follows. At time step tâˆˆ[T], the agent uses a stochasticfunction Ï€tthat selects a solution Stâˆˆ A Kbased on the
observation history Htâˆ’1:= (( Ss,{Wi(s)}iâˆˆSs))sâˆˆ[tâˆ’1].
In other words, St=Ï€t(Htâˆ’1)is a stochastic function
of the history Htâˆ’1. The agent receives the random re-
turnP
iâˆˆStWi(t), where {W(s) ={Wi(s)}iâˆˆE}sâˆˆ[T]are
i.i.d. according to Î½across time. The weights of the se-
lected items {Wi(t) :iâˆˆSt}are observed by the agent at
each time tâˆˆ[T]. The collection of stochastic functions
Ï€={Ï€t}tâˆˆ[T]is known as the agentâ€™s policy .
The goal of the agent is to minimize the expected cumulative
regret (or simply regret )Reg(T)over the horizon T, sub-
ject to a certain risk constraint. More precisely, the regret
suffered by a policy Ï€employed by the agent is defined as
RegÏ€(T) :=EÏ€"TX
t=1 X
iâˆˆSâ‹†Wi(t)âˆ’X
iâˆˆStWi(t)!#
The policy Ï€should satisfy the condition that all the solu-
tions chosen {SÏ€
t}tâˆˆ[T]âŠ‚ A Kare safe with probability at
least1âˆ’Î´, i.e.,
PÏ€
âˆ€tâˆˆ[T], SÏ€
tâˆˆ S
â‰¥1âˆ’Î´. (1)
This is referred to as the probably anytime-safe constraint.
In the problem-dependent lower bounds, we will refer to
a certain class of â€œgoodâ€ policies that operate as the time
horizon Tâ†’ âˆ and the probability of being safe in the
sense of (1)tends to 1. This is formalized in the following.
Definition 2.1. Fix an instance Î½and a vanishing sequence
{Î´T}âˆ
T=1âŠ‚(0,1). A policy Ï€={Ï€t}âˆ
t=1is said to be a
{Î´T}âˆ
T=1-variance-constrained consistent algorithm if
â€¢RegÏ€(T) =o(Ta)for all a >0and
â€¢PÏ€
âˆ€tâˆˆ[T], SÏ€
tâˆˆ S
â‰¥1âˆ’Î´Tfor all TâˆˆN.
We often omit the superscripts Ï€inRegÏ€, SÏ€
t(orAÏ€
tand
AÏ€
t,rinPASC OMB UCB ) and the subscripts Ï€in the proba-
bilities and expectations if there is no risk of confusion.
3. Our Algorithm: PASC OMB UCB
Our algorithm Probably Anytime- SafeComb inatorial UCB
(orPASC OMB UCB ), presented in Algorithm 1, is designed
to satisfy the probably anytime-safe constraint. In particu-
lar, we apply (and analyze) the GREEDY -SPLIT subroutine
in Line 11; this subroutine has not been involved in an al-
gorithm designed for standard combinatorial semi-bandits
such as C OMB UCB1 (Chen et al., 2013).
Statistics. Since each item iâˆˆEisÏƒ2-sub-Gaussian, any
solution that contains at most q:=âŒŠÂ¯Ïƒ2
Ïƒ2âŒ‹items is safe with
probability (w.p.) 1. We call such a solution absolutely
safe. Algorithm 1 ( PASC OMB UCB ) is conducted in phases ,
where each phase consists of multiple time steps and each
item can be pulled at most once during each phase. Thus
we adopt a different notation â€œ Aâ€ to denote the solution in
3Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Algorithm 1 PASC OMB UCB
1:Input : An instance Î›(with unknown Î½), the horizon T
and the confidence parameter Î´âˆˆ(0,1).
2:Set phase counter p= 1and time step counter t= 1.
3:whileâˆƒiâˆˆEsuch that Ti(pâˆ’1)<2do
4: PullAp=arg maxS:|S|â‰¤q|{iâˆˆS:Ti(pâˆ’1)<2}|.
5: pâ†p+ 1,tâ†t+ 1.
6:end while
7:Update the sample mean, sample variance and confi-
dence bounds according to (4).
8:Update the empirically safe set Spand possibly safe set
Â¯Spaccording to (5) and (6) respectively.
9:while t < T do
10: Identify a solution Ap=arg maxAâˆˆÂ¯Spâˆ’1UÂµ
A(pâˆ’1).
11: Invoke GREEDY -SPLIT to split the solution Apinto
npsub-solutions {Ap,1, . . . , A p,np} âŠ‚ S pâˆ’1.
12: Setnpâ†min{np, Tâˆ’t}.
13: Choose solution {Ap,1, . . . , A p,np}.
14: Update the statistics of all solutions based on (4).
15: Update the empirical sets based on (5) and (6).
16: Sett=t+npandp=p+ 1,
17:end while
our algorithm. Define Ti(p) :=Pp
s=11{iâˆˆAp}as the
number of times item iis pulled up to and including phase p.
Denote the sample mean and sample variance of item iat
phase prespectively as
Ë†Âµi(p) :=1
Ti(p)pX
s=1Wi(s)Â· 1{iâˆˆAs},and
Ë†Ïƒ2
i(p) :=1
Ti(p)pX
s=1(Wi(s)âˆ’Ë†Âµi(p))2Â· 1{iâˆˆAs}.
The bound based on the Law of Iterated Logarithms (LIL) is
used to construct the confidence radii. For a fixed Ïµâˆˆ(0,1),
define lil(t, Ï) := (1 +âˆšÏµ)
1+Ïµ
2tln ln((1+ Ïµ)t)
Ï1/2
and
denote the confidence radius for the mean as
Î±(t) := lil( t, Ï‰Âµ), (2)
where Ï‰Âµis a parameter to be chosen. The confidence radii
for the variance are asymmetric about the empirical variance
and are parameterized by Ï‰vandÏ‰â€²
vthat may not necessarily
be the same. They are defined as
Î²u(t) := 3 Â·lil(t, Ï‰v)and Î²l(t) := 3 Â·lil(t, Ï‰â€²
v).(3)
We denote the upper andlower confidence bounds (UCB
and LCB) for the mean of item ias
UÂµ
i(p) := Ë†Âµi(p) +Î±(Ti(p))and
LÂµ
i(p) := Ë†Âµi(p)âˆ’Î±(Ti(p))
V ariance
SolutionFigure 1. A diagram of a split to a solution Apcontaining 5items.
respectively. The UCB and LCB for the variance of item i
are defined as
Uv
i(p) := min {Ë†Ïƒ2
i(p) +Î²u(Ti(p)), Ïƒ2}and
Lv
i(p) := max {Ë†Ïƒ2
i(p)âˆ’Î²l(Ti(p)),0}
respectively. With the sample mean, sample variance, and
confidence bounds for the items, we define the following
statistics for all solution Sâˆˆ AK:
Ë†ÂµS(p) =X
iâˆˆSË†Âµi(p),Ë†Ïƒ2
S(p) =X
iâˆˆSË†Ïƒ2
i(p),
UÂµ
S(p) =X
iâˆˆSUÂµ
i(p), LÂµ
S(p) =X
iâˆˆSLÂµ
i(p), (4)
Uv
S(p) =X
iâˆˆSUv
i(p), Lv
S(p) =X
iâˆˆsLv
i(p).
Denote the empirically safe set as
Sp:={Sâˆˆ AK:Uv
S(p)<Â¯Ïƒ2} (5)
and the possibly safe set as
Â¯Sp:={Sâˆˆ AK:Lv
S(p)<Â¯Ïƒ2}. (6)
The solutions in StandÂ¯Stare called empirically safe and
possibly safe solutions respectively.
Dynamics. In the initialization stage (lines 3to6),
PASC OMB UCB greedily pulls the absolutely safe solu-
tions. When each item has been pulled at least twice,
this stage is terminated. After initialization, during
phase p,PASC OMB UCB firstly identifies a solution
Ap= arg maxAâˆˆÂ¯SpUÂµ
A(pâˆ’1)via an optimization ora-
cle(Line 10). It then calls a subroutine GREEDY -SPLIT
to greedily partition the solution Apinto empirically safe
sub-solutions (Line 11, see Figure 1 for illustration). Sub-
sequently , these solutions are chosen and the stochastic re-
wards from the corresponding items are observed (Line 13).
Lastly , the empirical estimates, the confidence bounds, and
the empirical sets are updated (Lines 14and15).
4Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Algorithm 2 GREEDY -SPLIT
1:Input : A solution Apand the upper confidence bound
on the variance Uv(pâˆ’1)at phase pâˆ’1.
2:Setnp= 1, s= 1andAp,1=âˆ….
3:Index the items in Apbyi1, . . . , i |Ap|.
4:while sâ‰¤ |Ap|do
5: ifUv
Ap,np(pâˆ’1) +Uv
is(pâˆ’1)â‰¤Â¯Ïƒ2then
6: SetAp,npâ†Ap,npâˆª {is}.
7: else
8: npâ†np+ 1andAp,np={is}.
9: end if
10: sâ†s+ 1.
11:end while
12:return {Ap,1, . . . , A p,np}.
MeanInstantaneous regret
due to suboptimality
Instantaneous regret
due to safeness-checking
Figure 2. Solution Apis split into np= 3 sub-solutions, the in-
stantaneous regret at phase pcan be divided into the instantaneous
regret due to suboptimality and the instantaneous regret due to
safeness-checking.
Illustration. Figures 2 and 3 illustrate the regret accumu-
lated during phase pand over the whole Thorizon respec-
tively. As shown in Figure 2, the regret accumulated during
phase pcan be decomposed into two parts
npX
r=1(Âµâ‹†âˆ’ÂµAp,r) = âˆ† Ap+Âµâ‹†(npâˆ’1)
where âˆ†Apisthe (phase-wise) instantaneous regret due
to suboptimality andÂµâ‹†(npâˆ’1)isthe instantaneous re-
gret due to safeness-checking ; the latter term results from
the safeness constraint. At the beginning, since the up-
per confidence bounds of the variances of all solutions are
large, each solution will be split into up to 2Qsub-solutions,
where Q:=âŒˆK
qâŒ‰, and hence the regret due to safeness
checking can be large. As the algorithm progresses, we
obtain more observations of items and get more confident
about their variances ( Uv
i(p)decreases). Hence, during
some later phase, it suffices to split some solutions into
fewer sub-solutions and the regret due to safeness-checking
reduces. Furthermore, when most items are sampled suffi-
PhaseInstantaneous Regret... ...
......Instantaneous regret due to suboptimality
Instantaneous regret due to safeness-checking
......Figure 3. An illustration of the instantaneous regret yielded by
PASC OMB UCB . As the variances of the items are more deter-
mined, less regret due to safeness-checking is generated.
ciently many times, the unsafe solutions are excluded from
the possibly safe set Â¯Sp, and the only contribution to the
regret is via the suboptimality of the solution Ap.
Remark 3.1. The two parameters Ï‰vandÏ‰â€²
vdetermine
the confidence radii of variances and do not necessarily
have to be the same. The confidence parameter Ï‰â€²
vis solely
a parameter of PASC OMB UCB ; its choice does not rely
on the confidence parameter Î´and only affects Lv
S(p), the
lower confidence bound of the variance, which determines
when we ascertain a solution to be unsafe. The choice of
Ï‰vdepends on Î´and it influences Uv
S(p), the upper confi-
dence bound of the variance, which guides PASC OMB UCB
to split the solution to satisfy the probably anytime-safe
constraint.
4. Problem-dependent Bounds
For simplicity, when a time horizon Tand a confidence pa-
rameter Î´=Î´Tare given, we set the confidence parameters
Ï‰Âµ=Ï‰â€²
v=1
T2andÏ‰v=Î´T
T2.
We introduce various suboptimality gaps that contribute to
the regret due to the suboptimality.
â€¢ for iâˆˆE\Sâ‹†, let the minimum safe-suboptimal gap be
âˆ†i,Sâˆ©B,min:= min
Sâˆ‹i,SâˆˆSâˆ©Bâˆ†S;
â€¢ for iâˆˆE, let the minimum unsafe-suboptimal gap be
âˆ†i,Scâˆ©B,min:= min
Sâˆ‹i, SâˆˆScâˆ©Bâˆ†S;
and let the tension parameter between the mean gap âˆ†S
and variance gap âˆ†v
Sbe
ci:= max
Sâˆ‹i, SâˆˆScâˆ©Bâˆ†S
max{âˆ†S,âˆ†v
S/3}2
.
We also define following safeness gaps that induce the
conservative sampling strategy to guarantee the probably
anytime-safe constraint. For iâˆˆE, and
5Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
â€¢for the risky set R, define the minimum unsafeness gap
âˆ†v
i,R:= min Sâˆ‹i,SâˆˆRâˆ†v
S.
â€¢ for the safe and suboptimal set S âˆ© B , let
Î¨i,Sâˆ©B:= max
Sâˆ‹i, SâˆˆSâˆ©BminlnT
âˆ†2
S,9 ln(T/Î´T)
(âˆ†v
S)2
which characterizes the order of the number of times
that item ineeds to be sampled in order to identify the
suboptimality of all safe and suboptimal solutions Aâˆ‹i
while satisfying the safeness constraint. We further define
a variant of Î¨i,Sâˆ©B as
Î¨â€²
i,Sâˆ©B:= max
Sâˆ‹i,SâˆˆSâˆ©BminlnT
âˆ†2
S,9 ln(1 /Î´T)
(âˆ†v
S)2
which will be used to characterize the lower bound.
â€¢ for the unsafe and suboptimal set Scâˆ© B, let
Î¦i,Scâˆ©B:= max
Sâˆ‹i, SâˆˆScâˆ©BminlnT
âˆ†2
S,9 lnT
(âˆ†v
S)2
which characterizes the hardness of identifying the un-
safeness of suboptimality of all unsafe and suboptimal
solutions that contain item i.
Define Î¾(Ï‰) :=2+Ïµ
Ïµ Ï‰
ln(1+ Ïµ)1+Ïµ, where Ïµâˆˆ(0,1)is fixed.
4.1. Problem-dependent Upper Bound
Theorem 4.1 (Problem-dependent upper bound) .LetÎ› =
(E,AK, Î½,Â¯Ïƒ2)be an instance and let {Î´T}âˆ
T=1âˆˆo(1)be a
sequence that satisfies ln(1/Î´T) =o(Tb)for all b >0(i.e.,
{Î´T}is not exponentially decaying). Then, PASC OMB UCB
is a{Î´T}âˆ
T=1-variance-constrained consistent algorithm.
More precisely, given a time budget T, the probably anytime-
safe constraint is satisfied and the regret of PASC OMB UCB
Reg(T)is upper bounded by
min{TÂµâ‹†,Reg1(T) + Reg2(T)}+ Reg3(T),
where
Reg1(T) =OX
iâˆˆE\Sâ‹†KlnT
âˆ†i,Sâˆ©B,min+X
iâˆˆEciKlnT
âˆ†i,Scâˆ©B,min
Reg2(T) = 2 Âµâ‹†H(âˆ†(Î›)) ,Reg3(T) = 2 Âµâ‹†(L+ 1)
where âˆ†(Î›) = {âˆ†v
Sâ‹†}âˆª{âˆ†v
i,R,Î¨i,Sâˆ©B,Î¦i,Scâˆ©B}iâˆˆEand
H(âˆ†(Î›)) := H(1,Î›)is defined in (26) in App. B.4.
Remark 4.2. If the gaps in âˆ†(Î›) are sufficiently small and
Î´T=Tâˆ’Î»for a fixed Î» >0,
H(âˆ†(Î›)) = O(Î»+ 1)K2lnT
(âˆ†v
Sâ‹†)2+KX
iâˆˆElnT
(âˆ†v
i,R)2
+ max
Sâˆ‹i,
SâˆˆSâˆ©BminlnT
âˆ†2
S,(Î»+ 1) ln T
(âˆ†v
S)2
+ Î¦i,Scâˆ©B
.
See(26) for more details of this calculation.The first term TÂµâ‹†in the regret bound provides a na Â¨Ä±ve
upper bound for the expected regret conditional on the vari-
ance constraint holds. The order of the regret ( o(Ta)for all
a >0) implies the regret will be asymptotically bounded
by the second term when the time budget Tis sufficiently
large. The second term is comprised of two partsâ€” the re-
gret due to suboptimality Reg1(T)andthe regret due to
safeness-checking Reg2(T). The intuition for the regret due
to suboptimality Reg1(T)is that
â€¢Each item in any safe and suboptimal solution will be
sampled O(KlnT
âˆ†2
i,Sâˆ©B,min)times to ascertain the suboptimal-
ity of all safe and suboptimal solutions to which this item
belongs to.
â€¢Each item in an unsafe and suboptimal solution Swill
be sampled O
KlnT
max{âˆ†S,âˆ†v
S/3}2
times to ascertain either
the suboptimality or the unsafeness of S. As this should
be done for all the unsafe and suboptimal solutions, we
need to take the maximum of the above time complexity.
More precisely, when ci= 1, suboptimality identification
of the unsafe and suboptimal solutions to which item
ibelongs dominates the regret; and when ci<1, the
ascertaining of the unsafeness dominates the regret.
The intuition for the regret due to safeness checking
Reg2(T)is that H(âˆ†(Î›)) provides an upper bound for
the number of time steps needed for guaranteeing the safe-
ness of all solutions. PASC OMB UCB achieves this in a
judicious manner since it does not check the safeness of all
the solutions at the start, followed by exploration and ex-
ploitation of the possibly high-return safe solutions. Instead,
it takes advantage of the fact that when a (safe or unsafe)
suboptimal solution is ascertained to be suboptimal, its safe-
ness can be disregarded, as reflected in the terms Î¨i,Sâˆ©B
andÎ¨i,Scâˆ©B. In addition, it will not sample an unsafe solu-
tion if it is identified as unsafe w.p. at least 1âˆ’2Î¾(Ï‰â€²
v). The
last term Reg3(T)corresponds to the regret due to failure
of the â€œgoodâ€ event and at the initialization stage. A proof
sketch is presented in Section 6.
4.2. Problem-dependent Lower Bound
Theorem 4.3 (Problem-dependent lower bound) .Let
{Î´T}âˆ
T=1âˆˆo(1)be a sequence that satisfies ln(1/Î´T) =
o(Tb)for all b >0. There exists an instance Î›such that for
any{Î´T}TâˆˆN-variance-constrained consistent algorithm Ï€,
the regret is lower bounded by
â„¦X
iâˆˆElnT
âˆ†i,Sâˆ©B,min
+Âµâ‹†
KÂ·â„¦Kln(1/Î´T)
(âˆ†v
Sâ‹†)2
+X
iâˆˆE
Î¨â€²
i,Sâˆ©B+lnT
(âˆ†v
i,R)2+ Î¦i,Scâˆ©B
.
The proof is presented at App. B.5. With Theorem 4.3, the
6Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
problem-dependent upper bound is tight for polynomially
decaying {Î´T}TâˆˆN.
Corollary 4.4 (Tightness of problem-dependent bounds) .
LetÎ´T=Tâˆ’Î»with a fixed Î» >0, the regret
Reg(T)âˆˆâ„¦X
iâˆˆElnT
âˆ†i,Sâˆ©B,min+Âµâ‹†
K2H(âˆ†(Î›))
âˆ©OX
iâˆˆEKlnT
âˆ†i,Sâˆ©B,min+Âµâ‹†H(âˆ†(Î›))
where H(âˆ†(Î›)) is defined in Remark 4.2. The upper bound
above is achieved by PASC OMB UCB .
Under different rates of decay of {Î´T}TâˆˆN(see App. D
for the cases where ln(1/Î´T) =Ï‰(lnT)ando(lnT)), the
upper bound of the regret due to suboptimality Reg1(T)(the
first term in the total regret) and the upper bound of the regret
due to safeness-checking Reg2(T)(the latter term) match
their corresponding lower bounds up to factors of Kand
K2respectively; this gap is acceptable as K(e.g., number
of ads displayed) is usually small relative to L(total number
of ads). More discussions are postponed to App. E. One
may naturally wonder whether we can tolerate a much more
stringent probably anytime-safe constraint. The following
theorem (with b= 1) indicates no algorithm is {Î´T}TâˆˆN-
variance-constrained consistent if Î´Tdecays exponentially
fastinT. Detailed proofs are postponed to App. C.
Theorem 4.5 (Impossibility result) .Let{Î´T}âˆ
T=1âˆˆo(1)
be a sequence that satisfies that there exists bâˆˆ(0,1]such
thatln(1/Î´T) = â„¦( Tb). For any instance Î›, the regret of
any algorithm is lower bounded by â„¦(Tb).
5. Problem-independent Bounds
We can derive a problem-independent upper bound on the re-
gret of PASC OMB UCB from the problem-dependent one in
Theorem 4.1 with some delicate calculations (see App. B.5).
Theorem 5.1 (Problem-independent upper bound) .Let
{Î´T}âˆ
T=1âˆˆo(1)be a sequence that satisfies ln(1/Î´T) =
o(Tb)for all b >0. IfT > L , for any instance Î›with
variance gaps lower bounded by âˆ†vâ‰¤minSâˆˆAKâˆ†v
S, the
regret of PASC OMB UCB is upper bounded by
Oâˆš
KLT lnT+LK2
(âˆ†v)2ln1
Î´T
.
Theorem 5.2 (Problem-independent lower bound) .Let the
minimum variance gap be âˆ†v:= min SâˆˆAKâˆ†v
S. When
K3â‰¥L2, we have
Reg(T) = â„¦âˆš
KLT + minnL
(âˆ†v)2ln1
Î´T
, To
.
Remark 5.3. The assumption that the variance gaps of all
solutions are lower bounded by âˆ†vis needed to achieve anon-vacuous problem-independent bound. Given any algo-
rithm and time budget T, the variance gap of Sâ‹†can be
arbitrarily small if âˆ†vis not bounded away from zero, so
themin in Theorem 5.2 will be dominated by the linear term
T, and hence, no algorithm can attain sublinear regret.
Corollary 5.4 (Tightness of problem-independent bounds) .
LetK3â‰¤L2, and{Î´T}âˆ
T=1âˆˆo(1)satisfies ln(1/Î´T) =
o(Tb)for all b >0. We have
Reg(T)âˆˆâ„¦âˆš
KLT +L
(âˆ†v)2ln1
Î´T
âˆ©Oâˆš
KLT lnT+LK2
(âˆ†v)2ln1
Î´T
.
The upper bound is achieved by PASC OMB UCB .
We observe that the gap between the upper and lower bounds
is manifested onâˆš
lnTandK2. The presence ofâˆš
lnT
is not unexpected as it is also involved in the gap between
the bounds on the regret for the (unconstrained) combina-
torial bandits (Kveton et al., 2015). Besides, the term K2
is induced by the design of PASC OMB UCB . Additional
discussions are provided in App. E.
6. Proof Sketch of the Problem-Dependent
Upper Bound (Theorem 4.1)
Assume that PASC OMB UCB has processed Tâ€²phases with
Ttime steps, we have P[Tâ€²â‰¤T] = 1 since each phase
is composed by multiple time steps. Denote the expected
regret of PASC OMB UCB withpphases as E[R(p)]. The
expected regret of PASC OMB UCB after Ttime steps is
E[R(Tâ€²)] :=ETâ€²X
p=1npX
r=1(Âµâ‹†âˆ’ÂµAp,r)
.
In the proof of Theorem 4.1, we first show a regret decompo-
sition lemma (Lemma 6.1) that separates the total regret into
the regret due to suboptimality E[R1(Tâ€²)],the regret due
to safeness-checking E[R2(Tâ€²)]and the regret due to the
failure of the â€œgoodâ€ event and the initialization. Then we
upper bound R1(Tâ€²)andR2(Tâ€²)separately. To elucidate
the dependence of the regret on the confidence parameters
Ï‰Âµ, Ï‰vandÏ‰â€²
v, we retain these notations henceforth. De-
tailed proofs are presented in App. B.
Forpâˆˆ[T], iâˆˆE, define the â€œgoodâ€ events that the sample
mean and the sample variance are near their ground truths:
EÂµ
i,Ti(p):={Ë†Âµi(p)âˆ’Î±(Ti(p))â‰¤Âµiâ‰¤Ë†Âµi(p) +Î±(Ti(p))}
andEv
i,Ti(p)(Ï) :={Ë†Ïƒ2
i(p)âˆ’3Â·lil(Ti(p), Ï)â‰¤Ïƒ2
iâ‰¤Ë†Ïƒ2
i(p)+
3Â·lil(Ti(p), Ï)}and
Ei,Ti(p):=EÂµ
i,Ti(p)âˆ© Ev
i,Ti(p)(Ï‰v)âˆ© Ev
i,Ti(p)(Ï‰â€²
v)
E:=\
iâˆˆE\
pâˆˆ[Tâ€²]Ei,Ti(pâˆ’1).
7Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
PhaseInstantaneous Regret... ...
......Instantaneous regret due to safeness-checking
............Upper bound
Figure 4. We assume the algorithm will sample those solutions
with large Uv
A(p), i.e., those phases in which more sub-solutions
are sampled are moved forward (the dark red ones). Based on this,
an upper bound can be derived (the thick black lines).
Forrâˆˆ[Qâˆ’1], define Up(r) :={Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2}.
When event Up(r)occurs at phase p, it indicates at least
r+ 1sub-solutions are needed in order to sample the items
inApand guarantee the safeness constraint.
Lemma 6.1. Assume that PASC OMB UCB has processed
Tâ€²phases with Ttime steps, the expected regret of PAS-
COMB UCB can be decomposed into three parts as follows
E[R(Tâ€²)]â‰¤E[R1(Tâ€²)|E] +E[R2(Tâ€²)|E] + R 3(T)
where R1(Tâ€²) :=Tâ€²X
p=11{Apâˆˆ B}âˆ†Ap
R2(Tâ€²) :=Âµâ‹†Tâ€²X
p=1
2Qâˆ’1X
r=11{Up(r)}
R3(T) := 2 Âµâ‹†L 
1 +T 
Î¾(Ï‰Âµ) + 2Î¾(Ï‰v) + 2Î¾(Ï‰â€²
v
In Lemma 6.1, the first term R1(Tâ€²)is the (high-probability)
regret due to suboptimality , in the sense that only the mean
gaps of the suboptimal solutions contribute to R1(T). The
second term R2(Tâ€²)is called the (high-probability) regret
due to safeness-checking , since it depends on the variance
gaps and goes to 0ifÂ¯Ïƒ2is sufficiently large. The last term
R3(T)contains the regret from the initialization stage and
the regret results from the failure of the â€œgoodâ€ event E.
The regret due to suboptimality can be bounded in terms of
the minimum safe/unsafe-suboptimal gaps as follows.
Lemma 6.2. Conditioned on event E, the regret due to
suboptimality R1(Tâ€²)can be bounded by
OX
iâˆˆE\Sâ‹†K
âˆ†i,Sâˆ©B,minln1
Ï‰Âµ+X
iâˆˆEciK
âˆ†i,Scâˆ©B,minln1
Ï‰â€²v
.
The regret due to safeness-checking involves more critical
parameters of the instance and we encode them in Tâ€²
râ€²and
H(râ€²,Î›)forrâ€²âˆˆ[Q](see Figure 5); these terms are defined
formally in (25) and (26) respectively.
PhaseInstantaneous Regret
............Upper boundFigure 5. An illustration of the upper bound of R2(Tâ€²)for phase
Tâ€²
Qâˆ’2â‰¤Tâ€²< Tâ€²
Qâˆ’3. When râ€²= 1,2Âµâ‹†H(1,Î›)is the area
below the thick line, i.e., the upper bound for R2(Tâ€²)for any Tâ€².
Lemma 6.3. On the event E, ifTâ€²âˆˆ[Tâ€²
râ€², Tâ€²
râ€²âˆ’1)then
R2(Tâ€²)â‰¤2Âµâ‹†[Tâ€²(râ€²âˆ’1) +H(râ€²,Î›)]â‰¤2Âµâ‹†H(1,Î›)
To upper bound R2(Tâ€²), we assume the algorithm samples
solutions with large Uv
A(p)inÂ¯Sp, which will then be split
into several sub-solutions (see Figure 4). Furthermore, for
râ€²=Qâˆ’1, Qâˆ’2, . . . , 1, we derive an upper bound for
the number of phases in which event Up(râ€²)âˆ©(Up(râ€²+ 1))c
occurs (at most 2râ€²+ 1sub-solutions are being pulled in
these phases). To be more specific (see Figure 5), for
râ€²=Qâˆ’1, we compute the maximum number of phases
Tâ€²
Qâˆ’1in which at most 2Qâˆ’1sub-solutions are sampled.
Then for râ€²=Qâˆ’2, we compute the maximum number of
phases Tâ€²
Qâˆ’2âˆ’Tâ€²
Qâˆ’1in which at most 2Qâˆ’3sub-solutions
are sampled. We do this until the time budget runs out. As
Tâ€²increases, râ€²decreases and H(râ€²,Î›)increases. When
râ€²= 1, i.e. Tâ€²â‰¥Tâ€²
1,H(1,Î›)is an upper bound for the
total number of sub-solutions being pulled (up to a con-
stant) for the safeness-checking or the price of satisfying the
probably anytime-safe constraint. The upper bound for the
regret due to safeness-checking is the instance-dependent
constant 2Âµâ‹†H(1,Î›)when Tâ€²â‰¥Tâ€²
1. More discussions are
postponed to Step 3 in the proof in App. B.4.
7. Experiments
In this section, we ran 3sets of experiments to illustrate the
empirical performance of PASC OMB UCB and to corrob-
orate its theoretical guarantees. As COMB UCB1 (Kve-
ton et al., 2015; Khezeli & Bitar, 2020; Amani et al.,
2019) has tight regret guarantees, we adopt it as the bench-
mark in the unconstrained case. Codes are accessible at
https://github.com/Y-Hou/PASSCSB.git .
Experimental Design: We design two instances where the
rewards are Beta distributed with means and variances as
in Table 1. There are L= 10 base arms and the admissible
solution set AKcontains all subsets of [L]with cardinal-
ity no greater than K= 3 (so|AK|= 175 ). Since the
arm distributions are supported on [0,1], the sub-Gaussian
parameter Ïƒ2= 0.25. The confidence parameter Î´= 0.05.
8Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
0 2 4 6 8 10
10500.511.522.533.5Cumulative regret105
(a) Experiment 1
0 1 2 3 4 5
10601234567Cumulative reward106
0.00%0.00%0.00%0.00%0.00%0.00%0.00%0.00%0.00%0.00%
99.90%99.95%99.96%99.98%99.98%99.98%99.98%99.99%99.99%99.99% (b) Experiment 2
0 20 40 60 80 100024681012Additional regret105
R2=0.99636Additional Regret
Linear fit (c) Experiment 3
Figure 6. Results of the Experiments: (a) Experiment 1: Cumulative regret v.s. Time horizon; (b) Experiment 2: Cumulative reward v.s.
Time horizon with the percentages of violations besides the data points; (c) Experiment 3: Additional regret v.s. 1/(âˆ†v
S)2.
Item index 1 2 3 4 5 to 10
Means 0.50.45 0.40.35 0.3
Variances ( Set 1 )0.24 0.24 0.04 0.01 0.01
Variances ( Set 2 )0.01 0.01 0.01 0.01 0.01
Table 1. Two sets of items with equal means for each item.
In Experiment 1 , we quantify the additional regret due
to the safeness checking and evaluate the performance of
PASC OMB UCB with Set 1 under the unconstrained case.
We run (1) PASC OMB UCB withÂ¯Ïƒ= 0.6which needs to
check the safeness of the solutions; (2) PASC OMB UCB
with Â¯Ïƒ= 0.751 which can be regarded as a variant of
PASC OMB UCB without the safeness constraint, since our
algorithm is aware of the safeness of all solutions; (3) COM-
BUCB1 which is a baseline algorithm.
In Experiment 2 , we illustrate the effectiveness of PAS-
COMB UCB in satisfying the safety constraint. Furthermore,
we show that if an algorithm ignores the safety constraint, it
will violate the safety constraint â„¦(T)times if there exists
a risky solution. We run PASC OMB UCB andCOMB UCB1
with Set 1 under the constrained case where Â¯Ïƒ= 0.4, the
optimal safe solution is {1,3,4}, and the optimal solution
under the unconstrained case {1,2,3}is unsafe (risky).
In Experiment 3 , we empirically verify the dependence of
the additional regret on the hardness parameter H(âˆ†(Î›))
in(26) using Set 2 . We fix the time horizon T= 2Ã—106
and vary the threshold on the variance from 0.14to0.72
(i.e., Â¯Ïƒ2= 0.14Ã—1.2kfork= 0,1, . . . , 9). As any so-
lution that is comprised of 3items has variance 0.03, we
have âˆ†v
S= Â¯Ïƒ2âˆ’0.03. We compare the additional regret
with respect to 1/(âˆ†v
S)2, which is proportional to H(âˆ†(Î›))
under this setup according to (26).
Experimental Results: ForExperiment 1 , we present the
results in Figure 6(a). We first observe when Â¯Ïƒ2= 0.751,
the regret incurred by PASC OMB UCB is similar to that
byCOMB UCB1 for all Tconsidered, which suggests that
PASC OMB UCB is comparable to COMB UCB1 under theunconstrained case, and hence in the following experiments
we refer the difference between the regret of PASC OM-
BUCB and the regret of COMB UCB1 as the â€œadditional
regretâ€. Secondly, when Â¯Ïƒ2= 0.6, the regret of PAS-
COMB UCB increases rapidly at the beginning and plateaus
when T >4Ã—105. This corroborates the design of PAS-
COMB UCB : (i) at the beginning, PASC OMB UCB pulls
solutions conservatively to meet the anytime-safe constraint
w.h.p.; (ii) after a number of time steps ( T >4Ã—105), the
safeness of the optimal (safe) solution can be ascertained, it
then exploits the optimal solution aggressively and eventu-
ally matches the performance of C OMB UCB1.
ForExperiment 2 , we plot the percentage of times each
algorithm violates the safeness constraint Ïƒ2
At<Â¯Ïƒ2as well
as the cumulative rewards in Figure 6(b). The reward of
PASC OMB UCB increases slowly at the start and then more
rapidly when T >1.5Ã—106, when the safeness of the op-
timal safe solution has been ascertained. However, while
the reward of COMB UCB1 increases linearly (as it pulls
the risky solution {1,2,3}â„¦(T)times), it violates the safe-
ness constraint Ïƒ2
St<Â¯Ïƒ2at almost all times. This implies
that the safety constraint is almost always violated by COM-
BUCB1 (â„¦(T)times) whereas PASC OMB UCB can meet
the probably anytime-safe requirement.
ForExperiment 3 , the results are in Figure 6(c). As sug-
gested by Theorem 4.1, the regret due to safeness checking
is proportional to H(âˆ†(Î›)) . Figure 6(c) indicates that em-
pirically, the additional regret scales linearly in 1/(âˆ†v
S)2,
which corroborates our theoretical results.
Additional discussions on the tightness results, the problem
formulation and comparisons with other literature, as well
as future research directions, are presented in App. E.
Acknowledgements
The authors are supported by Singapore Ministry of Edu-
cation (MOE) grants (Grant Numbers: A-0009042-01-00,
A-8000189-01-00, A-8000980-00-00, A-8000423-00-00)
and funding from CIFAR through Amii and NSERC.
9Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
References
Amani, S., Alizadeh, M., and Thrampoulidis, C. Linear
stochastic bandits under safety constraints. In Proceed-
ings of the 33rd International Conference on Neural Infor-
mation Processing Systems , volume 32, pp. 9256â€“9266,
2019.
Ayyagari, S. and Dukkipati, A. Risk-aware algorithms for
combinatorial semi-bandits, 2021.
Badanidiyuru, A., Kleinberg, R., and Slivkins, A. Bandits
with knapsacks. Journal of the ACM , 65(3), 2018.
Bhat, S. P. and Prashanth, L. A. Concentration of risk mea-
sures: a wasserstein distance approach. In Proceedings
of the 33rd International Conference on Neural Informa-
tion Processing Systems , volume 32, pp. 11762â€“11771.
Curran Associates, Inc., 2019.
Cassel, A., Mannor, S., and Zeevi, A. A general approach to
multi-armed bandits under risk criteria. In Proceedings
of the 31st Conference On Learning Theory , volume 75
ofProceedings of Machine Learning Research , pp. 1295â€“
1306. PMLR, 2018.
Chang, J. Q. L. and Tan, V . Y . F. A unifying theory of
Thompson sampling for continuous risk-averse bandits.
InProceedings of the 36th AAAI Conference on Artificial
Intelligence (AAAI) , 2022.
Chen, W., Wang, Y ., and Yuan, Y . Combinatorial multi-
armed bandit: General framework and applications. In
Proceedings of the 30th International Conference on Ma-
chine Learning , volume 28, pp. 151â€“159. PMLR, 2013.
David, Y ., Sz Â¨orÂ´enyi, B., Ghavamzadeh, M., Mannor, S., and
Shimkin, N. PAC bandits with risk constraints. In ISAIM ,
2018.
Garcelon, E., Ghavamzadeh, M., Lazaric, A., and Pirotta,
M. Improved algorithms for conservative exploration
in bandits. In Proceedings of the AAAI Conference on
Artificial Intelligence , volume 34, pp. 3962â€“3969, 2020.
Hou, Y ., Tan, V . Y . F., and Zhong, Z. Almost optimal
variance-constrained best arm identification. IEEE Trans-
actions on Information Theory , 2023.
Jamieson, K., Malloy, M., Nowak, R., and Bubeck, S.
lilâ€™UCB: An optimal exploration algorithm for multi-
armed bandits. In Proceedings of the 27th Conference on
Learning Theory , volume 35 of Proceedings of Machine
Learning Research , pp. 423â€“439, Barcelona, Spain, 2014.
PMLR.
Kagrecha, A., Nair, J., and Jagannathan, K. Constrained re-
gret minimization for multi-criterion multi-armed bandits.
Machine Learning , 2023.Kaufmann, E., Capp Â´e, O., and Garivier, A. On the com-
plexity of best-arm identification in multi-armed bandit
models. Journal of Machine Learning Research , 17(1):
1â€“42, 2016.
Kazerouni, A., Ghavamzadeh, M., Abbasi-Yadkori, Y ., and
Van Roy, B. Conservative contextual linear bandits. In
Proceedings of the 31st International Conference on Neu-
ral Information Processing Systems , pp. 3913â€“3922. Cur-
ran Associates Inc., 2017.
Khezeli, K. and Bitar, E. Safe linear stochastic bandits.
Proceedings of the AAAI Conference on Artificial Intelli-
gence , 34(06):10202â€“10209, 2020.
Kveton, B., Wen, Z., Ashkan, A., Eydgahi, H., and Eriksson,
B. Matroid bandits: Fast combinatorial optimization
with learning. In Proceedings of the 30th Conference on
Uncertainty in Artificial Intelligence , pp. 420â€“429, 2014.
Kveton, B., Wen, Z., Ashkan, A., and Szepesvari, C.
Tight Regret Bounds for Stochastic Combinatorial Semi-
Bandits. In Proceedings of the 18th International Confer-
ence on Artificial Intelligence and Statistics , volume 38,
pp. 535â€“543. PMLR, 2015.
Mahdavi, M., Jin, R., and Yang, T. Trading regret for
efficiency: Online convex optimization with long term
constraints. Journal of Machine Learning Research , 13
(1):2503â€“2528, 2012.
Moradipari, A., Thrampoulidis, C., and Alizadeh, M. Stage-
wise conservative linear bandits. In Proceedings of the
34th International Conference on Neural Information Pro-
cessing Systems , volume 33, pp. 11191â€“11201. Curran
Associates, Inc., 2020.
Sani, A., Lazaric, A., and Munos, R. Risk-aversion in multi-
armed bandits. In Proceedings of the 25th International
Conference on Neural Information Processing Systems ,
pp. 3275â€“3283. Curran Associates Inc., 2012.
Vakili, S. and Zhao, Q. Risk-averse multi-armed bandit
problems under mean-variance measure. IEEE Journal of
Selected Topics in Signal Processing , 10(6):1093â€“1111,
2016.
Wu, Y ., Shariff, R., Lattimore, T., and Szepesvari, C. Con-
servative bandits. In Proceedings of the 33rd Interna-
tional Conference on Machine Learning , volume 48, pp.
1254â€“1262. PMLR, 2016.
Zhong, Z., Cheung, W. C., and Tan, V . Y . F. Thompson
sampling algorithms for cascading bandits. Journal of
Machine Learning Research , 22(218):1â€“66, 2021.
10Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Zhu, Q. and Tan, V . Y . F. Thompson sampling algorithms
for mean-variance bandits. In Proceedings of the 37th In-
ternational Conference on Machine Learning , pp. 11599â€“
11608. PMLR, 2020.
11Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Appendices
The contents of the appendices are organized as follows:
â€¢ In App. A, we list 3useful lemmas concerning the LIL concentration bound.
â€¢ In App. B, we present detailed proofs of the upper bounds.
â€¢ App. B.1: preliminary results for the proof of the upper bound;
â€¢ App. B.2: the proof of the decomposition lemma Lemma 6.1;
â€¢ App. B.3: the proof of Lemma 6.2 (the regret due to suboptimality);
â€¢ App. B.4: the proof of Lemma 6.3 (the regret due to safeness-checking);
â€¢App. B.5: the proofs of Theorem 4.1 (problem-dependent upper bound) and Theorem 5.1 (problem-independent upper
bound).
â€¢ In App. C, we present detailed proofs of the lower bounds.
â€¢ App. C.1: preliminary results for the proof of the lower bound and the proof of the impossibility result Theorem 4.5.
â€¢ App. C.2: the proof of Theorem 4.3 (problem-dependent lower bound);
â€¢ App. C.3: the proof of Theorem 5.2 (problem-independent lower bound);
â€¢ In App. D, we present a corollary characterizing the tightness of the upper bound in Theorem 4.1.
â€¢In App. E, we provide additional discussions on the tightness results, the problem formulation and comparisons with other
literature, as well as future research directions.
A. Auxiliary results
Lemma A.1 (Lemma 3 in (Jamieson et al., 2014)) .Let{Xi}âˆ
i=1be a sequence of i.i.d. centered sub-Gaussian random
variables with scale parameter Ïƒ. Fix any Ïµâˆˆ(0,1)andÎ´âˆˆ(0,ln(1 + Ïµ)/e). Then one has
P
âˆ€tâˆˆN:tX
s=1Xsâ‰¤(1+âˆšÏµ)s
2Ïƒ2(1+Ïµ)tlnln ((1+ Ïµ)t)
Î´
â‰¥1âˆ’Î¾(Î´),
where Î¾(Î´) :=2+Ïµ
Ïµ Î´
ln(1+ Ïµ)1+Ïµ.
Lemma A.2. Fortâ‰¥1, Ïµâˆˆ(0,1), Ï‰âˆˆ(0,1]andu > 0, letÎ³:=(1+Ïµ)(1+âˆšÏµ)2
2,c:=(uÂ·s)2
Î³=2(uÂ·s)2
(1+Ïµ)(1+âˆšÏµ)2and
m:=Î³
u2Â·s2
2 ln1
Ï‰+ ln ln +1
s2+ ln2Î³(1+Ïµ)
u2
. Ift > m , it holds that
s >lil(t, Ï‰) = (1 +âˆšÏµ)s
1 +Ïµ
2tlnln ((1+ Ïµ)t)
Ï‰
.
Proof of Lemma A.2. Note that fact that
uÂ·sâ‰¤(1 +âˆšÏµ)s
1 +Ïµ
2tlnln ((1+ Ïµ)t)
Ï‰
â‡â‡’c=2(uÂ·s)2
(1 +Ïµ)(1 +âˆšÏµ)2â‰¤1
tlnln ((1+ Ïµ)t)
Ï‰
According to the computations in Jamieson et al. (2014) equation (1), i.e.,
1
tlnln((1 + Ïµ)t)
Ï‰
â‰¥câ€²â‡’tâ‰¤1
câ€²ln2 ln((1 + Ïµ)/(câ€²Ï‰))
Ï‰
fortâ‰¥1, Ïµâˆˆ(0,1), câ€²>0, Ï‰âˆˆ(0,1]. We take câ€²=c, thus
tâ‰¤1
cln2 ln((1 + Ïµ)/(cÏ‰))
Ï‰
=1
c
ln2
Ï‰+ ln
lnÎ³(1 +Ïµ)
u2Â·Ï‰+ ln1
s2
(a)
â‰¤1
c
ln2
Ï‰+ lnÎ³(1 +Ïµ)
u2Â·Ï‰+ ln ln +1
s2
=Î³
u2Â·s2
2 ln1
Ï‰+ ln ln +1
s2+ ln2Î³(1 +Ïµ)
u2
=m
12Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
where we adopt ln(x+y)â‰¤x+ ln ln +y,âˆ€x, yâˆˆR+in(a). Therefore, if t > m , we must have
uÂ·s >(1 +âˆšÏµ)s
1 +Ïµ
2tlnln ((1+ Ïµ)t)
Ï‰
.
Lemma A.3. With the choice of the confidence radii in (2)and(3), for all iâˆˆE, we have
P[âˆ€pâˆˆN:|Ë†Âµi(p)âˆ’Âµi| â‰¤Î±(Ti(p))]â‰¥1âˆ’2Î¾(Ï‰Âµ) (7)
P
âˆ€pâˆˆN:|Ë†Ïƒ2
i(p)âˆ’Ïƒ2
i| â‰¤Î²u(Ti(p))
â‰¥1âˆ’4Î¾(Ï‰v) (8)
P
âˆ€pâˆˆN:|Ë†Ïƒ2
i(p)âˆ’Ïƒ2
i| â‰¤Î²l(Ti(p))
â‰¥1âˆ’4Î¾(Ï‰â€²
v) (9)
Proof. Note the fact that any distribution supported on [0,1]is1/4-sub-Gaussian. By a direct application of Lemma A.1 to
the sample mean Ë†Âµi(p)and the sample second moment Ë†M2,i(p) :=1
Ti(p)Pp
s=1Wi(s)21{iâˆˆAs}of arm iâˆˆ[L],(7)can
be derived and
P[âˆ€pâˆˆN:|Âµiâˆ’Ë†Âµi(p)| â‰¤lil(Ti(p), Ï‰â€²
v)]â‰¥1âˆ’2Î¾(Ï‰â€²
v),and
Ph
âˆ€pâˆˆN:|Ë†M2,i(p)âˆ’(Âµ2
i+Ïƒ2
i)| â‰¤lil(Ti(p), Ï‰â€²
v)i
â‰¥1âˆ’2Î¾(Ï‰â€²
v)
Since the rewards are in [0,1],|Âµ2
iâˆ’Ë†Âµ2
i(p)|=|Âµi+ Ë†Âµi(p)| Â· |Âµiâˆ’Ë†Âµi(p)| â‰¤2Â·lil(Ti(p), Ï‰â€²
v). Using this and the triangle
inequality, we obtain for every pâ‰¥1,
|Ë†Ïƒ2
i(p)âˆ’Ïƒ2
i|=|Âµ2
iâˆ’Ë†Âµ2
i(p)|+|(Âµ2
i+Ïƒ2
i)âˆ’Ë†M2,i(p)|
â‰¤2Â·lil(Ti(p), Ï‰v) + lil( Ti(p), Ï‰v) =Î²u(Ti(p)).
Therefore, (8) is proved. (9) can be similarly obtained.
B. Proof of the Upper Bound
B.1. Proof scheme of the problem-dependent upper bound
In this subsection, we provide technical lemmas that can upper bound the components in R1(Tâ€²)andR2(Tâ€²).
Note that at phase p, the identified solution Apbelongs to one of the 4disjoint sets: (1) Ap=Sâ‹†; (2)S âˆ© B ; (3)Rand (4)
Scâˆ© B, i.e.
1 = 1{Ap=Sâ‹†}+ 1{Apâˆˆ S âˆ© B} + 1{Apâˆˆ R} + 1{Apâˆˆ Scâˆ© B}
and 1{Apâˆˆ B} = 1{Apâˆˆ S âˆ© B} + 1{Apâˆˆ Scâˆ© B} . Define two events (the Fevents) that connect the instance and
the confidence radii
FÂµ
p:=
âˆ†Apâ‰¤2X
iâˆˆAp\Sâ‹†Î±(Ti(pâˆ’1))
Fp(x, Ï) :=
xâ‰¤2X
iâˆˆAplil(Ti(pâˆ’1), Ï)
where xis a constant and Ï‰is a confidence parameter. When Apâˆˆ B, it indicates solution Aphas not been sampled
sufficiently many times and its suboptimality has not been ascertained. When Apâˆˆ Sc, it implies the unsafeness of Aphas
not been recognized. We formalize this in the following lemma.
Lemma B.1. Conditional on the event E, given any pâˆˆ[T], we have
â€¢Sâ‹†âˆˆÂ¯Spâˆ’1;
13Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
â€¢ IfApâˆˆ S âˆ© B ,
1{Apâˆˆ S âˆ© B} â‰¤ 1
FÂµ
p	
;
â€¢ IfApâˆˆ R,
1{Apâˆˆ R} â‰¤ 1
Fpâˆ†v
Ap
3, Ï‰â€²
v
;
â€¢ IfApâˆˆ Scâˆ© B,
1{Apâˆˆ Scâˆ© B} â‰¤ 1
FÂµ
p,Fpâˆ†v
Ap
3, Ï‰â€²
v
.
Proof of Lemma B.1. By the design of PASC OMB UCB , ApâˆˆÂ¯Spâˆ’1.
(1) We firstly prove that SâˆˆÂ¯Spâˆ’1,âˆ€Sâˆˆ S. On the event E, we have
Lv
S(pâˆ’1) =X
iâˆˆAmax{Ë†Ïƒ2
i(pâˆ’1)âˆ’Î²l(Ti(pâˆ’1)),0}
â‰¤X
iâˆˆAmax{Ïƒ2
i,0}
=Ïƒ2
S<Â¯Ïƒ2
Thus, SâˆˆÂ¯Spâˆ’1, and in particular, Sâ‹†âˆˆÂ¯Spâˆ’1.
(2) If Apâˆˆ B, according to the sampling strategy in Line 10ofPASC OMB UCB andSâ‹†âˆˆÂ¯Spâˆ’1, we have UÂµ
Sâ‹†(pâˆ’1)â‰¤
UÂµ
Ap(pâˆ’1)which indicatesP
iâˆˆSâ‹†\ApUÂµ
i(pâˆ’1)â‰¤P
iâˆˆAp\Sâ‹†UÂµ
i(pâˆ’1). Thus,
X
iâˆˆSâ‹†\ApÂµiâ‰¤X
iâˆˆSâ‹†\ApUÂµ
i(pâˆ’1)
â‰¤X
iâˆˆAp\Sâ‹†UÂµ
i(pâˆ’1)
â‰¤X
iâˆˆAp\Sâ‹†Âµi+ 2Î±i(Ti(pâˆ’1))
=â‡’ âˆ†Apâ‰¤2X
iâˆˆAp\Sâ‹†Î±(Ti(pâˆ’1)) (10)
(3) If Apâˆˆ Sc, according to the sampling strategy, we have ApâˆˆÂ¯Spâˆ’1which indicates Lv
Ap(pâˆ’1) =P
iâˆˆApLv
i(pâˆ’1)<
Â¯Ïƒ2. Thus,
Â¯Ïƒ2>Ë†Ïƒ2
Ap(pâˆ’1)âˆ’X
iâˆˆApÎ²l(Ti(pâˆ’1))
â‰¥Ïƒ2
Apâˆ’2X
iâˆˆApÎ²l(Ti(pâˆ’1))
=â‡’ âˆ†v
Apâ‰¤2X
iâˆˆAp\Sâ‹†Î²l(Ti(pâˆ’1)) (11)
Note that if Apâˆˆ S âˆ© B , according to (10),
1{Apâˆˆ S âˆ© B} â‰¤ 1
FÂµ
p	
.
IfApâˆˆ R âŠ‚ Sc, by (11)
1{Apâˆˆ R} â‰¤ 1
Fpâˆ†v
Ap
3, Ï‰â€²
v
.
14Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
IfApâˆˆ Scâˆ© B, by (11) and (10)
1{Apâˆˆ Scâˆ© B} â‰¤ 1
FÂµ
p,Fpâˆ†v
Ap
3, Ï‰â€²
v
At phase p, we define two sequences of mutually-exclusive events {GÂµ
j,p}jâˆˆNand{Gj,p(x, Ï‰}jâˆˆN(theGevents) which can
further bound the number of times FÂµ
pandFv
p(x, Ï‰)occur respectively. These events are indexed by two strictly-decreasing
sequences of constants:
a1> a2> . . . > a k> . . .
1> b1> b2> . . . > b k> . . .
where limjâ†’âˆaj= lim jâ†’âˆbj= 0. For simplicity, we set aj=4
9jâˆ’2,bj=1
4j,âˆ€jâˆˆNand denote the constant
C=P
jâˆˆNaj
bj= 259 .2. For xâˆˆR+andÏ‰âˆˆ(0,ln(1 + Ïµ)/e), define
mj(x, Ï‰) :=ajÂ·Î³K2
x2
2 ln1
Ï‰+ ln ln +1
x2+D
andmj(x, Ï‰) :=âˆotherwise, where (1) Î³=(1+Ïµ)(1+âˆšÏµ)2
2andÏµis the constant in the confidence bounds (3), (2)
ln ln +(x) = ln ln xifxâ‰¥eand it equals to 0otherwise, (3) D= ln 
324K2(1 +Ïµ)2(1 +âˆšÏµ)2
. Denote
GÂµ
j,p:=
iâˆˆAp\Sâ‹†:Ti(pâˆ’1)â‰¤mj(âˆ†Ap, Ï‰Âµ)	
and
Gj,p(x, Ï‰) :={iâˆˆAp:Ti(pâˆ’1)â‰¤mj(x, Ï‰)}
as the sets of items that were not chosen sufficiently often. For jâˆˆN, the events at phase pare sequentially defined as
GÂµ
j,p:=n
at least bjKitems in Ap\Sâ‹†were chosen
at most mj(âˆ†Ap, Ï‰Âµ)timeso\ï£«
ï£­[
kâˆˆ[jâˆ’1]GÂµ
k,pï£¶
ï£¸c
=nGÂµ
j,pâ‰¥bjKo\ï£«
ï£­[
kâˆˆ[jâˆ’1]GÂµ
k,pï£¶
ï£¸c
and
Gj,p(x, Ï‰) :=n
at least bjKitems in Apwere chosen
at most mj(x, Ï‰)timeso\ï£«
ï£­[
kâˆˆ[jâˆ’1]Gk,p(x, Ï‰)ï£¶
ï£¸c
=n
|Gj,p(x, Ï‰)| â‰¥bjKo\ï£«
ï£­[
kâˆˆ[jâˆ’1]Gk,p(x, Ï‰)ï£¶
ï£¸c
Lemma B.2. With our choice of {aj}jâˆˆNand{bj}jâˆˆN,
â€¢ ifFÂµ
poccurs, GÂµ
j,poccurs for some j, i.e.
1
FÂµ
p	
â‰¤ 1ï£±
ï£²
ï£³[
jâˆˆNGÂµ
j,pï£¼
ï£½
ï£¾.
15Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
â€¢ ifFp(x, Ï‰)occurs, Gj,p(x, Ï‰)occurs for some j, i.e.
1{Fp(x, Ï‰)} â‰¤ 1ï£±
ï£²
ï£³[
jâˆˆNGj,p(x, Ï‰)ï£¼
ï£½
ï£¾. (12)
Proof of Lemma B.2. We prove (12) in the following and the other statement can be proved by the same procedures.
To ease the notations, we omit the parameters x, Ï‰ andpinFp(x, Ï‰),Gj,p(x, Ï‰)andmj(x, Ï‰), since they are fixed when
givenFp(x, Ï‰). The event Gjcan be rewritten as
Gj=n
|Gj| â‰¥bjKo\ï£«
ï£­\
kâˆˆ[jâˆ’1]Gc
kï£¶
ï£¸
=n
|Gj| â‰¥bjKo\ï£«
ï£­\
kâˆˆ[jâˆ’1]n
|Gk|< bkKoï£¶
ï£¸
The statement is proved by contradiction. We assume that when F(Fp(x, Ï‰)) occurs, none of event Gjoccurs. Hence,
ï£«
ï£­[
jâˆˆNGjï£¶
ï£¸c
=\
jâˆˆNGc
j
=\
jâˆˆNï£®
ï£°n
|Gj|< bjKo[ï£«
ï£­[
kâˆˆ[jâˆ’1]n
|Gk| â‰¥bkKoï£¶
ï£¸ï£¹
ï£»
=\
jâˆˆNn
|Gj|< bjKo
LetÂ¯Gj:=Ap\Gjand define G0=Ap. According to the definition of Gj, we have GjâŠ‚Gjâˆ’1andÂ¯Gjâˆ’1âŠ‚Â¯Gj,âˆ€jâˆˆN.
Because limjâ†’âˆmj= 0, there exists j0such that Â¯Gj=Ap,âˆ€jâ‰¥j0. Therefore, we can write Apby the â€œtelescopingâ€
sum, i.e., Ap=âˆªjâˆˆN Â¯Gj\Â¯Gjâˆ’1
.Fp(x, Ï‰)indicates
xâ‰¤2X
iâˆˆAplil(Ti(pâˆ’1), Ï‰) (13)
= 2X
jâˆˆNX
iâˆˆÂ¯Gj\Â¯Gjâˆ’1lil(Ti(pâˆ’1), Ï‰)
Note that for iâˆˆÂ¯Gj\Â¯Gjâˆ’1=Gjâˆ’1\Gj, we have Ti(pâˆ’1)âˆˆ(mj, mjâˆ’1]. By Lemma A.2 with parameters
t=Ti(pâˆ’1), s=x, u=q
1
ajK2and note a1> aj, we have
s
1
ajK2Â·x >lil(Ti(pâˆ’1), Ï‰).
Note our choice of ajandbjsatisfy
2X
jâˆˆNbjâˆ’1âˆ’bjâˆšajâ‰¤1
16Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Thus, (13) can be further bounded by
xâ‰¤2X
jâˆˆNX
iâˆˆÂ¯Gj\Â¯Gjâˆ’1lil(Ti(pâˆ’1), Ï‰)
<2X
jâˆˆN|Â¯Gj\Â¯Gjâˆ’1|s
1
ajK2Â·x
â‰¤2X
jâˆˆN(bjâˆ’1âˆ’bj)KâˆšajKx
â‰¤x
which constitutes a contradiction. Thus when Foccurs, there must exists jâˆˆNsuch that Gjoccurs.
When none of the GÂµ
j,p(resp.Gj,p(x, Ï‰)) occurs, FÂµ
p(resp.Fp(x, Ï‰)) must not occur, which indicates all of the items in Ap
have been sampled sufficiently many times such that the suboptimality (resp. unsafeness) of Apis identified, thus Apwill
not been sampled in future phases.
As there will be multiple Fevents happening, we provide the following useful lemma that merges all Fevents.
Lemma B.3. Given two confidence parameters Ï‰1â‰¥Ï‰2âˆˆ(0,ln(1 + Ïµ)/e)
â€¢ IfFÂµ
poccurs, then Fp(âˆ†Ap, Ï‰Âµ)occurs.
â€¢ If both events Fp(x, Ï‰1)andFp(y, Ï‰2)occur, then event Fp
max{x,r
ln1
Ï‰1
ln1
Ï‰2y}, Ï‰1
occurs.
Proof of Lemma B.3. IfFÂµ
poccurs, we have
âˆ†Apâ‰¤2X
iâˆˆAp\Sâ‹†Î±(Ti(pâˆ’1))â‰¤2X
iâˆˆApÎ±(Ti(pâˆ’1)) = 2X
iâˆˆAplil(Ti(pâˆ’1), Ï‰Âµ)
Thus,Fp(âˆ†Ap, Ï‰Âµ)occurs.
For the second statement, notice the fact that
lil(Ti(pâˆ’1), Ï‰1)
lil(Ti(pâˆ’1), Ï‰2)=(1 +âˆšÏµ)
1+Ïµ
2Ti(pâˆ’1)ln ln((1+ Ïµ)Ti(pâˆ’1))
Ï‰11/2
(1 +âˆšÏµ)
1+Ïµ
2tln ln((1+ Ïµ)Ti(pâˆ’1))
Ï‰21/2
=vuutln1
Ï‰1+ ln ln((1 + Ïµ)Ti(pâˆ’1))
ln1
Ï‰2+ ln ln((1 + Ïµ)Ti(pâˆ’1))
(a)
â‰¥vuutln1
Ï‰1
ln1
Ï‰2=:Ï
where (a)utilizes the trick thata+c
b+câ‰¥a
b,âˆ€a, b, câˆˆR+andaâ‰¤b. When event Fp(y, Ï‰2)occurs,
yâ‰¤2X
iâˆˆAplil(Ti(pâˆ’1), Ï‰2)â‰¤2X
iâˆˆAp1
Ï‰lil(Ti(pâˆ’1), Ï‰1)
=â‡’ÏÂ·yâ‰¤2X
iâˆˆAplil(Ti(pâˆ’1), Ï‰1)
=â‡’ F p(Ïy, Ï‰ 1)
Thus if both events Fp(x, Ï‰1)andFp(y, Ï‰2)occur, we must have that event Fp(max{x, Ïy}, Ï‰1)) =
Fp
max{x,r
ln1
Ï‰1
ln1
Ï‰2y}, Ï‰1)
occurs.
17Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
B.2. Upper bound decomposition
Lemma 6.1. Assume that PASC OMB UCB has processed Tâ€²phases with Ttime steps, the expected regret of PASC OM-
BUCB can be decomposed into three parts as follows
E[R(Tâ€²)]â‰¤E[R1(Tâ€²)|E] +E[R2(Tâ€²)|E] + R 3(T)
where R1(Tâ€²) :=Tâ€²X
p=11{Apâˆˆ B}âˆ†Ap
R2(Tâ€²) :=Âµâ‹†Tâ€²X
p=1
2Qâˆ’1X
r=11{Up(r)}
R3(T) := 2 Âµâ‹†L 
1 +T 
Î¾(Ï‰Âµ) + 2Î¾(Ï‰v) + 2Î¾(Ï‰â€²
v
Proof of Lemma 6.1. The expected regret can be decomposed as:
E[R(Tâ€²)] =Eï£®
ï£°Tâ€²X
p=1npX
r=1(Âµâ‹†âˆ’ÂµAp,r)ï£¹
ï£»
=Eï£®
ï£°Tâ€²X
p=1npX
r=1(Âµâ‹†âˆ’ÂµAp,r) 1{E}ï£¹
ï£»+Eï£®
ï£°Tâ€²X
p=1npX
r=1(Âµâ‹†âˆ’ÂµAp,r) 1{Ec}ï£¹
ï£»
=Eï£®
ï£°Tâ€²X
p=1npX
r=1(Âµâ‹†âˆ’ÂµAp,r)Eï£¹
ï£»P[E] +Eï£®
ï£°Tâ€²X
p=1npX
r=1(Âµâ‹†âˆ’ÂµAp,r)Ecï£¹
ï£»P[Ec]
In the initialization stage, it will take at most 2Ltime steps, since each pulled solution Apcontains at least one item iwith
Ti(p)<2. Thus the regret is at most 2LÂ·Âµâ‹†.
The expected regret when the good events fail can be upper bounded by
Eï£®
ï£°Tâ€²X
p=1npX
r=1(Âµâ‹†âˆ’ÂµAp,r)Ecï£¹
ï£»P[Ec]â‰¤Eï£®
ï£°Tâ€²X
p=1npX
r=1Âµâ‹†Ecï£¹
ï£»P[Ec]
â‰¤E"TX
t=1Âµâ‹†Ec#
LÂ·2(Î¾(Ï‰Âµ) + 2Î¾(Ï‰v) + 2Î¾(Ï‰â€²
v))
â‰¤2Âµâ‹†TLÂ·(Î¾(Ï‰Âµ) + 2Î¾(Ï‰v) + 2Î¾(Ï‰â€²
v))
where P[Ec]can be bounded using Lemma A.3.
Conditional on the good event E, the high-probability regret can be upper bounded by
Ë†R(Tâ€²) :=Tâ€²X
p=1npX
r=1(Âµâ‹†âˆ’ÂµAp,r) (14)
=Tâ€²X
p=1
âˆ†Ap+Âµâ‹†(npâˆ’1)
(a)
â‰¤Tâ€²X
p=1"
âˆ†Ap+Âµâ‹†Qâˆ’1X
r=0
2Â· 1{Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2} âˆ’2#
=Tâ€²X
p=1"
âˆ†Ap+Âµâ‹†Qâˆ’1X
r=12Â· 1{Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2}#
18Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
where (a)makes use of Lemma B.4 and the fact if Uv
Ap(pâˆ’1)âˆˆ((mâˆ’1)Â¯Ïƒ2, mÂ¯Ïƒ2], then m=PQâˆ’1
r=01{Uv
Ap(pâˆ’1)>
rÂ¯Ïƒ2}=PQâˆ’1
r=01{Up(r)}. Note the fact that only the suboptimal solutions yields positive mean gap and that the negative
mean gap of the risky solutions can be upper bounded by 0, thus the above equation can be further divided into two parts
Tâ€²X
p=1"
âˆ†Ap+Âµâ‹†Qâˆ’1X
r=12Â· 1{Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2}#
â‰¤Tâ€²X
p=11{Apâˆˆ B}âˆ†Ap+Tâ€²X
p=1Âµâ‹†Qâˆ’1X
r=12Â· 1{Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2}
=: R 1(Tâ€²) + R 2(Tâ€²)
In conclusion, by summarizing the regret from the initialization stage, the regret due to failure of the good event and the
high-probability regret, the expected regret can be bounded by
E[R(Tâ€²)]â‰¤E[R1(Tâ€²)|E]P[E] +E[R2(Tâ€²)|E]P[E] + 2Âµâ‹†Â·TL(Î¾(Ï‰Âµ) + 2Î¾(Ï‰v) + 2Î¾(Ï‰â€²
v)) + 2 Âµâ‹†L
â‰¤E[R1(Tâ€²)|E] +E[R2(Tâ€²)|E] + 2Âµâ‹†Â·TL(Î¾(Ï‰Âµ) + 2Î¾(Ï‰v) + 2Î¾(Ï‰â€²
v)) + 2 Âµâ‹†L
=E[R1(Tâ€²)|E] +E[R2(Tâ€²)|E] + R 3(T)
B.3. Regret due to suboptimality
Lemma 6.2. Conditioned on event E, the regret due to suboptimality R1(Tâ€²)can be bounded by
OX
iâˆˆE\Sâ‹†K
âˆ†i,Sâˆ©B,minln1
Ï‰Âµ+X
iâˆˆEciK
âˆ†i,Scâˆ©B,minln1
Ï‰â€²v
.
Proof of Lemma 6.2. Notice the fact that the suboptimal solution Apcan be safe, i.e. Apâˆˆ S âˆ© B , or unsafe, i.e.,
Apâˆˆ Scâˆ© B, we upper bound the regret under these the two scenarios separately.
Case 1:Apâˆˆ S âˆ© B
By the definition of the event GÂµ
j,p, we have
|GÂµ
j,p|=
iâˆˆAp\Sâ‹†:Ti(pâˆ’1)â‰¤mj(âˆ†Ap, Ï‰Âµ)	â‰¤bjK
which indicates
1
Apâˆˆ S âˆ© B ,GÂµ
j,p	
â‰¤1
bjKX
iâˆˆAp\Sâ‹†1
Apâˆˆ S âˆ© B , Ti(pâˆ’1)â‰¤mj(âˆ†Ap, Ï‰Âµ)	
.
Given an item iâˆˆE\Sâ‹†, assume it is included visolutions in S âˆ© B , we index them according to the decreasing order of
their mean gaps, i.e. {Ai,k}kâˆˆ[vi]withâˆ†Ai,1â‰¥. . .â‰¥âˆ†Ai,vi. Therefore,
TX
p=11{Apâˆˆ S âˆ© B} âˆ†ApÂ· 1{E}
(a)
â‰¤TX
p=11
Apâˆˆ S âˆ© B ,FÂµ
p	
âˆ†Ap
(b)
â‰¤TX
p=1X
jâˆˆN1
Apâˆˆ S âˆ© B ,GÂµ
j,p	
âˆ†Ap
â‰¤TX
p=1X
jâˆˆN1
bjKX
iâˆˆAp\Sâ‹†1
Apâˆˆ S âˆ© B , Ti(pâˆ’1)â‰¤mj(âˆ†Ap, Ï‰Âµ)	
âˆ†Ap
19Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
â‰¤TX
p=1X
jâˆˆN1
bjKX
iâˆˆE\Sâ‹†X
kâˆˆ[vi]1
Ai,k=Ap, iâˆˆAp, Ti(pâˆ’1)â‰¤mj(âˆ†Ai,k, Ï‰Âµ)	
âˆ†Ai,k
â‰¤X
iâˆˆE\Sâ‹†X
jâˆˆNTX
p=1X
kâˆˆ[vi]âˆ†Ai,k
bjK1
Ai,k=Ap, iâˆˆAi,k, Ti(pâˆ’1)â‰¤ajÂ·Î³K2
âˆ†2
Ai,k
2 ln1
Ï‰Âµ+ ln ln +1
âˆ†2
Ai,k+D
(c)
â‰¤X
iâˆˆE\Sâ‹†X
jâˆˆNTX
p=1X
kâˆˆ[vi]âˆ†Ai,k
bjK1
Ai,k=Ap, iâˆˆAi,k, Ti(pâˆ’1)â‰¤ajÂ·Î³K2
âˆ†2
Ai,k
2 ln1
Ï‰Âµ+ ln ln +1
âˆ†2
Ai,vi+D
(d)
â‰¤X
iâˆˆE\Sâ‹†X
jâˆˆNajÂ·Î³K2
bjK
2 ln1
Ï‰Âµ+ ln ln +1
âˆ†2
Ai,vi+D 
1
âˆ†Ai,vi+viâˆ’1X
k=2âˆ†Ai,k+11
âˆ†2
Ai,k+1âˆ’1
âˆ†2
Ai,k!
â‰¤X
iâˆˆE\Sâ‹†2CÎ³K
âˆ†Ai,vi
2 ln1
Ï‰Âµ+ ln ln +1
âˆ†2
Ai,vi+D
where (a)andbmake use of Lemma B.1 and Lemma B.2, (c)is obtained by relaxing ln ln +1
âˆ†Ai,ktoln ln +1
âˆ†Ai,vi,(d)is
obtained by solving the optimization problem.
Case 2:Apâˆˆ Scâˆ© B
For the case where Ï‰Âµâ‰¤Ï‰â€²
v, denote Â¯Ï‰:=r
ln1
Ï‰â€²v
ln1
Ï‰Âµ. Given an item iâˆˆE, assume it is included visolutions in
Scâˆ© B, we index them according to the decreasing order of their gaps Â¯âˆ†A:= maxn
Â¯Ï‰âˆ†A,âˆ†v
A
3o
, i.e.{Ai,k}kâˆˆ[vi]with
Â¯âˆ†Ai,1â‰¥. . .â‰¥Â¯âˆ†Ai,vi. Denote ci:= max kâˆˆ[vi]âˆ†Ai,k
Â¯âˆ†Ai,k2
,ki= arg maxkâˆˆ[vi]âˆ†Ai,kanddi= min kâˆˆ[vi]âˆ†Ai,k, i.e., the
minimum mean gap.
We have
TX
p=11{Apâˆˆ Scâˆ© B} âˆ†ApÂ· 1{E}
(a)
â‰¤TX
p=11
Apâˆˆ Scâˆ© B,FÂµ
p,Fpâˆ†v
Ap
3, Ï‰â€²
v
âˆ†Ap
(b)
â‰¤TX
p=11
Apâˆˆ Scâˆ© B,Fp
max
Â¯Ï‰âˆ†Ap,âˆ†v
Ap
3
, Ï‰â€²
v
âˆ†Ap
(c)
â‰¤TX
p=1X
jâˆˆN1
Apâˆˆ Scâˆ© B,Gj,p
max
Â¯Ï‰âˆ†Âµ,âˆ†v
Ap
3
, Ï‰â€²
v
âˆ†Ap
â‰¤TX
p=1X
jâˆˆN1
bjKX
iâˆˆAp1
Apâˆˆ Scâˆ© B, Ti(pâˆ’1)â‰¤mj Â¯âˆ†Ap, Ï‰â€²
v	
âˆ†Ap
=TX
p=1X
jâˆˆN1
bjKX
iâˆˆE\Sâ‹†X
kâˆˆ[vi]1
Ai,k=Ap, iâˆˆAp, Ti(pâˆ’1)â‰¤mj Â¯âˆ†Ap, Ï‰â€²
v	
âˆ†Ai,k
â‰¤X
iâˆˆEX
jâˆˆNTX
p=1X
kâˆˆ[vi]âˆ†Ai,k
bjK1
Ai,k=Ap, iâˆˆAi,k, Ti(pâˆ’1)â‰¤ajÂ·Î³K2
Â¯âˆ†2
Ai,k
2 ln1
Ï‰â€²v+ ln ln +1
Â¯âˆ†2
Ai,k+D
(d)
â‰¤X
iâˆˆEX
jâˆˆNTX
p=1X
kâˆˆ[vi]âˆ†Ai,k
bjK1(
Ai,k=Ap, iâˆˆAi,k, Ti(pâˆ’1)â‰¤ajÂ·Î³K2
Â¯âˆ†2
Ai,k 
2 ln1
Ï‰â€²v+ ln ln +1
Â¯âˆ†2
Ai,vi+D!)
(15)
20Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
(e)
â‰¤X
iâˆˆEX
jâˆˆNajÂ·Î³K2
bjK 
2 ln1
Ï‰â€²v+ ln ln +1
Â¯âˆ†2
Ai,vi+D!ci
di+ciÂ·1
diâˆ’1
âˆ†Ai,ki
â‰¤X
iâˆˆE2ciÂ·CÎ³K
di 
2 ln1
Ï‰â€²v+ ln ln +1
Â¯âˆ†2
Ai,vi+D!
where (a)comes from Lemma B.1, (b)results from Lemma B.3, (c)is due to Lemma B.2, (d)is obtained by relaxing
ln ln +1
Â¯âˆ†2
Ai,ktoln ln +1
Â¯âˆ†2
Ai,viand(e)is achieved by solving the optimization problem in (15):
TX
p=1X
kâˆˆ[vi]âˆ†Ai,k
bjK1(
Ai,k=Ap, iâˆˆAi,k, Ti(pâˆ’1)â‰¤ajÂ·Î³K2
Â¯âˆ†2
Ai,k 
2 ln1
Ï‰â€²v+ ln ln +1
Â¯âˆ†2
Ai,vi+D!)
â‰¤ajÂ·Î³K2
bjK 
2 ln1
Ï‰â€²v+ ln ln +1
Â¯âˆ†2
Ai,vi+D!
Â· 
ci
di+Zâˆ†Ai,ki
dici
x2dx!
=ajÂ·Î³K2
bjK 
2 ln1
Ï‰â€²v+ ln ln +1
Â¯âˆ†2
Ai,vi+D!ci
di+ciÂ·1
diâˆ’1
âˆ†Ai,ki
In conclusion , foriâˆˆE\Sâ‹†, denote
âˆ†i,Sâˆ©B,min:= min
Sâˆ‹i,SâˆˆSâˆ©Bâˆ†S
ForiâˆˆE, denote
âˆ†i,Scâˆ©B,min:= min
Sâˆ‹i,SâˆˆScâˆ©Bâˆ†S
Â¯âˆ†â€²
i,Scâˆ©B:= min
Sâˆ‹i,SâˆˆScâˆ©Bmax{Â¯Ï‰âˆ†S,âˆ†v
S/3}
ci:= max
Sâˆ‹i,SâˆˆScâˆ©Bâˆ†S
max{Â¯Ï‰âˆ†S,âˆ†v
S/3}2
The regret due to suboptimality can be upper bounded by
R1(T)â‰¤X
iâˆˆE\Sâ‹†2CÎ³K
âˆ†i,Sâˆ©B,min 
2 ln1
Ï‰Âµ+ ln ln +1
âˆ†2
i,Sâˆ©B,min+D!
+X
iâˆˆE2ciÂ·CÎ³K
âˆ†i,Scâˆ©B,min 
2 ln1
Ï‰â€²v+ ln ln +1
(Â¯âˆ†â€²
i,Scâˆ©B)2+D!
B.4. Regret due to safeness-checking
We firstly introduce two more technical lemmas in order to upper bound the regret. We characterize the number of
sub-solutions npin Algorithm 2 by the following lemma.
Lemma B.4. At any phase p, we have P[npâ‰¤Q] = 1 . Furthermore, if Uv
Ap(pâˆ’1)âˆˆ((mâˆ’1)Â¯Ïƒ2, mÂ¯Ïƒ2]for some mâˆˆN,
thenmâ‰¤npâ‰¤2mâˆ’1.
Proof of Lemma B.4. Recall that an absolutely safe solution Sis safe w.p. 1andSâˆˆ Spâˆ’1, thus|Ap,r| â‰¥q,âˆ€râˆˆ[npâˆ’1].
Ifnp> Q, i.e.npâ‰¥Q+ 1, then
Kâ‰¥ |Ap|=npX
r=1|Ap,r|>QX
r=1|Ap,r| â‰¥QÂ·qâ‰¥K
21Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
which constitutes a contradiction. Therefore, we have P[npâ‰¤Q] = 1 .
IfUv
Ap(pâˆ’1)âˆˆ((mâˆ’1)Â¯Ïƒ2, mÂ¯Ïƒ2]for some mâˆˆN+, we sequentially define {j1, j2, . . .} âŠ‚[|Ap|]as follows: denote
j0:= 0 and let j1be the integer such that
j1âˆ’1X
s=1Uv
is(pâˆ’1)â‰¤Â¯Ïƒ2andj1X
s=1Uv
is(pâˆ’1)>Â¯Ïƒ2.
Then let j2> j1be the integer such that
j2âˆ’1X
s=j1+1Uv
is(pâˆ’1)â‰¤Â¯Ïƒ2andj2X
s=j1+1Uv
is(pâˆ’1)>Â¯Ïƒ2.
...
The last integer jk=|Ap|satisfies
0<jkX
s=jkâˆ’1+1Uv
is(pâˆ’1)â‰¤Â¯Ïƒ2.
Ifkâ‰¥m+ 1, we must have
Uv
At(pâˆ’1) =kX
l=1jlX
s=jlâˆ’1+1Uv
is(pâˆ’1)
â‰¥mX
l=1jlX
s=jlâˆ’1+1Uv
is(pâˆ’1)> mÂ¯Ïƒ2
which contradicts with Uv
Ap(pâˆ’1)âˆˆ((mâˆ’1)Â¯Ïƒ2, mÂ¯Ïƒ2]. Hence, kâ‰¤m. Then we construct the sub-solutions by
Ap,l={ijlâˆ’1+1, . . . , i jlâˆ’1},âˆ€lâˆˆ[kâˆ’1]
and Ap,k={ijkâˆ’1+1, . . . , i jk}.
There are kâˆ’1items{ijl:lâˆˆ[kâˆ’1]}left which will compose at most kâˆ’1additional sub-solutions. In conclusion, we
need at most 2mâˆ’1sub-solutions, i.e., npâ‰¤2mâˆ’1. Obviously, we need at least msub-solutions since Â¯Ïƒ2> Ïƒ2. So
mâ‰¤npâ‰¤2mâˆ’1.
Remark B.5. Indexing the items in Line 3ofGREEDY -SPLIT can be done arbitrarily, i.e., it does not require any specific
order of the items. As such, GREEDY -SPLIT is an efficient greedy algorithm. We note that finding the optimal order that
leads to the minimum number of sub-solutions npis a combinatorial problem which is generally hard to solve.
Due to the fact that the upper confidence of any solution Ssatisfies Uv
S(p)â‰¤QÂ¯Ïƒ2, thus npcan at most be 2Qâˆ’1.
Lemma 6.1 implies the key to upper bound the regret due to safeness-checking is to upper boundPQâˆ’1
r=11{Up(r)}over the
horizon T. From the definition of Up(r) :={Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2}, forr1, r2âˆˆ[Qâˆ’1]withr1> r2, event Up(r1)indicates
eventUp(r2). Thus in order to upper boundPQâˆ’1
r=11{Up(r)}, it suffices to upper bound 1{Up(r)}forrâˆˆ[Qâˆ’1]. To be
more specific, given lâˆˆ[Qâˆ’1], in order to compute the maximum number of timesPQâˆ’1
r=11{Up(r)} â‰¥l, we only need to
compute the maximum number of times event Up(l)occurs.
In the following lemma, we show a necessary condition (in terms of event Fp(x, Ï‰)) for event Up(r).
Lemma B.6. On the event E,
â€¢ for Apâˆˆ S:
1{Up(r)} â‰¤ 1(
Fp 
(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3, Ï‰v!)
22Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
â€¢ for Apâˆˆ Sc
1{Up(r)} â‰¤ 1(
Fp 
(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3, Ï‰v!)
Proof of Lemma B.6. The proof is straightforward
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2
(a)â‡’Ë†Ïƒ2
Ap(pâˆ’1) +X
iâˆˆApÎ²u(Ti(pâˆ’1))> rÂ¯Ïƒ2
(b)â‡’Ïƒ2
Ap+ 2X
iâˆˆApÎ²u(Ti(pâˆ’1))> rÂ¯Ïƒ2
â‡’2X
iâˆˆAp3Â·lil(Ti(pâˆ’1), Ï‰v)>(râˆ’1)Â¯Ïƒ2+ (Â¯Ïƒ2âˆ’Ïƒ2
Ap)
where (a)is due to the definition of the confidence bounds for a solution (4), and (b)utilizes the eventT
iâˆˆApEi,Ti(pâˆ’1).
ForApâˆˆ S , the above event is equivalent to Fp
(râˆ’1)Â¯Ïƒ2+âˆ†v
Ap
3, Ï‰v
; and for Apâˆˆ Sc, it is equivalent to
Fp
(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3, Ï‰v
.
The above lemma and Lemma B.1 upper bound the components in R2(Tâ€²)by the Fevents.
We are now ready to bound the regret due to safeness checking.
Lemma 6.3. On the event E, ifTâ€²âˆˆ[Tâ€²
râ€², Tâ€²
râ€²âˆ’1)then
R2(Tâ€²)â‰¤2Âµâ‹†[Tâ€²(râ€²âˆ’1) +H(râ€²,Î›)]â‰¤2Âµâ‹†H(1,Î›)
Proof of Lemma 6.3. From Lemma 6.1, the high-probability regret due to safeness-checking is
R2(Tâ€²) =Âµâ‹†Tâ€²X
p=1"
2Qâˆ’1X
r=11{Up(r)}#
= 2Âµâ‹†Qâˆ’1X
r=1Tâ€²X
p=11{Up(r)}
In the following, given râˆˆ[Qâˆ’1], we are going to upper boundPTâ€²
p=1 1{Up(r)}conditional on event E. When
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2holds, there are at most 2r+ 1solutions being chosen at phase p, i.e. npâ‰¤2r+ 1, according to
Lemma B.4. Therefore, we are also deriving an upper bound for number of phases in which there are at most 2r+ 1
sub-solutions being sampled.
The proof scheme is planned as follows: in Step 1 , we decompose the event Up(r)into4events according to where Aplies,
i.e. (1) Ap=Sâ‹†; (2)S âˆ© B ; (3)Rand (4) Scâˆ© B. We will upper bound the regret under each of these cases.
InStep 2 , we apply Lemma B.1 to upper bound the number of times a solution Acan be selected via the events FÂµ
pand
Fp(x, Ï‰). Because there will be multiple FÂµ
pandFp(x, Ï‰)events in the indicator function, Lemma B.3 will be adopted to
merge them into one event. After that, Lemma B.2 is utilized to bridge the number of times a solution is identified to the
number of times of an item is sampled. At the end of this step, we conclude the number of times 1{Up(r)}occurs under the
four cases.
InStep 3 , we upper boundPQâˆ’1
r=1PTâ€²
p=11{Up(r)}based on the results from Step 2.
23Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Step 1: We decomposePTâ€²
p=11{Up(r)}conditional on event Einto four parts:
Tâ€²X
p=11{Up(r)}
â‰¤Tâ€²X
p=11n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
=Tâ€²X
p=1
1{Ap=Sâ‹†}+ 1{Apâˆˆ S âˆ© B} + 1{Apâˆˆ R} + 1{Apâˆˆ Scâˆ© B}
Â· 1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
=Tâ€²X
p=11{Ap=Sâ‹†} 1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
+Tâ€²X
p=11{Apâˆˆ S âˆ© B} 1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
+Tâ€²X
p=11{Apâˆˆ R} 1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
+Tâ€²X
p=11{Apâˆˆ Scâˆ© B}
1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
Step 2: For each of the scenarios, we firstly upper bound the regret by the â€œ Feventsâ€ and they can be further bounded in
terms of â€œ Geventsâ€.
Case 1: Ap=Sâ‹†
Tâ€²X
p=11{Ap=Sâ‹†} 1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
(a)
â‰¤Tâ€²X
p=11{Ap=Sâ‹†} 1(
Fp 
(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3, Ï‰v!)
(b)
â‰¤Tâ€²X
p=1X
jâˆˆN1{Ap=Sâ‹†} 1(
Gj,p 
(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3, Ï‰v!)
(c)
â‰¤Tâ€²X
p=1X
jâˆˆN1{Ap=Sâ‹†}1
bjKX
iâˆˆAp1(
Ti(pâˆ’1)â‰¤mj 
(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3, Ï‰v!)
=X
iâˆˆSâ‹†X
jâˆˆNTâ€²X
p=11
bjK1
Ti(pâˆ’1)â‰¤mj(râˆ’1)Â¯Ïƒ2+ âˆ†v
Sâ‹†
3, Ï‰v
â‰¤X
iâˆˆSâ‹†X
jâˆˆN1
bjKmj(râˆ’1)Â¯Ïƒ2+ âˆ†v
Sâ‹†
3, Ï‰v
=X
iâˆˆSâ‹†X
jâˆˆNajÂ·Î³K2
bjK9
((râˆ’1)Â¯Ïƒ2+ âˆ†v
Sâ‹†)2
2 ln1
Ï‰v+ ln ln +1
((râˆ’1)Â¯Ïƒ2+ âˆ†v
Sâ‹†)2+D
â‰¤X
iâˆˆSâ‹†CÂ·9Â·Î³K
((râˆ’1)Â¯Ïƒ2+ âˆ†v
Sâ‹†)2
2 ln1
Ï‰v+ ln ln +1
âˆ†v
Sâ‹†2+D
where (a)utilizes Lemma B.6, (b)makes use of Lemma B.2 and (c)follows the definition of Gj,p. For simplicity, we denote
gSâ‹†(r,âˆ†v
Sâ‹†) =CÂ·9Â·Î³K
((râˆ’1)Â¯Ïƒ2+ âˆ†v
Sâ‹†)2
2 ln1
Ï‰v+ ln ln +1
âˆ†v
Sâ‹†2+D
.
24Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Thus
Tâ€²X
p=11{Ap=Sâ‹†} 1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
â‰¤X
iâˆˆSâ‹†gSâ‹†(r,âˆ†v
Sâ‹†)
Case 2: Apâˆˆ S âˆ© B
Under this case, there will be a comparison between Ï‰ÂµandÏ‰vthus we denote ËœÏ‰=r
ln1
Ï‰Âµ
ln1
Ï‰v. For iâˆˆE, denote
Â¯âˆ†i,Sâˆ©B:= min Sâˆ‹i,SâˆˆSâˆ©B max
âˆ†Sâˆš
ln(1/Ï‰Âµ),âˆ†v
S
3âˆš
ln(1/Ï‰v)
which is achieved by solution Si,Sâˆ©B, and assume Â¯âˆ†i,Sâˆ©Bâˆˆ
(riÂ¯Ïƒ2
3âˆš
ln(1/Ï‰v),(ri+1)Â¯Ïƒ2
3âˆš
ln(1/Ï‰v)]for some riâˆˆN.
Scenario 1: Ï‰Âµâ‰¥Ï‰v
We firstly deal with the case where Ï‰Âµâ‰¥Ï‰v, i.e., ËœÏ‰â‰¤1. We have
Tâ€²X
p=11{Apâˆˆ S âˆ© B} 1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
(a)
â‰¤Tâ€²X
p=11{Apâˆˆ S âˆ© B} 1(
FÂµ
p,Fp 
(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3, Ï‰v!)
(b)
â‰¤Tâ€²X
p=11{Apâˆˆ S âˆ© B} 1(
Fp 
âˆ†Ap, Ï‰Âµ
,Fp 
(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3, Ï‰v!)
(c)
â‰¤Tâ€²X
p=11{Apâˆˆ S âˆ© B} 1(
Fp 
max(
âˆ†Ap,ËœÏ‰(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3)
, Ï‰Âµ!)
(d)
â‰¤Tâ€²X
p=1X
jâˆˆN1{Apâˆˆ S âˆ© B} 1(
Gj,p 
max(
âˆ†Ap,ËœÏ‰(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3)
, Ï‰Âµ!)
(e)
â‰¤Tâ€²X
p=1X
jâˆˆN1{Apâˆˆ S âˆ© B}1
bjKX
iâˆˆAp1(
Ti(pâˆ’1)â‰¤mj 
max(
âˆ†Ap,ËœÏ‰(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3)
, Ï‰Âµ!)
=X
iâˆˆEX
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ S âˆ© B} 1(
iâˆˆAp, Ti(pâˆ’1)â‰¤mj 
max(
âˆ†Ap,ËœÏ‰(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3)
, Ï‰Âµ!)
(16)
where (a)utilizes Lemma B.6, (b)and(c)make use of Lemma B.3, (d)is due to Lemma B.2 and (e)follows the definition
ofGj,p.
Given iâˆˆE,
(1) if râ‰¥ri+ 2, for any Sâˆˆ S âˆ© B that contains item i,
max
âˆ†S,ËœÏ‰(râˆ’1)Â¯Ïƒ2+ âˆ†v
S
3
â‰¥ËœÏ‰(râˆ’1)Â¯Ïƒ2
3â‰¥ËœÏ‰(ri+ 1)Â¯Ïƒ2
3â‰¥s
ln1
Ï‰ÂµÂ·Â¯âˆ†i,Sâˆ©B.
Thus,
X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ S âˆ© B} 1(
iâˆˆAp, Ti(pâˆ’1)â‰¤mj 
max(
âˆ†Ap,ËœÏ‰(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3)
, Ï‰Âµ!)
X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ S âˆ© B} 1
iâˆˆAp, Ti(pâˆ’1)â‰¤mj
ËœÏ‰(râˆ’1)Â¯Ïƒ2
3, Ï‰Âµ
25Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
=X
jâˆˆN1
bjKmj
ËœÏ‰(râˆ’1)Â¯Ïƒ2
3, Ï‰Âµ
=X
jâˆˆNajÂ·Î³K2
bjK9
((râˆ’1)Â¯Ïƒ2)2
2 ln1
Ï‰v+1
ËœÏ‰2ln ln +9
(ËœÏ‰(râˆ’1)Â¯Ïƒ2)2+1
ËœÏ‰2D
â‰¤CÂ·9Â·Î³K
((râˆ’1)Â¯Ïƒ2)2 
2 ln1
Ï‰v+1
ËœÏ‰2ln ln +1
ln(1/Ï‰Âµ)Â¯âˆ†2
i,Sâˆ©B+1
ËœÏ‰2D!
=CÂ·Î³K
((râˆ’1)Â¯Ïƒ2
3âˆš
ln(1/Ï‰v))2 
2 +1
ln(1/Ï‰Âµ)ln ln +1
ln(1/Ï‰Âµ)Â¯âˆ†2
i,Sâˆ©B+1
ln(1/Ï‰Âµ)D!
(2) if râ‰¤ri+ 1, for any Sâˆˆ S âˆ© B that contains item i
max
âˆ†S,ËœÏ‰(râˆ’1)Â¯Ïƒ2+ âˆ†v
S
3
â‰¥max
âˆ†S,ËœÏ‰âˆ†v
S
3
â‰¥s
ln1
Ï‰ÂµÂ·Â¯âˆ†i,Sâˆ©B.
Thus,
X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ S âˆ© B} 1(
iâˆˆAp, Ti(pâˆ’1)â‰¤mj 
max(
âˆ†Ap,ËœÏ‰(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3)
, Ï‰Âµ!)
â‰¤X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ S âˆ© B} 1(
iâˆˆAp, Ti(pâˆ’1)â‰¤mj s
ln1
Ï‰ÂµÂ·Â¯âˆ†i,Sâˆ©B, Ï‰Âµ!)
(a)
â‰¤X
jâˆˆN1
bjKmj s
ln1
Ï‰ÂµÂ·Â¯âˆ†i,Sâˆ©B, Ï‰Âµ!
=X
jâˆˆNajÂ·Î³K2
bjK1
(q
ln1
Ï‰ÂµÂ·Â¯âˆ†i,Sâˆ©B)2ï£«
ï£­2 ln1
Ï‰Âµ+ ln ln +1
(q
ln1
Ï‰ÂµÂ·Â¯âˆ†i,Sâˆ©B)2+Dï£¶
ï£¸
â‰¤CÂ·Î³K
Â¯âˆ†2
i,Sâˆ©B 
2 +1
ln(1/Ï‰Âµ)ln ln +1
ln(1/Ï‰Âµ)Â¯âˆ†2
i,Sâˆ©B+1
ln(1/Ï‰Âµ)D!
where (a)is achieved by sampling Ai,Sâˆ©B. Therefore, if we denote gSâˆ©B,1(r,Â¯âˆ†i,Sâˆ©B) :=
ï£±
ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£³CÎ³K
((râˆ’1)Â¯Ïƒ2
3âˆš
ln(1/Ï‰v))2 
2 +1
ln(1/Ï‰Âµ)ln ln +1
ln(1/Ï‰Âµ)Â¯âˆ†2
i,Sâˆ©B+1
ln(1/Ï‰Âµ)D!
, râ‰¥$
3p
ln(1/Ï‰v)Â·Â¯âˆ†i,Sâˆ©B
Â¯Ïƒ2%
+ 2
CÎ³K
Â¯âˆ†2
i,Sâˆ©B 
2 +1
ln(1/Ï‰Âµ)ln ln +1
ln(1/Ï‰Âµ)Â¯âˆ†2
i,Sâˆ©B+1
ln(1/Ï‰Âµ)D!
, râ‰¤$
3p
ln(1/Ï‰v)Â·Â¯âˆ†i,Sâˆ©B
Â¯Ïƒ2%
+ 1
then (16) can be upper bounded by
X
iâˆˆEgSâˆ©B,1(r,Â¯âˆ†i,Sâˆ©B)
Scenario 2: Ï‰Âµâ‰¤Ï‰v
26Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
For the case where Ï‰Âµâ‰¤Ï‰v, i.e., ËœÏ‰â‰¥1. We have
Tâ€²X
p=11{Apâˆˆ S âˆ© B} 1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
(a)
â‰¤Tâ€²X
p=11{Apâˆˆ S âˆ© B} 1(
FÂµ
p,Fp 
(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3, Ï‰v!)
(b)
â‰¤Tâ€²X
p=11{Apâˆˆ S âˆ© B} 1(
Fp 
âˆ†Ap, Ï‰Âµ
,Fp 
(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3, Ï‰v!)
(c)
â‰¤Tâ€²X
p=11{Apâˆˆ S âˆ© B} 1(
Fp 
max(
âˆ†Ap
ËœÏ‰,(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3)
, Ï‰v!)
(d)
â‰¤Tâ€²X
p=1X
jâˆˆN1{Apâˆˆ S âˆ© B} 1(
Gj,p 
max(
âˆ†Ap
ËœÏ‰,(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3)
, Ï‰v!)
(e)
â‰¤Tâ€²X
p=1X
jâˆˆN1{Apâˆˆ S âˆ© B}1
bjKX
iâˆˆAp1(
Ti(pâˆ’1)â‰¤mj 
max(
âˆ†Ap
ËœÏ‰,(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3)
, Ï‰v!)
=X
iâˆˆEX
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ S âˆ© B} 1(
iâˆˆAp, Ti(pâˆ’1)â‰¤mj 
max(
âˆ†Ap
ËœÏ‰,(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3)
, Ï‰v!)
(17)
Given iâˆˆE,
(1) if râ‰¥ri+ 2, for any Sâˆˆ S âˆ© B that contains item i,
maxâˆ†S
ËœÏ‰,(râˆ’1)Â¯Ïƒ2+ âˆ†v
S
3
â‰¥(râˆ’1)Â¯Ïƒ2
3â‰¥(ri+ 1)Â¯Ïƒ2
3â‰¥r
ln1
Ï‰vÂ·Â¯âˆ†i,Sâˆ©B.
Thus,
X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ S âˆ© B} 1(
iâˆˆAp, Ti(pâˆ’1)â‰¤mj 
max(
âˆ†Ap
ËœÏ‰,(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3)
, Ï‰v!)
â‰¤X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ S âˆ© B} 1
iâˆˆAp, Ti(pâˆ’1)â‰¤mj(râˆ’1)Â¯Ïƒ2
3, Ï‰v
=X
jâˆˆN1
bjKmj(râˆ’1)Â¯Ïƒ2
3, Ï‰v
=X
jâˆˆNajÂ·Î³K2
bjK9
((râˆ’1)Â¯Ïƒ2)2
2 ln1
Ï‰v+ ln ln +9
((râˆ’1)Â¯Ïƒ2)2+D
â‰¤CÂ·9Â·Î³K
((râˆ’1)Â¯Ïƒ2)2 
2 ln1
Ï‰v+ ln ln +1
ln(1/Ï‰v)Â¯âˆ†2
i,Sâˆ©B+D!
=CÂ·Î³K
((râˆ’1)Â¯Ïƒ2
3âˆš
ln(1/Ï‰v))2 
2 +1
ln(1/Ï‰v)ln ln +1
ln(1/Ï‰v)Â¯âˆ†2
i,Sâˆ©B+1
ln(1/Ï‰v)D!
(2) if râ‰¤ri+ 1, for any Sâˆˆ S âˆ© B that contains item i,
maxâˆ†S
ËœÏ‰,(râˆ’1)Â¯Ïƒ2+ âˆ†v
S
3
â‰¥maxâˆ†S
ËœÏ‰,âˆ†v
S
3
â‰¥r
ln1
Ï‰vÂ·Â¯âˆ†i,Sâˆ©B.
27Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Thus,
X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ S âˆ© B} 1(
iâˆˆAp, Ti(pâˆ’1)â‰¤mj 
max(
âˆ†Ap
ËœÏ‰,(râˆ’1)Â¯Ïƒ2+ âˆ†v
Ap
3)
, Ï‰v!)
â‰¤X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ S âˆ© B} 1
iâˆˆAp, Ti(pâˆ’1)â‰¤mjr
ln1
Ï‰vÂ·Â¯âˆ†i,Sâˆ©B, Ï‰v
=X
jâˆˆN1
bjKmjr
ln1
Ï‰vÂ·Â¯âˆ†i,Sâˆ©B, Ï‰v
=X
jâˆˆNajÂ·Î³K2
bjK1
(q
ln1
Ï‰vÂ·Â¯âˆ†i,Sâˆ©B)2ï£«
ï£­2 ln1
Ï‰v+ ln ln +1
(q
ln1
Ï‰vÂ·Â¯âˆ†i,Sâˆ©B)2+Dï£¶
ï£¸
â‰¤CÂ·Î³K
Â¯âˆ†2
i,Sâˆ©B 
2 +1
ln(1/Ï‰v)ln ln +1
ln(1/Ï‰v)Â¯âˆ†2
i,Sâˆ©B+1
ln(1/Ï‰v)D!
Therefore, if we denote gSâˆ©B,2(r,Â¯âˆ†i,Sâˆ©B) :=
ï£±
ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£³CÎ³K
((râˆ’1)Â¯Ïƒ2
3âˆš
ln(1/Ï‰v))2 
2 +1
ln(1/Ï‰v)ln ln +1
ln(1/Ï‰v)Â¯âˆ†2
i,Sâˆ©B+1
ln(1/Ï‰v)D!
, râ‰¥$
3p
ln(1/Ï‰v)Â·Â¯âˆ†i,Sâˆ©B
Â¯Ïƒ2%
+ 2
CÎ³K
Â¯âˆ†2
i,Sâˆ©B 
2 +1
ln(1/Ï‰v)ln ln +1
ln(1/Ï‰v)Â¯âˆ†2
i,Sâˆ©B+1
ln(1/Ï‰v)D!
, râ‰¤$
3p
ln(1/Ï‰v)Â·Â¯âˆ†i,Sâˆ©B
Â¯Ïƒ2%
+ 1
then (17) can be upper bounded byX
iâˆˆEgSâˆ©B,2(r,Â¯âˆ†i,Sâˆ©B).
In conclusion, for iâˆˆE, we denote Â¯âˆ†i,Sâˆ©B:= min Sâˆ‹i,SâˆˆSâˆ©B max
âˆ†Sâˆš
ln(1/Ï‰Âµ),âˆ†v
A
3âˆš
ln(1/Ï‰v)
,Ï‰Âµv:= max {Ï‰Âµ, Ï‰v}and
gSâˆ©B(r,Â¯âˆ†i,Sâˆ©B) :=
ï£±
ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£³CÎ³K
((râˆ’1)Â¯Ïƒ2
3âˆš
ln(1/Ï‰v))2 
2 +1
ln(1/Ï‰Âµv) 
ln ln +1
ln(1/Ï‰Âµv)Â¯âˆ†2
i,Sâˆ©B+D!!
, râ‰¥$
3p
ln(1/Ï‰v)Â·Â¯âˆ†i,Sâˆ©B
Â¯Ïƒ2%
+ 2
CÎ³K
Â¯âˆ†2
i,Sâˆ©B 
2 +1
ln(1/Ï‰Âµv) 
ln ln +1
ln(1/Ï‰Âµv)Â¯âˆ†2
i,Sâˆ©B+D!!
, râ‰¤$
3p
ln(1/Ï‰v)Â·Â¯âˆ†i,Sâˆ©B
Â¯Ïƒ2%
+ 1
then
Tâ€²X
p=11{Apâˆˆ S âˆ© B} 1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
â‰¤X
iâˆˆEgSâˆ©B(r,Â¯âˆ†i,Sâˆ©B)
Case 3: Apâˆˆ R
Under this case, there will be a comparison between Ï‰vandÏ‰â€²
vthus we denote Â¯Ï‰=r
ln1
Ï‰â€²v
ln1
Ï‰vandÏ‰sum:=q
ln1
Ï‰â€²v+q
ln1
Ï‰v.
ForiâˆˆE, denote âˆ†v
i,R:= min Sâˆ‹i,SâˆˆRâˆ†v
Sand assume âˆ†v
i,Râˆˆ(riÂ¯Ï‰
Â¯Ï‰+1Â¯Ïƒ2,(ri+ 1)Â¯Ï‰
Â¯Ï‰+1Â¯Ïƒ2].
Scenario 1: Ï‰vâ‰¤Ï‰â€²
vFor the case Ï‰vâ‰¤Ï‰â€²
v, we have Â¯Ï‰â‰¤1.
28Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Tâ€²X
p=11{Apâˆˆ R} 1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
(a)
â‰¤Tâ€²X
p=11{Apâˆˆ R} 1(
Fpâˆ†v
Ap
3, Ï‰â€²
v
,Fp 
(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3, Ï‰v!)
(b)
â‰¤Tâ€²X
p=11{Apâˆˆ R} 1(
Fp 
max(
âˆ†v
Ap
3,Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3)
, Ï‰â€²
v!)
(c)
â‰¤Tâ€²X
p=1X
jâˆˆN1{Apâˆˆ R} 1(
Gj,p 
max(
âˆ†v
Ap
3,Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3)
, Ï‰â€²
v!)
(d)
â‰¤Tâ€²X
p=1X
jâˆˆN1{Apâˆˆ R}1
bjKX
iâˆˆAp1(
Ti(pâˆ’1)â‰¤mj 
max(
âˆ†v
Ap
3,Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3)
, Ï‰â€²
v!)
=X
iâˆˆEX
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ R} 1(
iâˆˆAp, Ti(pâˆ’1)â‰¤mj 
max(
âˆ†v
Ap
3,Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3)
, Ï‰â€²
v!)
(18)
where (a)utilizes Lemma B.6, (b)makes use of Lemma B.3, (c)is due to Lemma B.2 and (d)follows the definition of Gj,p.
Given iâˆˆE,
(1) if râ‰¥ri+ 2, for any Sâˆˆ R that contains item i,
maxâˆ†v
S
3,Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
S
3
â‰¥maxâˆ†v
S
3,Â¯Ï‰
1 + Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3
â‰¥Â¯Ï‰
1 + Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3â‰¥âˆ†v
i,R
3
where the first inequality uses the fact that for x, yâˆˆR+andzâˆˆ[0,1], ,max{x, y} â‰¥max{x, xz +y(1âˆ’z)}. We take
x=âˆ†v
Ap
3, y= Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3andz=Â¯Ï‰
1+Â¯Ï‰. Thus,
X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ R} 1(
iâˆˆAp, Ti(pâˆ’1)â‰¤mj 
max(
âˆ†v
Ap
3,Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3)
, Ï‰â€²
v!)
â‰¤X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ R} 1
iâˆˆAp, Ti(pâˆ’1)â‰¤mjÂ¯Ï‰
1 + Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3, Ï‰â€²
v
=X
jâˆˆN1
bjKmjÂ¯Ï‰
1 + Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3, Ï‰â€²
v
=X
jâˆˆNajÂ·Î³K2
bjK1
(Â¯Ï‰
1+Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3)2 
2 ln1
Ï‰â€²v+ ln ln +1
(Â¯Ï‰
1+Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3)2+D!
â‰¤CÎ³K
(Â¯Ï‰
1+Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3)2 
2 ln1
Ï‰â€²v+ ln ln +1
(Â¯Ï‰
1+Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3)2+D!
â‰¤CÎ³K
((râˆ’1)Â¯Ïƒ2
3Ï‰sum)2ï£«
ï£¬ï£­2 +1
ln(1/Ï‰â€²v)ï£«
ï£¬ï£­ln ln +1
ln(1/Ï‰â€²v)(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£·ï£¸ï£¶
ï£·ï£¸
(2) if râ‰¤ri+ 1, for any Sâˆˆ R that contains item i,
maxâˆ†v
S
3,Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
S
3
â‰¥maxâˆ†v
S
3,Â¯Ï‰
1 + Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3
â‰¥âˆ†v
i,R
3
29Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Thus,
X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ R} 1(
iâˆˆAp, Ti(pâˆ’1)â‰¤mj 
max(
âˆ†v
Ap
3,Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3)
, Ï‰â€²
v!)
â‰¤X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ R} 1
iâˆˆAp, Ti(pâˆ’1)â‰¤mjâˆ†v
i,R
3, Ï‰â€²
v
=X
jâˆˆN1
bjKmjâˆ†v
i,R
3, Ï‰â€²
v
=X
jâˆˆNajÂ·Î³K2
bjK1
(âˆ†v
i,R
3)2 
2 ln1
Ï‰â€²v+ ln ln +1
(âˆ†v
i,R
3)2+D!
â‰¤CÎ³K
(âˆ†v
i,R
3)2 
2 ln1
Ï‰â€²v+ ln ln +1
(âˆ†v
i,R
3)2+D!
=CÎ³K
(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2ï£«
ï£¬ï£­2 +1
ln(1/Ï‰â€²v)ï£«
ï£¬ï£­ln ln +1
ln(1/Ï‰â€²v)(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£·ï£¸ï£¶
ï£·ï£¸
Therefore, if we denote
gR,1(r,âˆ†v
i,R) :=ï£±
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£³CÎ³K
((râˆ’1)Â¯Ïƒ2
3Ï‰sum)2ï£«
ï£¬ï£­2 +1
ln(1/Ï‰â€²v)ï£«
ï£¬ï£­ln ln +1
ln(1/Ï‰â€²v)(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£·ï£¸ï£¶
ï£·ï£¸, râ‰¥$
Ï‰sumÂ·âˆ†v
i,Rp
ln(1/Ï‰â€²v)Â¯Ïƒ2%
+ 2
CÎ³K
(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²
v))2ï£«
ï£¬ï£­2 +1
ln(1/Ï‰â€²v)ï£«
ï£¬ï£­ln ln +1
ln(1/Ï‰â€²v)(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²
v))2+Dï£¶
ï£·ï£¸ï£¶
ï£·ï£¸, râ‰¤$
Ï‰sumÂ·âˆ†v
i,Rp
ln(1/Ï‰â€²v)Â¯Ïƒ2%
+ 1
then (18) can be upper bounded byX
iâˆˆEgR,1(r,âˆ†v
i,R).
Scenario 2: Ï‰vâ‰¥Ï‰â€²
vFor the case Ï‰vâ‰¥Ï‰â€²
v, we have Â¯Ï‰â‰¥1.
Tâ€²X
p=11{Apâˆˆ R} 1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
(a)
â‰¤Tâ€²X
p=11{Apâˆˆ R} 1(
Fpâˆ†v
Ap
3, Ï‰â€²
v
,Fp 
(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3, Ï‰v!)
(b)
â‰¤Tâ€²X
p=11{Apâˆˆ R} 1(
Fp 
max(
1
Â¯Ï‰âˆ†v
Ap
3,(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3)
, Ï‰v!)
(c)
â‰¤Tâ€²X
p=1X
jâˆˆN1{Apâˆˆ R} 1(
Gj,p 
max(
1
Â¯Ï‰âˆ†v
Ap
3,(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3)
, Ï‰v!)
(d)
â‰¤Tâ€²X
p=1X
jâˆˆN1{Apâˆˆ R}1
bjKX
iâˆˆAp1(
Ti(pâˆ’1)â‰¤mj 
max(
1
Â¯Ï‰âˆ†v
Ap
3,(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3)
, Ï‰v!)
30Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
=X
iâˆˆEX
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ R} 1(
iâˆˆAp, Ti(pâˆ’1)â‰¤mj 
max(
1
Â¯Ï‰âˆ†v
Ap
3,(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3)
, Ï‰v!)
(19)
where (a)utilizes Lemma B.6, (b)makes use of Lemma B.3, (c)is due to Lemma B.2 and (d)follows the definition of Gj,p.
Given iâˆˆE,
(1) if râ‰¥ri+ 2, for any Sâˆˆ R that contains item i,
max1
Â¯Ï‰âˆ†v
S
3,(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
S
3
â‰¥max1
Â¯Ï‰âˆ†v
S
3,Â¯Ï‰
1 + Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3
â‰¥1
1 + Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3â‰¥1
Â¯Ï‰âˆ†v
i,R
3
where the first inequality uses the fact that for x, yâˆˆR+andzâˆˆ[0,1], ,max{x, y} â‰¥max{x, xz +y(1âˆ’z)}. We take
x=1
Â¯Ï‰âˆ†v
Ap
3, y=(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3andz=Â¯Ï‰
1+Â¯Ï‰. Thus,
X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ R} 1(
iâˆˆAp, Ti(pâˆ’1)â‰¤mj 
max(
1
Â¯Ï‰âˆ†v
Ap
3,(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3)
, Ï‰v!)
â‰¤X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ R} 1
iâˆˆAp, Ti(pâˆ’1)â‰¤mj1
1 + Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3, Ï‰v
=X
jâˆˆN1
bjKmj1
1 + Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3, Ï‰v
=X
jâˆˆNajÂ·Î³K2
bjK1
(1
1+Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3)2 
2 ln1
Ï‰v+ ln ln +1
(1
1+Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3)2+D!
â‰¤CÎ³K
(1
1+Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3)2 
2 ln1
Ï‰v+ ln ln +1
(1
1+Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3)2+D!
â‰¤CÎ³K
((râˆ’1)Â¯Ïƒ2
3Ï‰sum)2ï£«
ï£¬ï£­2 +1
ln(1/Ï‰v)ï£«
ï£¬ï£­ln ln +1
ln(1/Ï‰v)(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£·ï£¸ï£¶
ï£·ï£¸
(2) if râ‰¤ri+ 1, for any Sâˆˆ R that contains item i,
max1
Â¯Ï‰âˆ†v
S
3,(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
S
3
â‰¥max1
Â¯Ï‰âˆ†v
A
3,Â¯Ï‰
1 + Â¯Ï‰Â·(râˆ’1)Â¯Ïƒ2
3
â‰¥1
Â¯Ï‰âˆ†v
i,R
3
Thus,
X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ R} 1(
iâˆˆAp, Ti(pâˆ’1)â‰¤mj 
max(
1
Â¯Ï‰âˆ†v
Ap
3,(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3)
, Ï‰v!)
â‰¤X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ R} 1
iâˆˆAp, Ti(pâˆ’1)â‰¤mj1
Â¯Ï‰âˆ†v
i,R
3, Ï‰v
=X
jâˆˆN1
bjKmj1
Â¯Ï‰âˆ†v
i,R
3, Ï‰v
=X
jâˆˆNajÂ·Î³K2
bjK1
(1
Â¯Ï‰âˆ†v
i,R
3)2 
2 ln1
Ï‰v+ ln ln +1
(1
Â¯Ï‰âˆ†v
i,R
3)2+D!
â‰¤CÎ³K
(1
Â¯Ï‰âˆ†v
i,R
3)2 
2 ln1
Ï‰v+ ln ln +1
(1
Â¯Ï‰âˆ†v
i,R
3)2+D!
31Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
=CÎ³K
(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2ï£«
ï£¬ï£­2 +1
ln(1/Ï‰v)ï£«
ï£¬ï£­ln ln +1
ln(1/Ï‰v)(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£·ï£¸ï£¶
ï£·ï£¸
Therefore, if we denote
gR,2(r,âˆ†v
i,R) :=ï£±
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£³CÎ³K
((râˆ’1)Â¯Ïƒ2
3Ï‰sum)2ï£«
ï£¬ï£­2 +1
ln(1/Ï‰v)ï£«
ï£¬ï£­ln ln +1
ln(1/Ï‰v)(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£·ï£¸ï£¶
ï£·ï£¸, râ‰¥$
Ï‰sumÂ·âˆ†v
i,Rp
ln(1/Ï‰â€²v)Â¯Ïƒ2%
+ 2
CÎ³K
(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2ï£«
ï£¬ï£­2 +1
ln(1/Ï‰v)ï£«
ï£¬ï£­ln ln +1
ln(1/Ï‰v)(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£·ï£¸ï£¶
ï£·ï£¸, râ‰¤$
Ï‰sumÂ·âˆ†v
i,Rp
ln(1/Ï‰â€²v)Â¯Ïƒ2%
+ 1
then (19) can be upper bounded by
X
iâˆˆEgR,2(r,âˆ†v
i,R).
In conclusion, for iâˆˆE, we denote âˆ†v
i,R:= min Sâˆ‹i,SâˆˆRâˆ†v
S,Ï‰vvâ€²:= max {Ï‰v, Ï‰â€²
v},Ï‰sum:=q
ln1
Ï‰â€²v+q
ln1
Ï‰vand
gR(r,âˆ†v
i,R) :=ï£±
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£³CÎ³K
((râˆ’1)Â¯Ïƒ2
3Ï‰sum)2ï£«
ï£¬ï£­2 +1
ln(1/Ï‰vvâ€²)ï£«
ï£¬ï£­ln ln +1
ln(1/Ï‰vvâ€²)(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£·ï£¸ï£¶
ï£·ï£¸, râ‰¥$
Ï‰sumÂ·âˆ†v
i,Rp
ln(1/Ï‰â€²v)Â¯Ïƒ2%
+ 2
CÎ³K
(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2ï£«
ï£¬ï£­2 +1
ln(1/Ï‰vvâ€²)ï£«
ï£¬ï£­ln ln +1
ln(1/Ï‰vvâ€²)(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£·ï£¸ï£¶
ï£·ï£¸, râ‰¤$
Ï‰sumÂ·âˆ†v
i,Rp
ln(1/Ï‰â€²v)Â¯Ïƒ2%
+ 1
then
Tâ€²X
p=11{Apâˆˆ R} 1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
â‰¤X
iâˆˆEgR(r,âˆ†v
i,R)
Case 4: Apâˆˆ Scâˆ© B
Under this case, there will be a comparison among Ï‰Âµ, Ï‰vandÏ‰â€²
vthus we denote Ï‰max= max {Ï‰Âµ, Ï‰v, Ï‰â€²
v}andÏ‰1=r
ln1
Ï‰max
ln1
Ï‰Âµ, Ï‰2=r
ln1
Ï‰max
ln1
Ï‰v, Ï‰3=r
ln1
Ï‰max
ln1
Ï‰â€²v. For Sâˆˆ Scâˆ© B, we denote Â¯âˆ†S:= maxn
Ï‰1âˆ†S, Ï‰3âˆ†v
S
3o
.
ForiâˆˆE, denote
Â¯âˆ†i,Scâˆ©B:= min
Sâˆ‹i,SâˆˆScâˆ©Bmax(
âˆ†Sp
ln(1/Ï‰Âµ),âˆ†v
S
3p
ln(1/Ï‰â€²v))
=s
1
ln(1/Ï‰max)min
Sâˆ‹i,SâˆˆScâˆ©BÂ¯âˆ†S.
and assume Â¯âˆ†i,Scâˆ©Bâˆˆ(riÂ¯Ïƒ2/3âˆš
ln(1/Ï‰v)+âˆš
ln(1/Ï‰â€²v),(ri+ 1)Â¯Ïƒ2/3âˆš
ln(1/Ï‰v)+âˆš
ln(1/Ï‰â€²v)]
32Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Tâ€²X
p=11{Apâˆˆ Scâˆ© B}
1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
Â· 1{E}
(a)
â‰¤Tâ€²X
p=11{Apâˆˆ Scâˆ© B} 1(
FÂµ
p,Fpâˆ†v
Ap
3, Ï‰â€²
v
,Fp 
(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3, Ï‰v!)
(b)
â‰¤Tâ€²X
p=11{Apâˆˆ Scâˆ© B} 1(
Fp 
âˆ†Ap, Ï‰Âµ
,Fpâˆ†v
Ap
3, Ï‰â€²
v
,Fp 
(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3, Ï‰v!)
(c)
â‰¤Tâ€²X
p=11{Apâˆˆ Scâˆ© B} 1(
Fp 
max(
Ï‰1âˆ†Ap, Ï‰3âˆ†v
Ap
3, Ï‰2(râˆ’1)Â¯Ïƒ2âˆ’âˆ†v
Ap
3)
, Ï‰max!)
(d)
â‰¤Tâ€²X
p=11{Apâˆˆ Scâˆ© B} 1
Fp
max
max
Ï‰1âˆ†Ap, Ï‰3âˆ†v
Ap
3
, Ï‰2(râˆ’1)Â¯Ïƒ2
3âˆ’Ï‰2
Ï‰3max
Ï‰1âˆ†Ap, Ï‰3âˆ†v
Ap
3
, Ï‰max
(e)
â‰¤Tâ€²X
p=1X
jâˆˆN1{Apâˆˆ Scâˆ© B} 1
Gj,p
max
Â¯âˆ†Ap, Ï‰2(râˆ’1)Â¯Ïƒ2
3âˆ’Ï‰2
Ï‰3Â¯âˆ†Ap
, Ï‰max
(f)
â‰¤Tâ€²X
p=1X
jâˆˆN1{Apâˆˆ Scâˆ© B}1
bjKX
iâˆˆAp1
Ti(pâˆ’1)â‰¤mj
max
Â¯âˆ†Ap, Ï‰2(râˆ’1)Â¯Ïƒ2
3âˆ’Ï‰2
Ï‰3Â¯âˆ†Ap
, Ï‰max
=X
iâˆˆEX
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ Scâˆ© B} 1
iâˆˆAp, Ti(pâˆ’1)â‰¤mj
max
Â¯âˆ†Ap, Ï‰2(râˆ’1)Â¯Ïƒ2
3âˆ’Ï‰2
Ï‰3Â¯âˆ†Ap
, Ï‰max
Given iâˆˆE
(1) if râ‰¥ri+ 2, for any Sâˆˆ Scâˆ© Bthat contains item i,
max
Â¯âˆ†S, Ï‰2(râˆ’1)Â¯Ïƒ2
3âˆ’Ï‰2
Ï‰3Â¯âˆ†S
â‰¥max
Â¯âˆ†S,Ï‰2Ï‰3
Ï‰2+Ï‰3(râˆ’1)Â¯Ïƒ2
3
â‰¥Ï‰2Ï‰3
Ï‰2+Ï‰3(râˆ’1)Â¯Ïƒ2
3â‰¥p
ln(1/Ï‰max)Â¯âˆ†i,Scâˆ©R
where the first inequality uses the fact that for x, yâˆˆR+andzâˆˆ[0,1], ,max{x, y} â‰¥max{x, xz +y(1âˆ’z)}. We take
x=Â¯âˆ†Ap, y=Ï‰2(râˆ’1)Â¯Ïƒ2
3âˆ’Ï‰2
Ï‰3Â¯âˆ†Apandz=Ï‰2
Ï‰2+Ï‰3.
Similar to the computations for the case Apâˆˆ R, we have
X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ Scâˆ© B} 1
iâˆˆAp, Ti(pâˆ’1)â‰¤mj
max
Â¯âˆ†Ap, Ï‰2(râˆ’1)Â¯Ïƒ2
3âˆ’Ï‰2
Ï‰3Â¯âˆ†Ap
, Ï‰max
â‰¤X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ Scâˆ© B} 1
iâˆˆAp, Ti(pâˆ’1)â‰¤mjÏ‰2Ï‰3
Ï‰2+Ï‰3(râˆ’1)Â¯Ïƒ2
3, Ï‰max
â‰¤CÎ³K
(Ï‰2Ï‰3
Ï‰2+Ï‰3(râˆ’1)Â¯Ïƒ2
3)2 
2 ln1
Ï‰max+ ln ln +1
(Ï‰2Ï‰3
Ï‰2+Ï‰3(râˆ’1)Â¯Ïƒ2
3)2+D!
â‰¤CÎ³K
(Ï‰2Ï‰3
Ï‰2+Ï‰3(râˆ’1)Â¯Ïƒ2
3)2
2 ln1
Ï‰max+ ln ln +1
ln(1/Ï‰max)(Â¯âˆ†i,Scâˆ©R)2+D
=CÎ³K
((râˆ’1)Â¯Ïƒ2/3âˆš
ln(1/Ï‰v)+âˆš
ln(1/Ï‰â€²v))2
2 +1
ln(1/Ï‰max)
ln ln +1
ln(1/Ï‰max)(Â¯âˆ†i,Scâˆ©R)2+D
33Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
(2) if râ‰¤ri+ 1, for any Sâˆˆ Scâˆ© Bthat contains item i,
max
Â¯âˆ†S, Ï‰2(râˆ’1)Â¯Ïƒ2
3âˆ’Ï‰2
Ï‰3Â¯âˆ†S
â‰¥max
Â¯âˆ†S,Ï‰2Ï‰3
Ï‰2+Ï‰3(râˆ’1)Â¯Ïƒ2
3
â‰¥Â¯âˆ†Sâ‰¥p
ln(1/Ï‰max)Â¯âˆ†i,Scâˆ©R
Similar to the computations for the case Apâˆˆ R, we have
X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ Scâˆ© B} 1
iâˆˆAp, Ti(pâˆ’1)â‰¤mj
max
Â¯âˆ†Ap, Ï‰2(râˆ’1)Â¯Ïƒ2
3âˆ’Ï‰2
Ï‰3Â¯âˆ†Ap
, Ï‰max
â‰¤X
jâˆˆN1
bjKTâ€²X
p=11{Apâˆˆ Scâˆ© B} 1n
iâˆˆAp, Ti(pâˆ’1)â‰¤mjp
ln(1/Ï‰max)Â¯âˆ†i,Scâˆ©R, Ï‰maxo
â‰¤CÎ³K
(p
ln(1/Ï‰max)Â¯âˆ†i,Scâˆ©B)2 
2 ln1
Ï‰max+ ln ln +1
(p
ln(1/Ï‰max)Â¯âˆ†i,Scâˆ©B)2+D!
=CÎ³K
(Â¯âˆ†i,Scâˆ©B)2
2 +1
ln(1/Ï‰max)
ln ln +1
ln(1/Ï‰max)(Â¯âˆ†i,Scâˆ©R)2+D
In conclusion, for iâˆˆE, we denote
Â¯âˆ†i,Scâˆ©B:= min
Sâˆ‹i,SâˆˆScâˆ©Bmax(
âˆ†Sp
ln(1/Ï‰Âµ),âˆ†v
S
3p
ln(1/Ï‰â€²v))
.
andÏ‰max:= max {Ï‰Âµ, Ï‰v, Ï‰â€²
v}andÏ‰sum:=q
ln1
Ï‰â€²v+q
ln1
Ï‰vandgScâˆ©B(r,Â¯âˆ†i,Scâˆ©B) :=
ï£±
ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£³CÎ³K
((râˆ’1)Â¯Ïƒ2
3Ï‰sum)2
2 +1
ln(1/Ï‰max)
ln ln +1
ln(1/Ï‰max)(Â¯âˆ†i,Scâˆ©R)2+D
, râ‰¥Ï‰sumÂ·Â¯âˆ†i,Scâˆ©B
Â¯Ïƒ2/3
+ 2
CÎ³K
(Â¯âˆ†i,Scâˆ©R)2
2 +1
ln(1/Ï‰max)
ln ln +1
ln(1/Ï‰max)(Â¯âˆ†i,Scâˆ©R)2+D
, râ‰¤Ï‰sumÂ·Â¯âˆ†i,Scâˆ©B
Â¯Ïƒ2/3
+ 1
then
Tâ€²X
p=11{Apâˆˆ Scâˆ© B} 1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
â‰¤X
iâˆˆEgScâˆ©B(r,Â¯âˆ†i,Scâˆ©B)
Conclusion of Step 2:
ForSâ‹†: denote
gSâ‹†(r,âˆ†v
Sâ‹†) :=9Â·CÎ³K
((râˆ’1)Â¯Ïƒ2+ âˆ†v
Sâ‹†)2
2 ln1
Ï‰v+ ln ln +1
âˆ†v
Sâ‹†2+D
(20)
we have
Tâ€²X
p=11{Ap=Sâ‹†} 1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
â‰¤X
iâˆˆSâ‹†gSâ‹†(r,âˆ†v
Sâ‹†)
34Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
ForS âˆ© B : foriâˆˆE, denote Â¯âˆ†i,Sâˆ©B:= min Sâˆ‹i,SâˆˆSâˆ©B max
âˆ†Sâˆš
ln(1/Ï‰Âµ),âˆ†v
S
3âˆš
ln(1/Ï‰v)
,Ï‰Âµv:= max {Ï‰Âµ, Ï‰v}and
gSâˆ©B(r,Â¯âˆ†i,Sâˆ©B) (21)
:=ï£±
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£³CÎ³K
((râˆ’1)Â¯Ïƒ2
3âˆš
ln(1/Ï‰v))2 
2 +1
ln(1/Ï‰Âµv) 
ln ln +1
ln(1/Ï‰Âµv)Â¯âˆ†2
i,Sâˆ©B+D!!
, râ‰¥ï£¯ï£¯ï£¯ï£°Â¯âˆ†i,Sâˆ©B
Â¯Ïƒ2
3âˆš
ln(1/Ï‰v)ï£ºï£ºï£ºï£»+ 2
CÎ³K
Â¯âˆ†2
i,Sâˆ©B 
2 +1
ln(1/Ï‰Âµv) 
ln ln +1
ln(1/Ï‰Âµv)Â¯âˆ†2
i,Sâˆ©B+D!!
, râ‰¤ï£¯ï£¯ï£¯ï£°Â¯âˆ†i,Sâˆ©B
Â¯Ïƒ2
3âˆš
ln(1/Ï‰v)ï£ºï£ºï£ºï£»+ 1
then
Tâ€²X
p=11{Apâˆˆ S âˆ© B} 1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
â‰¤X
iâˆˆEgSâˆ©B(r,Â¯âˆ†i,Sâˆ©B)
ForR: foriâˆˆE, denote âˆ†v
i,R:= min Sâˆ‹i,SâˆˆRâˆ†v
S,Ï‰vvâ€²:= max {Ï‰v, Ï‰â€²
v},Ï‰sum:=q
ln1
Ï‰â€²v+q
ln1
Ï‰vand
gR(r,âˆ†v
i,R) (22)
:=ï£±
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£³CÎ³K
((râˆ’1)Â¯Ïƒ2
3Ï‰sum)2ï£«
ï£¬ï£­2 +1
ln(1/Ï‰vvâ€²)ï£«
ï£¬ï£­ln ln +1
ln(1/Ï‰vvâ€²)(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£·ï£¸ï£¶
ï£·ï£¸, râ‰¥$
Ï‰sumÂ·âˆ†v
i,Rp
ln(1/Ï‰â€²v)Â¯Ïƒ2%
+ 2
CÎ³K
(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2ï£«
ï£¬ï£­2 +1
ln(1/Ï‰vvâ€²)ï£«
ï£¬ï£­ln ln +1
ln(1/Ï‰vvâ€²)(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£·ï£¸ï£¶
ï£·ï£¸, râ‰¤$
Ï‰sumÂ·âˆ†v
i,Rp
ln(1/Ï‰â€²v)Â¯Ïƒ2%
+ 1
then
Tâ€²X
p=11{Apâˆˆ R} 1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
â‰¤X
iâˆˆEgR(r,âˆ†v
i,R)
ForScâˆ© B: foriâˆˆE, denote
Â¯âˆ†i,Scâˆ©B:= min
Sâˆ‹i,SâˆˆScâˆ©Bmax(
âˆ†Sp
ln(1/Ï‰Âµ),âˆ†v
S
3p
ln(1/Ï‰â€²v))
.
andÏ‰max:= max {Ï‰Âµ, Ï‰v, Ï‰â€²
v}andÏ‰sum:=q
ln1
Ï‰â€²v+q
ln1
Ï‰vand
gScâˆ©B(r,Â¯âˆ†i,Scâˆ©B) (23)
:=ï£±
ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£³CÎ³K
((râˆ’1)Â¯Ïƒ2
3Ï‰sum)2
2 +1
ln(1/Ï‰max)
ln ln +1
ln(1/Ï‰max)(Â¯âˆ†i,Scâˆ©B)2+D
, râ‰¥Ï‰sumÂ·Â¯âˆ†i,Scâˆ©B
Â¯Ïƒ2/3
+ 2
CÎ³K
(Â¯âˆ†i,Scâˆ©B)2
2 +1
ln(1/Ï‰max)
ln ln +1
ln(1/Ï‰max)(Â¯âˆ†i,Scâˆ©B)2+D
, râ‰¤Ï‰sumÂ·Â¯âˆ†i,Scâˆ©B
Â¯Ïƒ2/3
+ 1
then
Tâ€²X
p=11{Apâˆˆ Scâˆ© B} 1n
Uv
Ap(pâˆ’1)> rÂ¯Ïƒ2o
â‰¤X
iâˆˆEgScâˆ©B(r,Â¯âˆ†i,Scâˆ©B)
35Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Step 3:
According to the results in Step 2, given râˆˆ[Qâˆ’1], the event Up(r)can happen at most
Tâ€²X
p=11{Up(r)} (24)
â‰¤min(
Tâ€²,X
iâˆˆSâ‹†gSâ‹†(r,âˆ†v
Sâ‹†) +X
iâˆˆEgSâˆ©B(r,Â¯âˆ†i,Sâˆ©B) +X
iâˆˆEgR(r,âˆ†v
i,R) +X
iâˆˆEgScâˆ©B(r,Â¯âˆ†i,Scâˆ©B))
phases, where the gfunctions are defined in (20),(21),(22) and(23). By Lemma B.4, (1) event Up(r)indicates r+ 1â‰¤np,
thus (24) also indicates at most in this number of phases there are at least r+ 1being pulled at each phase. (2) event
Up(r)âˆ© Up(r+ 1)cindicates r+ 1â‰¤npâ‰¤2r+ 1, i.e., there are at least r+ 1and at most 2r+ 1solutions being pulled at
each phase. For râˆˆ[Q], we denote
Tâ€²
r:=X
iâˆˆSâ‹†gSâ‹†(r,âˆ†v
Sâ‹†) +X
iâˆˆEgSâˆ©B(r,Â¯âˆ†i,Sâˆ©B) +X
iâˆˆEgR(r,âˆ†v
i,R) +X
iâˆˆEgScâˆ©B(r,Â¯âˆ†i,Scâˆ©B), râˆˆ[Qâˆ’1](25)
andTâ€²
Q:= 0, Tâ€²
0=âˆ. Note that the gfunctions are increasing as rdecreases, so if there exists an râ€²âˆˆ[Q], such that
Tâ€²âˆˆ[Tâ€²
râ€², Tâ€²
râ€²âˆ’1)(orTâ€²â‰¤Tâ€²
râ€²âˆ’1) , then
Qâˆ’1X
r=1Tâ€²X
p=11{Up(r)}
=râ€²âˆ’1X
r=1Tâ€²X
p=11{Up(r)}+Qâˆ’1X
r=râ€²Tâ€²X
p=11{Up(r)}
â‰¤Tâ€²Â·(râ€²âˆ’1) +Qâˆ’1X
r=râ€²X
iâˆˆSâ‹†gSâ‹†(r,âˆ†v
Sâ‹†) +X
iâˆˆEgSâˆ©B(r,Â¯âˆ†i,Sâˆ©B) +X
iâˆˆEgR(r,âˆ†v
i,R) +X
iâˆˆEgScâˆ©B(r,Â¯âˆ†i,Scâˆ©B)
=Tâ€²Â·(râ€²âˆ’1) +Qâˆ’1X
r=râ€²Tâ€²
r
â‰¤Tâ€²Â·(râ€²âˆ’1) +X
iâˆˆSâ‹†hSâ‹†(râ€²,âˆ†v
Sâ‹†) +X
iâˆˆEhSâˆ©B(râ€²,Â¯âˆ†i,Sâˆ©B) +X
iâˆˆEhR(râ€²,âˆ†v
i,R) +X
iâˆˆEhScâˆ©B(râ€²,Â¯âˆ†i,Scâˆ©B)
=Tâ€²Â·(râ€²âˆ’1) +H(râ€²,Î›)
where
H(râ€²,Î›) :=X
iâˆˆSâ‹†hSâ‹†(râ€²,âˆ†v
Sâ‹†) +X
iâˆˆEhSâˆ©B(râ€²,Â¯âˆ†i,Sâˆ©B) +X
iâˆˆEhR(râ€²,âˆ†v
i,R) +X
iâˆˆEhScâˆ©B(râ€²,Â¯âˆ†i,Scâˆ©B) (26)
and the hfunctions are defined at the end of the proof. This indicates, when Tâ€²â‰¤Tâ€²
râ€²âˆ’1, the upper bound of the high-
probability regret due to safeness-checking R2(Tâ€²)(hence the the total regret) is lower bounded by a linear function with
slope râ€²âˆ’1. In particular, the upper bound of R2(Tâ€²)is lower bounded by a linear function when Tâ€²â‰¤Tâ€²
1and it remains a
constant when Tâ€²> Tâ€²
1. We can compute an upper bound for the number of solutions being pulled during these Tâ€²phases
when Tâ€²âˆˆ[Tâ€²
râ€², Tâ€²
râ€²âˆ’1):
Tâ€²
Qâˆ’1Â·(2Qâˆ’1) + ( Tâ€²
Qâˆ’2âˆ’Tâ€²
Qâˆ’1)Â·(2Qâˆ’3) +Â·Â·Â·+ (Tâ€²
râ€²âˆ’Tâ€²
râ€²+1)Â·(2râ€²+ 1) + ( Tâ€²âˆ’Tâ€²
râ€²)(2râ€²âˆ’1)
=Tâ€²+ 2 
Tâ€²
Qâˆ’1Â·(Qâˆ’1) + ( Tâ€²
Qâˆ’2âˆ’Tâ€²
Qâˆ’1)Â·(Qâˆ’2) +Â·Â·Â·+ (Tâ€²
râ€²âˆ’Tâ€²
râ€²+1)Â·râ€²+ (Tâ€²âˆ’Tâ€²
râ€²)(râ€²âˆ’1)
= (2râ€²âˆ’1)Tâ€²+ 2Qâˆ’1X
r=râ€²Tâ€²
r
â‰¤(2râ€²âˆ’1)Tâ€²+ 2H(râ€²,Î›)
36Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Thus, the number of pulled solutions is at most 2H(1,Î›).1
In conclusion , the regret due to safeness-checking can be upper bounded by
R2(Tâ€²) = 2 Âµâ‹†Qâˆ’1X
r=1Tâ€²X
p=11{Up(r)}
â‰¤2Âµâ‹†Tâ€²Â·(râ€²âˆ’1)
+ 2Âµâ‹† X
iâˆˆSâ‹†hSâ‹†(râ€²,âˆ†v
Sâ‹†) +X
iâˆˆEhSâˆ©B(râ€²,Â¯âˆ†i,Sâˆ©B) +X
iâˆˆEhR(râ€²,âˆ†v
i,R) +X
iâˆˆEhScâˆ©B(râ€²,Â¯âˆ†i,Scâˆ©B)!
= 2Âµâ‹†Tâ€²Â·(râ€²âˆ’1) + 2 Âµâ‹†Â·H(râ€²,Î›)
where Tâ€²âˆˆ[Tâ€²
râ€², Tâ€²
râ€²âˆ’1)withTâ€²
râ€²defined in (25), foriâˆˆE,Â¯âˆ†i,Sâˆ©B:= min Sâˆ‹i,SâˆˆSâˆ©B max
âˆ†Sâˆš
ln(1/Ï‰Âµ),âˆ†v
S
3âˆš
ln(1/Ï‰v)
,
âˆ†v
i,R:= min Sâˆ‹i,SâˆˆRâˆ†v
SandÂ¯âˆ†i,Scâˆ©B:= min Sâˆ‹i,SâˆˆScâˆ©Bmax
âˆ†Sâˆš
ln(1/Ï‰Âµ),âˆ†v
S
3âˆš
ln(1/Ï‰â€²v)
.
Thehfunctions:
(For convenience, we restate the notations: Ï‰Âµv:= max {Ï‰Âµ, Ï‰v},Ï‰vvâ€²:= max {Ï‰v, Ï‰â€²
v},Ï‰max:= max {Ï‰Âµ, Ï‰v, Ï‰â€²
v}and
Ï‰sum:=q
ln1
Ï‰â€²
v+q
ln1
Ï‰v.)
ForSâ‹†: for each iâˆˆSâ‹†
hSâ‹†(râ€²,âˆ†v
Sâ‹†) :=Qâˆ’1X
r=râ€²gSâ‹†(r,âˆ†v
Sâ‹†) (27)
=Qâˆ’1X
r=râ€²9Â·CÎ³K
((râˆ’1)Â¯Ïƒ2+ âˆ†v
Sâ‹†)2
2 ln1
Ï‰v+ ln ln +1
âˆ†v
Sâ‹†2+D
â‰¤ï£±
ï£´ï£´ï£²
ï£´ï£´ï£³18Â·CÎ³K
(râ€²âˆ’1)Â¯Ïƒ4
2 ln1
Ï‰v+ ln ln +1
(âˆ†v
Sâ‹†)2+D
, râ€²â‰¥2
18Â·CÎ³K
(âˆ†v
Sâ‹†)2
2 ln1
Ï‰v+ ln ln +1
(âˆ†v
Sâ‹†)2+D
, râ€²= 1
ForS âˆ© B : for each iâˆˆE, there is a changing point$
Â¯âˆ†i,Sâˆ©B
Â¯Ïƒ2
3âˆš
ln(1/Ï‰v)%
+ 2ingSâˆ©B(r,Â¯âˆ†i,Sâˆ©B), thus
hSâˆ©B(râ€²,Â¯âˆ†i,Sâˆ©B) :=Qâˆ’1X
r=râ€²gSâˆ©B(r,Â¯âˆ†i,Sâˆ©B) (28)
1Note that the upper bound for the regret is 2Âµâ‹†Tâ€²Â·(râ€²âˆ’1) + 2 Âµâ‹†Â·H(râ€²,Î›)and the upper bound for the number of solutions is
(2râ€²âˆ’1)Tâ€²+ 2H(râ€²,Î›), which indicates we can roughly use min{TÂµâ‹†,2Âµâ‹†H(râ€²,Î›)}to bound the regret due to safeness-checking
withTtime steps.
37Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
â‰¤ï£±
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£³0, râ€²=Q
(Qâˆ’râ€²)CÎ³K
Â¯âˆ†2
i,Sâˆ©B 
2 +1
ln(1/Ï‰Âµv) 
ln ln +1
ln(1/Ï‰Âµv)Â¯âˆ†2
i,Sâˆ©B+D!!
,ï£¯ï£¯ï£¯ï£°Â¯âˆ†i,Sâˆ©B
Â¯Ïƒ2
3âˆš
ln(1/Ï‰v)ï£ºï£ºï£ºï£»â‰¥Qâˆ’3
2Â·CÎ³K
(râ€²âˆ’1)(Â¯Ïƒ2
3âˆš
ln(1/Ï‰v))2 
2 +1
ln(1/Ï‰Âµv) 
ln ln +1
ln(1/Ï‰Âµv)Â¯âˆ†2
i,Sâˆ©B+D!!
,ï£¯ï£¯ï£¯ï£°Â¯âˆ†i,Sâˆ©B
Â¯Ïƒ2
3âˆš
ln(1/Ï‰v)ï£ºï£ºï£ºï£»+ 2â‰¤râ€²< Qâˆ’1
3Â·CÎ³K
Â¯âˆ†2
i,Sâˆ©B 
2 +1
ln(1/Ï‰Âµv) 
ln ln +1
ln(1/Ï‰Âµv)Â¯âˆ†2
i,Sâˆ©B+D!!
,ï£¯ï£¯ï£¯ï£°Â¯âˆ†i,Sâˆ©B
Â¯Ïƒ2
3âˆš
ln(1/Ï‰v)ï£ºï£ºï£ºï£»= 0, râ€²= 1
CÎ³Kï£«
ï£­4
Â¯Ïƒ2
3âˆš
ln(1/Ï‰v)Â·Â¯âˆ†i,Sâˆ©Bâˆ’râ€²âˆ’1
Â¯âˆ†2
i,Sâˆ©Bï£¶
ï£¸ 
2 +1
ln(1/Ï‰Âµv) 
ln ln +1
ln(1/Ï‰Âµv)Â¯âˆ†2
i,Sâˆ©B+D!!
,otherwise
ForR: for each iâˆˆE, there is a changing point
Ï‰sumÂ·âˆ†v
i,R âˆš
ln(1/Ï‰â€²v)Â¯Ïƒ2
+ 2, thus
hR(râ€²,âˆ†v
i,R) :=Qâˆ’1X
r=râ€²gR(r,âˆ†v
i,R)â‰¤ (29)
ï£±
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£³0, râ€²=Q
(Qâˆ’râ€²)CÎ³K
(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2ï£«
ï£¬ï£­2 +1
ln(1/Ï‰vvâ€²)ï£«
ï£¬ï£­ln ln +1
ln(1/Ï‰vvâ€²)(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£·ï£¸ï£¶
ï£·ï£¸,$
Ï‰sumÂ·âˆ†v
i,Rp
ln(1/Ï‰â€²v)Â¯Ïƒ2%
â‰¥Qâˆ’3
2CÎ³K
(râ€²âˆ’1)(Â¯Ïƒ2
3Ï‰sum)2ï£«
ï£¬ï£­2 +1
ln(1/Ï‰vvâ€²)ï£«
ï£¬ï£­ln ln +1
ln(1/Ï‰vvâ€²)(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£·ï£¸ï£¶
ï£·ï£¸,ï£¯ï£¯ï£¯ï£°Ï‰sumÂ·âˆ†v
i,Rq
ln1
Ï‰â€²vÂ¯Ïƒ2ï£ºï£ºï£ºï£»+ 2â‰¤râ€²< Qâˆ’1
3CÎ³K
(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2ï£«
ï£¬ï£­2 +1
ln(1/Ï‰vvâ€²)ï£«
ï£¬ï£­ln ln +1
ln(1/Ï‰vvâ€²)(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£·ï£¸ï£¶
ï£·ï£¸,$
Ï‰sumÂ·âˆ†v
i,Rp
ln(1/Ï‰â€²v)Â¯Ïƒ2%
= 0, râ€²= 1
CÎ³Kï£«
ï£¬ï£­3
Â¯Ïƒ2
3Ï‰sumÂ·âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v)âˆ’râ€²âˆ’1
(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2ï£¶
ï£·ï£¸ï£«
ï£¬ï£­2 +1
ln(1/Ï‰vvâ€²)ï£«
ï£¬ï£­ln ln +1
ln(1/Ï‰vvâ€²)(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£·ï£¸ï£¶
ï£·ï£¸,else
ForScâˆ© B: for each iâˆˆE, there is a changing pointj
Ï‰sumÂ·Â¯âˆ†i,Scâˆ©B
Â¯Ïƒ2/3k
+ 2, thus
hScâˆ©B(râ€²,Â¯âˆ†i,Scâˆ©B) :=Qâˆ’1X
r=râ€²gScâˆ©B(r,Â¯âˆ†i,Scâˆ©B) (30)
38Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
â‰¤ï£±
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£³0, râ€²=Q
(Qâˆ’râ€²)CÎ³K
(Â¯âˆ†i,Scâˆ©B)2
2 +1
ln(1/Ï‰max)
ln ln +1
ln(1/Ï‰max)(Â¯âˆ†i,Scâˆ©B)2+D
,Ï‰sumÂ·Â¯âˆ†i,Scâˆ©B
Â¯Ïƒ2/3
â‰¥Qâˆ’3
2CÎ³K
(râ€²âˆ’1)(Â¯Ïƒ2
3Ï‰sum)2
2 +1
ln(1/Ï‰max)
ln ln +1
ln(1/Ï‰max)(Â¯âˆ†i,Scâˆ©B)2+D
,Ï‰sumÂ·Â¯âˆ†i,Scâˆ©B
Â¯Ïƒ2/3
+ 2â‰¤râ€²< Qâˆ’1
3CÎ³K
(Â¯âˆ†i,Scâˆ©B)2
2 +1
ln(1/Ï‰max)
ln ln +1
ln(1/Ï‰max)(Â¯âˆ†i,Scâˆ©B)2+D
,Ï‰sumÂ·Â¯âˆ†i,Scâˆ©B
Â¯Ïƒ2/3
= 0, râ€²= 1
CÎ³K 
3
Â¯Ïƒ2
3Ï‰sumÂ¯âˆ†i,Scâˆ©Bâˆ’râ€²âˆ’1
(Â¯âˆ†i,Scâˆ©B)2!
2 +1
ln(1/Ï‰max)
ln ln +1
ln(1/Ï‰max)(Â¯âˆ†i,Scâˆ©B)2+D
,otherwise
B.5. Proofs of Theorem 4.1 and Theorem 5.1
Theorem 4.1 (Problem-dependent upper bound) .LetÎ› = ( E,AK, Î½,Â¯Ïƒ2)be an instance and let {Î´T}âˆ
T=1âˆˆo(1)be a
sequence that satisfies ln(1/Î´T) =o(Tb)for all b >0(i.e.,{Î´T}is not exponentially decaying). Then, PASC OMB UCB is
a{Î´T}âˆ
T=1-variance-constrained consistent algorithm. More precisely, given a time budget T, the probably anytime-safe
constraint is satisfied and the regret of PASC OMB UCB Reg(T)is upper bounded by
min{TÂµâ‹†,Reg1(T) + Reg2(T)}+ Reg3(T),
where
Reg1(T) =OX
iâˆˆE\Sâ‹†KlnT
âˆ†i,Sâˆ©B,min+X
iâˆˆEciKlnT
âˆ†i,Scâˆ©B,min
Reg2(T) = 2 Âµâ‹†H(âˆ†(Î›)) ,Reg3(T) = 2 Âµâ‹†(L+ 1)
where âˆ†(Î›) = {âˆ†v
Sâ‹†} âˆª {âˆ†v
i,R,Î¨i,Sâˆ©B,Î¦i,Scâˆ©B}iâˆˆEandH(âˆ†(Î›)) := H(1,Î›)is defined in (26) in App. B.4.
Proof of Theorem 4.1. According to Lemma 6.1, Lemma 6.2 and Lemma 6.3, and take Ï‰Âµ=Ï‰â€²
v=1
T2andÏ‰v=Î´T
T2, the
expected regret of Tâ€²phases E[R(Tâ€²)]can be upper bounded as
E[R(Tâ€²)]â‰¤E[R1(Tâ€²)|E] +E[R2(Tâ€²)|E] + R 3(T) (31)
â‰¤Oï£«
ï£­X
iâˆˆE\Sâ‹†K
âˆ†i,Sâˆ©B,minln1
Ï‰Âµ+X
iâˆˆEciK
âˆ†i,Scâˆ©B,minln1
Ï‰â€²vï£¶
ï£¸+ 2Âµâ‹†[Tâ€²Â·(râ€²âˆ’1) +H(râ€²,Î›)]
+ 2Âµâ‹†L+ 2Âµâ‹†TL(Î¾(Ï‰Âµ) + 2Î¾(Ï‰v) + 2Î¾(Ï‰â€²
v))
â‰¤Oï£«
ï£­X
iâˆˆE\Sâ‹†K
âˆ†i,Sâˆ©B,minlnT+X
iâˆˆEciK
âˆ†i,Scâˆ©B,minlnTï£¶
ï£¸+ 2Âµâ‹†H(1,Î›)
+ 2Âµâ‹†L+ 2Âµâ‹†TL 
3Î¾(1/T2) + 2Î¾(Î´T/T2)
= Reg1(T) + Reg2(T) + Reg3(T)
On the other hand, the high-probability regret (14) can be na Â¨Ä±ve bounded as
Ë†R(Tâ€²) =Tâ€²X
p=1npX
r=1(Âµâ‹†âˆ’ÂµAp,r)
â‰¤Tâ€²X
p=1npX
r=1Âµâ‹†
=TÂµâ‹†.
39Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Therefore, we have
E[R(Tâ€²)]â‰¤E[Ë†R(Tâ€²)|E] + Reg3(T) (32)
â‰¤TÂµâ‹†+ Reg3(T)
(31) and (32) give the final upper bound with Ttime steps.
Theorem 5.1 (Problem-independent upper bound) .Let{Î´T}âˆ
T=1âˆˆo(1)be a sequence that satisfies ln(1/Î´T) =o(Tb)
for all b >0. IfT > L , for any instance Î›with variance gaps lower bounded by âˆ†vâ‰¤minSâˆˆAKâˆ†v
S, the regret of
PASC OMB UCB is upper bounded by
Oâˆš
KLT lnT+LK2
(âˆ†v)2ln1
Î´T
.
Proof of Theorem 5.1. We firstly deal with the regret due to suboptimality R1(Tâ€²). Letâˆ†Âµbe a constant that is to be chosen.
R1(Tâ€²) =Tâ€²X
p=11{Apâˆˆ B}âˆ†Ap
=Tâ€²X
p=11{âˆ†Apâ‰¥âˆ†Âµ} 1{Apâˆˆ B}âˆ†Ap+Tâ€²X
p=11{âˆ†Ap<âˆ†Âµ} 1{Apâˆˆ B}âˆ†Ap
â‰¤Tâ€²X
p=11{âˆ†Apâ‰¥âˆ†Âµ} 1{Apâˆˆ B}âˆ†Ap+TÂ·âˆ†Âµ
where the second term makes use of the fact that Tâ€²â‰¤Tw.p.1.
The first term can be upper bounded by adopting the proof of Lemma 6.3 with the constraint that âˆ†Apâ‰¥âˆ†Âµ. Thus, for
iâˆˆE\Sâ‹†,âˆ†i,Sâˆ©B,minâ‰¥âˆ†Âµ.ForiâˆˆE,
âˆ†i,Scâˆ©B,minâ‰¥âˆ†Âµ
Â¯âˆ†â€²
i,Scâˆ©Bâ‰¥max{Â¯Ï‰âˆ†Âµ,âˆ†v/3}= max {âˆ†Âµ,âˆ†v/3}=: âˆ†Âµv
ciâ‰¤1
Â¯Ï‰2= 1
where Â¯Ï‰:=r
ln1
Ï‰â€²v
ln1
Ï‰Âµ= 1. The regret due to suboptimality can be upper bounded by
Tâ€²X
p=11{âˆ†Apâ‰¥âˆ†Âµ} 1{Apâˆˆ B}âˆ†Apâ‰¤X
iâˆˆE\Sâ‹†2CÎ³K
âˆ†i,Sâˆ©B,min 
2 ln1
Ï‰Âµ+ ln ln +1
âˆ†2
i,Sâˆ©B,min+D!
+X
iâˆˆE2ciÂ·CÎ³K
âˆ†i,Scâˆ©B,min 
2 ln1
Ï‰â€²v+ ln ln +1
(Â¯âˆ†â€²
i,Scâˆ©B)2+D!
â‰¤X
iâˆˆE\Sâ‹†2CÎ³K
âˆ†Âµ
2 ln1
Ï‰Âµ+ ln ln +1
(âˆ†Âµ)2+D
+X
iâˆˆE2CÎ³K
âˆ†Âµ
2 ln1
Ï‰â€²v+ ln ln +1
(âˆ†Âµv)2+D
â‰¤LÂ·8CÎ³K
âˆ†Âµ
2 lnT+ ln ln +1
(âˆ†Âµ)2+D
40Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
By taking âˆ†Âµ=q
KLln(TL)
T, the regret due to suboptimality is bounded by
R1(Tâ€²)â‰¤Tâ€²X
p=11{âˆ†Apâ‰¥âˆ†Âµ} 1{Apâˆˆ B}âˆ†Ap+TÂ·âˆ†Âµ
â‰¤16CÎ³p
KLT ln(TL) + 8CÎ³r
KLT
lnTln ln +T
KLlnT+ 8CÎ³r
KLT
lnTD+p
KLT ln(TL)
=O(p
KLT ln(TL))
=O(âˆš
KLT lnT).
where we utilize Tâ‰¥L.
We then cope with the regret due to safeness-checking R2(Tâ€²).According to Lemma 6.3, we only need to upper bound
H(1,Î›), i.e., the hfunctions defined in (27), (28), (29) and (30).
ForhSâ‹†(1,âˆ†v
Sâ‹†):
hSâ‹†(1,âˆ†v
Sâ‹†)â‰¤hSâ‹†(1,âˆ†v)
=18Â·CÎ³K
(âˆ†v)2
2 ln1
Ï‰v+ ln ln +1
(âˆ†v)2+D
=OK
(âˆ†v)2ln1
Ï‰v
=OK
(âˆ†v)2lnT
Î´
ForhSâˆ©B(1,Â¯âˆ†i,Sâˆ©B), define âˆ†Âµv:= max
âˆ†Âµâˆš
ln(1/Ï‰Âµ),âˆ†v
3âˆš
ln(1/Ï‰v)
= maxq
KL
T,âˆ†v
3âˆš
ln(TL/Î´ )
. We have Â¯âˆ†i,Sâˆ©Bâ‰¥
âˆ†Âµv. The threshold$
âˆ†Âµv
Â¯Ïƒ2
3âˆš
ln(1/Ï‰v)%
=ï£¯ï£¯ï£¯ï£°max
3q
KLln(TL/Î´ )
T,âˆ†v
Â¯Ïƒ2ï£ºï£ºï£ºï£».
hSâˆ©B(1,Â¯âˆ†i,Sâˆ©B)â‰¤hSâˆ©B(1,âˆ†Âµv) (33)
=ï£±
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£³(Qâˆ’1)CÎ³K
(âˆ†Âµv)2
2 +1
ln(1/Ï‰Âµv)
ln ln +1
ln(1/Ï‰Âµv)(âˆ†Âµv)2+D
,ï£¯ï£¯ï£¯ï£°âˆ†Âµv
Â¯Ïƒ2
3âˆš
ln(1/Ï‰v)ï£ºï£ºï£ºï£»â‰¥Qâˆ’3
CÎ³K4
Â¯Ïƒ2
3âˆš
ln(1/Ï‰v)Â·âˆ†Âµv
2 +1
ln(1/Ï‰Âµv)
ln ln +1
ln(1/Ï‰Âµv)(âˆ†Âµv)2+D
,0<ï£¯ï£¯ï£¯ï£°âˆ†Âµv
Â¯Ïƒ2
3âˆš
ln(1/Ï‰v)ï£ºï£ºï£ºï£»< Qâˆ’3
3Â·CÎ³K
(âˆ†Âµv)2
2 +1
ln(1/Ï‰Âµv)
ln ln +1
ln(1/Ï‰Âµv)(âˆ†Âµv)2+D
,ï£¯ï£¯ï£¯ï£°âˆ†Âµv
Â¯Ïƒ2
3âˆš
ln(1/Ï‰v)ï£ºï£ºï£ºï£»= 0
=ï£±
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£³O
(Qâˆ’1)K
(âˆ†Âµv)2
,ï£¯ï£¯ï£¯ï£°âˆ†Âµv
Â¯Ïƒ2
3âˆš
ln(1/Ï‰v)ï£ºï£ºï£ºï£»â‰¥Qâˆ’3
Oï£«
ï£­K
Â¯Ïƒ2
3âˆš
ln(1/Ï‰v)Â·âˆ†Âµvï£¶
ï£¸,0<ï£¯ï£¯ï£¯ï£°âˆ†Âµv
Â¯Ïƒ2
3âˆš
ln(1/Ï‰v)ï£ºï£ºï£ºï£»< Qâˆ’3
OK
(âˆ†Âµv)2
,ï£¯ï£¯ï£¯ï£°âˆ†Âµv
Â¯Ïƒ2
3âˆš
ln(1/Ï‰v)ï£ºï£ºï£ºï£»= 0
41Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
In particular, in the asymptotic case where Tâ†’ âˆ andln1
Î´= ln1
Î´T=o(Tb),âˆ€b >0(this includes the scenario where Î´is
fixed with respect to T), we have
hSâˆ©B(1,âˆ†Âµv) =OK
(âˆ†Âµv)2
=OK
(âˆ†v)2lnT
Î´
ForhR(1,âˆ†v
i,R), we have âˆ†v
i,Râ‰¥âˆ†v. Furthermore, Ï‰sum=p
ln(TL) +p
ln(TL/Î´ )and the changing point
Ï‰sumÂ·âˆ†vâˆš
ln(1/Ï‰â€²v)Â¯Ïƒ2
=
(âˆš
ln(TL)+âˆš
ln(TL/Î´ ))Â·âˆ†vâˆš
ln(TL)Â¯Ïƒ2
.
Thus
hR(1,âˆ†v
i,R)â‰¤hR(râ€²,âˆ†v) (34)
=ï£±
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£³(Qâˆ’1)CÎ³K
(âˆ†v
3âˆš
ln(1/Ï‰â€²v))2ï£«
ï£­2 +1
ln(1/Ï‰vvâ€²)ï£«
ï£­ln ln +1
ln(1/Ï‰vvâ€²)(âˆ†v
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£¸ï£¶
ï£¸,$
Ï‰sumÂ·âˆ†v
p
ln(1/Ï‰â€²v)Â¯Ïƒ2%
â‰¥Qâˆ’3
CÎ³K3
Â¯Ïƒ2
3Ï‰sumÂ·âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v)ï£«
ï£¬ï£­2 +1
ln(1/Ï‰vvâ€²)ï£«
ï£¬ï£­ln ln +1
ln(1/Ï‰vvâ€²)(âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£·ï£¸ï£¶
ï£·ï£¸,0<$
Ï‰sumÂ·âˆ†v
p
ln(1/Ï‰â€²v)Â¯Ïƒ2%
â‰¤Qâˆ’3
3CÎ³K
(âˆ†v
3âˆš
ln(1/Ï‰â€²v))2ï£«
ï£­2 +1
ln(1/Ï‰vvâ€²)ï£«
ï£­ln ln +1
ln(1/Ï‰vvâ€²)(âˆ†v
3âˆš
ln(1/Ï‰â€²v))2+Dï£¶
ï£¸ï£¶
ï£¸,$
Ï‰sumÂ·âˆ†v
p
ln(1/Ï‰â€²v)Â¯Ïƒ2%
= 0
=ï£±
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£³Oï£«
ï£­(Qâˆ’1)K
(âˆ†v
3âˆš
ln(1/Ï‰â€²v))2ï£¶
ï£¸,$
Ï‰sumÂ·âˆ†v
p
ln(1/Ï‰â€²v)Â¯Ïƒ2%
â‰¥Qâˆ’3
Oï£«
ï£¬ï£­K
Â¯Ïƒ2
3Ï‰sumÂ·âˆ†v
i,R
3âˆš
ln(1/Ï‰â€²v)ï£¶
ï£·ï£¸, 0<$
Ï‰sumÂ·âˆ†v
p
ln(1/Ï‰â€²v)Â¯Ïƒ2%
â‰¤Qâˆ’3
=Oï£«
ï£­K
(âˆ†v
3âˆš
ln(1/Ï‰â€²v))2ï£¶
ï£¸,$
Ï‰sumÂ·âˆ†v
p
ln(1/Ï‰â€²v)Â¯Ïƒ2%
= 0
In particular, in the asymptotic case where Tâ†’ âˆ andln1
Î´= ln1
Î´T=o(Tb),âˆ€b >0, we have
hR(1,âˆ†v) =OQK
(âˆ†v)2ln1
Ï‰â€²v
=OQK
(âˆ†v)2lnT
ForScâˆ© B: define Â¯âˆ†Âµv:= max
âˆ†Âµâˆš
ln(1/Ï‰Âµ),âˆ†v
3âˆš
ln(1/Ï‰â€²v)
= maxq
KL
T,âˆ†v
3âˆš
ln(TL)
.We have Â¯âˆ†i,Scâˆ©Bâ‰¥Â¯âˆ†Âµvand
the changing pointj
Ï‰sumÂ·Â¯âˆ†Âµv
Â¯Ïƒ2/3k
=
(âˆš
ln(TL)+âˆš
ln(TL/Î´ ))Â·âˆ†Âµv
Â¯Ïƒ2/3
thus
hScâˆ©B(1,Â¯âˆ†i,Scâˆ©B)â‰¤hScâˆ©B(1,Â¯âˆ†Âµv) (35)
=ï£±
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£³(Qâˆ’1)CÎ³K
(Â¯âˆ†Âµv)2
2 +1
ln(1/Ï‰max)
ln ln +1
ln(1/Ï‰max)(Â¯âˆ†Âµv)2+D
,Ï‰sumÂ·Â¯âˆ†Âµv
Â¯Ïƒ2/3
â‰¥Qâˆ’3
CÎ³K 
3
Â¯Ïƒ2
3Ï‰sumÂ¯âˆ†Âµv!
2 +1
ln(1/Ï‰max)
ln ln +1
ln(1/Ï‰max)(Â¯âˆ†Âµv)2+D
,0<Ï‰sumÂ·Â¯âˆ†Âµv
Â¯Ïƒ2/3
< Qâˆ’3
3CÎ³K
(Â¯âˆ†Âµv)2
2 +1
ln(1/Ï‰max)
ln ln +1
ln(1/Ï‰max)(Â¯âˆ†Âµv)2+D
,Ï‰sumÂ·Â¯âˆ†Âµv
Â¯Ïƒ2/3
= 0, râ€²= 1
42Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
=ï£±
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£³O
(Qâˆ’1)K
(Â¯âˆ†Âµv)2
,Ï‰sumÂ·Â¯âˆ†Âµv
Â¯Ïƒ2/3
â‰¥Qâˆ’3
O 
K
Â¯Ïƒ2
3Ï‰sumÂ·Â¯âˆ†Âµv!
, 0<Ï‰sumÂ·Â¯âˆ†Âµv
Â¯Ïƒ2/3
< Qâˆ’3
OK
(Â¯âˆ†Âµv)2
,Ï‰sumÂ·Â¯âˆ†Âµv
Â¯Ïƒ2/3
= 0, râ€²= 1
In particular, in the asymptotic case where Tâ†’ âˆ andln1
Î´= ln1
Î´T=o(Tb),âˆ€b >0, we have
hScâˆ©B(1,Â¯âˆ†Âµv) =OQK
(âˆ†v)2lnT
Lastly,
R3(T) = 2 Âµâ‹†L+ 2Âµâ‹†TL(Î¾(Ï‰Âµ) + 2Î¾(Ï‰v) + 2Î¾(Ï‰â€²
v))
â‰¤2KL+KÎ´+ 2KTLÂ·4Â·2 +Ïµ
Ïµ 1
T2
ln(1 + Ïµ)1+Ïµ
â‰¤2KL+KÎ´+ 4KÂ·2 +Ïµ
Ïµ  1
ln(1 + Ïµ)1+Ïµ
=O(1)
where we utilize T > L and the Onotation refers to the fact that the preceding term is bounded as a function of T.
Note that Âµâ‹†â‰¤K, soTÂµâ‹†+KÎ´â‰¤TK+KÎ´.
In conclusion , according to Theorem 4.1, for any T > L , the problem-independent upper bound is the minimum of
TK+KÎ´and
O(âˆš
KLT lnT) +K X
iâˆˆSâ‹†hSâ‹†(1,âˆ†v) +X
iâˆˆEhSâˆ©B(1,âˆ†Âµv) +X
iâˆˆEhR(1,âˆ†v) +X
iâˆˆEhScâˆ©B(1,Â¯âˆ†Âµv)!
â‰¤O(âˆš
KLT lnT) +K 
KhSâ‹†(1,âˆ†v) +LhSâˆ©B(1,âˆ†Âµv) +LhR(1,âˆ†v) +LhScâˆ©B(1,Â¯âˆ†Âµv)
=O(âˆš
KLT lnT) +OK3
(âˆ†v)2lnT
Î´
+KL 
hSâˆ©B(1,âˆ†Âµv) +hR(1,âˆ†v) +hScâˆ©B(1,Â¯âˆ†Âµv)
where the hfunctions are defined in (33),(34) and(35). In the asymptotic case where Tâ†’ âˆ andln1
Î´= ln1
Î´T=
o(Tb),âˆ€b >0(this includes the scenario where Î´is fixed with respect to T), the asymptotic problem-independent upper
bound is
O(âˆš
KLT lnT) +K X
iâˆˆEOK
(âˆ†v)2lnT
Î´
+OX
iâˆˆEQK
(âˆ†v)2lnT!
=O(âˆš
KLT lnT) +OLK2
(âˆ†v)2ln1
Î´
where we utilizeâˆš
TlnTâ‰¥QK2
(âˆ†v)2lnTwhen Tis sufficiently large.
C. Proofs of the Lower Bounds
C.1. Preliminaries and the Impossibility Result
LetKL(Î½, Î½â€²)denote the KL divergence between distributions Î½andÎ½â€², and
d(x, y) :=xlnx
y
+ (1âˆ’x) ln1âˆ’x
1âˆ’y
denote the Kullbackâ€“Leibler (KL) divergence between the Bernoulli distributions Bern( x)andBern( y).
43Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Lemma C.1 (Pinskerâ€™s and reverse Pinskerâ€™s Inequality) .Consider two probability mass functions PX, PYdefined on the
same discrete probability space A âŠ‚[0,1]. The following inequalities hold:
|EXâˆ¼PX[X]âˆ’EYâˆ¼PY[Y]| â‰¤Î´(PX, PY)â‰¤r
1
2KL(PX, PY)â‰¤1âˆšÎ±YÂ·Î´(PX, PY), .
where Î´(PX, PY) := supAâŠ†AP
aâˆˆAPX(a)âˆ’P
aâˆˆAPY(a)	
=1
2P
aâˆˆA|PX(a)âˆ’PY(a)|is the total variational
distance, and Î±Y:= min aâˆˆA:PY(a)>0Q(a).
Lemma C.2 (Lemma 1 in Kaufmann et al. (2016)) .Assume the distributions under instance Î›1= (E,AK, Î½(1),Â¯Ïƒ2)and
instance Î›2= (E,AK, Î½(2),Â¯Ïƒ2)are mutually absolutely continuous. Given time budget T,
LX
i=1EÎ›1[Ni(T)]Â·KL(Î½(1)
i, Î½(2)
i)â‰¥sup
EâˆˆHÎ›1
Td 
PÎ›1(E),PÎ›2(E)
.
where Ni(t)denotes the number of time steps item iis selected up to and including time step tandHÎ›1
Tis all the possible
events generated by instance Î›1and algorithm Ï€withTtime steps.
Lemma C.3. Let solution Scontaining |S|=m(q < m â‰¤K)items be a safe solution under instance Î›1=
(E,AK, Î½(1),Â¯Ïƒ2). Each item in Sis i.i.d. with reward distribution Î½1, mean Âµ1and variance Ïƒ2
1<Â¯Ïƒ2. De-
fine event E(t,1)={Sis identified as safe after time step t},E(t,2)={Sis chosen at least once after time step t}, and
E(t)=E(t,1)âˆ© E(t,2). Assume there exists Ï„â‰¤Tsuch that PÎ›1[E(Ï„)]â‰¥1âˆ’Î´andPÎ›1[E(Ï„âˆ’1,1)]<1âˆ’Î´. IfÏ„exists, we
have
X
iâˆˆSEÎ›1[Ni(Ï„)]â‰¥sup
Î½2âˆˆE(Î½1)d(Î´,1âˆ’Î´)
KL(Î½1, Î½2).
Furthermore,
EÎ›1[M(Ï„)]â‰¥sup
Î½2âˆˆE(Î½1)1
|S| âˆ’1Â·d(Î´,1âˆ’Î´)
KL(Î½1, Î½2):=T(Î½(1)),
where M(t)is the number of times that a solution Sâ€²âŠ‚Sis sampled up to and include time step tandE(Î½1) ={Î½2:
the variance associated to Î½2is larger than Â¯Ïƒ2/|S|}.
Proof. With Ïƒ2
2>Â¯Ïƒ2/|S|, we construct an alternative instance Î›2= (E,AK, Î½2,Â¯Ïƒ2), under which each item in Sis with
reward distribution Î½2, mean Âµ2and variance Ïƒ2
2, while the distributions of other items remain unchanged.
Define event E(t,1)={Sis identified as safe after time step t},E(t,2)={Sis chosen at least once after time step t}, and
E(t)=E(t,1)âˆ© E(t,2). Assume there exists Ï„â‰¤Tsuch that PÎ›1[E(Ï„)]â‰¥1âˆ’Î´andPÎ›1[E(Ï„âˆ’1,1)]<1âˆ’Î´. Since Sis
unsafe under instance Î›2and all the solutions chosen {St}T
t=1âŠ‚ A Kare safe with probability at least 1âˆ’Î´, we have
PÎ›2[E(t)]< Î´for all tâ‰¤T.
We now apply Lemma C.2 to obtain that
X
iâˆˆSEÎ›1[Ni(Ï„)]Â·KL(Î½1, Î½2)â‰¥d(P1(Ec
(Ï„)),P2(Ec
(Ï„)))â‰¥d(Î´,1âˆ’Î´)â‡’X
iâˆˆSEÎ›1[Ni(Ï„)]â‰¥d(Î´,1âˆ’Î´)
KL(Î½1, Î½2).
SincePÎ›1[E(Ï„âˆ’1,1)]<1âˆ’Î´, we can select at most mâˆ’1items at one time step among the first Ï„time steps. Therefore,
EÎ›1[M(Ï„)]â‰¥1
mâˆ’1X
iâˆˆPEÎ›1[Ni(Ï„)]â‰¥1
mâˆ’1Â·d(Î´,1âˆ’Î´)
KL(Î½1, Î½2).
44Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Theorem 4.5 (Impossibility result) .Let{Î´T}âˆ
T=1âˆˆo(1)be a sequence that satisfies that there exists bâˆˆ(0,1]such that
ln(1/Î´T) = â„¦( Tb). For any instance Î›, the regret of any algorithm is lower bounded by â„¦(Tb).
Proof. The proof is similar to the proof of Lemma C.3. We consider an alternative instance Î›2= (E,AK, Î½(2),Â¯Ïƒ2)with
the distributions of the items in the optimal safe solution Sâ‹†changed such that (assume the variances of all the items in Sâ‹†
are changed (increased))
X
iâˆˆSâ‹†(Ïƒ(2)
i)2â‰¥Â¯Ïƒ2
i.e., under instance Î›2, this solution Sâ‹†is unsafe (thus not optimal safe). The other items remain unchanged.
By a similar argument as the proof of Lemma C.3, we have
X
iâˆˆSâ‹†EÎ›1[Ni(Ï„)]Â·KL(Î½(1)
i, Î½(2)
i)â‰¥d(Î´,1âˆ’Î´)
â‡’X
iâˆˆSâ‹†EÎ›1[Ni(Ï„)]â‰¥d(Î´,1âˆ’Î´)
miniâˆˆSâ‹†KL(Î½(1)
i, Î½(2)
i)
So the safeness checking of Sâ‹†will take â„¦(ln1
2.4Î´T) = â„¦( Tb)
Recall the probably anytime-safe constraint (1):
P
âˆ€tâˆˆ[T], Stâˆˆ S
â‰¥1âˆ’Î´T.
This indicates at time step t, for any solution S, ifPH(0)
t[Sâˆˆ S]<1âˆ’Î´T,Swill not be selected at this time step. Otherwise,
(1)is violated. Therefore, before the safeness of the optimal safe solution Sis ascertained, it is not going to be sampled and
the instantaneous regret will be lower bounded by minSâˆˆSâˆ©B âˆ†S.
In conclusion, the regret is at least ln1
2.4Î´TÂ·minSâˆˆSâˆ©B âˆ†S= â„¦(Tb).
We derive both the problem-dependent and problem independent lower bounds on the K-path semi-bandit problem. The
items in the ground set are divided into L0paths: P1, . . . , P L0, each of which contains Kunique items. Path Pjcontains
items (jâˆ’1)K+ 1, . . . , jK . Without loss of generality, we assume that L/K is an integer. A set Sis a solution if and
only if SâŠ‚Pjfor some j. In other words, the solution set AK={S:SâŠ‚Pj,âˆƒj= 1, . . . , L 0}. We let Ni(t)denote the
number of time steps item iis selected up to and including time step t,Mj(t)denote the number of time steps a safe subset
in path jis selected up to and including time step t, andSj(t)denote the time steps when a safe subset in path jis selected,
i.e.,
Ni(t) =tX
s=11{iâˆˆSs}, M j(t) =tX
s=11{SsâŠ‚Pj, Ssis safe }, S j(t) ={1â‰¤sâ‰¤t:SsâŠ‚Pj, Ssis safe }.
We let Reg[j](t)denote the regret accumulated in Sj(t). Since all the chosen solutions are safe with probability at least
1âˆ’Î´, we have Reg(T)â‰¥(1âˆ’Î´)Â·PL0
j=1Reg[j](T). In the following, we lower bound the regret accumulated in time steps
where safe solutions are chosen.
We will construct several instances to prove each of the lower bounds (which will be specified in the proof) such that
under instance k(Î›k= (E,AK, Î½(k),Â¯Ïƒ2)), the stochastic reward of items in path j(1â‰¤jâ‰¤L0) are i.i.d., i.e. ,
Î½(k)
i=Î½(k)
Pj,âˆ€iâˆˆPj, which will be specified in each case. Under instance k, we define several other notations as follows:
â€¢ Let Wi(t)(k)be the random reward of arm iat time step t.
â€¢LetS(k)
tbe the pulled solution at time step t, andH(j)
t={(S(j)
s,{Wi(s)(k)}sâˆˆS(k)
s)}t
s=1be the sequence of selected
solutions and observed rewards up to and including time step t.
For simplicity, we abbreviate EH(k)
T,PH(k)
T, asEk,Pkrespectively.
45Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
C.2. Problem-dependent Lower bound
In order to provide a better understanding of the analysis, we first derive a lower bound with Gaussian distributions
(unbounded) in Theorem C.4. With the same technique, we derive a lower bound with bounded Bernoulli distributions in
Theorem 4.3, which corroborates with our problem setup.
Theorem C.4 (Problem-dependent lower bound for sub-Gaussian instances) .Let{Î´T}âˆ
T=1âˆˆo(1)be a sequence that
satisfies ln(1/Î´T) =o(Tb)for all b >0. There exists an instance Î›, for any {Î´T}TâˆˆN-variance-constrained consistent
algorithm Ï€, the regret is lower bounded by
â„¦ X
iâˆˆElnT
âˆ†i,Sâˆ©B,min!
+Âµâ‹†
KÂ·â„¦KÂ·ln(1/Î´T)
(âˆ†Sâ‹†)2+X
iâˆˆE
Î¨â€²
i,Sâˆ©B+lnT
(âˆ†v
i,R)2+ Î¦i,Scâˆ©B
.
Proof. Given a vanishing sequence {Î´T}TâˆˆN, we consider a fixed {Î´T}TâˆˆN-variance-constrained consistent algorithm Ï€on
theK-path semi-bandit problem. For simplicity, the distributions of the items are assumed to be Gaussian in the proof, but
the techniques can be applied to the Bernoulli case and we provide the instance design and the corresponding bound at the
end of the proof.
Under instance Î›0(the base instance), Ïƒ2=2Â¯Ïƒ2
K(so the absolutely safe solutions contain at most K/2items) and the
distributions of the items are
Î½(0)
i=N(Âµ(0)
j,(Ïƒ2
i)(0)) =ï£±
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£²
ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£´ï£³Î½(0)
P1=N(âˆ†,Â¯Ïƒ2âˆ’Ïµv
K), i âˆˆP1
Î½(0)
Pj=N(âˆ†âˆ’ÏµÂµ
K,Â¯Ïƒ2âˆ’Ïµv
K), i âˆˆPj,2â‰¤jâ‰¤L1+ 1
Î½(0)
Pj=N(âˆ† +ÏµÂµ
K,Â¯Ïƒ2+Ïµv
K), i âˆˆPj, L1+ 2â‰¤jâ‰¤L2+ 1
Î½(0)
Pj=N(âˆ†âˆ’ÏµÂµ
K,Â¯Ïƒ2+Ïµv
K), i âˆˆPj, L2+ 2â‰¤jâ‰¤L0
where ÏµÂµ<âˆ†
KandÏµvare small positive constants (e.g. ÏµÂµ=âˆ†
2K, Ïµvâ‰¤Â¯Ïƒ2
K2), and L1=L2âˆ’L1=L0âˆ’L2âˆ’1 =L0âˆ’1
3
(assume it is an integer). In this case,
â€¢ path 1is an optimal safe path,
â€¢ path 2to path L1+ 1are the safe and suboptimal paths,
â€¢ path L1+ 2to path L2+ 1are the risky paths
â€¢ path L2+ 2to path L3+ 1 = L0are the unsafe and suboptimal paths.
In the following, we will compute the minimum regret yielded from each of the paths.
Case 1: the optimal safe path P1
In order to achieve o(Ta),âˆ€a >0regret, any algorithm has to identify the safeness of the optimal safe solution P1and
sample P1â„¦(T)times, otherwise, the regret is linear. According to Lemma C.3, the expected number of time steps needed
for the safeness identification of P1is lower bounded by
E0[M1(Ï„)]â‰¥ sup
Î½(1)
P1âˆˆE(Î½(0)
P1)1
Kâˆ’1Â·d(Î´T,1âˆ’Î´T)
KL(Î½(0)
P1, Î½(1)
P1):=T(Î½(0)
P1)
where E(Î½(0)
P1) ={Î½(1)
P1:the variance associated to Î½(1)
P1is larger than Â¯Ïƒ2/K}. In particular, we let instance Î›1=
(E,AK, Î½(1),Â¯Ïƒ2)with
Î½(1)
i=ï£±
ï£´ï£²
ï£´ï£³Î½(1)
P1=N
âˆ†,Â¯Ïƒ2+Ïµv
1
K
, i âˆˆP1
Î½(0)
i, i / âˆˆP1
46Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
where Ïµv
1is an arbitrarily small constant. Thus, we can take supremum over Ïµv
1>0and have
T(Î½(0)
P1)â‰¥1
Kâˆ’1Â·ln1
2.4Î´T
KL(N(âˆ†,Â¯Ïƒ2âˆ’Ïµv
K), N(âˆ†,Â¯Ïƒ2
K))â‰¥1
Kâˆ’1Â·4K2(Â¯Ïƒ2/K)2
(Ïµv)2ln1
2.4Î´T=K(Ïƒ2)2
(Ïµv)2ln1
2.4Î´T
When a solution SâŠ‚P1is chosen before this time step, the instantaneous regret is lower bounded by âˆ†. The accumulative
regret from P1is lower bounded by
Reg[1]( T)â‰¥âˆ†Â·T(Î½(0)
P1) = â„¦(Kâˆ†
(âˆ†v
P1)2ln1
Î´T)
Case 2: the safe and suboptimal paths
For any safe and suboptimal path Pj(2â‰¤jâ‰¤L1+ 1) , we define instance Î›j= (E,AK, Î½(j),Â¯Ïƒ2)with
Î½(j)
i=ï£±
ï£´ï£²
ï£´ï£³Î½(j)
Pj=N(âˆ† +ÏµÂµ
j
K,Â¯Ïƒ2âˆ’Ïµv
K), i âˆˆPj
Î½(0)
i, i / âˆˆPj
where ÏµÂµ
j<âˆ†is an arbitrarily small constant. So Pjis the optimal safe solution under instance j.
Fix any item iâˆˆPj, consider the event Ej={Ni(T)â‰¥T
2}, under instance 1,Ejindicates the optimal safe solution P1
is sampled less thanT
2times; under instance j,Ec
jindicates the optimal safe solution Pjis sampled less thanT
2times.
Therefore,
RegÎ›0(T) + RegÎ›j(T)â‰¥T
2ÏµÂµP0[Ej] +T
2ÏµÂµ
jPj[Ec
j]
â‰¥T
2min{ÏµÂµ, ÏµÂµ
j} 
P0[Ej] +Pj[Ec
j]
According to Lemma C.1 and Lemma C.2, we have
P0[Ej] +Pj[Ec
j]â‰¥1
2exp{âˆ’KL(P1,Pj)}
KL(P1,Pj) =LX
i=1E0[Ni(T)]Â·KL 
Î½(0)
i, Î½(j)
i
=X
iâˆˆPjE0[Ni(T)]Â·KL 
Î½(0)
i, Î½(j)
i
Thus
RegÎ›0(T) + RegÎ›j(T)â‰¥T
2min{ÏµÂµ, ÏµÂµ
j} Â·1
2exp{âˆ’KL(P1,Pj)}
â‡â‡’ln
RegÎ›0(T) + RegÎ›j(T)
lnTâ‰¥1 +min{ÏµÂµ, ÏµÂµ
j}/4
lnTâˆ’KL(P1,Pj)
lnT
(âˆ—)=â‡’KL(P1,Pj)
lnTâ‰¥1
â‡â‡’P
iâˆˆPjE0[Ni(T)]
lnTâ‰¥1
KL 
Î½(0)
Pj, Î½(j)
Pj=2Â¯Ïƒ2âˆ’Ïµv
K
(ÏµÂµ+ÏµÂµ
j
K)2
(âˆ—âˆ—)=â‡’P
iâˆˆPjE0[Ni(T)]
lnTâ‰¥2Â¯Ïƒ2âˆ’Ïµv
K
(ÏµÂµ
K)2=:T(Î½(0)
Pj)
where in (âˆ—)we let Tâ†’ âˆ and note that both RegÎ›0(T)andRegÎ›j(T)are of order o(Ta),âˆ€a >0; in(âˆ—âˆ—)we take
supremum over ÏµÂµ
j>0.
47Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
We also have to take the safeness constraint into consideration. According to Lemma C.3, in order to check the safeness of
Pj, the items in Pjhave to be sampled
X
iâˆˆPjEÎ›0[Ni(Ï„)]â‰¥ sup
Î½â€²
PjâˆˆE(Î½(0)
Pj)d(Î´T,1âˆ’Î´T)
KL(Î½(0)
Pj, Î½â€²
Pj).
â‡â‡’P
iâˆˆPjEÎ›0[Ni(Ï„)]
lnTâ‰¥ sup
Î½â€²
PjâˆˆE(Î½(0)
Pj)1
KL(Î½(0)
Pj, Î½â€²
Pj)Â·d(Î´T,1âˆ’Î´T)
lnTâ‰¥4K2(Â¯Ïƒ2/K)2
(Ïµv)2ln1
2.4Î´T
lnT:=Tsafe(Î½(0)
Pj).
IfT(Î½(0)
Pj)â‰¤Tsafe(Î½(0)
Pj), it indicates the suboptimality of Pjis identified before the safeness. Furthermore, whenever a
solution SâŠ‚Pjis sampled, Scan have most Kâˆ’1items. So the regret is lower bounded by
Reg[j](T)
lnTâ‰¥T(Î½(0)
Pj)
Kâˆ’1Â·(ÏµÂµ+ âˆ†âˆ’ÏµÂµ
K)â‰¥2K2Â¯Ïƒ2âˆ’Ïµv
K
(ÏµÂµ)2Â·(âˆ†
Kâˆ’1+ÏµÂµ
K)
=â‡’Reg[j](T)
lnTâ‰¥2KÂ¯Ïƒ2âˆ’Ïµv
K
(ÏµÂµ)2Â·(âˆ† + ÏµÂµ)â‰¥KÏƒ2/2
(ÏµÂµ)2Â·(âˆ† + ÏµÂµ)
=â‡’Reg[j](T) = â„¦ 
K
âˆ†2
Pj(âˆ†Pj+ âˆ†) ln T!
(36)
IfT(Î½(0)
Pj)â‰¥Tsafe(Î½(0)
Pj), it indicates the suboptimality of Pjis identified after the safeness. Thus, whenever a solution
SâŠ‚Pjis sampled, Scan have most Kâˆ’1items before the safeness checking is finished. So the regret is lower bounded by
Reg[j](T)
lnTâ‰¥Tsafe(Î½(0)
Pj)
Kâˆ’1Â·(ÏµÂµ+ âˆ†âˆ’ÏµÂµ
K) +T(Î½(0)
Pj)âˆ’Tsafe(Î½(0)
Pj)
KÂ·ÏµÂµ
â‰¥T(Î½(0)
Pj)
KÂ·ÏµÂµ+ (âˆ†âˆ’ÏµÂµ
K)Â·Tsafe(Î½(0)
Pj)
Kâˆ’1
â‰¥2KÂ¯Ïƒ2âˆ’Ïµv
K
(ÏµÂµ)2Â·ÏµÂµ+ (âˆ†âˆ’ÏµÂµ
K)Â·1
Kâˆ’1Â·4K2(Â¯Ïƒ2/K)2
(Ïµv)2ln1
2.4Î´T
lnT
â‰¥KÏƒ2/2
ÏµÂµ+ (âˆ†âˆ’ÏµÂµ
K)Â·1
Kâˆ’1Â·K2(Ïƒ2)2
(Ïµv)2ln1
2.4Î´T
lnT
=â‡’Reg[j](T) = â„¦ 
K
âˆ†PjlnT+ (âˆ†âˆ’âˆ†Pj
K)K
(âˆ†v
Pj)2ln1
Î´T!
(37)
Based on (36) and (37), the regret is
Reg[j](T) = â„¦ 
K
âˆ†PjlnT+ âˆ†Â·min(
K
âˆ†2
PjlnT,K
(âˆ†v
Pj)2ln1
Î´T)!
Case 3: the risky paths
For any risky path Pj(L1+ 2â‰¤jâ‰¤L2+ 1, we define instance Î›j= (E,AK, Î½(j),Â¯Ïƒ2)with
Î½(j)
i=ï£±
ï£´ï£²
ï£´ï£³Î½(j)
Pj=N(âˆ† +ÏµÂµ
K,Â¯Ïƒ2âˆ’Ïµv
j
K), i âˆˆPj
Î½(0)
i, i / âˆˆPj
where Ïµv
jis an arbitrarily small constant. So Pjis the optimal safe solution under instance j.
48Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Fix any item iâˆˆPj, consider the event Ej={Ni(T)â‰¥T
2}, under instance 1,Ejindicates the optimal safe solution P1
is sampled less thanT
2times; under instance j,Ec
jindicates the optimal safe solution Pjis sampled less thanT
2times.
Therefore,
RegÎ›0(T) + RegÎ›j(T)â‰¥T
2
âˆ†âˆ’Kâˆ’1
KÏµÂµ
P0[Ej] +T
2ÏµÂµPj[Ec
j]
â‰¥T
2ÏµÂµÂ· 
P0[Ej] +Pj[Ec
j]
According to Lemma C.1 and Lemma C.2, we have
P0[Ej] +Pj[Ec
j]â‰¥1
2exp{âˆ’KL(P1,Pj)}
KL(P1,Pj) =LX
i=1E0[Ni(T)]Â·KL 
Î½(0)
i, Î½(j)
i
=X
iâˆˆPjE0[Ni(T)]Â·KL 
Î½(0)
i, Î½(j)
i
Thus
RegÎ›0(T) + RegÎ›j(T)â‰¥T
2ÏµÂµÂ·1
2exp{âˆ’KL(P1,Pj)}
â‡â‡’ln
RegÎ›0(T) + RegÎ›j(T)
lnTâ‰¥1 +min{ÏµÂµ, ÏµÂµ
j}/4
lnTâˆ’KL(P1,Pj)
lnT
(âˆ—)=â‡’KL(P1,Pj)
lnTâ‰¥1
â‡â‡’P
iâˆˆPjE0[Ni(T)]
lnTâ‰¥1
KL 
Î½(0)
Pj, Î½(j)
Pj=K2(Ïƒ2)2
(Ïµv)2=:T(Î½(0)
Pj)
where in (âˆ—)we let Tâ†’ âˆ and note that both RegÎ›0(T)andRegÎ›j(T)are of order o(Ta),âˆ€a >0.
Note that Pjis a risky path and if any solution SâŠ‚Pjis sampled, |S| â‰¤Kâˆ’1. Thus, E[Mj(T)]â‰¥T(Î½(0)
Pj)
Kâˆ’1lnT. The
regret is lower bounded by
Reg[j](T) = â„¦
âˆ†âˆ’Kâˆ’1
KÏµÂµ1
Kâˆ’1K2(Ïƒ2)2
(Ïµv)2lnT
= â„¦ 
Kâˆ†
(âˆ†v
Pj)2lnT!
Case 4: the unsafe and suboptimal paths
For any unsafe and suboptimal path Pj(L2+ 2â‰¤jâ‰¤L0), we define instance Î›j= (E,AK, Î½(j),Â¯Ïƒ2)with
Î½(j)
i=ï£±
ï£´ï£²
ï£´ï£³Î½(j)
Pj=N(âˆ† +ÏµÂµ
j
K,Â¯Ïƒ2âˆ’Ïµv
j
K), i âˆˆPj
Î½(0)
i, i / âˆˆPj
where ÏµÂµ
j<âˆ†, Ïµv
j<Â¯Ïƒ2
Kare arbitrarily small constants. So Pjis the optimal safe solution under instance j.
Fix any item iâˆˆPj, consider the event Ej={Ni(T)â‰¥T
2}, under instance 1,Ejindicates the optimal safe solution P1
is sampled less thanT
2times; under instance j,Ec
jindicates the optimal safe solution Pjis sampled less thanT
2times.
Therefore,
RegÎ›0(T) + RegÎ›j(T)â‰¥T
2ÏµÂµP0[Ej] +T
2ÏµÂµ
jPj[Ec
j]
â‰¥T
2min{ÏµÂµ, ÏµÂµ
j} 
P0[Ej] +Pj[Ec
j]
49Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
According to Lemma C.1 and Lemma C.2, we have
P0[Ej] +Pj[Ec
j]â‰¥1
2exp{âˆ’KL(P1,Pj)}
KL(P1,Pj) =LX
i=1E0[Ni(T)]Â·KL 
Î½(0)
i, Î½(j)
i
=X
iâˆˆPjE0[Ni(T)]Â·KL 
Î½(0)
i, Î½(j)
i
Thus
RegÎ›0(T) + RegÎ›j(T)â‰¥T
2min{ÏµÂµ, ÏµÂµ
j} Â·1
2exp{âˆ’KL(P1,Pj)}
â‡â‡’ln
RegÎ›0(T) + RegÎ›j(T)
lnTâ‰¥1 +min{ÏµÂµ, ÏµÂµ
j}/4
lnTâˆ’KL(P1,Pj)
lnT
(âˆ—)=â‡’KL(P1,Pj)
lnTâ‰¥1
â‡â‡’P
iâˆˆPjE0[Ni(T)]
lnTâ‰¥1
KL 
Î½(0)
Pj, Î½(j)
Pj= 4K2ï£«
ï£­ 
Ïµv
j+Ïµv
(Â¯Ïƒ2âˆ’Ïµv
j)/K!2
+2(ÏµÂµ
j+ÏµÂµ)2
(Â¯Ïƒ2âˆ’Ïµv
j)/Kï£¶
ï£¸âˆ’1
(âˆ—âˆ—)=â‡’P
iâˆˆPjE0[Ni(T)]
lnTâ‰¥4K2 Ïµv
Ïƒ2/22
+2(ÏµÂµ)2
Ïƒ2/2!âˆ’1
=:T(Î½(0)
Pj)
where in (âˆ—)we let Tâ†’ âˆ and note that both RegÎ›0(T)andRegÎ›j(T)are of order o(Ta),âˆ€a >0; in(âˆ—âˆ—)we take the
supremum over ÏµÂµ
j>0, Ïµv
j>0.
Note that Pjis an unsafe path and if any solution SâŠ‚Pjis sampled, |S| â‰¤Kâˆ’1. Thus, E[Mj(T)]â‰¥T(Î½(0)
Pj)
Kâˆ’1lnT. The
regret is lower bounded by
Reg[j](T)â‰¥
âˆ† +Kâˆ’1
KÏµÂµ4K2
Kâˆ’1 Ïµv
Ïƒ2/22
+2(ÏµÂµ)2
Ïƒ2/2!âˆ’1
lnT
= â„¦Kâˆ† +KÏµÂµ
max{ÏµÂµ, Ïµv}2lnT
= â„¦ 
min(
Kâˆ†
âˆ†2
PjlnT,Kâˆ†
(âˆ†v
Pj)2lnT)!
In conclusion , the regret yielded from these paths is lower bounded by
Reg(T)
1âˆ’Î´Tâ‰¥Reg[1]( T) +L1+1X
j=2Reg[j](T) +L2+1X
j=L1+2Reg[j](T) +L0X
j=L2+2Reg[j](T)
â‰¥â„¦Kâˆ†
(Ïµv)2ln1
Î´T
+L1+1X
j=2â„¦K
ÏµÂµlnT+ âˆ†Â·minK
(ÏµÂµ)2lnT,K
(Ïµv)2ln1
Î´T
+L2+1X
j=L1+2â„¦Kâˆ†
(Ïµv)2lnT
+L0X
j=L2+2â„¦
minKâˆ†
(ÏµÂµ)2lnT,Kâˆ†
(Ïµv)2lnT
.
Note
â€¢L1=L2âˆ’L1=L0âˆ’L2âˆ’1 =L0âˆ’1
3,L0=L
KandÂµâ‹†=Kâˆ†.
â€¢ for Sâ‹†,Ïµv= âˆ†v
Sâ‹†.
50Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
â€¢ for Sâˆˆ S âˆ© B andiâˆˆS, we check that if SâŠ‚Pj,2â‰¤jâ‰¤L1+ 1,âˆ†i,Sâˆ©B,min=ÏµÂµand
Î¨â€²
i,Sâˆ©Bâ‰¥minlnT
âˆ†2
S,9 ln(1 /Î´T)
(âˆ†v
S)2
.
where the equality holds when S=Pj,2â‰¤jâ‰¤L1+ 1.
â€¢ for Sâˆˆ R andiâˆˆS,Ïµv= âˆ†v
i,R.
â€¢Sâˆˆ Scâˆ© BandiâˆˆS, we can easily check S=Pjfor some L2+ 2â‰¤jâ‰¤L0, thus âˆ†i,Scâˆ©B,min=ÏµÂµand
Î¦i,Scâˆ©B= minlnT
âˆ†2
S,9 lnT
(âˆ†v
S)2
.
Therefore,
Reg(T)â‰¥â„¦LlnT
âˆ†i,Sâˆ©B,min
+Âµâ‹†
KÂ·â„¦ 
KÂ·ln(1/Î´T)
(âˆ†Sâ‹†)2+X
iâˆˆEÎ¨â€²
i,Sâˆ©B+X
iâˆˆElnT
(âˆ†v
i,R)2+X
iâˆˆEÎ¦i,Scâˆ©B!
.
Theorem 4.3 (Problem-dependent lower bound) .Let{Î´T}âˆ
T=1âˆˆo(1)be a sequence that satisfies ln(1/Î´T) =o(Tb)for
allb >0. There exists an instance Î›such that for any {Î´T}TâˆˆN-variance-constrained consistent algorithm Ï€, the regret is
lower bounded by
â„¦X
iâˆˆElnT
âˆ†i,Sâˆ©B,min
+Âµâ‹†
KÂ·â„¦Kln(1/Î´T)
(âˆ†v
Sâ‹†)2
+X
iâˆˆE
Î¨â€²
i,Sâˆ©B+lnT
(âˆ†v
i,R)2+ Î¦i,Scâˆ©B
.
Proof. We divide the whole ground set into several paths. Meanwhile, we define four sets E1, . . . , E 4such that Eiâˆ©Ej=âˆ…
for any iÌ¸=j.P1=E1,PjâŠ‚Ejforj= 2,3,4. For any j >4, there exists kÌ¸= 1such that PjâŠ‚Ek. For any path Pj, if
PjâŠ‚E4,|Pj|=K2; otherwise, |Pj|=K1.Pjconsists of arms
jâˆ’1X
i=1|Pi|+ 1, . . . ,jâˆ’1X
i=1|Pi|+K1Â· 1{PjÌ¸âŠ‚E4}+K2Â· 1{PjâŠ‚E4}.
The feasible solution set AKconsists of all subsets of each path.
We let Bern( a)denote the Bernoulli distribution with parameter a(aâˆˆ(0,1)). Note that the variance of Bern( a)isa(1âˆ’a).
We construct an instance with Î½i= Bern( Âµi). With Îµ1, Îµ2>0, we set
Âµi= âˆ† âˆ€iâˆˆE1,
Âµi= âˆ†âˆ’Îµ1âˆ€iâˆˆE2,
Âµi= âˆ† + Îµ2âˆ€iâˆˆE3,
Âµi= âˆ†âˆ’Îµ3âˆ€iâˆˆE4.
We let 2â‰¤K1< K 2â‰¤K,âˆ†<1/2and
K1âˆ†(1âˆ’âˆ†)<Â¯Ïƒ2(paths in E1andE2are safe) ,
K1(âˆ† + Îµ2)(1âˆ’âˆ†âˆ’Îµ2)>Â¯Ïƒ2(paths in E3are unsafe) ,
K2(âˆ†âˆ’Îµ3)(1âˆ’âˆ† +Îµ3)>Â¯Ïƒ(paths in E4are unsafe) ,
K2(âˆ†âˆ’Îµ3)< K 1âˆ†(paths in E4are suboptimal) ,
(K1âˆ’1)Â·(âˆ† + Îµ2)< K 1Â·âˆ†â‡”(K1âˆ’1)Â·Îµ2<âˆ†â‡”Îµ2<âˆ†
K1âˆ’1(paths in E3are suboptimal or unsafe) .
The conditions above indicate that
51Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
â€¢P1is the unique optimal safe set;
â€¢ ifPjâŠ‚E2,Pjand its subsets are safe but suboptimal;
â€¢ ifPjâŠ‚E3,Pjis risky, and its proper subsets are suboptimal;
â€¢ ifPjâŠ‚E4,Pjand its subsets are suboptimal, and Pjis unsafe.
Let
p1:=1âˆ’p
1âˆ’Â¯Ïƒ2/K1
2andp2:=1âˆ’p
1âˆ’Â¯Ïƒ2/K2
2,
The relations between Âµiâ€™s are as in the following figure:
With a similar proof to that of Theorem C.4, we have, the accumulative regret from the optimal P1is lower bounded by
Reg[1]( T)â‰¥â„¦(K1âˆ†
(âˆ†v
P1)2ln1
Î´T);
the accumulative regret from a safe and suboptimal path in E2is lower bounded by
Reg[j](T)â‰¥â„¦ 
K1
âˆ†PjlnT+ âˆ†Â·min(
K1
âˆ†2
PjlnT,K1
(âˆ†v
Pj)2ln1
Î´T)!
;
the accumulative regret from a risky path in E3is lower bounded by
Reg[j](T)â‰¥â„¦ 
K1âˆ†
(âˆ†v
Pj)2lnT!
;
the accumulative regret from a unsafe and suboptimal path in E4is lower bounded by
Reg[j](T)â‰¥â„¦ 
min(
K2âˆ†
âˆ†2
PjlnT,K2âˆ†
(âˆ†v
Pj)2lnT)!
.
We let
ÏµÂµ= min
j{âˆ†Pj}, Ïµv= min
j{âˆ†v
Pj};
and set K1,K2,Îµ1,Îµ2,Îµ3such that
K1>3
4Â·K2, K 2=K, min
j{âˆ†Pj}<2ÏµÂµ,min
j{âˆ†v
Pj}<2Ïµv.
52Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
In conclusion , the regret yielded from these paths is lower bounded by
Reg(T)
1âˆ’Î´Tâ‰¥Reg[1]( T) +X
PjâˆˆE2Reg[j](T) +X
PjâˆˆE3Reg[j](T) +X
PjâˆˆE4Reg[j](T)
â‰¥â„¦Kâˆ†
(Ïµv)2ln1
Î´T
+|E2| Â·â„¦K
ÏµÂµlnT+ âˆ†Â·minK
(ÏµÂµ)2lnT,K
(Ïµv)2ln1
Î´T
+|E3| Â·â„¦Kâˆ†
(Ïµv)2lnT
+|E4| Â·â„¦
minKâˆ†
(ÏµÂµ)2lnT,Kâˆ†
(Ïµv)2lnT
.
Note that
â€¢Âµâ‹†=K1âˆ†.
â€¢ for Sâ‹†,Ïµv= âˆ†v
Sâ‹†.
â€¢ for Sâˆˆ S âˆ© B andiâˆˆS, we check that if SâŠ‚Pj, jâˆˆE2,âˆ†i,Sâˆ©B,min=ÏµÂµand
Î¨â€²
i,Sâˆ©Bâ‰¥minlnT
âˆ†2
S,9 ln(1 /Î´T)
(âˆ†v
S)2
.
where the equality holds when S=Pj, PjâˆˆE2.
â€¢ for Sâˆˆ R andiâˆˆS,Ïµv= âˆ†v
i,R.
â€¢Sâˆˆ Scâˆ© BandiâˆˆS, we can easily check S=Pjfor some PjâˆˆE4, thus âˆ†i,Scâˆ©B,min=ÏµÂµand
Î¦i,Scâˆ©B= minlnT
âˆ†2
S,9 lnT
(âˆ†v
S)2
.
Therefore,
Reg(T)â‰¥â„¦LlnT
âˆ†i,Sâˆ©B,min
+Âµâ‹†
KÂ·â„¦ 
KÂ·ln(1/Î´T)
(âˆ†Sâ‹†)2+X
iâˆˆEÎ¨â€²
i,Sâˆ©B+X
iâˆˆElnT
(âˆ†v
i,R)2+X
iâˆˆEÎ¦i,Scâˆ©B!
.
C.3. Problem-independent Lower bound
Theorem 5.2 (Problem-independent lower bound) .Let the minimum variance gap be âˆ†v:= min SâˆˆAKâˆ†v
S. When K3â‰¥L2,
we have
Reg(T) = â„¦âˆš
KLT + minnL
(âˆ†v)2ln1
Î´T
, To
.
Proof. Since the rewards of items are bounded in [0,1], the variance of each arm is at most 1/4. Therefore, when Â¯Ïƒ2âˆˆ
[K/4,âˆ), any solution in AKis safe and there exists a generic lower bound (Kveton et al., 2015). When Â¯Ïƒ2âˆˆ(0, K/4), let
Â¯a:=1 +p
1âˆ’Â¯Ïƒ2/K
2anda:=1âˆ’p
1âˆ’Â¯Ïƒ2/K
2.
We consider the instances containing items with Bernoulli reward distributions. We let Bern( a)denote the Bernoulli
distribution with mean a. An item iâˆˆ[L]with reward distribution Bern( Âµi)is with variance Âµi(1âˆ’Âµi), which is smaller
thanÂ¯Ïƒ2/Kif and only if Âµiâˆˆ(0, a)âˆª(Â¯a,1).
We will construct 3instances such that under instance k(0â‰¤kâ‰¤2), the stochastic reward of an item in path j(1â‰¤jâ‰¤L0)
is drawn from distribution Î½(k)
j= Bern( Âµ(k)
j), where Âµ(k)
jwill be specified in each case.
Under instance 0, with Âµ0< a, we let Âµ(0)
j=Âµ0for all j, i.e., the reward distribution of each item is Bern( Âµ0). Since
ÂµPj=KÂµ0andÏƒ2
Pj=KÂµ0(1âˆ’Âµ0)<Â¯Ïƒ2for all j, each path is an identical safe and optimal solution. Since all paths
53Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
are equivalent under instance 0, we have E0[Mj(t)] =T/L 0for all jâˆˆ1, . . . , L 0, where E0denote the expectation under
instance 0.
We next construct instance 1such that
Âµ(1)
1=Âµ1, Âµ(1)
j=Âµ0jÌ¸= 1,
where Âµ0< Âµ1< a.2Hence, P1is the unique optimal safe solution under instance 1while all other solutions are safe but
suboptimal.
With an analysis similar to that of Lemma 6.4 in Zhong et al. (2021), we can show that
Lemma C.5. Let the reward distribution of item ibeÎ½(j)
iunder instance j(j= 1,2), then
KL 
H(1)
T,H(2)
T
=LX
i=1E0[Ni(T)]Â·KL 
Î½(1)
i, Î½(2)
i
.
Hence, we have
KL 
H(0)
T,H(1)
T
=X
iâˆˆP1E0[Ni(T)]Â· 
Î½(0)
i, Î½(1)
i(a)
â‰¤KÂ·E0[M1(t)]Â·d(Âµ0, Âµ1) =KÂ·T
L0Â·d(Âµ0, Âµ1),
where (a)follows from the fact that at most Kitems are selected at one time step and the definition of instances.
Next, we apply Pinskerâ€™s Inequality to bound E1[M1(T)]. Lemma C.1 indicates that
|E0[M1(T)]âˆ’E1[M1(T)]| â‰¤r
1
2KL 
H(0)
T,H(1)
T
,
â‡’E1[M1(T)]âˆ’T
L0â‰¤r
KT
2L0Â·d(Âµ0, Âµ1).
Moreover, since the paths PjforjÌ¸= 1are identical under instance 1, we have
E1[Mj(T)] =1
L0âˆ’1 
Tâˆ’E1[M1(T)]
â‰¥1
L0âˆ’1 
Tâˆ’T
L0âˆ’r
KT
2L0Â·d(Âµ0, Âµ1)!
:=M.
To learn the regret incurred by P2under instance 1, we need to take the effects of the safety constraint into consideration.
Lemma C.3 indicates that
â€¢ifM< T(Î½0), at each of the first Mtime steps in S2(T), at most Kâˆ’1items are pulled and regret of at least
[K(Âµ1âˆ’Âµ2) +Âµ2]Â·Mis incurred, i.e.,
Reg[2] â‰¥[K(Âµ1âˆ’Âµ2) +Âµ2]Â·M.
â€¢ifMâ‰¥T(Î½0), at each of the first T(Î½0)time steps in S2(T), at most Kâˆ’1items are pulled and regret of at least
[K(Âµ1âˆ’Âµ2) +Âµ2]Â·T(Î½0)is incurred; besides, at the subsequent time steps in S2(T), regret of at least K(Âµ1âˆ’Âµ2)Â·
[Mâˆ’T(Î½0)]is incurred, i.e.,
Reg[2] â‰¥[K(Âµ1âˆ’Âµ2) +Âµ2]Â·T(Î½0) +K(Âµ1âˆ’Âµ2)Â·[Mâˆ’T(Î½0)] =K(Âµ1âˆ’Âµ2)Â·M+Âµ2Â·T(Î½0).
In short, we have
Reg[2] â‰¥K(Âµ1âˆ’Âµ2)Â·M+Âµ2Â·min{T(Î½0), M}.
We can lower bound Reg(j)for all j= 3, . . . , L 0with the same method.
2In this proof, Âµ1areÂµ2are redefined to minimize clutter; the previous definitions of them not used.
54Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
Besides, since
E1[M1(T)]â‰¥Tâˆ’r
KT
2L0Â·d(Âµ0, Âµ1)
and at most Kâˆ’1items are selected at each of the first T(Î½1)time steps in S1(T), we have
Reg[1] â‰¥Âµ1Â·min
T(Î½1), Tâˆ’r
KT
2L0Â·d(Âµ0, Âµ1)
.
Therefore, under instance 1, we have
Reg(T)
1âˆ’Î´â‰¥L0X
j=1Reg[j]
â‰¥Âµ1Â·min
T(Î½1), Tâˆ’r
KT
2L0Â·d(Âµ0, Âµ1)
+ (L0âˆ’1)Â·[K(Âµ1âˆ’Âµ2)Â·M+Âµ2Â·min{T(Î½0), M}]
=Âµ1Â·min
sup
Î½â€²
1âˆˆE(Î½1)1
Kâˆ’1Â·d(Î´,1âˆ’Î´)
KL(Î½1, Î½â€²
1), Tâˆ’r
KT
2L0Â·d(Âµ0, Âµ1)
+ (L0âˆ’1)Â·
K(Âµ1âˆ’Âµ2)Â·M+Âµ2Â·min
sup
Î½â€²
0âˆˆE(Î½0)1
Kâˆ’1Â·d(Î´,1âˆ’Î´)
KL(Î½0, Î½â€²
0), M
where
E(Î½0) ={Î½(0â€²) :the variance related to Î½(0â€²)is larger than Â¯Ïƒ2/K},
E(Î½1) ={Î½(1â€²) :the variance related to Î½(1â€²)is larger than Â¯Ïƒ2/K},
M=1
L0âˆ’1 
Tâˆ’T
L0âˆ’r
KT
2L0Â·d(Âµ0, Âµ1)!
.
By Pinskerâ€™s inequality (see Lemma C.1), for Âµiâ‰¥1/2,
d(Âµi,Â¯a)â‰¤(Âµiâˆ’Â¯a)2Â·(1âˆ’Âµiâˆ’Â¯a)2
a(1âˆ’Âµiâˆ’Â¯a)2=[Âµi(1âˆ’Âµi)âˆ’Â¯Ïƒ2/K]2
a(1âˆ’Âµiâˆ’Â¯a)2â‰¤[Âµi(1âˆ’Âµi)âˆ’Â¯Ïƒ2/K]2
a(Â¯aâˆ’1/2)2=[Âµi(1âˆ’Âµi)âˆ’Â¯Ïƒ2/K]2
a(1/2âˆ’a)2;
forÂµi<1/2,
d(Âµi, a)â‰¤(Âµiâˆ’a)2Â·(1âˆ’Âµiâˆ’a)2
a(1âˆ’Âµiâˆ’a)2=[Âµi(1âˆ’Âµi)âˆ’Â¯Ïƒ2/K]2
a(1âˆ’Âµiâˆ’a)2â‰¤[Âµi(1âˆ’Âµi)âˆ’Â¯Ïƒ2/K]2
a(1/2âˆ’a)2.
Since Î½0= Bern( Âµ0),Î½1= Bern( Âµ1), and 0< Âµ0< Âµ1< a<1/2, we have
sup
Î½â€²
0âˆˆE(Î½0)1
Kâˆ’1Â·d(Î´,1âˆ’Î´)
KL(Î½0, Î½â€²
0)=d(Î´,1âˆ’Î´)
Kâˆ’1Â·(1/2âˆ’a)2
[Âµ0(0âˆ’Âµ0)âˆ’Â¯Ïƒ2/K]2,
sup
Î½â€²
1âˆˆE(Î½1)1
Kâˆ’1Â·d(Î´,1âˆ’Î´)
KL(Î½1, Î½â€²
1)=d(Î´,1âˆ’Î´)
Kâˆ’1Â·(1/2âˆ’a)2
[Âµ1(1âˆ’Âµ1)âˆ’Â¯Ïƒ2/K]2.
We define the minimum variance gap âˆ†v:= min SâˆˆAâˆ†v
S. When K3â‰¤L2andLK/T â‰¤a2, we can let Âµ1âˆ’Âµ2=p
L/KT . Then we have
Reg(T) = â„¦
min1
Kâˆ’1Â·d(Î´,1âˆ’Î´)
(âˆ†v/K)2, T
+âˆš
KLT +L0Â·min1
Kâˆ’1Â·d(Î´,1âˆ’Î´)
(âˆ†v/K)2,TK
L
= â„¦
min
KÂ·d(Î´,1âˆ’Î´)
(âˆ†v/)2, T
+âˆš
KLT +LÂ·mind(Î´,1âˆ’Î´)
(âˆ†v)2,T
L
= â„¦âˆš
KLT + min
LÂ·d(Î´,1âˆ’Î´)
(âˆ†v)2, T
.
Moreover, we complete the proof with d(Î´,1âˆ’Î´)â‰¥ âˆ’ln(2.4Î´)andÎ´T=Î´.
55Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
D. Tightness of the Upper bound
Corollary D.1 (Tightness of problem-dependent bounds) .Let{Î´T}âˆ
T=1âˆˆo(1)be a sequence that satisfies ln(1/Î´T) =
o(Tb)for all b >0,
â€¢ ifln(1/Î´T)âˆˆo(lnT), in particular, if Î´T=Î´0>0for all T, the regret Reg(T)is
â„¦ X
iâˆˆElnT
âˆ†i,Sâˆ©B,min+Âµâ‹†lnT/K
(âˆ†v
i,R)2+Âµâ‹†
KÎ¦i,Scâˆ©B!
âˆ©O X
iâˆˆEKlnT
âˆ†i,Sâˆ©B,min+Âµâ‹†KlnT
(âˆ†v
i,R)2+Âµâ‹†KÎ¦i,Scâˆ©B!
â€¢ ifln(1/Î´T) =Î»lnT, i.e., Î´T=Tâˆ’Î»with a fixed Î» >0, the regret Reg(T)is
â„¦ X
iâˆˆElnT
âˆ†i,Sâˆ©B,min+Î»Âµâ‹†lnT
(âˆ†v
Sâ‹†)2+Âµâ‹†
KX
iâˆˆE
Î¨â€²
i,Sâˆ©B+lnT
(âˆ†v
i,R)2+ Î¦i,Scâˆ©B!
âˆ©O X
iâˆˆEKlnT
âˆ†i,Sâˆ©B,min+Î»Âµâ‹†K2lnT
(âˆ†v
Sâ‹†)2+KÂµâ‹†X
iâˆˆE
Î¨i,Sâˆ©B+lnT
(âˆ†v
i,R)2+ Î¦i,Scâˆ©B!
where ln(1/Î´T)in the Î¨andÎ¨â€²functions should be replaced by Î»lnT.
â€¢ ifln(1/Î´T)âˆˆÏ‰(lnT), the regret Reg(T)is
Reg(T)âˆˆâ„¦Âµâ‹†ln(1/Î´T)
(âˆ†v
Sâ‹†)2
âˆ©OÂµâ‹†K2ln(1/Î´T)
(âˆ†v
Sâ‹†)2
The upper bounds above are achieved by PASC OMB UCB .
E. Additional Discussions and Future Research
E.1. Discussions on the Tightness Results
In terms of the problem-dependent bounds in Corollary 4.4, we consider general instances where the rewards from the items
are independent and the gap in Reg1(T)can be closed when that the rewards from the items are correlated, as in the lower
bound for the unconstrained combinatorial bandits in Kveton et al. (2015). This assumption also allows us to remove a
factor of Kfrom the gap of Reg2(T).
In terms of the problem-independent bounds in Corollary 5.4, the regret due to suboptimality is almost tight as in the
unconstrained case (Kveton et al., 2015). The regret due to safeness checking is tight up to a factor of K2. During each
phase, PASC OMB UCB selects and samples solutions which are disjoint subsets of Ap, and hence one item is sampled at
most once during one phase. However, it is empirically feasible to sample some items more than once during one phase,
which will help reduce the regret but requires more delicate analysis.
For future directions, it is of interest to close the gap (the factor K) in the regret due to safeness checking with improved
analyses or additional assumptions on the instance.
E.2. Discussions on the Problem Formulation
Anytime safety is important in safety-critical applications where at each point in time the risk cannot exceed a certain threshold.
For example, in a self-driving car that is scheduled to move from start point x0to end point xnvia(x1, x2, . . . , x nâˆ’1)(the
choice of these waypoints is a combinatorial problem), it is necessary that the car stay in its designated lane at all points in
time, and not just â€œon averageâ€, otherwise a catastrophic accident might result at some point in time with non-negligible
probability. In this example, we might want to choose a route that is safe at all times w.h.p. (in the sense that the car stays in
its designated lane) at the cost of a longer travel time.
This work studies the anytime-safe constraint at the super-arm3level and provides a first step to understanding risk in
combinatorial semi-bandits. The sumP
iâˆˆAÏƒ2
iof a set of items (base arms) in Ais adopted as the risk measure, which is a
3In this discussion, the terms â€œsuper armâ€ and â€œbase armâ€ refer to â€œsolutionâ€ and â€itemâ€ respectively.
56Probably Anytime-Safe Stochastic Combinatorial Semi-Bandits
certain function of Ïƒ2
i, iâˆˆA. It is also of interest to study the anytime safety at the base arm level , where the risk function
ismax iâˆˆAÏƒ2
i. From a technical point of view, if the safeness of any single base arm has not been ascertained (as we need
to learn the safeness/risk of the base arms), then pulling any base arm can be risky, in the sense that with non-vanishing
probability, the anytime-safe constraint (or even the less stringent stagewise safety constraint (Khezeli & Bitar, 2020)) is
violated when we do the exploration (by pulling any base arm) at the beginning . Thus, this seems infeasible from a technical
standpoint. Nevertheless, we believe additional proper assumptions can be made to formulate a practical and feasible model
that leads to future researches.
E.3. Comparisons
Comparison with Wu et al. (2016); Kazerouni et al. (2017): While the conservative (linear) constraint
Pï£®
ï£°\
tâ‰¥1(tX
k=1âŸ¨Xk, Î¸âˆ—âŸ© â‰¥(1âˆ’Î±)tb0)ï£¹
ï£»â‰¥1âˆ’Î´
requires the constraint should be satisfied w.p. 1âˆ’Î´over the whole horizon, which is similar to our probably anytime-safe
constraint, the constraint is in terms of the cumulative expected reward (up to time step t). The cumulative nature of the
conservative constraint maintains a â€œbudget reservoirâ€ that makes this constraint less stringent than the stagewise safety
constraint (Khezeli & Bitar, 2020), in the sense that one algorithm may satisfy the conservative constraint but violate the
stagewise safety constraint. Both the stagewise safety constraint and the probably anytime-safe constraint consider the
reward/risk that is incurred at each single time step.
Comparison with Khezeli & Bitar (2020); Moradipari et al. (2020): To the best of our knowledge, the stagewise safety
(or the stagewise conservative) constraint (Khezeli & Bitar, 2020; Moradipari et al., 2020) is the most related risk-aware
constraint to our anytime-safe constraint.
(1) The stagewise conservative constraint is a constraint on the mean reward (hence, only one statistics is involved in
the problem), which originates from the conservative constraint (Wu et al., 2016). In our setup, we post the anytime-safe
constraint on the risk while minimizing the regret, which requires us to consider two statistics and the interaction between
them .
(2) The stagewise safety constraint has only been utilized under the linear bandit setup in the literature, where the arm set
is assumed to be a convex and compact set inRn(Moradipari et al., 2020), and thus, the arms constitute an uncountable
continuous set. If an arm Ais known to be safe, then it is safe to pull any arm â€œnearâ€ A. However, in the combinatorial
bandit setup, such a continuity property of the arm set does not hold since it is â€œdiscreteâ€. Specifically, given that super arm
Ais safe (but not absolutely safe), even the safeness of a nearby arm ËœA, which is obtained by replacing one single base arm
inAwith another base arm, cannot be guaranteed by the safeness of A.
(3) In terms of the safety level, consider the stagewise safety constraint with a constant confidence parameter Î´(independent
ofT); intuitively, the safety constraint can be violated approximately Î´Ttimes, which is linear inT. In addition, consider
an algorithm which does safeness checking first, followed by exploration-and-exploitation on the safe super arms, it takes
Î˜(1
(âˆ†v
A)2ln1
Î´)pulls to identify the unsafeness of an unsafe super arm A. Note that the time required is independent of T,
so the regret due to safeness checking is o(Ta)for all a >0. From this perspective, the stagewise safety constraint is not
stringent enough and can be easily satisfied by such a naive algorithm. A more direct intuition (yet not completely rigorous)
is, if the algorithm ignores the stagewise safety constraint, it only takes o(Ta)for all a >0to rule out the unsafe super
arms, which indicates it satisfies the stagewise safety constraint (since the unsafe super arms are pulled o(Ta)< Î´T times).
From another point of view, given a confidence parameter Î´, if the stagewise safety constraint is satisfied w.p. 1âˆ’Î´tat time
steptwithPT
t=1Î´t=Î´, then the probably anytime-safe constraint is met w.p. 1âˆ’Î´.
(4) Besides the constant confidence parameter Î´, we have investigated the whole spectrum ofÎ´in terms of the time horizon
T. The tightness result (Corollary D.1) indicates our algorithm is capable of dealing with an even stricter constraint (in the
sense that Î´decreases with respect to T) and we provide a sharp threshold on the achievability of o(Ta)(for all a >0)
regret (see Theorem 4.5).
57