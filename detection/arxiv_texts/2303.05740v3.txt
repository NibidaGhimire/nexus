1
A Novel Bilateral Energy Trading Mechanism for
Electricity Markets with Numerous Prosumers
Bing Liu, Furan Xie and Li Chai*
Abstract —With the rapid development of distributed energy
resources, increasing number of residential and commercial users
have been switched from pure electricity consumers to prosumers
that can both consume and produce energy. To properly manage
these emerging prosumers, a peer-to-peer (P2P) electricity market
has been explored and extensively studied. In this paper, a
scalable energy management mechanism is proposed for the P2P
electricity market. First, the multi-bilateral economic dispatch
problem that maximizes social welfare is formulated, taking
into account product differentiation and network constraints.
Then, an energy management mechanism is devised to improve
the scalability from two aspects: (i) an accelerated distributed
clearing algorithm with less exchanged information and faster
convergence rate. (ii) a novel selection strategy to reduce the
amount of computation and communication per player. Finally,
the convergence rate of the proposed accelerated algorithm is
given, and the proposed selection strategy is illustrated through
a Monte Carlo simulation experiment.
Index Terms —Energy management, Electricity market, Pro-
sumer, Scalability, Distributed optimization.
I. I NTRODUCTION
IN the past, electricity generation has always relied on
fossil fuels, contributing about one-third of annual carbon
emissions [1]. With aggravation of global warming, more
and more countries have set up “carbon peak” and “carbon
neutral” action goals to gradually reduce carbon emissions. To
achieve the stated action goals, new energy sources, mainly
solar energy and wind energy, have received unprecedented
attention and rapid development. So in recent years, more and
more residential and commercial users have been equipped
with photovoltaic panels, wind turbines, and distributed en-
ergy resources, becoming the so-called prosumers that both
consume and produce electricity. These emerging prosumers
are geographically decentralized and more willing to actively
participate in the electricity market for additional revenue [2].
To properly manage these prosumers, a so-called peer-to-
peer (P2P) electricity market has been proposed and received
widespread attentions [3]. In such an electricity market, each
player can directly trade energy with other players at mutually
satisfactory prices. There are three main energy trading strate-
gies: game theory, double auction, and optimization-based
This work is supported by National Natural Science Foundation of China
under grant number 62173259.
Bing Liu and Furan Xie are with the Engineering Research Center of Metal-
lurgical Automation and Measurement Technology, Wuhan University of Sci-
ence and Technology, Wuhan 430081, China (e-mail: liubing17@wust.edu.cn;
xiefuran328@wust.edu.cn).
Li Chai is with the College of Control Science and Engineering, Zhejiang
University, Hangzhou 310027, China (e-mail: chaili@zju.edu.cn).
*Corresponding Author.theory [4]. Game theory analyzes the decision-making process
of market players in which each player’s action depends on
and influences other players’ actions [5]. In the double auction,
buyers and sellers submit offers and bids to the auctioneer, and
the auctioneer facilitates market transactions by coordinating
the prices of both step by step [6]. However, neither game
theory nor double auction can guarantee optimal energy allo-
cation. In contrast, due to optimality, robustness, scalability,
and security concerns, an increasing number of research has
focused on distributed optimization-based methods to solve
the energy trading problem [7]–[9].
In the above work, electricity is regarded as a homogenized
good and priced under uniform pricing in the forward mar-
ket. However, in practice, consumers should be allowed to
express their preferences on the type and quality of electricity,
which may result in product differentiation and further price
differentiation [10]. In [10], a multi-bilateral energy trading
framework that allows product differentiation is proposed for
the P2P electricity market. The optimal solution of the multi-
bilateral energy trading problem with product differentiation
is analyzed in [11]. Product differentiation is further enriched
and developed in [12], in which the energy is classified to
meet individual preferences based on attributes of its source,
such as generation technology, location in the network and
the owner’s reputation. In addition, product differentiation can
also be used to implement consumer-related costs, such as
taxes and network usage fees [13], [14].
On the other hand, in the P2P electricity market, since
each player trades directly with other players, the number of
transactions and optimization variables increases exponentially
with the number of market players. This will vastly increase
the computation and communication burdens for each player,
presenting serious challenges to the scalability of the market.
At present, the scalability can be improved by either reducing
the exchanged information between players or the number of
trading partners per player. The former can reduce the amount
of communication while the latter can reduce both the amount
of communication and computation. For example, in the P2P
energy trading scheme proposed in [15], only price or energy
information is transmitted between producers and consumers,
which reduces the exchanged information by half compared
to the RCI approach in [10]. In [16], the concept of node
coloring is presented to improve scalability, in which each
player only trades with players of the same color. In [17],
an additional adaptive segmentation procedure is proposed in
which all players are grouped into different segments such that
each player only trades with players within the same segment.
It also enhances the scalability by reducing the number ofarXiv:2303.05740v3  [cs.DC]  14 Sep 20232
trading partners per player. However, this approach of reducing
trading partners may cause the loss of social welfare due to
artificially limiting possible transactions. In addition, the adap-
tive segmentation method in [17] requires to additionally slove
a strongly NP-hard problem. In this paper, besides reducing the
exchanged information, the scalability is enhanced by directly
improving the convergence rate of the clearing algorithm. In
addition, a simple selection strategy is presented to choose
efficient trading partners for each consumer, which can further
improve the scalability while keep the optimal social welfare
as much as possible. In summary, the main contributions of
this paper are as follows:
1) A distributed clearing algorithm is proposed to solve
the multi-bilateral economic dispatch problem with prod-
uct differentiation. Compared with other methods, the
proposed algorithm has less exchanged information and
faster convergence rate.
2) A novel selection strategy based on consumer preferences
is presented, which can reduce the number of inefficient
trading partners for consumers and thus reduce the com-
putational and communication burdens per player.
3) A detailed theoretical analysis of the convergence rate of
the proposed clearing algorithm is given, and the effec-
tiveness of the proposed selection strategy is illustrated
by a Monte Carlo simulation experiment.
The rest of this paper is structured as follows. Section
II formulates a multi-bilateral economic dispatch problem
for maximizing the social welfare. Section III proposes a
scalable energy trading mechanism. Section IV gives the main
theoretical results. Section V conducts numerical simulations.
Section VI gathers conclusions of the paper.
II. P ROBLEM FORMULATION
In the P2P electricity market, prosumers can trade directly
with other prosumers to sell or buy energy. The role of a
prosumer, producer or consumer, depends on its net power
within a single time slot. Our focus is on the problem of
maximizing the welfare of all producers and consumers.
Consider a P2P electricity market with nprosumers. The
communication network among prosumers is represented by
an undirected graph G= (N,E), where Nis the set of
prosumers and E ⊆ N × N is the set of communication
edges. The producers set and the consumers set are defined
asNP={1,2, ..., n p}andNC={1,2, ..., n c}, satisfying
NPSNC=N,NPTNC=∅andnp+nc=n. LetNi
andNjbe the sets of neighbors of producer iand consumer
jwith capacity NiandNj, respectively. A radial distribution
network for transmitting energy is composed of a set of buses
NB={0,1, . . . , n }and a set of distribution lines NL. The
root of the radial network (bus 0) is considered as the slack
bus. Except for bus 0, each bus corresponds to one prosumer.
In addition, all vectors are regarded as column vectors.
A. Welfare Function of Producers
The generation cost of producer iis associated with its
total generation. Define the sold energy of producer ito
consumer jasxij, then the total generation of producer iisxi=P
j∈Nixij. Then, the cost function of producer ican
be represented as [9], [10]
Ci(xi) =1
2aix2
i+bixi+ci,
with xmin
i≤xi≤xmax
i,∀i∈ NP,(1)
where ai,bi, and ciare positive cost coefficients of producer i.
xmin
iandxmax
i are the minimum and maximum generation of
producer i, respectively. Note that for new energy producers,
since its generation is a fixed value in a particular time slot, the
constraint in (1) can be remodelled by setting xmin
i equal to
xmax
i. Generally speaking, it is reasonable to model classical
producers’ cost function as a quadratic form, while that of
new energy producers is currently unclear. However, since its
generation is a fixed value, the generation cost of new energy
producers is a constant in a single time slot, which will not
affect the optimal energy allocation. For the sake of brevity,
the cost function of producers are uniformly modeled as a
quadratic form.
The welfare function of producer iis composed of the
generation cost and the trading profit. Suppose the trading
price between producer iand consumer jisλij. Then, the
welfare function of producer iis obtained
WPi=X
j∈Niλijxij−Ci(xi) =λT
ixi−Ci(xi),
with xmin
i≤xi≤xmax
i,∀i∈ NP,(2)
where λi= (λij)j∈Niandxi= (xij)j∈Niare column vectors
containing the trading price and energy of producer iwith its
neighbors, respectively.
B. Welfare Function of Consumers
For each consumer j∈ N C, consuming a certain amount
of energy will get corresponding convenience and satisfaction.
This kind of welfare obtained through consumption can be
expressed by the utility function in microeconomics [18].
Define the energy purchased by consumer jfrom producer
iasyji, and the total energy purchased by consumer jis
yj=P
i∈Njyji. Then, the utility function with linearly
decreasing marginal benefit can be formulated as [19]
Uj(yj) =(
ωjyj−δj
2y2
j,0≤yj≤ωj
δj,
ω2
j
2δj, y j≥ωj
δj,
with ymin
j≤yj≤ymax
j,∀j∈ NC,(3)
where ωjrepresents the value of electricity for consumer
j.δjis a predefined parameter. ymin
j andymax
j are the
minimum and maximum demand of consumer j, respectively.
In particular, the utility function (3) is modeled for consumers
with flexible loads, such as smart appliances and plug-in
electric vehicles, etc. For consumers with inflexible loads, the
utility function (3)is still applicable by setting ymin
jandymax
j
equal to each other. In addition to the above quadratic form,
any function with the property of diminishing marginal benefit
can be used to quantify the welfare that consumers receive
from consumption.
In the P2P market, the welfare of consumer jis not only
composed of utility function and purchase cost, but also3
includes the additional welfare gained from product differenti-
ation [10]. To implement it, a transaction coefficient denoted as
αjiis introduced and imposed on the trade between consumer
jand producer i, and its detailed explanation is given later.
Then, the welfare function of consumer jis represented as
WC j=Uj(yj)−X
i∈Njλijyji+X
i∈Njαjiyji
=Uj(yj) + (αj−λj)Tyj,
with ymin
j≤yj≤ymax
j,∀j∈ NC,(4)
where αj= (αji)i∈Nj, λj= (λij)i∈Njandyj= (yji)i∈Nj.
Note that in (4), a linear function with constant marginal
benefit (i.e., αjiyji) is used to calculate the additional wel-
fare brought by product differentiation [5], [10]–[14], [20].
This is because the additional welfare arising from product
differentiation generally have either constant marginal benefit
or diminishing marginal benefit.
In the following, the composition of the transaction coef-
ficients is explained, followed by two examples. In the P2P
trading market, all transactions can be described by a set of
criteria S. The criterion can be the type of generation, the
level of emission, the level of reliability, the location or rating
of the producer, etc. Based on these criteria, the transaction
coefficient αji, used to reflect product differentiation, can be
composed of two parts: criterion values and trade charac-
teristics . Specifically, under criterion s∈ S, the preference
degree or relevant cost of consumer jis characterized by
the parameter rs
j(called the criterion value ), and consumer
j’s objective evaluation of the trade with producer iunder
criterion sis expressed by parameter ds
ji(called the trade
characteristic ). Then, the transaction coefficient αjibetween
consumer jand producer ican be calculated as
αji=X
s∈Srs
jds
ji. (5)
For instance, if the transaction coefficient is for the purpose
of increasing local consumption, the ‘distance’ can be used
as a single criterion. Then, the criterion value is the prefer-
ence degree of consumer jfor local consumption with unit
$·kWh−1·km−1, and the trade characteristic djiis the
Euclidean distance between consumer jand producer iwith
unit km [10]. If the transaction coefficient is used to implement
network fees for electricity network owners, the criterion value
is the network usage charge per unit electrical distance, and
thetrade characteristic djiis the electrical distance between
consumer jand producer i[13], [14].
C. Network Constraints
Since the energy transfers of P2P transactions are insepa-
rable from the distribution network, the network constraints,
including voltage and line flow constraints, should be consid-
ered to prevent overvoltage and congestion. In this paper, the
voltage changes and line flows are calculated by using the
voltage sensitivity coefficient and the power transfer distribu-tion factor proposed in [21], respectively. The corresponding
voltage and line flow constraints are formulated as follows
Vmin
i≤Vi≤Vmax
i,∀i∈ NB, (6)
−Fmax
ℓ≤Fℓ≤Fmax
ℓ,∀ℓ∈ NL, (7)
where Vmin
i andVmax
i are the lowest and highest voltage
magnitudes, respectively. Fmax
ℓ is the maximum capacity
allowed for line ℓ.
D. Optimization Problem
The problem of maximizing social welfare is widely con-
sidered [10], [11], [14], [15], [20], where the social welfare
consists of the welfare of all producers and consumers. Based
on the welfare functions (2) and (4) and network constraints
(6) and (7), the problem of maximizing social welfare is
formulated as
max
x,yX
j∈NCUj(yj)−X
i∈NPCi(xi) +X
j∈NCX
i∈Njαjiyji,(8a)
s.t.xij=yji,∀i∈ NP,∀j∈ Ni, (8b)
xij≥0,∀i∈ NP,∀j∈ Ni, (8c)
yji≥0,∀j∈ NC,∀i∈ Nj, (8d)
xmin
i≤xi=X
j∈Nixij≤xmax
i,∀i∈ NP,(8e)
ymin
j≤yj=X
i∈Njyji≤ymax
j,∀j∈ NC,(8f)
Vmin
b≤Vb≤Vmax
b,∀b∈ NB, (8g)
−Fmax
ℓ≤Fℓ≤Fmax
ℓ,∀ℓ∈ NL, (8h)
where x= (xT
1,xT
2, ...,xT
np)Tandy= (yT
1,yT
2, ...,yT
nc)T
denote all transactions in the market.
III. M ARKET TRADING MECHANISM
To solve the multi-bilateral economic dispatch problem (8),
an accelerated distributed clearing algorithm and a selection
strategy are proposed, which constitute our scalable energy
trading mechanism.
A. Problem Decoupling
Before solving problem (13), the coupling constraint (8b)
is dealt with first. Let λijdenote the Lagrange multiplier to
decouple (8b). Then, the Lagrange function associated to (8)
denoted by L(·)is
L(x,y, λ) =X
j∈NCUj(yj)−X
i∈NPCi(xi)
+X
j∈NCX
i∈Njαjiyji+X
i∈NPX
j∈Niλij(xij−yji),(9)
where λ= (λT
1, λT
2, ..., λT
np)Tis a column vector composed
of all Lagrange multipliers λij. According to the Lagrange
function (9), the dual function q(λ)is established as
q(λ) = max
x,yL(x,y, λ)
=X
i∈NP−Ci(xi) +λT
ixi| {z }
qi(λi)+X
j∈NCUj(yj) + (αj−λj)Tyj| {z }
qj(λj),
(10)4
where each component of xandyis bounded by local con-
straints, i.e., 1Txi∈[xmin
i, xmax
i]and1Tyj∈[ymin
j, ymax
j].
Then, the dual problem is as follows
min
λq(λ). (11)
Note that the dual problem has the same optimal solution
as the original problem due to the strong duality, which can
be proved using Proposition 5.2.1 in [22].
B. Accelerated Market Clearing Algorithm
To solve the dual problem (11), a distributed algorithm
based on Nesterov’s accelerated gradient is proposed, which
is shown in Algorithm 1.
Algorithm 1 Accelerated Market Clearing Algorithm
Initialization:
1:Fori∈ NP, sets γ1= 1 andˆλ1
ij=λ0
ij,∀j∈ Ni.
2:Forj∈ NC, receives ˆλ1
ijfrom all i∈ Nj.
Iteration ( k≥1):
3:Update xk
ijfori∈ NPand update yk
jiforj∈ NC,
xk
ij= arg max
xij≥0n
−Ci(xi) +ˆλk
ijxijo
,∀j∈ Ni,
s.t.(8e),(8g),and(8h).(12)
yk
ji= arg max
yji≥0n
Uj(yj) + 
αji−ˆλk
ij
yjio
,∀i∈ Nj,
s.t.(8f)and(8g).
(13)
4:Receive yk
jifrom j∈ Nifori∈ NP.
5:Update λk
ijfori∈ NP,
λk
ij=ˆλk
ij−ηij 
xk
ij−yk
ji
,∀j∈ Ni. (14)
6:Update γk+1=(k+1) 
1+r
1+4
γk
k2!
2andˆλk+1
ij fori∈
NP, j∈ Ni,
ˆλk+1
ij=λk
ij+(k+ 1)( γk−k)
kγk+1 
λk
ij−λk−1
ij
.(15)
7:Receive ˆλk+1
ijfrom i∈ Njforj∈ NC.
InInitialization , each producer i∈ N Pdetermines ini-
tial trading price λ0
ijwith neighboring consumers and sets
ˆλ1
ij=λ0
ij, γ1= 1. Each consumer j∈ N Creceives ˆλ1
ij
from neighboring producers. In Iteration , each producer and
consumer update the generation xk
ijand demand yk
jiwith (12)
and (13) to maximize their own welfare, respectively. Sub-
problems (12) and (13) can be solved by using the Lagrange
relaxation method in [23]. The consumer’s updated demand
yk
jiis then sent to the corresponding producer. Based on the
updated demand and generation, each producer updates the
price λk
ijto promote the social welfare according to (14) with
step-size ηijin Step 5. Through the last term of (14), the
energy consensus (i.e., xij=yji) is guaranteed. Then, the
producer updates the parameter γkand the acceleration term
ˆλk
ijusing (15) in Step 6. Note that ˆλijis an interpolated pointofλij, which plays an acceleration role in the algorithm. Fi-
nally, the producer feeds back the latest price information ˆλk+1
ij
to the corresponding consumer. All the steps in Algorithm 1
can be implemented in a distributed manner without seeding
any private information, such as ai,bi,ci,ωjandδj. When
the iteration triggers the stopping criteria, the algorithm stops
running. The stopping criteria are set as follows
|xk
ij−yk
ji| ≤ϵ,∀i∈ NP, j∈ Ni, (16)
where ϵis extremely small positive numbers.
Unlike [10], our proposed algorithm does not need to
consider the price consensus, since producer iand consumer
jupdate xk
ijandyk
jiwith the same price information ˆλk
ij. In
this way, producers only need to send price information while
consumers only need to send energy information, which re-
duces the exchanged information between players. In addition,
compared with the primal-dual gradient method used in [15],
our algorithm adds Steps 5 and 6, and replaces λijwith ˆλijin
Steps 3 and 7, which can improve the convergence rate. This
fact will be verified in Theorem 1 and Corollary 1 of Section
IV , and explained in Remark 2.
C. Selection Strategy
It can be seen from Algorithm 1 that the amount of compu-
tation and communication for each player largely depends on
the number of neighbors (i.e., the number of trading partners).
As a consequence, reducing the number of trading partners
can reduce the amount of computation and communication.
However, this may lose some social welfare due to artificially
limiting possible transactions. In fact, there is a trade-off
between the number of trading partners and optimal social
welfare [17]. Our goal is to develop a simple selection strategy
that reduces the number of trading partners per player, while
keeping the optimal social welfare as much as possible.
Our selection strategy is based on a basic microeconomics
principle: in maximizing social welfare, an allocation is inef-
fective if a good is not consumed by the buyers who value
it most highly [24, Chapter 7]. Thus, if these ineffective
transactions can be blocked before executing the clearing
algorithm, we can achieve our goal. One feasible strategy
is that each consumer selects its preferred producers from
neighbors and only choose them as its trading partners. In
this way, not only the number of trading partners per player
is reduced, but also each producer’s energy can be allocated
to the consumers who prefer it (i.e., efficient transactions in
the market is preserved).
The key for the selection strategy is to find the preferred
producers for each consumer. In problem (8), the transaction
coefficient αjifor product differentiation essentially reflects
the preference of consumer jto producer i. Hence, based
on each consumer’s transaction coefficients for neighboring
producers, the following selection strategy is proposed with
only two simple steps
Step 1: Each consumer j∈ N Cnormalizes transaction
coefficients αjifor each neighboring producers i∈
Njto [-1,1] and sets 0 as the preferred benchmark.5
Step 2: Each consumer j∈ N Conly chooses neighboring
producers whose normalized transaction coefficient
is greater than or equal to 0 as its trading partners.
In Step 1, the purpose of normalization is to explicitly reflect
each consumer’s preferred producers relatively. Then in Step
2 consumers choose these preferred producers as their trading
partners instead of all neighboring producers. On one hand,
this reduces the number of trading partners per player and
thus reduces the amount of computation and communication
per player. On the other hand, choosing the preferred producer
preserves efficient transactions in the market and thus keeps
the optimal social welfare as much as possible, which is
illustrated in Section V-C.
Remark 1: The selection strategy is executed before the
clearing algorithm starts. So it can be extendable to any
clearing methods for P2P electricity markets. In addition, it
neither has any computation burden nor brings any privacy
issues since the transaction coefficients αji, i∈ N jare the
local information of consumer j.
IV. C ONVERGENCE ANALYSIS
This section analyzes the convergence rates of Algorithm 1
and the algorithm in [15]. We first give the result of Algorithm
1 in Theorem 1.
Theorem 1: Let the sequence λk
ijbe generated by Algorithm
1 and the step-size is set to ηij∈(0,1/Lij], where Lij=
σi+σj
σiσjandσi,σjare the strong concave constants of the cost
and utility function of producer iand consumer j, respectively.
Then, for any k≥1
q(λk)−q(λ∗)≤X
i∈NPX
j∈Ni2 
λ0
ij−λ∗
ij2
ηijk2, (17)
where λ∗is the optimal solution of the dual problem (11).
Proof: The IEEEproof can be found in Appendix A.
Theorem 1 shows that the dual sequence of Algorithm 1
converges to the optimal value with the rate of O(1/k2). In
the following, the convergence result is given for our proposed
algorithm without acceleration term, which is consistent with
the primal-dual gradient method in [15].
Corollary 1: The acceleration terms in Algorithm 1 are not
considered, i.e., Steps 5 and 6 are ignored, and ˆλk
ijin Steps 3
and 7 are replaced by λk
ij. Let ηij∈(0,1/Lij], where Lijis
the same as in Theorem 1. Then, for any k≥1
q(λk)−q(λ∗)≤X
i∈NPX
j∈Ni 
λ0
ij−λ∗
ij2
2ηijk. (18)
Proof: The IEEEproof can be found in Appendix B.
Remark 2: From Theorem 1 and Corollary 1, it can be con-
cluded that our proposed algorithm has a faster convergence
rate in the sense that the acceleration term ˆλijin Algorithm
1 can indeed improve the convergence rate.
V. N UMERICAL SIMULATIONS
In this section, we first demonstrate the feasibility of our
proposed clearing algorithm in IEEE 15-bus system. Then, we
illustrate the effectiveness of the selection strategy through aMonte Carlo simulation experiment. Finally, we validate the
scalability of our proposed mechanism compared with other
state-of-the-art methods in a large-scale market.
A. Simulation Setup
The setup considers a standard IEEE 15-bus system with 14
prosumers (including 7 producers and 7 consumers), where
producers are located at buses 1, 3, 4, 5, 9, 10, 11 and
consumers are positioned in buses 2, 6, 7, 8, 12, 13, 14 in
sequence. The bus 0 is the slack bus. All bus voltages are
initialized to 1 p.u., limited to [0.9,1.1]. The maximum flow
of lines is 60kW. The producers and consumers parameters
are taken from [7]. The transaction coefficients between con-
sumers and producers are randomly generated from [0,1). In
addition, the step-size is set to ηij= 0.1, i∈ NP, j∈ Niand
the stopping criteria are set to 0.001.
TABLE I
ENERGY TRADED BETWEEN CONSUMERS AND PRODUCERS ,UNIT K WH
Pro.1 Pro.2 Pro.3 Pro.4 Pro.5 Pro.6 Pro.7 Sum
Con.1 0.00 26.28 3.44 0.00 0.00 5.43 0.00 35.15
Con.2 9.82 16.84 0.00 0.00 0.00 0.00 0.00 26.66
Con.3 0.00 0.00 0.00 0.00 15.85 14.41 20.56 50.82
Con.4 4.69 0.00 1.98 0.00 0.00 0.00 23.33 30.00
Con.5 5.85 0.00 0.00 25.47 10.60 19.97 0.00 61.89
Con.6 0.00 0.00 0.00 0.00 7.50 0.00 0.00 7.50
Con.7 18.75 0.00 12.58 0.00 0.00 0.00 0.00 31.33
Sum 39.11 43.12 18.00 25.47 33.95 39.81 43.88 243.34
(a)
 (b)
(c)
 (d)
Fig. 1. Feasibility analysis of clearing algorithm: (a) The balance of total
generation and total demand, (b) Bus voltages, (c) Line flows, (b) The
evolution of social welfare.
B. Feasibility of Clearing Algorithm
In this subsection, we illustrate the feasibility of our pro-
posed clearing algorithm as indicated in Table I and Fig. 1. Ta-
ble I shows energy traded between consumers and producers.
Fig. 1(a) shows that total generation and demand are balanced.6
Fig. 1(b) and (c) show that energy transactions do not violate
network constraints. Fig. 1(d) illustrates that social welfare
generated by our proposed algorithm can asymptotically reach
an optimal value with iterations. Therefore, we conclude that
our proposed algorithm can converge to an optimal solution
with energy and network constraints.
In addition, Table I shows that consumers only conduct ef-
ficient energy transactions with some producers. For example,
Consumer 1 only buys energy from Producers 2, 3, and 6.
This is due to Consumer 1 has a larger transaction coefficient
with Producers 2, 3, and 6 ( α11, α12, α13, α14, α15, α16, α17:
0.54,0.71,0.60,0.54,0.42,0.64,0.43). It implies that con-
sumers are more willing to enter into transactions with their
preferred producers.
(a)
(b)
Fig. 2. Effectiveness of the selection strategy: (a) Number of trading pairs,
social welfare, and convergence time for 7000 simulations, (b) Social welfare
and convergence time under different benchmark values.
C. Effectiveness of Selection Strategy
To verify the effectiveness of the proposed selection strat-
egy, we conduct a Monte Carlo experiment in which con-
sumers randomly select different trading partners in each
simulation. We perform 7000 simulations and record the
number of trading pairs (i.e., sum of the number of trading
partners of all consumers), social welfare and convergence
time in each simulation, as indicated in Fig. 2(a). It shows that
as the number of trading pairs reduces, both social welfare
and convergence time are trending down. This is because
reducing the number of trading pairs can reduce the amount
of computation and communication, at the expense of some
social welfare. Fig. 2(a) also shows that a reasonable reduction
of trading pairs can not only decrease convergence time butTABLE II
PERFORMANCE OF OUR PROPOSED MECHANISM AND OTHER METHODS
M1 M2 M3 M4
No. of Iteration 5464 4954 3904 3352
Convergence Time (s) 5520.95 4034.57 3160.67 1700.13
Social Welfare ($) 28115.21 28114.10 28113.70 28098.34
also hardly lose social welfare, as shown by the red dot,
which is the case of the proposed selection strategy. In the
next subsection, we further illustrate the performance of the
selection strategy through specific numerical comparisons.
In the selection strategy, we set the normalized transaction
coefficient of 0 as the preferred benchmark. However, is the
benchmark set reasonable? We conduct several simulations
under different benchmark values, as indicted in Fig. 2(b).
It shows that with the increase of benchmark value, conver-
gence time gradually decreases while social welfare is almost
unchanged until the benchmark value reaches 0.15. This is
because as the benchmark value increases, the number of
trading partners selected by consumers decreases, which can
reduce the amount of computation and communication. In ad-
dition, since consumers can still conduct efficient transactions
with their preferred producers, the loss of social welfare is
limited. When consumers cannot trade with enough producers,
the loss of social welfare is exacerbated. Note that the red
dot in Fig. 2(b) is the case of the benchmark value we set,
which is appropriate in the sense that it can effectively reduce
convergence time without causing a significant reduction in
social welfare.
D. Scalability of the Algorithm
In this subsection, we illustrate the scalability of our pro-
posed mechanism by comparing with other methods in a large-
scale P2P market. We expand the original 14-prosumers mar-
ket to a 500-prosumers market. These methods for comparison
are: M1: the RCI method reported in [10], M2: the DBET
method proposed in [15], M3: our proposed algorithm without
selection strategy, M4: our proposed algorithm with selection
strategy. For each method, we set the same stopping criteria
and run multiple simulations to determine its optimal step-
size. We record the number of iterations, convergence time,
and social welfare for each method, as indicated in Table II.
It can be found that M3 and M4 require fewer iterations than
M1 and M2, which is due to the faster convergence rate. The
convergence time of M4 is less, because the selection strategy
can further reduce the amount of computation and communi-
cation. Less convergence time means better scalability for the
electricity market.
VI. CONCLUSION
In this paper, we consider the multi-bilateral economic
dispatch problem with product differentiation. To meet the
scalability challenge of the problem, we propose a scalable
mechanism including an accelerated distributed clearing al-
gorithm and a novel selection strategy. The accelerated dis-
tributed algorithm using Nesterov’s accelerated gradient has7
a faster convergence rate than many existing methods. The
selection strategy based on consumer preferences can reduce
the amount of computation and communication per player
by reducing the number of inefficient trading partners for
consumers, while keeping the optimal social welfare as much
as possible.
There are many interesting problems for future research,
for instance, incorporating energy storage devices, employing
more general cost and utility functions for prosumers, and
protecting prosumers’ privacy.
APPENDIX A
IEEE PROOF OF THEOREM 1
We first give five lemmas for proving Theorem 1.
Lemma 1: The local dual functions qi(λi)andqj(λj)
defined in (10) have Lipschitz continuous gradient with Lip-
schitz constants1
σiand1
σj, that is, ∥∇qi(µi)− ∇qi(λi)∥ ≤
1
σi∥µi−λi∥and∥∇qj(µj)− ∇qj(λj)∥ ≤1
σj∥µj−λj∥.
Proof: According to the definition of qi(λi)in (10),
letxi(λi) = arg max
xi 
−Ci(xi) +λT
ixi
andxi(µi) =
arg max
xi 
−Ci(xi) +µT
ixi
. By using the optimality condi-
tions in [25], we have
D
− ∇Ci(xi(λi)) +λi,xi(µi)−xi(λi)E
≤0,
D
− ∇Ci(xi(µi)) +µi,xi(λi)−xi(µi)E
≤0.
Then, adding the above two inequalities, it gives
D
− ∇Ci(xi(λi)) +∇Ci(xi(µi)),xi(µi)−xi(λi)E
≤ ∥µi−λi∥∥xi(µi)−xi(λi)∥,
It follows from the strong concavity of −Ci(·)that
σi∥xi(µi)−xi(λi)∥2≤D
µi−λi,xi(µi)−xi(λi)E
,
where σiis the strong concave constant. Then, the Lipschitz
continuous gradient of qi(λi)follows from the fact that
∇qi(µi)− ∇qi(λi) =xi(µi)−xi(λi). Similarly, qj(λj)also
has Lipschitz continuous gradient.
Lemma 2: For any λ, µ∈Rnpnc, the following inequality
holds
q(λ)≤q(µ) +⟨λ−µ,∇q(µ)⟩+X
i∈NPX
j∈NiLij
2(λij−µij)2,
where Lij=σi+σj
σiσj.
Proof: According to Lemma 1, we have
qi(λi)≤qi(µi)+⟨λi−µi,∇qi(µi)⟩+X
j∈Ni1
2σi(λij−µij)2.
Define qx(λ) =P
i∈NPqi(λi), then summing all qi(λi)for
alli∈ NPyields
qx(λ)≤qx(µ)+⟨λ−µ,∇qx(µ)⟩+X
i∈NPX
j∈Ni1
2σi(λij−µij)2.
(19)Similarly, we can show that
qy(λ)≤qy(µ)+⟨λ−µ,∇qy(µ)⟩+X
i∈NPX
j∈Ni1
2σj(λij−µij)2,
(20)
where qy(λ) =P
j∈NCqj(λj). Then, combining (19) and
(20), we can draw the conclusion.
Lemma 3: Let the sequence γk, λk
ijbe defined in Algorithm
1 with ηij∈(0,1/Lij], where Lij=σi+σj
σiσj. Then, the
following inequality holds
(γk)2
k2hk−(γk+1)2
(k+ 1)2hk+1
≥X
i∈NPX
j∈Ni1
2ηij 
uk+1
ij2−X
i∈NPX
j∈Ni1
2ηij 
uk
ij2,
where hk=q(λk)−q(λ∗),uk
ij=γk
kλk
ij−(γk
k−1)λk−1
ij−λ∗
ij.
Proof: Define the quadratic approximation function
Q(λ, µ)ofq(λ)as
Q(λ, µ) =q(µ)+⟨λ−µ,∇q(µ)⟩+X
i∈NPX
j∈Ni1
2ηij(λij−µij)2.
In light of Lemma 2, it can be obtained that
q(λ)≤Q(λ, µ). (21)
Substituting λ=ϕ, ϕ∈Rnpncandµ=ˆλintoQ(λ, µ), it has
Q(ϕ,ˆλ) =q(ˆλ)+⟨ϕ−ˆλ,∇q(ˆλ)⟩+X
i∈NPX
j∈Ni1
2ηij
ϕij−ˆλij2
,
where ϕ:=arg min {Q(λ,ˆλ)}. In accordance with the first
order optimality conditions, it obtains ϕij=ˆλij−ηij∇q(ˆλij).
Combining the convexity of q(λ)(i.e., q(λ)≥q(ˆλ) +⟨λ−
ˆλ,∇q(ˆλ)⟩) and (21), we have
q(λ)−q(ϕ)≥q(λ)−Q(ϕ,ˆλ)
≥D
λ−ˆλ,∇q(ˆλ)E
−D
ϕ−ˆλ,∇q(ˆλ)E
−X
i∈NPX
j∈Ni1
2ηij
ϕij−ˆλij2
=X
i∈NPX
j∈Ni1
2ηij
ϕij−ˆλij2
+X
i∈NPX
j∈Ni1
ηij(ϕij−ˆλij)(ˆλij−λij),(22)
where the first equality uses ∇q(ˆλij) =1
ηij(ˆλij−ϕij). By
using (22) with the points (λ:=λk,ˆλ:=ˆλk+1)and(λ:=
λ∗,ˆλ:=ˆλk+1), it yields
hk−hk+1≥X
i∈NPX
j∈Ni1
2ηij
λk+1
ij−ˆλk+1
ij2
+X
i∈NPX
j∈Ni1
ηij(λk+1
ij−ˆλk+1
ij)(ˆλk+1
ij−λk
ij),(23)
−hk+1≥X
i∈NPX
j∈Ni1
2ηij
λk+1
ij−ˆλk+1
ij2
+X
i∈NPX
j∈Ni1
ηij(λk+1
ij−ˆλk+1
ij)(ˆλk+1
ij−λ∗
ij),(24)8
where hk=q(λk)−q(λ∗). To get the relationship between
hkandhk+1, multiply the inequality (23) by(γk+1
k+1−1)and
add it to (24). Then, multiplying both sides of the obtained
result byγk+1
k+1and using(γk+1)2
(k+1)2−γk+1
k+1=(γk)2
k2, we have
(γk)2
k2hk−(γk+1)2
(k+ 1)2hk+1
≥X
i∈NPX
j∈Ni1
2ηijγk+1
k+ 1
λk+1
ij−ˆλk+1
ij2
+X
i∈NPX
j∈Ni1
ηijγk+1
k+ 1
λk+1
ij−ˆλk+1
ijγk+1
k+ 1ˆλk+1
ij
−γk+1
k+ 1−1
λk
ij−λ∗
ij
.(25)
By using (b−a)2+ 2(b−a, a−c) = ( b−c)2−(a−c)2
and combing the inequality (25) with a:=γk+1
k+1ˆλk+1
ij, b:=
γk+1
k+1λk+1
ij, c:= (γk+1
k+1−1)λk
ij+λ∗
ij, it has
(γk)2
k2hk−(γk+1)2
(k+ 1)2hk+1
≥X
i∈NPX
j∈Ni1
2ηijγk+1
k+ 1λk+1
ij−γk+1
k+ 1−1
λk
ij−λ∗
ij2
−X
i∈NPX
j∈Ni1
2ηijγk+1
k+ 1ˆλk+1
ij−γk+1
k+ 1−1
λk
ij−λ∗
ij2
.
Finally, according to the definition of ˆλk+1in Algorithm 1,
the result is obtained.
Lemma 4: If{sk, mk}are two positive sequences of reals
and satisfy
sk−sk+1≥mk+1−mk,∀k≥1,withs1+m1≤w, w > 0,
Then for any k≥1,sk≤w.
Lemma 5: Let the positive sequence γkbe denoted in
Algorithm 1 with γ1= 1. Then, for all k≥1,γk≥k2
2.
In the following, by combining Lemma 3, 4 and 5, the
IEEEproof of Theorem 1 is given.
Proof: According to Lemma 3 and 4, let sk=(γk)2
k2hk
andmk=P
i∈NPP
j∈Ni1
2ηij 
uk
ij2, then s1= (γ1)2·h1=
q(λ1)−q(λ∗)andm1=P
i∈NPP
j∈Ni1
2ηij 
λ1
ij−λ∗
ij2.
By using (22) with the point ( λ=λ∗,ˆλ=ˆλ1), it yields
s1+m1≤X
i∈NPX
j∈Ni1
2ηij 
λ0
ij−λ∗
ij2,
which is due to ˆλ1
ij=λ0
ij. By using Lemma 4, it obtains
(γk)2
k2hk≤X
i∈NPX
j∈Ni1
2ηij 
λ0
ij−λ∗
ij2.
With hk=q(λk)−q(λ∗)and Lemma 5, (17) in Theorem 1
is obtainedAPPENDIX B
IEEE PROOF OF COROLLARY 1
Proof: By using (22) with points (λ=λ∗,ˆλ=λn)and
(λ=λn,ˆλ=λn), it obtains
q(λ∗)−q(λn+1)≥X
i∈NPX
j∈Ni1
2ηij 
λ∗
ij−λn+1
ij2
−X
i∈NPX
j∈Ni1
2ηij(λ∗
ij−λn
ij)2,(26)
q(λn)−q(λn+1)≥X
i∈NPX
j∈Ni1
2ηij 
λn+1
ij−λn
ij2.(27)
Sum (26) over n= 0, ..., k−1. Multiply (27) by nand sum it
overn= 0, ..., k−1. Then, adding the two results obtained,
we can get (18) in Corollary 1.
REFERENCES
[1] Y . Liu, L. Wu, and J. Li, “Peer-to-peer (p2p) electricity trading in
distribution systems of the future,” Electr. J. , vol. 32, no. 4, pp. 2–6,
2019.
[2] Y . Parag and B. K. Sovacool, “Electricity market design for the prosumer
era,” Nat. Energy , vol. 1, no. 4, pp. 1–6, 2016.
[3] C. Liu and Z. Li, “Comparison of centralized and peer-to-peer decentral-
ized market designs for community markets,” IEEE Trans. Ind. Appl. ,
vol. 58, no. 1, pp. 67–77, 2022.
[4] W. Tushar, T. K. Saha, C. Yuen, D. Smith, and H. V . Poor, “Peer-to-peer
trading in electricity networks: An overview,” IEEE Trans. Smart Grid ,
vol. 11, no. 4, pp. 3185–3200, 2020.
[5] A. A. Raja and S. Grammatico, “Bilateral peer-to-peer energy trading
via coalitional games,” IEEE Trans. Ind. Informat. , vol. 19, no. 5, pp.
6814–6824, 2023.
[6] K. Chen, J. Lin, and Y . Song, “Trading strategy optimization for a
prosumer in continuous double auction-based peer-to-peer market: A
prediction-integration model,” Appl. Energy , vol. 242, pp. 1121–1133,
2019.
[7] G. Hug, S. Kar, and C. Wu, “Consensus+ innovations approach for
distributed multiagent coordination in a microgrid,” IEEE Trans. Smart
Grid , vol. 6, no. 4, pp. 1893–1903, 2015.
[8] A. Paudel, M. Khorasany, and H. B. Gooi, “Decentralized local energy
trading in microgrids with voltage management,” IEEE Trans. Ind.
Informat. , vol. 17, no. 2, pp. 1111–1121, 2021.
[9] M. H. Ullah and J.-D. Park, “A two-tier distributed market clearing
scheme for peer-to-peer energy sharing in smart grid,” IEEE Trans. Ind.
Informat. , vol. 18, no. 1, pp. 66–76, 2022.
[10] E. Sorin, L. Bobo, and P. Pinson, “Consensus-based approach to peer-
to-peer electricity markets with product differentiation,” IEEE Trans.
Power Syst. , vol. 34, no. 2, pp. 994–1004, 2019.
[11] D. H. Nguyen, “Optimal solution analysis and decentralized mechanisms
for peer-to-peer energy markets,” IEEE Trans. Power Syst. , vol. 36, no. 2,
pp. 1470–1481, 2021.
[12] T. Morstyn and M. D. McCulloch, “Multiclass energy management
for peer-to-peer energy trading driven by prosumer preferences,” IEEE
Trans. Power Syst. , vol. 34, no. 5, pp. 4005–4014, 2019.
[13] T. Baroche, P. Pinson, R. L. G. Latimier, and H. B. Ahmed, “Exogenous
cost allocation in peer-to-peer electricity markets,” IEEE Trans. Power
Syst., vol. 34, no. 4, pp. 2553–2564, 2019.
[14] A. Paudel, L. Sampath, J. Yang, and H. B. Gooi, “Peer-to-peer energy
trading in smart grid considering power losses and network fees,” IEEE
Trans. Smart Grid , vol. 11, no. 6, pp. 4727–4737, 2020.
[15] M. Khorasany, Y . Mishra, and G. Ledwich, “A decentralized bilateral
energy trading system for peer-to-peer electricity markets,” IEEE Trans.
Ind. Electron. , vol. 67, no. 6, pp. 4646–4657, 2020.
[16] K. Umer, Q. Huang, M. Khorasany, M. Afzal, and W. Amin, “A
novel communication efficient peer-to-peer energy trading scheme for
enhanced privacy in microgrids,” Appl. Energy , vol. 296, 2021, Art. no.
117075.
[17] M. Khorasany, Y . Mishra, B. Babaki, and G. Ledwich, “Enhancing
scalability of peer-to-peer energy markets using adaptive segmentation
method,” J. Mod. Power Syst. Clean Energy , vol. 7, no. 4, pp. 791–801,
2019.9
[18] A. Mas-Colell, M. D. Whinston, and J. R. Green, Microeconomic
Theory, 1st ed . Oxford University Press, 1995.
[19] P. Samadi, H. Mohsenian-Rad, R. Schober, and V . W. Wong, “Advanced
demand side management for the future smart grid using mechanism
design,” IEEE Trans. Smart Grid , vol. 3, no. 3, pp. 1170–1180, 2012.
[20] M. H. Ullah and J.-D. Park, “Peer-to-peer energy trading in transactive
markets considering physical network constraints,” IEEE Trans. Smart
Grid , vol. 12, no. 4, pp. 3390–3403, 2021.
[21] J. Guerrero, A. C. Chapman, and G. Verbi ˇc, “Decentralized p2p energy
trading under network constraints in a low-voltage network,” IEEE
Trans. Smart Grid , vol. 10, no. 5, pp. 5163–5173, 2019.
[22] D. Bertsekas, Nonlinear Programming . Athena Scientific, 1995.
[23] S. Boyd, N. Parikh, and E. Chu, Distributed optimization and statistical
learning via the alternating direction method of multipliers . Now
Publishers Inc, 2011.
[24] N. G. Mankiw, Principles of microeconomics . Cengage Learning, 2011.
[25] A. Nedi ´c,LectureNotes Optimization I . Hamilton Institute, 2008.