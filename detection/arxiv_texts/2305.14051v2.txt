1
Downlink Clustering-Based Scheduling of
IRS-Assisted Communications With
Reconfiguration Constraints
Alberto Rech, Matteo Pagin, Leonardo Badia, Stefano Tomasin,
Marco Giordani, Jonathan Gambini, Michele Zorzi
Abstract —Intelligent reflecting surfaces (IRSs) are being
widely investigated as a potential low-cost and energy-efficient
alternative to active relays for improving coverage in next-
generation cellular networks. However, technical constraints in
the configuration of IRSs should be taken into account in
the design of scheduling solutions and the assessment of their
performance. To this end, we examine an IRS-assisted time
division multiple access (TDMA) cellular network where the
reconfiguration of the IRS incurs a communication cost; thus, we
aim at limiting the number of reconfigurations over time. Along
these lines, we propose a clustering-based heuristic scheduling
scheme that maximizes the cell sum capacity, subject to a fixed
number of reconfigurations within a TDMA frame. First, the
best configuration of each user equipment (UE), in terms of joint
beamforming and optimal IRS configuration, is determined using
an iterative algorithm. Then, we propose different clustering
techniques to divide the UEs into subsets sharing the same
sub-optimal IRS configuration, derived through distance- and
capacity-based algorithms. Finally, UEs within the same clus-
ter are scheduled accordingly. We provide extensive numerical
results for different propagation scenarios, IRS sizes, and phase
shifters quantization constraints, showing the effectiveness of our
approach in supporting multi-user IRS systems with practical
constraints.
Index Terms —Intelligent Reflecting Surfaces (IRS); millimeter
wave (mmWave) communication; multiple access; scheduling;
clustering; optimization.
I. I NTRODUCTION
The ever-increasing growth of mobile traffic has called both
academia and industry to identify and develop solutions for
extending the radio spectrum beyond the crowded sub-6 GHz
bands. As a result, the use of millimeter wave (mmWave) band
for cellular communications has been included in the latest
releases of the 3rd Generation Partnership Project (3GPP)
Alberto Rech, Leonardo Badia, Matteo Pagin, Stefano Tomasin, Marco
Giordani, and Michele Zorzi are with the Department of Information En-
gineering, University of Padova, Italy. Jonathan Gambini is with the Milan
Research Center, HUAWEI, Italy. A. Rech is also with the Paris Re-
search Center, HUAWEI, France. Corresponding author: A. Rech (email:
alberto.rech@huawei.com).
Project funded under the National Recovery and Resilience Plan (NRRP),
Mission 4 Component 2 Investment 1.3 - Call for tender No. 341 of 15 marzo
2022 of Italian Ministry of University and Research funded by the European
Union – NextGenerationEU Project code MUR: PE_0000001 Concession
Decree No. 1549 of 11/10/2022 adopted by the Italian Ministry of University
and Research, CUP C93C22005250001 Project title RESearch and innovation
on future Telecommunications systems and networks, to make Italy more
smART (RESTART).
Part of this paper has been presented at the IEEE Wireless Communications
and Networking Conference (WCNC), [1]].standard, namely fifth-generation (5G) New Radio (NR) [2].
Moreover, Terahertz (THz) frequencies are being investigated
as enablers for sixth-generation (6G) networks as well [3].
However, transmissions in the mmWave and THz bands are
subject to challenging propagation conditions, mainly due to
severe path loss and susceptibility to blockages [4]. To miti-
gate these limitations, the research community has explored
solutions to improve network coverage, for example using
integrated access and backhaul (IAB) nodes, as also approved
by the 3GPP as part of 5G new radio (NR) specifications
for Rel-16 [5]. In particular, IAB allows base stations, or
next generation Node Bases (gNBs) in 5G NR parlance, to
establish wireless (rather than traditional fiber-like) backhaul
links, possibly through multiple hops, to a donor, thus reducing
deployment costs [6]. Still, IAB involves complex signal
processing and saturation of the available resources and may
be costly and energy-consuming for network operators.
In light of this, intelligent reflecting surfaces (IRSs) are
being investigated as solutions to overcome the harsh prop-
agation conditions shown by mmWave and THz bands in a
cost- and energy-efficient manner [7]. IRSs are meta-surfaces,
whose radiating elements can passively tune the phase shift of
impinging signals to favorably alter an electromagnetic field
towards an intended destination. They can be configured to
beamform the reflected signal virtually in any direction, hence
acting as a relay to improve the signal quality without an active
(power-consuming) amplification [8].
A. Prior Work
Despite the substantial research hype, most recent studies on
IRSs rely on strong assumptions that do not match real-world
deployments. Specifically, a significant body of literature is
based on the assumption that IRSs establish an ideal (i.e., fiber-
like) control channel with the base station [9]–[12]. Instead,
actual deployments are expected to feature a wireless, i.e.,
error-prone, IRS control, possibly implemented with low-cost
technologies [13], [14]. This introduces constraints on the
IRS reconfiguration period, which needs to be synchronized
with the base station to beamform the signal towards the user
equipment (UE) served during the specific time slot [7], a
similar research problem to scheduling in cellular networks.
In this perspective, IRS-assisted downlink scheduling so-
lutions have been widely studied in different domains, each
with its own theoretical constraints. For example, in orthogonalarXiv:2305.14051v2  [eess.SP]  12 Feb 20242
frequency-division multiple access (OFDMA) user scheduling,
all the users scheduled in a given time slot must be served
using the same reflection coefficients, due to the lack of
frequency selective beamforming capabilities at the IRS. In
this context, dynamic optimization schemes, wherein the IRS
configurations are adjusted at each time slot, have been studied
in [15], [16]. The authors of [17] consider a two-user
downlink transmission problem in an IRS-assisted scenario
over fading channels, and compare the results of different
basic orthogonal multiple access (OMA) and non-orthogonal
multiple access (NOMA) schemes. It is found that, while
NOMA is the best solution, by exploiting IRS reconfiguration
in each slot of the fading block, time division multiple ac-
cess (TDMA) outperforms frequency division multiple access
(FDMA), and its performance is similar to that of NOMA. A
hybrid TDMA-NOMA approach, instead, was investigated in
an uplink scenario in [18], [19], in the context of a wireless-
powered network, where users are grouped based on their
channel gains. Then, UEs within the same group transmit in
a non-orthogonal fashion, while different groups are assigned
to different time slots. Moreover, a user scheduling algorithm
based on graph neural networks, able to jointly optimize the
IRS configuration and the gNB beamforming in downlink, was
recently presented in [20]. Similarly, the authors of [21]–[23]
evaluated the performance of several non-orthogonal downlink
scheduling methods, such as rate-splitting multiple access
(RSMA). Finally, IRSs with energy harvesting capabilities are
considered in [24]. In this work, the authors propose a trade-off
between the system sum capacity and the IRS energetic self-
sustainability, with the goal of achieving coverage flexibility
and low deployment costs.
Still, most of the literature poses little to no reconfiguration
constraints for the IRS. However, early IRS control circuitry
prototypes, which have low power consumption (i.e., a few
hundreds of mW), have a non-negligible phase-shifts recon-
figuration time [25], [26], thus posing additional constraints
in the system design. For example, the prototypes in [27]
and [28] have a reconfiguration time of a few tens of ms,
even though architectures based on field programmable gate
array (FPGA) such as in [29] promise to achieve much lower
configuration times, i.e., in the order of tens of microseconds.
Still, the overhead (in terms of time) increases as the number
of IRS elements increases, as investigated in [30]–[32]. In
any case, a constraint on the number of reconfigurations (and
relative period) is desirable to ensure system synchronization
and minimize the IRS downtime during reconfiguration. In
this regard, it is of interest to ( i) investigate the level of
performance degradation experienced by IRS-assisted systems
when considering practical constraints, including limitations in
the number of reconfigurations, and ( ii) design algorithms that
can mitigate these constraints. The limitation on the number of
IRS reconfigurations in a given time frame has been initially
studied in [25], where the authors evaluate the capacity of both
OMA and NOMA schemes of a 2-user IRS-assisted single
input single output (SISO) system under Rayleigh fading
conditions. Still, additional research efforts is required to fully
characterize the impact of IRS reconfigurations constraints on
the network.B. Contributions
In this paper, we propose a TDMA scheduling policy
for downlink cellular transmissions based on clustering algo-
rithms, to maximize the sum capacity in IRS-assisted network
deployments with practical constraints. Notably, we assume a
fixed maximum number of IRS reconfigurations within a time
frame and aim at optimizing both the reconfiguration time and
the resulting IRS configuration(s). The limit on the number
of reconfigurations sets a simple constraint on the overhead
entailed by the control of the IRS. Our contributions can be
summarized as follows. First, we formalize an optimization
problem to determine the optimal IRS configuration(s) to
maximize the sum capacity. Specifically, we partition the UEs
into disjoint groups, and propose an algorithm that iteratively
optimizes the IRS configuration for each group, as well as the
relative beamformers to be used for transmission. Secondly, we
convert the sum capacity problem into a clustering problem
to determine the optimal set of groups, or clusters, for the
UEs based on their channel characteristics. Accordingly, we
design clustering algorithms for the UEs, such that all UEs in
the same cluster will adopt the same IRS configuration. The
goal is to minimize the capacity loss associated with a sub-
optimal IRS configuration for each UE in the cluster, for pro-
moting communication efficiency and reducing the overhead.
We investigate two clustering techniques: ( i) distance-based
clustering, which adjusts the cluster configuration based on
the distance with the optimal IRS configuration of each UE
in the cluster; ( ii) capacity-based clustering, which adjusts the
cluster configuration to maximize the sum capacity and/or the
user fairness. Specifically, we propose three clustering algo-
rithms. The first, named capacity-weighted clustering (CWC),
iteratively adjusts the clusters’ centroids weighting the points
in each cluster by the capacity achieved by each UE in the
cluster, therefore favoring the best users and maximizing the
sum capacity. The second, named one-shot capacity-based
clustering (OSCBC), is a low-complexity approach where
the centroids are simply the optimal configurations of the
UEs experiencing the highest signal-to-noise-ratio (SNR) in
each cluster, without considering the impact of the remaining
UEs. Finally, inverse capacity-weighted clustering (ICWC)
promotes fairness among the UEs by weighting the points in
the clusters by the inverse of the UEs’ achievable rate.
Moreover, we compare via simulation the performance of
the distance- and capacity-based clustering in different IRS-
assisted scenarios. Extensive numerical results show that there
exists a trade-off between the achievable sum capacity and
fairness, even though capacity-based clustering techniques
can guarantee satisfactory performance, despite some recon-
figuration constraints. Also, we demonstrate that scheduling
based on clustering can reduce by 50% the number of IRS
reconfigurations, thus promoting communication efficiency, in
view of minor degradation in terms of sum capacity.
Finally, with respect to [1], we introduce new capacity-
based clustering strategies to improve fairness and provide
more extensive numerical results to demonstrate the scalability
of the proposed solutions as a function of the density of UEs
and the IRS size. Moreover, we evaluate the performance of3
IRS
UE 1
UE 3
UE 2
UE 4
 UE 𝐾
UE 𝐾−1
𝚽(1)𝚽(2)𝚽(𝑍)gNB
… timeIRS Controller
BlockageControl Link𝑯
𝚽(1)
𝚽(2) 𝚽(𝑍)
𝑮1
𝑮2 𝑮𝐾−1𝑮𝐾 𝑮3𝑮4
…
Fig. 1. Downlink TDMA scheduling for multi-user IRS-aided systems.
the proposed scheduling strategies considering realistic IRS
network constraints, including the quantization of phase shifts,
and for different channel propagation conditions. In this sense,
we provide additional results in terms of the computational
complexity of the proposed distance- and capacity-based clus-
tering algorithms, as well as in terms of fairness.
C. Organization and Notation
The rest of the paper is organized as follows. In Section II,
we introduce the system model. In Section III, we present
the sum capacity optimization problem. In Section IV, we
describe the scheduling framework, while in Sections V and
VI we present distance-based and capacity-based clustering
algorithms, respectively. In Section VII, we show numerical
results and compare the different scheduling and clustering
solutions. Finally, Section VIII draws the main conclusions.
Scalars are denoted by italic letters; vectors and matrices by
boldface lowercase and uppercase letters, respectively; sets are
denoted by calligraphic uppercase letters. diag(a)indicates a
square diagonal matrix with the elements of aon the principal
diagonal. ATandA†denote the transpose and the conjugate
transpose of matrix A, respectively. [A]kℓdenotes the scalar
value in the k-th row and ℓ-th column of matrix A, while [a]k
denotes the k-th element of vector a. The imaginary unit is
denoted as j=√−1, and∠adenotes the phase of a∈C.
Finally, E[·]denotes statistical expectation.
II. S YSTEM MODEL
We consider downlink data transmissions for the multi-user
multiple input multiple output (MIMO) communication system
shown in Fig. 1, wherein the transmission from the gNB to
theKUEs is assisted by an IRS. The gNB and the UEs are
equipped with NgandNUantennas, respectively. We assume
that the direct link between the gNB and the UEs is unavailable
due to blockage. As a consequence, the gNB transmits signals
to the UEs by exploiting the virtual link offered by the IRS.
In this context, the IRS configuration is managed by the
gNB through the IRS controller, by exploiting a dedicated
link between the gNB and the IRS, thus with no additional
communication overhead in the gNB-UE link. Time is dividedinto frames of Kslots, and each UE is served exactly once
in a frame in a TDMA fashion, which ensures there is no co-
channel interference as UEs are separated in the time domain.
We assume that UEs are either static or moving slowly,
which is the most typical application scenario for IRS-assisted
networks. Under such conditions, the channel coherence time
is in the order of 10 ms [33, Fig. 5]. Considering that perfect
channel state information (CSI) of all UEs is acquired at the
gNB at the beginning of each frame (a realistic assumption that
does not affect the proposed scheduling framework for IRS
communication), it is reasonable to conclude that the channel
remains constant throughout the whole time frame. Here, we
assume that the CSI is available for any IRS configuration.
A. IRS Model
Each of the NIelements of the IRS acts independently as
an omnidirectional antenna unit that reflects the impinging
electromagnetic field by introducing a tunable phase shift on
the baseband-equivalent signal. We denote as ϕn=ejθnthe
reflection coefficient of the n-th IRS element, where θn∈ Pθ
is the induced phase shift, and Pθis the set of possible phase
shifts. Recent works argue that continuous phase shifts are
hardly implementable in practice [34]. Therefore, we consider
both continuous and quantized phase shifts. While in the
former case the set of phase shifts is Pθ= [−π, π), in the
latter we have Pθ=n
0,2π
2b, . . . ,2π(2b−1)
2bo
where b >0is
the number of bits employed to quantize the phase shifts.
We denote with H∈CNI×Ngthe channel matrix between
the IRS and the gNB, and with Gk∈CNU×NIthe channel
matrix of the link between the IRS and UE k, respectively. We
consider single-stream transmissions,1withwk∈CNg×1and
vk∈CNU×1defined as the beamforming vectors at the gNB
and UE k, respectively. Let xkbe the single-stream signal
transmitted by the gNB to UE k; the received post-processing
signal can be expressed as
zk=vT
kGkΦHw kxk+vT
knk, (1)
where nk∈CNU×1represents the circularly symmetric
complex Gaussian noise vector with entries having zero mean
and variance σ2
n, while Φ∈CNI×NIis the IRS configuration,
i.e., a diagonal matrix defined as Φ= diag( ϕ1, . . . , ϕ NI). Note
that different, and specific, IRS configurations can be adopted
for different UEs. Accordingly, in the rest of the paper we let
Φkbe the IRS configuration adopted when UE kis served.
The SNR at UE kunder IRS configuration Φkis
Γk(Φk) =|vT
kGkΦkHw k|2σ2
x
|vk|2σ2n, (2)
where σ2
xis the power of the transmitted signal. To maximize
the SNR of a given UE, a specific IRS configuration should
be adopted, tailored to the UE position in the cell and the
channel conditions. However, the goal of this paper is to limit
the number of IRS reconfigurations to comply with realistic
1The assumption of single-stream transmissions is justified by the rank of
the cascade channel matrix, which is likely equal to one. This conclusion
comes from the considerations reported in [35]–[37], and has been verified
numerically for the considered setup.4
overhead constraints, as well as to improve the communica-
tion efficiency, and algorithms seeking to comply with these
requirements will be presented in Section IV.
III. S UMCAPACITY OPTIMIZATION PROBLEM
We impose a constraint on the number of IRS reconfigura-
tions per time frame, with the goal of either limiting the recon-
figuration,2for accounting for practical limitations that might
arise in realistic deployments. On the downside, achieving this
objective usually leads to SNR degradation as sub-optimal IRS
configurations might be adopted for some UEs. To mitigate
this effect, we formulate a constrained optimization problem
on the average cell sum capacity. Specifically, we assume the
following conditions:
1. at most ZIRS reconfigurations can occur per time frame;
2. the gNB serves KUEs by partitioning them into Z
disjoint subsets U1, . . . ,UZ,Z≤K;
3. for each UE in Uz, the same IRS configuration Φ(z)is
used, i.e., Φk=Φ(z),∀k∈ Uz,∀1≤z≤Z.
Then, the achievable rate of UE k∈ Uzis
Rk(Φ(z)) = log2
1 + Γ k 
Φ(z)
, (3)
where Γk(Φ(z))is the SNR experienced by the k-th UE while
configuration Φ(z)is adopted at the IRS, i.e., the configuration
shared by all UEs belonging to subset Uz.
LetI={Φ(1),Φ(2), . . . ,Φ(Z)}be the set of IRS configu-
rations corresponding to subsets U1, . . . ,UZ. The system sum
capacity within a time frame is defined as
C(U1, . . . ,UZ,I) =BZX
z=1X
k∈UzRk 
Φ(z)
, (4)
where Bis the transmission bandwidth. The optimization
problem is then formulated as
max
U1,...,UZ,IC(U1, . . . ,UZ,I), (5a)
s.t.∠
Φ(z)
n,n∈ Pθ,∀n, z. (5b)
Problem (5) determines the optimal grouping strategy for
the UEs subsets U1, . . . ,UZ, and assigns the best IRS config-
uration accordingly. Therefore, (5) is both continuous (i.e., the
optimization of the IRS configuration) and combinatorial (i.e.,
the grouping of the UEs), and can be thus classified as a mixed
integer nonlinear programming (MINLP) problem. Moreover,
the following theorem holds.
Theorem 1. The sum capacity maximization problem (5)is
NP-complete.
Proof: First, we observe that the problem falls within
the general NP class. This is because if (5) is solved to
findU1, . . . ,UZ,I, both the sum capacity and the phase-shift
constraints (5b) could be verified in polynomial time. To prove
2We remark that the gNB typically communicates a (possibly new) IRS
configuration in each transmission time interval (TTI). The reconfiguration
constraint introduced in the proposed IRS scheduling framework is able to
reduce this overhead by a factor Z/K≤1.that the problem in NP-complete, we set I, and consider the
simplified problem
max
U1,...,UZC(U1, . . . ,UZ,I). (6)
This problem can be viewed as a multi-knapsack problem
with different clusters U1, . . . ,UZas knapsacks, and the goal
is to maximize the total system capacity. This is known to
be NP-hard, as it is a generalization of the classic knapsack
problem. The original sum capacity maximization problem (5),
where we consider the additional degrees of freedom of the
IRS configurations, remains NP-hard, thus making the problem
NP-complete.
Given the inherent problem complexity, we adopt heuristic
clustering algorithms to obtain approximated, though close-to-
optimal, solutions, as described in Section IV.
IV. H EURISTIC SUMCAPACITY MAXIMIZATION
In this section, we provide heuristic solutions to (5). First,
we present two clustering-based approaches to identify and
group UEs with a similar optimal IRS configuration. Then, we
solve the scheduling problem on the identified clusters with a
TDMA approach [38]. We compute the UEs clusters by first
estimating the optimal individual IRS configurations, denoted
asΦ∗
k,1≤k≤K, i.e., the IRS configurations leading to
the maximum capacity for each UE k, as described in Sec-
tion IV-A. These configurations would solve (5) for Z=K,
as in this case all UEs are served in a TDMA fashion and
with their optimal IRS configuration. The phase coefficients of
the optimal IRS configuration matrices are then chosen as the
initial points of a procedure leveraging clustering algorithms
in the NI-dimensional space, as explained in Section IV-B.
A. Optimal Individual IRS Configurations
In MIMO systems, both the gNB and the UEs adopt
properly tuned beamformers to match the signal transmissions
and receptions to the spatial direction providing the highest
channel gain [7]. For the optimization of the IRS configuration
of each individual UE, we adopt a procedure similar to that
presented in [32], focusing on single-stream transmissions and,
without loss of generality, on UE k.
For a given IRS configuration, the optimal beamform-
ing vectors vkandwkcoincide with the singular vectors
corresponding to the highest singular value of the wireless
channel matrix. In particular, we calculate the singular value
decomposition (SVD) of the overall cascade channel matrix
GkΦkH=UΣV†, (7)
where the right and left singular vectors of GkΦkHare the
columns of VandU, and the corresponding singular values
are the diagonal entries of Σ.
In our formulation, the IRS configuration Φkis one of the
optimization variables. Indeed, given vkandwk, we can solve
Φ∗
k= argmax
ΦkRk(Φk), (8a)
s.t.∠[Φk]n,n∈ Pθ, n = 1, . . . , N I, (8b)5
where Rkis the achievable capacity of UE k,1≤k≤K,
according to (3). By defining sk=vT
kGanduk=Hw k, the
signal power can be re-written as
|skΦkuk|2=NIX
n=1|[sk]n||[uk]n|ej(∠[sk]n+θn+∠[uk]n)2
.(9)
Then, it is sufficient to observe that the SNR is maximized
when the phase shifts introduced by the IRS are aligned with
the phase shifts accumulated along the various paths, i.e.,
θk,n=−(∠[sk]n+∠[uk]n),∀n. (10)
Taking into account the possible quantization, the optimal
phase shifts are given by
∠[Φ∗
k]n,n←argmin
ψ∈Pθ
∠ej(θk,n−ψ)
,∀n. (11)
Algorithm 1 Iterative Alternate IRS Optimization
Require: Gk,H
Ensure: Φ∗
k
1:t←0
2:vk,wk←1
3:repeat
4:sk←vT
kG,uk←Hw k
5:θk,n← −(∠[sk]n+∠[uk]n)
6:∠[Φk,t]n,n←argminψ∈Pθ(∠ej(θk,n−ψ))
7:U,Σ,V†←SVD of vT
kGkΦkHw k
8:vk←column of Vcorresponding to
the largest singular value
9:wk←column of Ucorresponding to
the largest singular value
10: t←t+ 1
11:until|Rk(Φk,t)−Rk(Φk,t−1)|< ν
12:Φ∗
k←Φk,t
To overcome the interdependence between optimal IRS con-
figurations and beamforming vectors, we propose an iterative
alternate optimization approach. We first estimate the optimal
beamforming vectors for a given IRS configuration using (7).
Then, we plug the derived beamformers into (8a), and obtain
the corresponding optimal IRS configuration. We repeat this
two-step procedure until convergence, which, for practical pur-
poses, is assumed to be reached when the difference between
the achievable rates Rk,∀k, in two consecutive iterations is
lower than a tolerance ν >0. This procedure is summarized
in Algorithm 1, where tis the iteration index. The number of
iterations grows with the numbers of antennas and IRS phase
shifters. However, from preliminary simulations, and based
on the set of parameters we considered (see Section VII),
convergence is typically reached in less than 10iterations.
B. Clustering-based TDMA Scheduling
For an approximated but close-to-optimal solution to (5), we
resort to a clustering-based approach. Our proposed clustering
algorithms estimate both the subsets of UEs U1, . . . ,UZ,
and the relative set of IRS configurations I. We operate onthephase vector space , i.e., the points to be clustered are
identified by the IRS phase shifts vector [∠ϕ1, . . . ,∠ϕNI]T=
[θ1, . . . , θ NI]T, which maps each IRS configuration Φto a
point in [−π, π)NI. In case of quantized phase shifts, the phase
vector space is a lattice in the continuous space [−π, π)NI.
The general clustering-based procedure works as follows:
•Step 1: findΦ∗
k,∀k, i.e., the optimal individual IRS
configurations for each UE as in Section IV-A;
•Step 2: build UE subsets Uz, z= 1, . . . , Z , by using a
clustering algorithm, according to Sections V and VI;
•Step 3: assign Φ(z)to all UEs ∈ Uz.
The core idea of this procedure is to use clustering algo-
rithms to group UEs, and assign the respective IRS config-
urations, which are mapped to the centroid of the cluster.
In the case of quantized phase shifts, once the clustering
procedure is performed, clusters may share the same centroid
and be merged. Therefore, Zrepresents the maximum number
of clusters , not the effective number. Moreover, we remark
that the procedure above does not rely on the assumption of
perfect CSI, as the grouping strategy (Step 2) and the individ-
ual optimization step (Step 1) are performed independently.
Nevertheless, in the case of imperfect CSI, the estimated
individual optimal configurations may differ from the actual
optimal configurations, leading to a sub-optimal grouping.
In the following, we propose different techniques to build
the clusters based on either a distance metric (Section V) or
the achievable rate (Section VI).
V. D ISTANCE -BASED CLUSTERING ALGORITHMS
The class of distance-based clustering contains methods that
group data points based on their similarity or dissimilarity
according to a distance metric. This approach has several
advantages, including the efficiency in handling large datasets,
and the flexibility to adapt to many different scenarios of
interest. However, distance-based clustering can be sensitive to
the choice of the distance metric (which depends on the nature
of the data and the clustering problem), and the initialization
values. Moreover, in our specific case, it does not take into
account the achievable rate, which is not directly related to
the distance among the points in the phase vector space.
Since the scalar field is the range [−π, π), the adopted
distance has to take into account the circularity of data.
However, the convergence to a local minimum for most of
the clustering algorithms is guaranteed only if the points to
be clustered belong to a Euclidean space. For distance-based
algorithms, we thus define the bijective mapping function
f:PNI
θ→R2NIas
f(θ) =f([θ1, . . . , θ NI])
= [cos( θ1),sin(θ1), . . . , cos(θNI),sin(θNI)],(12)
and then define the pairwise distance between two generic IRS
configurations αandβas
δ(α,β) =||f(α)−f(β)||, (13)
i.e., the Euclidean distance between the mapping on the unit
NI-sphere of their respective phase vectors. In the following,
with a slight abuse of notation, f(Φ)maps the phases of6
the complex entries in the diagonal of Φas in (12), and
δ(Φ1,Φ2)denotes the pairwise distance between the phases
of the elements in the diagonal of matrices Φ1andΦ2. The
sum of squared distances is defined as
J(U1, . . . ,UZ,I) =ZX
z=1X
k∈Uzδ
Φ∗
k,Φ(z)2
, (14)
and the distance-based clustering schemes are used to solve
the following problem:
min
U1,...,UZ,IJ(U1, . . . ,UZ,I), s.t. (5b) . (15)
We consider and compare some of the most popular
distance-based clustering algorithms, namely, K-means, ag-
glomerative hierarchical clustering, and K-medoids.
K-means. K-means (KM) clustering [39] aims at finding Z
disjoint clusters minimizing the within-cluster squared Eu-
clidean distances. Here, we consider the generalized Lloyd
algorithm [40], which randomly selects Zpoints in the space
of phase vectors as the initial centroids. In our setup, to ensure
optimal performance when Z=K, we force the algorithm
initialization to a random selection among the phase vectors
of the optimal individual IRS configurations derived in Sec-
tion IV-A. Then, in the assignment step KM assigns each data
point to the closest centroid, according to the specified distance
metric. In the subsequent update step , the set of centroids is
re-computed as the average of the data points that belong to
each cluster. These steps are repeated until either convergence
or a maximum number of iterations IKM
max is reached.
Agglomerative hierarchical clustering. The agglomerative hi-
erarchical clustering (HC) [41] partitions a set of data points
into disjoint clusters by iteratively merging points into clusters
until a target number of partitions is met. In our setup, clusters
are initialized as the optimal phase vectors, which thus act as
the respective centroids. Then, the average distance between
all pairs of data points in any pair of clusters is evaluated. The
closest pair of clusters are merged into a new single cluster,
whose centroid is computed as the mean of its data points.
The procedure is repeated until the number of clusters is Z.
K-medoids. K-medoids (KMed) [42] is a clustering technique
similar to KM, but instead of the mean of the data points
within each cluster, it uses the medoid, i.e., the data point that
is closest to the center of the cluster. In our setup, we consider
the partition around medoids (PAM) method [43], which starts
by randomly selecting Zmedoids among the optimal phase
vectors and assigns each point to the cluster with the closest
medoid. In each iteration, the algorithm evaluates potential
swaps of medoids with non-medoids. A swap is accepted only
if it results in a lower value of the sum of the squared distances
to all other data points within the same cluster. The algorithm
continues until the medoids no longer change.
Theorem 2. The proposed distance-based clustering tech-
niques converge to a local minimum of (14).
Proof for KM (LLoyd): In the assignment step, each
UEkis assigned to the cluster zthat minimizes the squared
distance δ 
Φ∗
k,Φ(z)2. This guarantees that the total sumJ(U1, . . . ,UZ,I)does not increase. Then, in the update step,
Φ(z)is recalculated as the average Φ∗
kwithin each cluster,
so as to minimize the intra-cluster sum of squared distancesP
k∈Uzδ 
Φ∗
k,Φ(z)2, for all z. Therefore, the conditions
of [44, Lemma 5] are satisfied, which ensures the convergence
to a local minimum.3
Proof for Agglomerative HC: At each step, clusters are
merged to minimize the increase of the total intra-cluster
sum of squared distances. This is equivalent to choosing
the merged cluster that results in the smallest increase of
J(U1, . . . ,UZ,I). Then, as in the update step of KM, the
average of the data points minimizesP
k∈Uzδ 
Φ∗
k,Φ(z)2,
for all z. Once the number of clusters Zreaches the desired
value, convergence to a local minimum is reached.
Proof for K-Medoids (PAM): Since, at each iteration,
a swap is performed only when it leads to a lower value
of the intra-cluster sum of squares, J(U1, . . . ,UZ,I)does
not increase over different iterations. Given the finite number
of data points and possible configurations, the algorithm is
guaranteed to converge to a configuration where no swap
can further decrease the objective function, thus reaching a
local minimum.
VI. C APACITY -BASED CLUSTERING ALGORITHMS
The distance-based clustering techniques presented in Sec-
tion V do not directly take into account the actual capacity
achievable by the UEs, which is a crucial factor for the sum
capacity maximization (5). Thus, in the following we propose
original capacity-based clustering algorithms that go beyond
the state of the art, namely CWC (Section VI-A), OSCBC
(Section VI-B), and ICWC (Section VI-C).
A. Capacity-Weighted Clustering (CWC)
Similarly to distance-based clustering, also CWC proceeds
iteratively. However, the stopping condition is based on the
variation of the sum capacity of each cluster, rather than on the
distance between the centroids. In this approach, the clustering
algorithm itself weighs the UEs based on their achievable
capacity, so that the parameters of the resulting clusters are
closer to those preferred by the UEs with higher rates, thus
promoting the maximization of the sum capacity.
LetΦ(z)
ibe the IRS configuration of cluster Uz,iat iteration
i. UEs are initially sorted in decreasing order of achievable
rate. The algorithm then selects the ZUEs providing the
highest achievable capacity based on the expression in (3) with
their optimal IRS configurations. Without loss of generality,
we let z= 1, . . . , Z be the index of those UEs, and set
Φ(z)
1=Φ∗
z,∀1≤z≤Z, as the centroids of the initial clus-
tersU1,0, . . . ,UZ,0. In the following, for simplicity, we denote
with zk,ithe cluster such that k∈ Uz,i. Each UE k > Z is
assigned to the cluster whose centroid provides the lowest rate
difference with respect to its ideal configuration. Let Rk(Φ∗
k)
3Notice that [44] does not specify the number of iterations needed to reach
convergence, which could be large in the case of highly dimensional spaces.
Therefore, in practice, we limit the maximum number of iterations to IKM
max.7
be the maximum achievable rate of UE k, obtained from the
solution of problem (1). UE kis assigned to cluster
zk,i= argmin
z[Rk(Φ∗
k)−Rk(Φ(z)
i)], (16)
where Rk(Φ(z)
i)is the rate achieved by UE kadopting the IRS
configuration of cluster zat iteration i. Note that, despite being
always non-negative, the rate difference in (16) cannot be
considered a distance metric as, in general, it does not satisfy
the triangle inequality. However, we prove that, as the distance
from the optimal configuration increases, the corresponding
rate decreases, thus supporting the use of the rate difference
as a clustering criterion.
Theorem 3. Given the optimal IRS configuration Φ∗
k, the
rateRk(Φ)is monotonically decreasing with respect to the
magnitude of any phase shifts error ϵ.
Proof: Letϵ∈[−π, π]be an arbitrary error phase shift,
and consider the configuration Φϵ
k=Φ∗
kE, where E=
diag( ejϵ,1, . . . , 1), i.e., the sub-optimal configuration where
only the first IRS element is affected by the error ϵ. Assuming,
without loss of generality, that Ng=Nk= 1 andσx=σn=
1, the rate Rk(Φϵ
k)is proportional to Γk(Φϵ
k)when using
configuration Φϵ
k. The SNR Γk(Φϵ
k)can be written as
Γk(Φϵ
k) =|gkΦ∗
kEh|2(17)
=|[gk]1[Φ∗
kE]1,1[h]1+A|2, (18)
where A=PNI
n=2[gk]n[Φ∗
k]n,n[h]n. Since Φ∗
kis the optimal
configuration, it satisfies (10). It follows that A∈R+, so (17)
can be further manipulated into
Γk(Φϵ
k) =||[gk]1||[h]1|ejϵ+A|2(19)
=A2+ (|[gk]1||[h]1|)2+ 2A|[gk]1||[h]1|cos(ϵ).(20)
Finally, we evaluate the sign of the derivative of Γk(Φϵ
k)with
respect to the error ϵas
∂Γk(Φϵ
k)
∂ϵ=−2A|[gk]1||[h]1|sin(ϵ), (21)
and observe that Γk(Φϵ
k), and therefore Rk(Φϵ
k), is strictly
decreasing for 0<|ϵ| ≤π.
After all the remaining UEs have been assigned to the corre-
sponding clusters, the coordinates of the centroids are updated.
At iteration i+ 1, the new IRS configuration (centroid) of
cluster Uz,i+1is computed as the average of the data points
in the cluster, weighted by their achievable rate, i.e.,
Φ(z)
i+1=f−1 P
k∈Uzf(Φ∗
k)Rk(Φ∗
k)P
k∈UzRk(Φ∗
k)!
. (22)
Also, in the case of phase shift quantization, an additional
approximation step must be performed as
∠[Φ(z)
i+1]n,n←argmin
ψ∈Pθ
∠ej(∠[Φ(z)
i+1]n,n−ψ)
,∀n. (23)
This two-step procedure is repeated until convergence, which
is reached when the rate difference between two consecutive
iterations is lower than the sum capacity tolerance µ >0.
The rationale behind the algorithm is that, based on the
initial centroid assignment, the UEs experiencing the bestAlgorithm 2 CWC Algorithm
Require: Z,H,Gk,∀k
Ensure: U1, . . . ,UZ,I
1:Compute Φ∗
k,∀kwith the procedure of Algorithm 1
2:Sort the UEs in decreasing order of Rk(Φ∗
k)
3:Select the ZUEs providing the highest Rk(Φ∗
k),
4:SetΦ(z)
1=Φ∗
k,z= 1, . . . , Z as the initial centroids.
5:repeat
6: foreach UE kdo
7: zk,i←argminzRk(Φ∗
k)−Rk(Φ(z)
i)
8: end for
9: foreach cluster zdo
10: Compute Φ(z)
i+1as per (22), (23)
11: end for
12: i←i+ 1
13:untilP
k∈UzRk(Φ(z)
i)−P
k∈UzRk(Φ(z)
i−1)< µ
14:Assign Φ(z)to all k∈ Uz.
channel conditions, i.e., those dominating the system sum
capacity, are initially served with their optimal (individual)
IRS configurations. Even after the adjustment of the clusters,
these UEs will always get the largest weight coefficient within
the cluster. The remaining UEs, instead, will be penalized
by the configuration constraints, but their impact on the sum
capacity will be limited. The whole workflow of the CWC
procedure is summarized in Algorithm 2.
B. One-Shot Capacity-Based Clustering (OSCBC)
The main drawback of CWC presented in Section VI-A is
that it requires solving problem (16) at each iteration, relative
to all the UEs in each cluster. Considering massive MIMO
systems, the CWC procedure could become exceedingly com-
plex, as it requires the SVD computation of extremely large
matrices. Therefore, we propose another lower-complexity
clustering algorithm, denoted as OSCBC.
As in CWC, also in OSCBC: ( i) the UEs are sorted in
decreasing order of achievable rate; ( ii) the ZIRS configura-
tions of the ZUEs experiencing the highest rates are chosen
as initial centroids for the clusters; and ( iii) the remaining
UEs are assigned to the closest centroid in terms of circular
distance, as per (13). Then, compared to CWC, instead of
recomputing the coordinates of the centroids at each iteration
until convergence, the algorithm stops right after the initial
association. Therefore, with OSCBC the computed centroids
are the optimal configurations relative to the ZUEs achieving
the highest individual rate, which provides sub-optimal (non-
optimized) performance for the rest of the UEs in the clusters.
C. Inverse Capacity-Weighted Clustering (ICWC)
The CWC algorithm is designed to optimize the capacity of
the UEs experiencing the best channel conditions and is unfair
to the other UEs in the system, which may use sub-optimal IRS
configurations. Therefore, we propose an additional variation8
TABLE I
COMPUTATIONAL COMPLEXITY OF DISTANCE -BASED VS .
CAPACITY -BASED CLUSTERING .
Clustering algorithm Computational complexity
KM (Lloyd) O(IZKN I)
KMed (PAM) O(Z3K2NI)
HC O(K3NI)
CWC/ICWC O(IZKN gN2
I)
OSCBC O(Z(K−Z)NI)
of CWC, named ICWC, with the goal of achieving higher
fairness among the UEs in the system. In ICWC, while the
cluster association principle of (16) is preserved, the initial
condition is reversed. Specifically: ( i) UEs are sorted in in-
creasing order of achievable rate; ( ii) the initial configurations
of the clusters Φ(z)
1=Φ∗
z,z= 1, . . . , Z , are based on the
optimal configurations of the UEs with the worst channel
conditions. The remaining k > Z UEs are associated as in
(16). Then, at iteration i, the IRS configuration is updated as
Φ(z)
i+1=f−1 P
k∈UzΦ∗
kR−1
k(Φ∗
k)
P
k∈UzR−1
k(Φ∗
k)!
, (24)
and the discretization step (23) is performed (if needed). As in
CWC, convergence is achieved if the rate difference between
two consecutive iterations is lower than the tolerance µ. While
ICWC obtains lower sum capacity than CWC, it can provide
significant improvements in terms of fairness, especially from
the perspective of the UEs with the worst channel conditions.
D. Computational Complexity
The computational complexity is evaluated as the number of
iterations required for the clustering algorithms to: ( i) obtain
the optimal IRS configuration of each UE; ( ii) partition the
UEs into disjoint subsets, or clusters, based on distance or
capacity metrics; and ( iii) for each cluster, find the best IRS
configuration to serve the corresponding UEs. Specifically, at
each iteration, the main source of complexity is the compu-
tation of the overall cascade channel matrix GkΦkH, which
has complexity O 
NgN2
I+NgNINU
. Additionally, in the
case of quantized IRS phase shifts, after obtaining the optimal
beamformers, the optimal phase shifts for the IRS are obtained
through an exhaustive search over the set of possible phase
shiftsPθ, yielding a complexity O(2bNI).
Notice that different clustering algorithms, in general, re-
quire a different number of iterations Ito reach convergence,
thus possibly introducing practical limitations. Moreover, the
complexity introduced in each iteration depends on the clus-
tering algorithm itself. In Table I and in the following text
we characterize the computational complexity of each of the
clustering algorithms presented in Sections V and VI.
Distance-based clustering. These algorithms do not require
specific initialization. For KM, based on the Lloyd implemen-
tation in [40], each iteration involves calculating the distances
between data points and centroids. As a result, the computa-
tional complexity is influenced by the number of iterationsrequired for convergence, the number of data points, the
number of clusters, and the dimensionality of data, resulting
in an overall complexity O(IZKN I). KMed can be solved
with the PAM algorithm [43], so the computational complexity
isO(Z3K2NI)due to the pairwise distance computations
between data points and medoids. Finally, the computational
complexity of the agglomerate HC is primarily determined by
the computation of pairwise distances among all data points,
resulting in a total complexity O(K3NI)[45].
Capacity-based clustering. The complexity of the OSCBC
algorithm is dominated by the centroid assignment upon
initialization, which has complexity O 
Z(K−Z)NI
. In-
stead, for the CWC and ICWC algorithms, the complexity
isO(IZKN gN2
I), as demonstrated in the following theorem.
Theorem 4. The time complexity of CWC and ICWC scales
quadratically with NIasO(IZKN gN2
I).
Proof: Capacity-based clustering requires an initialization
stage where the algorithm selects the ZUEs providing the
highest (or lowest) Rk 
Φ∗
k
, resulting in a complexity of
O(KlogK)due to the sorting of Kscalars. In the subsequent
iterations:
1) Both CWC and ICWC compute the rate difference be-
tween each UE and the Zcentroids. The complexity
of computing Rk(Φ(z)
i)can be dominated either by the
matrix multiplication in (2), or by the SVD for the
single stream beamforming which require, respectively,
O 
NgN2
I+NgNINU
and O 
NgNUmin(Ng, NU)
operations for each UE and each centroid.
2) The computation of the centroids as per (22)-(24) requires
NI+ 1 scalar operations per UE, which has negligible
complexity with respect to the rate computation.
In typical IRS-assisted systems, NI≫Ng> N U. Therefore,
the complexity at each iteration is dominated by the chan-
nel matrix product, and the overall algorithm complexity is
O(IZKN gN2
I).
VII. N UMERICAL RESULTS
After presenting our various simulation scenarios and eval-
uation metrics in Sections VII-A and VII-B, respectively, we
assess in Section VII-C the scheduling performance of an IRS-
assisted network with practical constraints.
A. Simulation Parameters
Our simulation parameters are reported in Table II.
Scenario. All devices are assumed to lie on a 2D plane, and we
consider an urban micro-cell (UMi) scenario, according to the
3GPP nomenclature [46], with the gNB placed at the center.
According to the 3GPP specifications, the coverage area of the
gNB is characterized by an average radius of 167 m and is
assumed to lie in the positive x-axis region.
We assume that K= 100 UEs are randomly deployed
according to a uniform distribution within the cell area, to be
served in downlink by the gNB, assisted by an IRS at coordi-
nates (75,100) m. The gNB is equipped with a uniform planar
array (UPA) with 8H×8V antennas (i.e., Ng= 64 ), and the9
TABLE II
SIMULATION PARAMETERS .
Parameter Value
Carrier frequency 28GHz
Total bandwidth ( B) 100 MHz
Noise power spectral density −174 dBm/Hz
Number of UEs ( K) 100
gNB antenna array ( Ng) 8H×8V
gNB transmit power 33dBm
UE antenna array ( NU) 2H×1V
IRS elements ( NI){10H×20V ,20H×40V ,
40H×80V ,60H×120V}
Phase shift quant. bits ( b) {unquantized, 1-bit, 2-bits}
LoS probability ( pLoS) Eq. (26)
Individual rate opt. tolerance ( ν) 10−6[bit/s/Hz]
KM max. iterations ( IKM
max) 50
CWC/ICWC rate tolerance ( µ) 10−3[bit/s]
UEs with uniform linear arrays (ULAs) of 2H×1V antennas
(i.e., NU= 2). For the IRS, if not otherwise specified, we
adopt a 40H×80V reflective panel ( NI= 3200 ).
Channel and Frame Structure. The system operates at a
carrier frequency of 28GHz (that is in the lower part of the
mmWave bands), the transmission power at the gNB is set to
33dBm, the noise power spectral density at the receivers is
−174dBm/Hz, and the total system bandwidth is 100MHz.
We consider the fourth numerology of the NR frame structure
[47], wherein each 10ms frame is split into 160 slots. With
this assumption, as already pointed out in Section II, channels
can be considered constant over the entire frame duration. We
consider the 3GPP TR 38.901 spatial channel model [46],
which supports a wide range of frequencies, from 0.5to
100 GHz (and including therefore our carrier frequency of
28GHz), and can be integrated with realistic beamforming
models. As such, channel matrices, and multipath fading, are
computed based on the superposition of Ndifferent clusters,
each of which consists of Mrays that arrive (depart) to
(from) the antenna arrays with specific angles and powers.
Based on [46], and using the simplifications proposed in [48],
the generic entry [A]pqof the channel matrix can then be
computed as:
[A]pq=γNX
n=1r
Pn
MMX
m=1Frx 
θA
n,m, ϕA
n,m
×
ejΦθ,θ
n,mq
K−1n,mejΦθ,ϕ
n,m
q
K−1n,mejΦϕ,θ
n,m ejΦϕ,ϕ
n,m

×Ftx 
θD
n,m, ϕD
n,m
×ejkT
rx,n,m drx,pejkT
tx,n,mdtx,q,(25)
where γis the large-scale fading coefficient (LSFC) of the
considered link, which incorporates the path loss and shad-
owing terms. For a complete description of the remaining
terms appearing in (25) we refer the interested reader to [48].
Specifically, while the gNB and the IRS can be assumed to
operate in line-of-sight (LoS), the path loss between a genericUEkand the IRS is modeled based on the following channel
conditions:
•non-line-of-sight (NLoS) : UE kis in NLoS with the IRS;
•deterministic LoS (LoS) : UE kis in LoS with the IRS;
•probabilistic LoS (LoS) : the IRS-UE klink is in LoS ∨NLoS
with respective probabilities pLoS
k(dk)∨1−pLoS
k(dk), with
pLoS
k(dk) =(
1 ifdk≤18,
18
dk+
1−18
dk
e−dk
36 ifdk>18,(26)
where dkis the distance (in m) between the IRS and UE
k. In the considered UMi scenario, and based on 3GPP
specifications [46], the average LoS probability in (26) is 0.35.
For each wireless link, based on the presence of the
LoS component, the path loss is then derived according to
[46, Table 7.4.1-1], with shadowing standard deviation set
toσSF= 0. For the optimal individual IRS configuration
(Section IV-A), we set ν= 10−6[bit/s/Hz].
Clustering algorithms. In the following subsections, we
present extensive simulation results to compare the perfor-
mance of distance-based (KM, HC, KMed) vs. capacity-based
(CWC, OSCBC, ICWC) clustering algorithms to perform
scheduling in an IRS system with reconfiguration constraints.
The KM clustering has been implemented with the Lloyd algo-
rithm [40] with a maximum number of IKM
max= 50 iterations.
Instead, for both CWC and ICWC, we set µ= 10−3[bit/s].
As an upper bound to the system performance, we also
consider an “unclustered” scheduling, wherein we assume that
all UEs are served with their optimal IRS configuration. This
scheduling clearly violates the constraint on the maximum
numbers of reconfiguration per frame, but can be regarded as
the limit case when Z=K, i.e., all UEs belong to a cluster
with cardinality one. As such, it is a suitable approach for
benchmarking the performance of more practical schemes.
B. Performance Metrics
The performance of the proposed clustering-based schedul-
ing techniques is evaluated in terms of average sum capacity
and fairness, as a function of the numbers of both clusters and
UEs, under different channel conditions, IRS dimensions, and
degrees of quantization for the phase shifts.
Average sum capacity. It is derived from (4) as
¯C=1
KE[C(U1, . . . ,UZ,I)], (27)
where the expectation is computed across the different channel
realizations. Moreover, as each UE is served in its specific
slot, we average over the TDMA frame length, dividing the
empirical expectation by the number of UEs (slots) K.
Fairness. We consider the 95% percentile of the achieved
individual user capacity, computed as
C95%=B
Kinf{x: CDF( x)≥0.95}, (28)
where CDF(·)is the empirical cumulative distribution func-
tion of Rk(Φ(z)),∀k, z. Notice that the 95% percentile of the
user capacity is a practical and meaningful way to evaluate
fairness, as it measures the performance of the majority of the
UEs, excluding only the top 5%.10
1 10 20 30 40 50 60 70 80 90 1000100200300
Maximum number of clusters ZAverage sum capacity ¯C[Mbit/s]
KMed
KM
HC
Unclustered
CWC
ICWC
OSCBC
Fig. 2. Average sum capacity as a function of the maximum number of
clusters Z, for an unquantized 40H×80V IRS, and considering a pLoS
channel for the IRS-UEs links.
C. Scheduling Performance
In this section, we compare the IRS scheduling performance
considering distance-based vs. capacity-based clustering, and
as a function of different channel conditions, reconfiguration
constraints, and degrees of quantization of the phase shifts.
Impact of the clustering algorithm. First, Fig. 2 displays the
average sum capacity ¯Cper slot as a function of the number of
clusters Z, for unquantized IRS phase shifts, and considering
a pLoS channel for the IRS-UEs links. It is evident that all the
scheduling policies perform better whenever Zincreases, and
converge to the “unclustered” policy when Z=K. In fact, in-
creasing the number of clusters corresponds to a smaller intra-
cluster average distance, which eventually becomes zero when
Z=K. Among the considered clustering policies, CWC
and OSCBC provide the highest sum capacity, as they are
designed to maximize ¯C, and choose the IRS configurations
of the UEs that achieve the highest rate. Instead, distance-
based clustering achieves worse performance as it does not
exploit the knowledge of the rate achievable with different IRS
configurations when building the clusters. As expected, ICWC
is designed to promote fairness, thus underperforms both
CWC and OSCBC in terms of sum capacity; still, it achieves
similar performance as distance-based clustering. Finally, the
gap between CWC and OSCBC is almost negligible: this
implies that a single iteration in the clustering process is
enough to achieve good sum capacity, while also promoting
lower computational complexity as reported in Table I, which
demonstrates the good scalability of the proposed techniques.
Fig. 3 compares the fairness performance of the different
clustering algorithms, measured as the 95% percentile of the
average sum capacity C95%, as a function of the maximum
number of clusters Zin pLoS conditions. Our results identify
ICWC as the best clustering approach in terms of fairness,
which comes at the cost of a lower sum capacity, as shown
in Fig. 2. Therefore, there exists a trade-off between the
achievable sum capacity and fairness. We also observe that
OSCBC achieves very low fairness, as the UEs with worst
channel conditions are forced to aggregate to the strongest
UEs, thus via a sub-optimal IRS configuration. On the other
hand, we see that CWC is more than acceptable in terms of1 10 20 30 40 50 60 70 80 90 10000.10.20.30.4
Maximum number of clusters ZC95% [Mbit/s]KMed
KM
HC
Unclustered
CWC
ICWC
OSCBC
Fig. 3. 95% percentile of the user capacity as a function of the maximum
number of clusters Z, for an unquantized 40H×80V IRS, and considering a
pLoS channel for the IRS-UEs links.
1 10 20 30 40 50 60 70 80 90 1000200400600800
Maximum number of clusters ZAverage sum capacity ¯C[Mbit/s]
CWC ICWC OSCBC
pLoS NLoS dLoS
Fig. 4. Average sum capacity as a function of the maximum number of
clusters Z, forNI= 3200 , unquantized phase shifts, and for different channel
conditions.
fairness, and achieves comparable performance than most of
the distance-based clustering algorithms. Finally, notice that
C95%increases as Zincreases, and eventually approaches the
“unclustered” baseline for Z=K. This is due to the fact that
the LoS probability in the pLoS scenario increases with the
number of clusters, i.e., as the inter-cluster distance becomes
smaller, which permits to experience better channel conditions,
thus a higher capacity, even for the worst UEs.
Impact of the channel. From the above results, we concluded
that distance-based clustering provides lower sum capacity
and fairness compared to capacity-based scheduling, so the
rest of our simulation campaign has been focused on the
latter. Figs. 4 and 5 display the average sum capacity and the
95% percentile, respectively, for CWC, ICWC, and OSCBC
in different channel conditions. First, we observe that in the
dLoS scenario, where UEs are in LoS with the IRS, the sum
capacity is up to 2.6 (2.4) times higher than in the NLoS
(pLoS) scenario for Z=K. This is mainly due to the fact
that NLoS links experience ( i) a higher path loss, and ( ii) the
lack of a dominant multipath component, thus of a clear
steering direction for the IRS beam, which deteriorates the link
quality. In particular, in the pLoS scenario the LoS probability
decreases exponentially with the distance, therefore, the UEs11
1 10 20 30 40 50 60 70 80 90 1000246
Maximum number of clusters ZC95% [Mbit/s]
CWC ICWC OSCBC
pLoS NLoS dLoS50 60 70 80 900.020.060.1
Fig. 5. 95% percentile of the user capacity as a function of the maximum
number of clusters Z, forNI= 3200 , unquantized phase shifts, and for
different channel conditions. The zoom inside the figure is for 50≤Z≤90.
10H×20V 20H×40V 40H×80V 60H×120V0200400
IRS elementsAverage sum capacity ¯C[s]Unclustered
CWC
ICWC
Z= 20
Z= 50
Z= 80
Fig. 6. Average sum capacity for CWC and ICWC as a function of the
number of reflecting elements at the IRS, for unquantized phase shifts, and
considering a pLoS channel for the IRS-UEs links.
that are far from the IRS typically operate in NLoS. For similar
reasons, both CWC and ICWC in the dLoS scenario start to
reach stability in terms of capacity with a relatively lower
number of clusters than in the pLoS and NLoS scenarios.
As expected, OSCBC performs worse than its competitors,
and the gap is even more significant in the dLoS scenario
(around −30% in terms of sum capacity). The bad perfor-
mance of OSCBC compared to CWC and ICWC is confirmed
also in terms of fairness, as illustrated in Fig. 5 (see, in
particular, the zoom for 50≤Z≤90).
Finally, even though ICWC is not explicitly designed to
maximize the sum capacity, it shows similar performance (if
not even slightly better) as CWC in the dLoS scenario. The
rationale behind this behavior is not clear and deserves more
investigation. Most likely, it is related to the fact that, in the
dLoS scenario, all UEs have similar channel conditions, which
permits ICWC to choose, on average, a good IRS configuration
even among the worst UEs in the clusters.
Impact of the IRS configuration. Figs. 6 and 7 show the
impact of the number of IRS radiating elements on the system
performance when considering the CWC and ICWC clustering
algorithms. As expected, both fairness (measured in terms of10H×20V 20H×40V 40H×80V 60H×120V00.511.5
IRS elementsC95% [Mbit/slot]
10H×20V 20H×40V1234·10−2·10−2·10−2Unclustered CWC ICWC
Z= 20 Z= 50 Z= 80
Fig. 7. 95% percentile of the user capacity for CWC and ICWC as a function
of the number of reflecting elements at the IRS, for unquantized phase shifts,
and considering a pLoS channel for the IRS-UEs links. The zoom inside the
figure is for NI= 200 andNI= 800 .
1 10 20 30 40 50 60 70 80 90 1000100200300
Maximum number of clusters ZAverage sum capacity ¯C[Mbit/s]
CWC Unquantized
ICWC 1-bit quantized
Unclustered 2-bits quantized
Fig. 8. Average sum capacity as a function of the maximum number of
clusters Z, forNI= 3200 and for different degrees of quantization of the
phase shifts, and considering a pLoS channel for the IRS-UEs links.
the95% percentile of the average sum capacity) and sum
capacity increase as the IRS is larger and operates with more
reflecting elements, regardless of the number of clusters. For
example, we observe that CWC is able to approach the optimal
sum capacity with as few as 20clusters for small-sized IRS,
i.e., with 10H×20V or 20H×40V arrays. The same trends are
shown also in Fig. 7 in terms of fairness. Still, notice that ¯Cis
below 100 Mbps, which is not compatible with the requirement
of most 5G applications when the IRS is made of fewer than
200 elements, which justifies the use of larger IRS panels [12].
Nevertheless, we still observe that the number of reflecting
elements has an impact on the number of clusters that are
needed to provide maximum performance. Indeed, the num-
ber of possible IRS configurations increases as we consider
larger IRS antennas. In turn, this decreases the likelihood of
UEs having the same (or similar) ideal configurations, and
therefore, it increases the probability of being associated with
increasingly sub-optimal centroids if the number of clusters
is small. However, if the number of phase shifters is large,
the sub-optimality is mitigated by the increasing number of
reconfigurations.12
1 10 20 30 40 50 60 70 80 90 1000.10.20.30.4
Maximum number of clusters ZC95% [Mbit/s]CWC Unquantized
ICWC 1-bit quantized
Unclustered 2-bits quantized
Fig. 9. 95% percentile of the user capacity as a function of the maximum
number of clusters Z, forNI= 3200 and for different degrees of quantization
of the phase shifts, and considering a pLoS channel for the IRS-UEs links.
Impact of quantization. Figs. 8 and 9 display the average sum
capacity and the 95% percentile, respectively, as a function
of the maximum number of clusters Zfor CWC and ICWC,
and of the number of quantization bits bof the phase shifts.
Notice that energy and hardware constraints pose a limit to
b[49], which implies restricting the infinite set of possible IRS
configurations to a finite set of cardinality 2bNI. Moreover, the
quantization constraint affects the beamforming capabilities
of the IRS [10], with negative implications for the resulting
achievable sum capacity. In [1], results were obtained consid-
ering that the quantization was performed only at the end of
the clustering procedure. Here, instead, we assume that the
quantization of the phase shifts is taken into account from the
initial optimization stage. The results reveal that the use of
non-ideal phase shifters leads to a 30% degradation in the sum
capacity when using b= 1 at the IRS, while the performance
is close to the unquantized baseline if more quantization
bits are used. Furthermore, it is shown that the gap between
quantized and the unquantized performance increases with Z.
As a result, 1-bit quantization is sufficient to guarantee a
performance comparable to the unquantized case with a small
number of clusters, while more quantization bits are needed
to achieve higher capacity. In any case, we can conclude that
our proposed capacity-based clustering algorithms are robust
to phase-shift quantization.
Scalability. Finally, we prove the scalability performance of
the proposed clustering algorithms. To do so, we first show
the performance of capacity-based clustering as a function
of the number of UEs in Figs 10 and 11. In particular, we
compare CWC and ICWC with HC as a function of the ratio
K/N , for an unquantized 40H×80V IRS, K={50,100,150}
UEs, and considering a pLoS channel for the IRS-UEs links.
The results are in line with the plots in Figs 2 and 3,
which demonstrates the scalability of the proposed clustering
techniques for different numbers of UEs. Finally, Fig. 12
depicts the average minimum number of IRS configurations
Zmin needed to achieve 80% of the maximum achievable
sum capacity (“unclustered” baseline) as a function of the
number of UEs Kin the system. Notably, we observe that
CWC and OSCBC are confirmed to be the best algorithms0.10.20.30.40.50.60.70.80.9 124·104
Z/KSum capacity K¯C[Mbit/s]HC K= 50
CWC K= 100
ICWC K= 150
Fig. 10. Sum capacity as a function of the maximum number of clusters
over the number of UEs Z/K , for different values fo K, for an unquantized
40H×80V IRS, K={50,100,150}, and considering a pLoS channel for
the IRS-UEs links. For readability, the results are shown without averaging
over the TDMA frame length.
0.10.20.30.40.50.60.70.80.9 100.20.40.60.8
Z/KC95% [Mbit/s]HC K= 50
CWC K= 100
ICWC K= 150
Fig. 11. 95% of the user capacity as a function of the maximum number
of clusters over the number of UEs Z/K , for different values of K, for an
unquantized 40H×80V IRS, K={50,100,150}UEs, and considering a
pLoS channel for the IRS-UEs links.
to optimize the sum capacity, even for a limited number of
IRS configurations. For example, both solutions achieve 80%
of the maximum sum capacity with less than half the number
of configurations than in the “unclustered” deployment. More-
over, we recognize the same trends as in the previous results.
Specifically, capacity-based clustering outperforms distance-
based clustering and requires fewer IRS reconfigurations to
maximize the sum capacity (up to −37% considering CWC
vs. KMed). Furthermore, the gap increases as the number of
UEs increases.
VIII. C ONCLUSIONS
We considered a MIMO cellular network, in which a gNB
serving multiple UEs is assisted by an IRS acting as a relay.
Notably, we considered practical constraints on the IRS recon-
figuration period. We studied a TDMA scheduling for down-
link transmissions, and formulated an optimization problem to
maximize the average sum capacity, subject to a fixed number
of IRS reconfigurations per time frame. We first discussed13
20 40 60 80 100 120 140 1601020406080100120
Number of UEs KMin. number of IRS configurations ZminKMed
KM
HC
CWC
ICWC
OSCBC
Fig. 12. Minimum number of IRS configurations (clusters) Zmin to achieve
80% of the maximum achievable sum capacity, for an unquantized 40H×80V
IRS, and considering a pLoS channel for the IRS-UEs links.
an iterative algorithm to obtain the optimal IRS configuration
of each UE. Then, we proposed clustering-based scheduling
algorithms, which group UEs with similar (ideal) IRS config-
urations based on either a distance metric or the achievable
capacity, to mitigate the performance degradation due to the
constraint in the number of possible reconfigurations. Different
clustering algorithms were numerically evaluated in terms of
computational complexity, sum capacity, and fairness under
different channel conditions, as a function of the size of
the IRS size and the number of users, and with or without
quantization of phase shifts. The results showed that capacity-
based clustering outperforms distance-based clustering, and
can achieve up to 85% of the sum capacity obtained in an ideal
deployment (with no reconfiguration constraints), reducing by
50% the number of IRS reconfigurations.
REFERENCES
[1] A. Rech et al. , “Downlink TDMA scheduling for IRS-aided commu-
nications with block-static constraints,” in Proc. IEEE WCNC Wkshps ,
2023.
[2] 3GPP, “5G; NR; Base Station (BS) radio transmission and reception,”
TS 38.104 (Rel. 16), 2022.
[3] F. Tariq, M. R. Khandaker, K.-K. Wong, M. A. Imran, M. Bennis, and
M. Debbah, “A speculative study on 6G,” IEEE Wireless Commun. ,
vol. 27, no. 4, pp. 118–125, Aug. 2020.
[4] S. Rangan, T. S. Rappaport, and E. Erkip, “Millimeter-wave cellular
wireless networks: Potentials and challenges,” Proc. IEEE , vol. 102,
no. 3, pp. 366–385, Mar. 2014.
[5] 3GPP, “5G; NR; integrated access and backhaul (IAB) radio transmis-
sion and reception,” TS 38.174 (Rel. 17), 2022.
[6] M. Polese et al. , “Integrated access and backhaul in 5G mmWave
networks: Potential and challenges,” IEEE Commun. Mag. , vol. 58, no. 3,
pp. 62–68, Mar. 2020.
[7] R. Flamini et al. , “Towards a heterogeneous smart electromagnetic envi-
ronment for millimeter-wave communications: An industrial viewpoint,”
IEEE Trans. Antennas Propag. , vol. 70, no. 10, pp. 8898–8910, Oct.
2022.
[8] E. Björnson, Ö. Özdogan, and E. G. Larsson, “Intelligent reflecting
surface versus decode-and-forward: How large surfaces are needed to
beat relaying?” IEEE Commun. Lett. , vol. 9, no. 2, pp. 244–248, Feb.
2020.
[9] Q. Wu and R. Zhang, “Towards smart and reconfigurable environment:
Intelligent reflecting surface aided wireless network,” IEEE Commun.
Mag. , vol. 58, no. 1, pp. 106–112, Jan. 2020.
[10] S. Abeywickrama, R. Zhang, Q. Wu, and C. Yuen, “Intelligent reflecting
surface: Practical phase shift model and beamforming optimization,”
IEEE Trans. Commun. , vol. 68, no. 9, pp. 5849–5863, Sep. 2020.[11] Q. Wu and R. Zhang, “Intelligent reflecting surface enhanced wireless
network via joint active and passive beamforming,” IEEE Trans. Wireless
Commun. , vol. 18, no. 11, pp. 5394–5409, Nov. 2019.
[12] M. Pagin et al. , “End-to-end simulation of 5G networks assisted by IRS
and AF relays,” in Proc. IEEE MedComNet , 2022.
[13] R. Liu, Q. Wu, M. Di Renzo, and Y . Yuan, “A path to smart radio
environments: An industrial viewpoint on reconfigurable intelligent
surfaces,” IEEE Wireless Commun. , vol. 29, no. 1, pp. 202–208, Jan.
2022.
[14] C. Liaskos, S. Nie, A. Tsioliaridou, A. Pitsillides, S. Ioannidis, and
I. Akyildiz, “Realizing wireless communication through software-
defined hypersurface environments,” in Proc. IEEE WoWMoM , 2018.
[15] Y . Yang, S. Zhang, and R. Zhang, “IRS-enhanced OFDMA: Joint re-
source allocation and passive beamforming optimization,” IEEE Wireless
Commun. Lett. , vol. 9, no. 6, pp. 760–764, Jun. 2020.
[16] J. Lee, J. Choi, and J. Kang, “Harmony search-based optimization
for multi-RISs MU-MISO OFDMA systems,” IEEE Wireless Commun.
Lett., vol. 12, no. 2, pp. 257–261, Feb. 2023.
[17] Y . Guo, Z. Qin, Y . Liu, and N. Al-Dhahir, “Intelligent reflecting surface
aided multiple access over fading channels,” IEEE Trans. Commun. ,
vol. 69, no. 3, pp. 2015–2027, Mar. 2021.
[18] D. Zhang, Q. Wu, M. Cui, G. Zhang, and D. Niyato, “Throughput
maximization for IRS-assisted wireless powered hybrid NOMA and
TDMA,” IEEE Wireless Commun. Lett. , vol. 10, no. 9, pp. 1944–1948,
Sep. 2021.
[19] H. Al-Obiedollah, H. A. B. Salameh, K. Cumanan, Z. Ding, and
O. A. Dobre, “Self-sustainable multi-IRS-aided wireless powered hybrid
TDMA-NOMA system,” IEEE Access , vol. 11, pp. 57 428–57 436, Jun.
2023.
[20] Z. Zhang, T. Jiang, and W. Yu, “Learning based user scheduling in
reconfigurable intelligent surface assisted multiuser downlink,” IEEE J.
Sel. Topics Signal Process. , vol. 16, no. 5, pp. 1026–1039, May 2022.
[21] A. Bansal, K. Singh, B. Clerckx, C.-P. Li, and M.-S. Alouini, “Rate-
splitting multiple access for intelligent reflecting surface aided multi-
user communications,” IEEE Trans. Veh. Technol. , vol. 70, no. 9, pp.
9217–9229, Sep. 2021.
[22] H. Fu, S. Feng, and D. W. Kwan Ng, “Resource allocation design for
IRS-aided downlink MU-MISO RSMA systems,” in Proc. IEEE ICC
Wkshps , 2021.
[23] B. Zhuo et al. , “Partial non-orthogonal multiple access: A new perspec-
tive for RIS-aided downlink,” IEEE Wireless Commun. Lett. , vol. 11,
no. 11, pp. 2395–2399, Nov. 2022.
[24] S. Hu, Z. Wei, Y . Cai, C. Liu, D. W. K. Ng, and J. Yuan, “Robust and
secure sum-rate maximization for multiuser MISO downlink systems
with self-sustainable IRS,” IEEE Trans. Commun. , vol. 69, no. 10, pp.
7032–7049, Oct. 2021.
[25] X. Mu, Y . Liu, L. Guo, J. Lin, and N. Al-Dhahir, “Capacity and optimal
resource allocation for IRS-assisted multi-user communication systems,”
IEEE Trans. Commun. , vol. 69, no. 6, pp. 3771–3786, Jun. 2021.
[26] ETSI, “Reconfigurable Intelligent Surfaces (RIS); Communication Mod-
els, Channel Models, Channel Estimation and Evaluation Methodology,”
ETSI GR RIS 003 V1.1.1, 2023.
[27] M. Rossanese, P. Mursia, A. Garcia-Saavedra, V . Sciancalepore,
A. Asadi, and X. Costa-Perez, “Designing, building, and characterizing
RF switch-based Reconfigurable Intelligent Surfaces,” in Proc. ACM
WiNTECH , 2022.
[28] G. C. Alexandropoulos et al. , “RIS-enabled smart wireless environ-
ments: Deployment scenarios, network architecture, bandwidth and area
of influence,” EURASIP J. on Wirel. Commun. and Netw. , vol. 2023,
no. 1, p. 103, Oct. 2023.
[29] L. Yezhen, R. Yongli, Y . Fan, X. Shenheng, and Z. Jiannian, “A novel
28 GHz phased array antenna for 5G mobile communications,” ZTE
Communications , vol. 18, no. 3, pp. 20–25, 2020.
[30] V . Jamali, G. C. Alexandropoulos, R. Schober, and H. V . Poor, “Low-to-
zero-overhead IRS reconfiguration: Decoupling illumination and channel
estimation,” IEEE Commun. Lett. , vol. 26, no. 4, pp. 932–936, Apr. 2022.
[31] Q.-U.-A. Nadeem, A. Kammoun, A. Chaaban, M. Debbah, and M.-S.
Alouini, “Asymptotic max-min SINR analysis of reconfigurable intelli-
gent surface assisted MISO systems,” IEEE Trans. Wireless Commun. ,
vol. 19, no. 12, pp. 7748–7764, Dec. 2020.
[32] X. Qian, M. Di Renzo, V . Sciancalepore, and X. Costa-Pérez, “Joint
optimization of reconfigurable intelligent surfaces and dynamic meta-
surface antennas for massive MIMO communications,” in Proc. IEEE
SAM workshop , 2022.
[33] Y . Lu, M. Koivisto, J. Talvitie, M. Valkama, and E. S. Lohan,
“Positioning-aided 3d beamforming for enhanced communications in14
mmwave mobile networks,” IEEE Access , vol. 8, pp. 55 513–55 525,
2020.
[34] X. Tan, Z. Sun, D. Koutsonikolas, and J. M. Jornet, “Enabling indoor
mobile millimeter-wave networks based on smart reflect-arrays,” in Proc.
IEEE INFOCOM , 2018.
[35] Z.-Q. He and X. Yuan, “Cascaded channel estimation for large intelligent
metasurface assisted massive MIMO,” IEEE Commun. Lett. , vol. 9,
no. 2, pp. 210–214, Feb. 2020.
[36] J. Rains, A. Tukmanov, Q. H. Abbasi, and M. Imran, “RIS-Enhanced
MIMO Channels in Urban Environments: Experimental Insights,”
techrxiv preprint techrxiv.24558475.v1 , 11 2023.
[37] T. S. Rappaport, S. Sun, and M. Shafi, “Investigation and comparison of
3GPP and NYUSIM channel models for 5G wireless communications,”
inProc. IEEE VTC-Fall , 2017, pp. 1–5.
[38] L. Anchora, L. Badia, E. Karipidis, and M. Zorzi, “Capacity gains due to
orthogonal spectrum sharing in multi-operator LTE cellular networks,”
inProc. IEEE ISWCS , 2012.
[39] L. Rokach and O. Maimon, “Clustering methods,” in Data mining and
knowledge discovery handbook . Springer, 2005, pp. 321–352.
[40] S. Lloyd, “Least squares quantization in PCM,” IEEE Trans. Inf. Theory ,
vol. 28, no. 2, pp. 129–137, Mar. 1982.
[41] F. Murtagh and P. Contreras, “Algorithms for hierarchical clustering: an
overview,” Wiley Interdisciplinary Rev.: Data Mining Knowl. Discovery ,
vol. 2, no. 1, pp. 86–97, 2012.
[42] L. Kaufman and P. J. Rousseeuw, “Clustering by means of medoids,” in
Rep. Fac. Math. Inf. , vol. 87, no. 3, 1987.
[43] M. Van der Laan, K. Pollard, and J. Bryan, “A new partitioning around
medoids algorithm,” J. Stat. Computat. Simul. , vol. 73, no. 8, pp. 575–
584, 2003.
[44] M. Sabin and R. Gray, “Global convergence and empirical consistency
of the generalized Lloyd algorithm,” IEEE Trans. Inf. Theory , vol. 32,
no. 2, pp. 148–155, Feb. 1986.
[45] D. Xu and Y . Tian, “A comprehensive survey of clustering algorithms,”
Annals of Data Science , vol. 2, pp. 165–193, Jun. 2015.
[46] 3GPP, “5G; Study on channel model for frequencies from 0.5 to 100
GHz,” TS 38.901 (Rel. 16), 2020.
[47] ——, “5G; NR; Physical channels and modulation,” TS 38.211 (Rel.
16), 2020.
[48] T. Zugno, M. Polese, N. Patriciello, B. Bojovi ´c, S. Lagen, and M. Zorzi,
“Implementation of a spatial channel model for ns-3,” in Proc. ACM
WNS3 , 2020.
[49] M. Rivera, M. Chegini, W. Jaafar, S. Alfattani, and H. Yanikomeroglu,
“Optimization of quantized phase shifts for reconfigurable smart surfaces
assisted communications,” in Proc. IEEE CCNC , 2022.