BRACELETS BASES ARE THETA BASES
TRAVIS MANDEL AND FAN QIN
Dedicated to Bernhard Keller and Sean Keel on the occasion of their 60th birthdays
Abstract. The skein algebra of a marked surface, possibly with punctures, admits the basis of
(tagged) bracelet elements constructed by Fock-Goncharov and Musiker-Schier-Williams. As a
cluster algebra, it also admits the theta basis of Gross-Hacking-Keel-Kontsevich, quantized by
Davison-Mandel. We show that these two bases coincide (with a caveat for notched arcs in once-
punctured tori). In unpunctured cases, one may consider the quantum skein algebra. We show that
the quantized bases also coincide. Even for cases with punctures, we dene quantum bracelets for
the cluster algebras with coecients, and we prove that these are again theta functions.
On the corresponding cluster Poisson varieties (parameterizing framed PGL 2-local systems), we
prove in general that the canonical coordinates of Fock-Goncharov, quantized by Bonahon-Wong
and Allegretti-Kim, coincide with the associated (quantum) theta functions.
Long-standing conjectures on strong positivity and atomicity follow as corollaries. Of potentially
independent interest, we examine the behavior of cluster scattering diagrams under folding.
Contents
1. Introduction 1
2. Review of cluster algebras 8
3. Cluster algebras from surfaces 19
4. The tagged bracelets basis 39
5. Scattering diagrams and theta functions 44
6. Operations on seeds 65
7. Quantum tagged bracelets with coecients 71
8. Bracelets are theta functions: unpunctured cases 78
9. Results for general cluster algebras of surface type 94
10. Canonical functions on cluster Poisson varieties from surfaces 100
Appendix A. Folding of cluster structures 108
Appendix B. Once-punctured closed surfaces 119
Appendix C. Donaldson-Thomas transformation 123
References 127
1.Introduction
1.1.Overview. Cluster algebras are algebras with certain combinatorial structures. They were in-
troduced by Fomin and Zelevinsky [FZ02] with the desire to understand the dual canonical basis
When work on this project began, the rst author was being supported by the Starter Grant \Categoried Donaldson-
Thomas Theory" no. 759967 of the European Research Council.
1arXiv:2301.11101v3  [math.QA]  20 Apr 20232 TRAVIS MANDEL AND FAN QIN
[Lus90, Lus91, Kas91] and the theory of total positivity [Lus94]. In particular, looking for good bases
has always been a fundamental and important problem in the theory of cluster algebras. Well-known
and important bases for cluster algebras include:
the generic basis in the spirit of [Dup11]: this generalizes the dual semi-canonical basis to
cluster algebras [Lus00, GLS12], see [Pla13, Qin22] for its construction and existence;
the common triangular basis introduced by [Qin17]: this is a Kazhdan-Lusztig type basis
generalizing the dual canonical basis to cluster algebras [Qin20], see also [BZ14] for acyclic
cases;
the theta basis introduced by [GHKK18]: this consists of theta functions arising from the
study of mirror symmetry and scattering diagrams.
Following [FG06] and [FST08, FT18b], one can construct cluster algebras on the (decorated) Te-
ichm uller spaces of surfaces with marked points. In this case, algebra elements are represented by
topological objects: the homotopy classes of unions of curves, which are subject to Kauman skein
relations. In addition to being of interest in Teichm uller theory and geometric representation theory,
this surface model provides a convenient framework for visualizing the algebraic structures. There are
three well-known bases represented by topological objects [MSW13, Thu14]: the bangles basis, the
bands basis, and the bracelets basis. We note that [FG06] has also constructed the bracelets basis as
certain coordinates on the moduli space of twisted decorated SL 2-local systems, cf. ยง10.2.
It has been long conjectured [FG06, Thu14] that the bracelets basis satises the following properties:
It is (strongly) positive, i.e., its structure constants under multiplication are non-negative.
It is atomic, i.e., it is the extremal positive basis.
The strong positivity conjecture was veried by [FG06, Thu14] in the classical case.
In this paper, we prove that the bracelets basis coincides with the theta basis (in most cases) at
both the classical and the quantum level. This result enables us to visualize theta functions in terms
of topological objects. The above conjectures follow as consequences using the corresponding known
properties of the theta bases [GHKK18, Man17, DM21].
We will not treat other bases in this paper (see ยง1.4 for further information).
1.2.Background and main results.
Background. Let us rst recall necessary notions and constructions, see ยง3-ยง4 for details.
We x a base ring |Zand denote |t=|[tD] for some suciently divisible positive integer D.
LetSbe a compact oriented surface, possibly with boundary. Let Mbe a nite collection of
distinct marked points in S. Markings in the interior of Swill be called punctures. We will consider
the marked surface  = ( S;M) with a mild condition that  is triangulable (see ยง3.2).
We consider curves on  which either end at Mor are closed (meaning with empty boundary).
The closed curves are called loops, and the non-closed curves arcs. A multicurve is a union of curves
considered up to homotopy xing the endpoints. The skein algebra Sk() associated to  is the
|-algebra generated by the multicurves, subject to the Kauman skein relations (cf. ยง3.1), whose
multiplication is provided by the union. Diagrams which cannot be reduced by the skein relations are
said to be simple. The (localized) skein algebra Sk() is the localization of Sk() at the boundary
arcs.
For any ideal triangulation  of , we have a seed swith boundary coecients as in [FG06, FST08,
Mul16b]. Then Sk() is contained in the corresponding upper cluster algebra Aup(s). A weightedBRACELETS BASES ARE THETA BASES 3
simple multicurve C=FwiCiis a weighted sum of non-intersecting non-homotopic components Ci,
such thatCiare simple arcs or loops, wi2Z, andwi2NwheneverCiis not a boundary arc.
By [MSW13, Thu14], we can construct bracelet elements hCiBrac=QhwiCiiBrac2Aup(s). Here,
hwiCiiBrac:= [Ci]wiifCiis an arc, and if Ciis a loop, thenhwiCiiBrac:=Twi([Ci]) whereTwiis the
wi-th Chebyshev polynomial of the rst kind (cf. ยง4.2). The bracelet elements form a basis for Sk().
Following [Mul16b], when  is unpunctured, we can also introduced the quantum skein algebra
Skt() by working with |tinstead of |, using links instead of multicurves, and rening the skein
relations with powers of q=t2(cf. Figure 3.2). One also renes sinto a quantum seed. Then
Skt() is contained in the quantum upper cluster algebra Aup
t(s). Quantum bracelets hCiBraccan
be dened similarly [Thu14].
Generalization. Before stating our results, we need to generalize the previous notions and construc-
tions to  possibly with punctures.
Following [FT18b], we consider (generalized) tagged arcs by tagging the endings of arcs as plain
or notched. Then we extend Sk() to the extended skein algebra Sk2() by adjoining tagged arcs
(ยง3.3). Using techniques involving ramied covering spaces, we prove that tagged arcs are always
contained inAup(s) even if they do not correspond to cluster variables (Propositions 3.9 and 3.18).
Our denition of the generalized tagged arcs in ยง3.3 is in terms of lambda lengths between horocycles
as in [FT18a], but following a suggestion from G. Muller, we later show that Sk2() can equivalently
be dened using a nice collection of generators and relations; cf. ยง3.3.5 and ยง9.2.1.
Inยง4.3, we generalize weighted simple multicurves to weighted tagged simple multicurves by includ-
ing compatible tagged arcs as components. We then use this to generalize the denition of bracelets
to a denition of tagged bracelets.
We say two seeds are similar of they have the same principal exchange matrices (i.e., they only
dier in their frozen parts). For ssimilar to s, [FT18b] shows how scan be understood in terms
of laminated Teichm uller space. In the case of principal coecients, [MSW13] gives a construction
of bracelets bases extending the constructions described above. On the other hand, the correction
technique in cluster algebras [Qin14, Qin17] gives a simple way to relate bases for similar seeds (see
ยง6.2), and we thus characterize the bracelets for any ssimilar to s(ยง7.2).
For surfaces  with punctures, it is unclear how to quantize Sk() directly (cf. Remark 3.1),1but
quantization of the upper cluster algebra becomes possible if we replace sby a similar seed satisfying
the Injectivity Assumption (e.g., we may take s:=sprin
). The correction techniques mentioned above
apply to theta functions in the quantum setting as well.
So suppose that we have xed a quantum seed ssimilar to s. It remains to construct the
quantum bracelet hCiBracin the quantum upper cluster algebra Aup
t(s) for any weighted tagged simple
multicurve C(ยง7.4). For any loop L,hLiBrac is constructed from a quantum trace [AK17, BW11]
(cf. ยง7.4.1), or using a cut-and-paste technique ( ยง7.5). For a tagged arc ,hiBrac can usually be
constructed as a quantum cluster variable. But for a notched arc on a once-punctured closed surface,
hiBracis dened via the Donaldson-Thomas transformation (when the genus is at least 2). A more
direct and natural denition for this case would be desirable, cf. Remark 7.3.
Main results. We will show that (quantum) tagged bracelets are (quantum) theta functions, with a
caveat for notched arcs in the once-punctured torus.
1A quantization of skein algebras is proposed in the ongoing work [SSW23]. Special cases were treated in [RY14].4 TRAVIS MANDEL AND FAN QIN
Theorem 1.1 (Theorem 9.4) .LetC=F
1iswiCidenote any weighted tagged simple multicurve.
(i) If no component Ciis a notched arc in a once-punctured torus, then hCiBrac coincides with
the quantum theta function #g(C)inAup
t(s), whereg(C)denotes the g-vector (leading degree)
ofhCiBrac.
(ii) In the coecient-free classical setting, hCiBrac= 4k#g(C)wherekis the sum of the weights
wifor all notched arcs Ciin once-punctured closed torus components.
The extra factors in the once-punctured torus case can be interpreted as follows. The theta functions
we consider are those associated to a scattering diagram D=Dsprin
as in [GHKK18] (setting frozen
variables equal to 1 after computing the theta functions). One can dene a new scattering diagram
D0:=Dtf(H;fH)gconsisting of a single additional wall with support a single hyperplane Hand
central scattering function fH, cf. Theorem 9.6. The bracelets for the once-punctured torus coincide
with the theta functions associated to this D0. We speculate that D0may be the stability scattering
diagram [Bri17] for the associated quiver (with a non-degenerate potential); cf. [Qin22][Mou19].
Upcoming work will investigate this by examining the behavior of stability scattering diagrams under
folding [CMQ23].
We obtain the following important consequences concerning skein algebras and the atomicity of
their bases (see ยง5.10).
Theorem 1.2 (Theorem 9.5) .When is unpunctured, the (untagged) quantum bracelets form the
atomic basis for the quantum skein algebra Skt()with respect to the cluster atlas.
Theorem 9.4 shows that our quantum tagged bracelets are theta functions for punctured surfaces
as well (except with the once-punctured torus). The following summarizes some of our main results
for the classical setting.
Theorem 1.3 (See Theorem 9.6 for details) .The following statements are true.
(i) The bracelets form the atomic basis for the skein algebra Sk() with respect to the ideal tri-
angulation atlas.
(ii) The tagged bracelets form the atomic basis for the extended skein algebra Sk2()with respect
to the scattering atlas2.
(iii) When no component of is a once-punctured torus, Sk2()coincides with the middle cluster
algebraAmid(s). Moreover, if every component of has non-empty boundary, then the full
Fock-Goncharov conjecture holds (cf. Theorem 5.24).
Since the theta basis has positive structure constants (i.e. strong positivity), the above bases are
strongly positive as well. We thus prove D. Thurston's Conjecture [Thu14, Conj. 4.20] on the strong
positivity of the quantum bracelets basis for unpunctured surfaces; cf. Theorem 9.10|our proof
applies to all (not necessarily triangulable) unpunctured surfaces with non-empty boundary.
In Corollaries 9.7 and 9.8, we show that the non-localized skein algebras Skt() and Sk2() have
bases consisting of the bracelets associated to weighted tagged simple multicurves whose weights are
all non-negative.
2The scattering atlas is the same as the extended cluster atlas in [FG09, Examples after Conj. 5.7]. We will also
refer to this as the tagged triangulation atlas. If no component of  is a once-punctured closed surface, then this also
agrees with the cluster atlas. See ยง2.9 for more on the cluster atlas and ยง5.10 for other atlases.BRACELETS BASES ARE THETA BASES 5
1.2.1. Canonical coordinates for moduli of framed PGL 2-local systems. Given a seed sassociated
to an ideal triangulation of a marked surface as above, Fock and Goncharov [FG06] interpret the
corresponding cluster Poisson variety as a moduli space Xof framed PGL 2-local systems. They then
construct canonical coordinates in terms of features like traces and eigenvalues of the monodromies
of these local systems. Allegretti and Kim [AK17] develop a quantum analog of these canonical
coordinates using Bonahon-Wong's [BW11] quantum trace map. We review these constructions in
ยง10.
Universal positivity for these quantum canonical bases has been proved in [CKKO20], and strong
positivity is known in the classical setting by [FG06, Thm. 12.2.5]. Up to this point, atomicity in
the classical and quantum setting ([FG06, Conj. 12.2] and [MSW13, Conj. 1.5]) and strong positivity
in the quantum setting [FG06, Conj. 12.4.5] have been open. These conjectures follow as immediate
corollaries of the following (and of the analogous known results for theta bases):
Theorem 1.4 (Theorem 10.11) .The (quantum) canonical coordinates on X, as constructed in
[FG06, AK17] , are precisely the (quantum) theta bases.
1.3.Structure of the paper. ยง2-ยง7 serve to introduce the relevant background, denitions, and
lemmas. Additional background and lemmas for the cluster Poisson setting are introduced in ยง10.
The bulk of the proofs for our main results are in ยง8-ยง9 and ยง10.4- ยง10.5. We outline this in more detail
below.
1.3.1. Background and setup. Inยง2, we review basics of cluster algebras and their quantizations.
Positivity properties (for the cluster atlas) are reviewed in ยง2.9.
Inยง3, we review skein algebras and cluster algebras on marked surfaces following [FST08, Mul16b].
We also extend to tagged skein algebras as in [FT18b, MSW11], understood here in terms of functions
on Teichm uller space. Of possibly independent interest, we prove that if one adjoins tagged arcs to
Sk() to produce Sk2(), then Sk2() will contain all generalized tagged arcs as well (Proposition
3.9). In fact, we prove in ยง3.3.5 that generalized tagged arcs satisfy a \local digon relation," and in
ยง9.2.1 (as an application of our main results) we nd that the usual skein algebra relations plus the
local digon relation can be used to give a relatively simple alternative construction of Sk2(). We
review laminations, the associated tropical coordinates, and Dehn twists in ยง3.4.
Inยง4, we review known construction of the bracelets and quantum bracelets as in [MSW13, Thu14].
Then we extend the classical bracelets in the punctured cases by allowing contributions from tagged
arcs (as suggested in [MSW13]).
Inยง5 we switch to discussing scattering diagrams and theta functions as in [GHKK18, DM21].
Proposition 5.19 is a new general result saying that theta functions corresponding to points in the
closure of the cluster complex are linearly independent (and a bit more than this), thus generalizing
[GHKK18, Thm. 7.20]. We consider some special properties for cluster algebras from surfaces|
[Yur20, Thm. 1.2] says that the cluster complex is dense everywhere or in a half-space for cluster
algebras from surfaces (cf. Proposition 5.23), and we apply this to prove Theorem 5.24 regarding the
full Fock-Goncharov conjecture for cluster algebras from surfaces. In ยง5.10, we discuss properties of
theta functions, both in general and in the case of cluster algebras from surfaces. Positivity properties
for bracelets are discussed in ยง5.11.
Inยง6, we examine the behavior of theta functions under various manipulations of seeds. ยง6.2
relates theta functions for similar seeds, i.e., seeds with the same principal (or non-frozen) part. This6 TRAVIS MANDEL AND FAN QIN
is applied in ยง6.3 to show how theta functions behave when frozen vertices are glued together. In
ยง6.5 we look at conditions implying that a theta function remains a theta function when an index is
unfrozen (Lemmas 6.12 and 6.13).
Inยง7, we dene bracelets for cluster algebras from surfaces with arbitrary coecients ( ยง7.2) and
their quantizations ( ยง7.4). For loops, these denitions rely on constructions from ยง10 (the cluster
Poisson setting), and for tagged arcs we dene the bracelets to be the corresponding cluster variables
(except with notcched arcs in once-punctured closed surfaces, which are more complicated). In ยง7.5
we prove a useful lemma about cutting surfaces into simpler pieces (Lemma 7.5) and we use this to
give another (equivalent) characterization of the quantum bracelet elements associated to loops.
1.3.2. Outline of the main proofs. The bulk of our proofs lies in ยง8-ยง10, plus some details in the
appendices. Here we give a rough outline of these arguments. We begin with ยง8, where we assume
that  is unpunctured.
The Gluing Lemma ( ยง8.1): Let  be a marked surface, and let 0be another marked surface
obtained from  by gluing pairs of boundary arcs together. Assume  and 0are both unpunctured.
Our Gluing Lemma (Lemma 8.2) says that if a bracelet hCiBrac2Skt() is a theta function, then
the corresponding element hC0iBrac2Skt(0) is also a theta function.
To prove this, we note that gluing two boundary arcs together corresponds to identifying two frozen
indices, followed by unfreezing the glued index (this process is called \amalgamation" in [GS19, ยง19.1]).
As we mentioned above, the operation of gluing frozen indices is shown to act on theta functions in
a simple and natural way in ยง6.3. Then Lemma 6.12 shows that the operation of unfreezing also
respects theta functions under a certain positivity assumption, and this positivity assumption holds
for bracelets as an immediate consequence of known results for classical bracelets in unpunctured
surfaces (their universal positivity).
Annular and Non-annular loops ( ยง8.2 - ยง8.3): In light of the Gluing Lemma, to show that a
weighted loophwLiBrac2Skt() is a theta function, we can cut  into simpler surfaces rst. In fact,
this cutting allows us to reduce to the following cases:
i (Annular loops) Lemma 8.5 shows that we can often cut as in Figure 8.25 to reduce to the
case where  is an annulus with one marking on each boundary component and no other
markings, and Lis the unique simple loop in . In these cases, sis the seed associated to
the Kronecker quiver (with frozen vertices). The claim that hwLiBracis a theta function in
these cases is checked in Lemma 8.4 (also cf. Example 5.8) using explicit computations.
ii (Non-annular loops) By Lemma 8.6 and cutting as in Figure 8.26, the other cases to consider
are where  has a single boundary component with a single marked point, and Lis homotopic
to this boundary component. We show that hLiBracis a theta function in ยง8.3.2 by using the
skein relations to multiply by an arc and then applying properties of bracelets (e.g., positivity;
cf. Lemma 8.8) and of theta functions (e.g., atomicity and bar-invariance).
To deal withhwLiBrac, we rst prove some lemmas on the equivariance of the mapping class
group action on Sk t() and on the theta functions; cf. ยง8.3.3. Then in ยง8.3.4, we repeatedly
apply Dehn twists to  to obtain a triangulation 0whose corresponding chamber C0in the
scattering diagram is arbitrarily close to g(wL) (using a result of [Yur20]). By analyzing the
Laurent expansions of #g(wL)in these chambers, we deduce that the theta functions satisfy
the desired Chebyshev recursion. The equality hwLiBrac=#g(wL)follows.BRACELETS BASES ARE THETA BASES 7
Unions of compatible bracelets ( ยง8.4): Inยง8.20, we consider an arbitrary bracelet hCiBracfor
C=F
iwiCi. Using Dehn twists as before, we construct a chamber C0of the scattering diagram
which is arbitrarily close to all g(wiLi). We then choose a base-point Q2C0and apply arguments
similar to those from the non-annular case to prove that #g(C)=Q
i#g(wiCi). This completes the
proof that the bracelets and theta bases agree for unpunctured surfaces.
Punctured surfaces ( ยง9.1): We extend to allow for punctured surfaces in ยง9.1. First, we show in
Lemma 9.1 that bracelets consisting only of weighted loops are theta functions. This is essentially by
using the Gluing Lemma to reduce to the unpunctured setting, but we rst have to prove the classical
universal positivity of loops in punctured surfaces so that we can apply Lemma 6.12 (unfreezing
respects theta functions, assuming positivity). In Lemma 9.2, we prove in the quantum setting that
loops commute with tagged arcs which they don't intersect|here we use new results on quantum
DT-transformations ( ยงC) to deal with doubly-notched arcs. Proposition 6.14 tells us that a product
oft-commuting theta functions, one of which is a cluster monomial, will still be a theta function (up
to a power of t). It then follows that bracelets and theta functions coincide in most cases.
Once-punctured closed surfaces: In these cases, products of compatible notched arcs and
weighted loops still give (tagged) bracelets, but since the notched arcs in these cases are not cluster
variables, we need another argument to show that they are theta functions. To do this, we rst prove
new results on quiver folding and scattering diagrams in ยงA. We then apply this to nite covering
spaces of  in ยงB. The scattering diagram for a once-punctured closed surface  is thus related to
\slice" of the scattering diagram for a closed surface e with multiple punctures, with the former
giving the usual theta functions and the latter giving the bracelets. We nd that these two scattering
diagrams agree except in the case where  is a once-punctured torus|in this case the scattering
diagram from the covering space gives the one extra wall ( H;fH).
We put our ndings together in ยง9.2 to prove a number of theorems for bases of skein algebras.
Cluster Poisson Varieties ( ยง10)Inยง10.1, we review Fock-Goncharov's construction of canonical
coordinates for the moduli space Xof framed PGL 2-local systems in ยง10.1|these spaces Xare the
cluster Poisson varieties associated to the cluster algebras from surfaces. Then in ยง10.2 we review
the construction of moduli of twisted decorated SL 2-local systems as in [FG06]|this gives another
interpretation of the surface skein algebras we consider. We review the quantization XqofXin
ยง10.3, and the quantum canoncial coordinates of [AK17] in ยง10.4. Finally, in ยง10.5, we prove that
the (quantum) canonical coordinates coincide with the (quantum) theta functions. For unpunctured
surfaces, this is essentially because the cluster AandX-varieties nearly coincide when the injectivity
assumption holds, so we reduce to the usual surface skein algebra setting. Punctured cases then follow
by a cutting-and-gluing argument.
1.3.3. The appendices. InยงA, we review the notions of covering and folding of seeds (including for
skew-symmetrizable seeds), and we look at how scattering diagrams behave under covering of seeds
(Theorem A.7) and folding of seeds (Corollary A.14 and Lemma A.15).
We apply this to covering spaces of surfaces in ยงB. For once-punctured closed surfaces, this allows
us to relate notched arcs to theta functions
Finally, in ยงC we prove some features and useful lemmas regarding the action of the quantum
DT-transformation on theta functions and bracelets.8 TRAVIS MANDEL AND FAN QIN
1.4.Relation to other works. The original construction of a quantum bracelets basis (for the case
of a closed torus), including the application of the Chebyshev polynomials, was [FG00].
The bangles basis is conjectured to coincide with the generic basis. This has been proved in
[GLFS20] for unpunctured surfaces. The bands basis is conjectured to provide an analog of the dual
canonical basis [Thu14], i.e. it should coincide with the common triangular basis.
[Bou20b] proves that the (untagged) quantum bracelet elements are theta functions for the once-
punctured torus and the four-punctured sphere, both for the cluster algebra and the associated cluster
Poisson algebra, thus imply Thurston's strong positivity conjecture in these cases. Bousseau's argu-
ments utilize the characterization of the quantum scattering diagram in terms of certain higher-genus
log Gromov-Witten invariants [Bou20a]. Bousseau also suggests a mathematical physics interpretation
for the agreement between bracelets and theta bases.
[QW18, QW21] studies positivity of quantum bracelets and other bases using categorication.
Building on this, [Que22] proves strong positivity for the quantum bands basis for surfaces without
marked points.
[FT17, C  T19] extended bracelets bases (for unpunctured cases) to orbifolds, with the help of un-
folding. It is possible that our main result (bracelets = theta functions) extends to orbifolds as well.
Cluster structures and cluster Poisson structures have been dened on moduli of twisted decorated
G-local systems and framed G_-local systems, respectively, for much more general Lie groups Gwith
Langlands dual G_[FG06, Le19, GS15, GS19]|the case considered in this work is G= SL 2,G_=
PGL 2. It would be very interesting to prove a geometric/representation-theoretic characterization of
the theta bases for other groups G. This more general setting is signicantly more complicated, but
many of our tools do generalize naturally, including the equivariance of the mapping class group action
and the relationship between unfolding and covering spaces. Moreover, upcoming results in [CMMM]
will use properties of tropical theta functions to prove a general version of our Gluing Lemma.
1.5.Acknowledgements. The second author was inspired to study algebras on surfaces by attending
the conference \Interactions between Representation Theory and Homological Mirror Symmetry" in
Leicester, UK, in 2019. He would like to thank the organizers, Pierre-Guy Plamondon and Sibylle
Schroll, for inviting him. This work began in October 2019 when the second author visited the rst
at the University of Edinburgh, and they would like to thank the university for its hospitality. We are
grateful to Dylan Allegretti, Peigen Cao, Ben Davison, Emily Gunawan, Min Huang, Greg Muller,
and Gregg Musiker for many enlightening conversations.
2.Review of cluster algebras
We will work over a xed base ring |. Often one takes |to beZ,Q, orC, but unless otherwise
stated, any commutative ring containing Zas aZ-subalgebra will work equally well.
2.1.Seeds. A (skew-symmetric) cluster algebra is determined by the data of a seed s , by which we
mean the following collection of data:
s= (N;I;E =feiji2Ig;F;! )
whereNis a lattice of nite rank r,Iis an index-set with jIj=r(whose elements are called vertices),
Eis a basis for Nindexed by I,Fis a subset of I, and!is aQ-valued skew-symmetric3form on
3We shall not consider the more general \skew-symmetrizable" cases except in Appendix ยงA.BRACELETS BASES ARE THETA BASES 9
Nsuch that!(ei;ej)2Zwheneveriorjis inIuf:=InF. The elements ei2Ewithi2F(resp.
i2Iuf) are called the frozen vectors (resp. unfrozen vectors). We denote Euf:=feiji2InFg,
and we letNufNdenote the span of Euf. As is common practice in the cluster literature,4we shall
denote the transpose of !byB. Denotebij=B(ei;ej). The matrix ( bij)i;j2Iufis called the principal
B-matrix. If sis not clear from context, we may decorate the data with the subscript s, e.g., as in Ns
ores;i.
Remark 2.1.Consider a seed sas above for which !isZ-valued on all of N. The data of such a seed
is equivalent to the data of a nite quiver Qwithout loops (1-cycles) or oriented 2-cycles, and with
some vertices labelled as frozen. Given s, the vertices Q0of the quiver correspond to the elements
ofI, withFcorresponding to the frozen vertices. For i2I, letVidenote the corresponding vertex.
Then the number of arrows from VitoVjisB(ei;ej), where the arrows go the reverse direction if
B(ei;ej)<0. Similarly, given the quiver Q, one recovers a seed swith lattice N=ZQ0by inverting
this correspondence.
We next introduce some examples which shall be built upon throughout the paper.
Example 2.2. TheA2-quiver 1 2 corresponds to a seed with N=Z2,I=f1;2g,E=fe1;e2g,
F=;, and!(e1;e2) = 1.
Example 2.3. Consider the quiver Qof Figure 2.1. For the corresponding seed s, we haveN=Z4,
I=f1;2;3;4g,E=feigi2Ithe standard basis, F=f3;4g, andB(the transpose of !) given in the
basisEby the matrix
B=0
BBB@0 2 1 1
2 0 1 1
 1 1 0 0
 1 1 0 01
CCCA:
2 1
43
Figure 2.1. A quiver with frozen vertices represented as boxes.
Given a seed sas above, let M:=N= Hom(N;Z), and letfe
iji2IgMbe the dual basis to
E. LetNQ:=N
QandMQ:=M
Q. Denote
!1:NQ!MQ; ! 1(n) =!(n;): (1)
Note that!1jNufhas image in M. We denote Muf:=!1(Nuf). It will also be useful to denote
MF:=Zhe
iji2Fi. We may denote the dual pairing between NandMbyh;i:NM!Z.
4Beware, the pairing called Bin [DM21] is actually the pairing !=BThere.10 TRAVIS MANDEL AND FAN QIN
2.2.Compatible pairs. Let  be a Q-valued skew-symmetric form on M. Denote  1(m) :=
(m;)2NQand  2(m) := (;m). As in [DM21, (47)] (originally due to [BZ05] with a dier-
ent sign; cf. Remark 2.5), we say that ( s;) is a compatible pair if
2(!1(ei)) =dei (2)
for eachi2InFand for some xed5multiplierd2Q>0| for quantum cluster algebras from surfaces
as we shall consider, we will always have d= 4. Note that  being compatible with simplies
(!1(ei);!1(ej)) =d!(ei;ej) =dB(ej;ei) (3)
wheneveriorjis inInF.
Example 2.4. Consider again the seed sassociated to the A2-quiver 1 2 as in Example 2.2. Since
there are no frozen indices, (2) uniquely determines  up to the factor d. Explicitly, we have
!1(e1) =e
2and!1(e2) = e
1;
so using (3), we see that  satises
(e
1;e
2) = ( !1(e2);!1(e1)) = d!(e2;e1) =d:
Remark 2.5.It is common to express (2) in terms of matrix multiplication, viewing !andBas
matrices in the basis Eand  as a matrix in the dual basis feT
igi2I. Notice that the vector !1(ei),
viewed as a column vector, agrees with ( eT
i!)T=!Tei=Beiin this matrix convention. Thus,
2(!1(ei)) = Bei, and so the compatibility condition (2) becomes
Bei=dei (4)
for alli2InF. In other words, the columns of  Bindexed by InFagree with the corresponding
columns of the diagonal matrix dIdjIjjIj.
On the other hand, taking the transpose of (4) and using the skew-symmetry of  yields
eT
iBT = deT
i:
I.e., the rows of BT indexed by InFagree with the corresponding rows of the diagonal matrix
 dIdjIjjIj. This is the compatibility condition of [BZ05, Def. 3.1] except for the minus sign. Because
of this sign, our quantum parameter twill correspond to q 1=2in [BZ05].
Example 2.6. Consider the seed sof Example 2.3. With respect to the dual basis to E, a compatible
 is given by
 =0
BBB@0 2 0 0
 2 0 0 0
0 0 0 0
0 0 0 01
CCCA:
5In [DM21], the factor dis always taken to be 1. But the generalization to the setup here is straightforward|e.g.,
dividing  by dwhile substituting t1=D7!td=Din (12) preserves the quantum torus algebra, and similar substitutions
are easily made for all other constructions we consider. We will mostly avoid the more general skew-symmetrizable
setups like [BZ05] where dis replaced by dierent numbers d0
ifor dierent i(cf. ยงA.1).BRACELETS BASES ARE THETA BASES 11
Indeed, we have
B=0
BBB@4 0 2 2
0 4 2 2
0 0 0 0
0 0 0 01
CCCA;
so the condition as in Remark 2.5 is satised for d= 4.
We will often wish to impose the following assumption:
Assumption 2.7 (The Injectivity Assumption) .One says the Injectivity Assumption holds for sif
!1jNufis injective.
Notice the assumption is equivalent to the matrix ( B(ei;ek))i2I;k2Iufbeing full rank, and this is
also equivalent to the existence of a compatible ; see [GSV03][GSV05].
2.3.Principal coecients. A common approach for dealing with cases where the Injectivity As-
sumption fails is to work with principal coecients . For this, given a seed sas above, one associates
another seed sprindened as follows:
Nsprin:=NM.
Isprinis the disjoint union of two copies of I. We shall call them I1andI2to distinguish
between them.
Esprin:=f(ei;0):i2I1g[f (0;e
i):i2I2g.
Fsprin:=F1[I2, whereF1isFviewed as a subset of I1.
!sprin((n1;m1);(n2;m2)):=!(n1;n2) +m2(n1) m1(n2).
We may also denote NsprinasNprin,!sprinas!prin, and similarly for the other pieces of data. We
denote the analog of !1for!sprinby!prin
1:Nprin!Mprin:= (Nprin)=MN, identifying N=N.
I.e.,
!prin
1: (n;m)7!!sprin((n;m);) = (!1(n) m;n): (5)
The form!sprinis unimodular (i.e., has determinant 1) on Nsprin. In particular, the Injectivity As-
sumption always holds for sprin.
Given a seed sand the corresponding principal coecients seed sprin, dene
:Mprin=MN!M; (m;n)7!m: (6)
Note that if ( s;) is a compatible pair, then one can pull  back by to give a compatible pair
(sprin;) with the same value of d. Here,
((m1;n1);(m2;n2)) = (m1;m2):
In general, even if the Injectivity Assumption fails for sand so there is no compatible , one can
still dene a compatible pair ( sprin;prin) withd= 1
prin((m1;n1);(m2;n2)) :=!(n2;n1) m2(n1) +m1(n2): (7)12 TRAVIS MANDEL AND FAN QIN
Indeed,
prin(!prin
1(n1;m1);!prin
1(n2;m2)) = prin((!1(n1) m1;n1);(!1(n2) m2;n2))
=!(n2;n1) (!1(n2) m2)(n1) + (!1(n1) m1)(n2)
=!(n2;n1) !1(n2)(n1) +!1(n1)(n2) +m2(n1) m1(n2)
=!(n1;n2) +m2(n1) m1(n2)
=!prin((n1;m1);(n2;m2))
as in (3). Equivalently, prin= (Bprin) 1.
Example 2.8. Building on Example 2.2, we construct Isprin=I1tI2=f1;2gtf 10;20gfrom two
copies ofI. We haveNprin=NM=Ze1Ze2Ze
1Ze
2,Mprin=MN=Ze
1Ze
2Ze1Ze2.
In the basisfe1;e2;e
1;e
2gofNprin, the form!sprintakes the following matrix form:
!sprin =0
BBB@0 1 1 0
 1 0 0 1
 1 0 0 0
0 1 0 01
CCCA:
In the basisfe
1;e
2;e1;e2gofMprin, we have!prin
1(e1) =0
BBB@0
1
1
01
CCCA,!prin
1(e2) =0
BBB@ 1
0
0
11
CCCA. The
matrix for prinis
prin= (!prin) T=0
BBB@0 0 1 0
0 0 0 1
 1 0 0 1
0 1 1 01
CCCA:
2.4.Seed mutations. Given a seed s= (N;I;E =feigi2I;F;! ), the (positive) mutation ofswith
respect toj2InFis the seedj(s):= (N;I;E0=fe0
igi2I;F;! ), where the vectors e0
iare dened by
e0
i:=j(ei):=(
ei+ max(0;!(ei;ej))ejifi6=j
 ej ifi=j.(8)
We extend this to compatible pairs ( s;) by dening j(s;) = (j(s);), i.e.,  is unchanged by
mutation6. Letfi=e
i,i2I, denote the dual basis for EinM. As in [FG09, (8)], mutation of this
dual basis is given by
f0
i:=j(fi):=(
fi ifi6=j
 fj+P
s2Imax(0; !(ej;es))fsifi=j.(9)
Remark 2.9.For simplicity, we do not dene a signed mutation (see [Qin22, (2.1)]). Positive mutations
alone suce for calculating upper cluster algebra elements, see [GHK15, Rmk. 2.5].
6The matrix representations of Band  with respect to Eand the dual basis do change as the bases change, but
the coordinate-independent versions used here do not.BRACELETS BASES ARE THETA BASES 13
Following [GHKK18, (1.23)] and [DM21, ยง4.5], we also consider the piecewise-linear \tropical"
transformations Ts
j:MR!MRdened by
Ts
j(m) =m+ max(0;hej;mi)!1(ej): (10)
By design, Ts
j(!1(es;i)) =!1(ej(s);i) for alli6=j, whileTs
j(!1(es;j)) = !1((ej(s);j)). We also note
thatTs
j(f0
i) =f0
ifor alli.
Consider a sequence ~ |= (j1;:::;js) of elements jiinInF. For each k= 1;:::;s , let~ |kbe the
truncated tuple ( j1;:::;jk 1). We recursively dene s~ |in terms of s~ |s 1as follows. Take s():=s, and
denote
T~ |:=Ts~ |s
jsTs~ |1
j1:MR!MR: (11)
We now dene s~ |to be the seed ( N;I;E~ |;F;! ) whereE~ |is the dual basis to
ffs~ |;i:=T~ |(fi)ji2Ig:
In particular, sj:=s(j)is equal toj(s) for eachj2InF.
2.5.Quantum torus algebras. Let there be given a compatible pair ( s;). Choose and x a
positive integer Dsuch that  and !are1
DZ-valued. Let tdenote a formal parameter and dene
|t:=|[t1=D]. We consider the quantum torus algebra
|
t[M] :=|t[zmjm2M]=hzuzv=t(u;v)zu+vju;v2Mi: (12)
We may leave the superscript  out of the notation. Note that setting t= 1 recovers the classical
torus algebra
|[M] :=|[zmjm2M]=hzuzv=zu+vju;v2Mi:
For any submonoid M0M, we may dene |t[M0]|t[M] by restricting to those exponents which
lie inM0.
LetMdenote the Z0-span off!1(ei)ji2InFgMuf, and letM+:=Mnf0g. Suppose the
injectivity assumption holds, so Mis contained in a strongly convex7cone. Then let
|tJMK:=|t[M]
|t[M]|tJMK;
i.e.,|tJMKis spanned over |tby formal sums of the formP
v2Mavzm+vfor various m2Mand
coecients av2|t.
Given a subset PofM(typicallyP=M+) and anyk2Z1, we denote
kP=fm1+:::+mkjm1;:::;mk2Pg: (13)
We also consider (Langlands) dual versions of these concepts: as in [FG09, ยง3.1], even without the
Injectivity Assumption, we can dene the dual quantum torus algebra
|!
t[N] :=|t[znjn2N]=hzuzv=t!(u;v)zu+vju;v2Ni:
As before, we may leave the superscript !out of the notation. Under the Injectivity Assumption, (3)
implies there is a natural |t-algebra embedding (denoted !1by abuse of notation) dened by
!1:|!
t[Nuf],!|
t[M]; t1
D7!td
D; zn7!z!1(n): (14)
7ForLa lattice, a cone LR:=L
Ris called strongly convex if it is convex and contains no line through the
origin. By an abuse of terminology, we may also describe \Las being strongly convex.14 TRAVIS MANDEL AND FAN QIN
As in [Bri17, DM21], let Ndenote the Z0-span offeiji2InFg, soM=!1(N), and let
N+:=Nnf0g. Then dene
|tJNK:=|t[N]
|t[N]|tJNK
so|JNKis spanned over |tby formal sums of the formP
v2Navzn+vforn2Nand coecients
av2|t. Given a subset PofN(typicallyP=N+) and anyk2Z1, we denote
kP=fn1+:::+nkjn1;:::;nk2Pg:
The quantum torus algebras |t[N] and|t[M] admit involutive |-algebra automorphisms, called
thebar involutions , induced by t7!t 1andzv7!zvfor allvinNorM, respectively. These
involutions naturally extend to the completions |tJNKand|tJMK. We say an element fof any of
these algebras is bar-invariant iffis invariant under the appropriate bar involution.
2.6.Cluster mutation. In the following, we assume the existence of a compatible  in order to
dene quantum cluster A-algebras. The existence of compatible  is not required for the quantum X-
analog. These same constructions also apply when t= 1 without assuming the existence of compatible
, and this yields the classical cluster A- andX-algebras.
Given a seed s, denote the associated (quantum) torus algebra
As
t:=|t[M]
and the (partially compactied) subalgebra
(15) As
t:=|t[s]
wheresis the monoid
s:=Zhe
iji2InFi+Z0he
iji2FiM:
We consider the monomials
Ai:=ze
i2|t[M]
for eachi2I. When sis not clear from context, we will write AiasAs;i.
Dually, let
Xs
t:=|t[N]:
Given a seed s, for eachi2I, let
Xi:=zei2Xs
t: (16)
LetAs
tand Xs
tdenote the skew-elds of fractions of As
tandXs
t, respectively.8For eachj2InF,
we dene an isomorphism A
j:As
t ! Asj
tsuch that the corresponding inverse map gives
(A
j) 1(Asj;i) :=8
<
:As;i ifi6=j,
ze
sj;j+ze
sj;j+!1(es;j)ifi=j.(17)
Note that the dual bases in sandsj=j(s) are related by (9). Then the quantum mutation at Asj;j
can be expressed as in [BZ05, (4.23)] via
(A
j) 1(Asj;j) =z e
j+P
ij!(ei;ej)>0!(ei;ej)e
i+z e
j P
ij!(ei;ej)<0!(ei;ej)e
i:
8See [BZ05, ยง11] for a brief review of skew-elds of fractions and Ore localization in this context.BRACELETS BASES ARE THETA BASES 15
If we taket= 1, then we recover the classical mutations given in [FZ02] as follows:
As;j 
(A
j) 1(Asj;j)
=Y
!(ei;ej)>0A!(ei;ej)
s;i +Y
!(ei;ej)<0A !(ei;ej)
s;i:
Given a tuple ~ |= (j1;:::;js)2(InF)sand denoting s~ |as in ยง2.4, we dene
A
~ |:As
t ! As~ |
t
as the composition
A
~ |:=A
jsA
j1
whereA
jkhere is viewed as mapping As(j1;:::;jk 1)
t ! As(j1;:::;jk)
t . Let
As~ |2
s~ |1;i:=A
~ |2(A
~ |1) 1(As~ |1;i):
In particular,
As
s~ |;i= (A
~ |) 1(As~ |;i):
We may denote As
s~ |;imore simply as A~ |;i.
Denition 2.10 (Quantum cluster variables) .The elements A~ |;i=As
s~ |;ifor any mutation sequence
~ |and indexi2Iare called the (quantum) cluster variables.
Note that, for frozen vertices i2F, we always have A~ |;i=Ai. These are called frozen variables or
coecients. The Laurent monomials in the frozen variables are called the frozen factors.
Remark 2.11 ([GHK15, Rmk. 2.5]) .It is straightforward to check that A(j;j);i=Ai, for alli, even
thoughe
s(j;j);j6=e
s;jin general.
Similarly, for each j2InF, one denes an isomorphism X
j:Xs
t ! Xsj
tby specifying that for
n2Nwith!(n;ej)0, we have
X
j(zn) =!(n;ej)X
k=0!(n;ej)
k
tzn+kej(18)
as in [DM21, (53)]|the coecients are explained below; cf. (20). Then, for !(n;ej)0, the inverse
map reads (cf. [Qin20, (2.3)]):
(X
j) 1(zn) = !(n;ej)X
k=0 !(n;ej)
k
tzn+kej: (19)
Here, a
k
tdenotes the (bar-invariant) quantum binomial coecient dened as follows: for each
integerk, let [k]t:=tk t k
t t 1. Note that lim t!1[k]t=k. Then dene [0] t!:= 1 and
[k]t!:= [k]t[k 1]t[2]t[1]t
fork2Z1. Now fora;k2Z0withak, one denes
a
k
t:=[a]t!
[k]t![a k]t!2Z0[t1]: (20)
We note that, regardless of the sign of !(n;ej), the classical limit of this mutation induced by (18) is
given by
lim
t!1X
j(zn) =zn(1 +zej)!(n;ej);16 TRAVIS MANDEL AND FAN QIN
as in [GHK15, (2.5)]. We also note that A
jcould similarly be expressed in terms of quantum binomial
coecients, and both A
jandX
jcould be expressed in terms of conjugation by a quantum exponential,
cf. (61) and (64).
As on theA-side, given a tuple ~ |= (j1;:::;js)2(InF)s, we dene
X
~ |:Xs
t !Xs~ |
t
as the composition
X
~ |:=X
jsX
j1(21)
whereX
jkis viewed as mapping Xs(j1;:::;jk 1)
t !Xs(j1;:::;jk)
t . As before, dene
Xs~ |2
s~ |1;i:=X
~ |2(X
~ |1) 1(Xs~ |1;i):
and denote X~ |;i=Xs
s~ |;i.
Example 2.12. Let us take sas in Example 2.2 and take t= 1 for simplicity. For s1=1(s), we
havees1;1= e1,es1;2=e2. Since!(es1;2;e1) = 1<0, we have ( X
1) 1(zes1;2) =zes1;2(1 +ze1) or,
equivalently, ( X
1) 1(Xs1;2) =Xs;2(1 +Xs;1).
Similarly, for s2=2(s), we have es2;1=e1+e2,es2;2= e2. Since!(es2;1;e2) = 1>0, we
haveX
2(zes2;1) =zes2;1(1 +ze2) or, equivalently, ze1+e2(1 +ze2) 1= (X
2) 1(ze1+e2). Recall that
Xs2;1=ze1+e2. The last equation can be rewritten as Xs;1Xs;2(1 +Xs;2) 1= (X
2) 1(Xs2;1).
Example 2.13. Take ( s;) as in Examples 2.3 and 2.6. Then
(A
1) 1(A0
1) =z e
1+e
3+e
4+z e
1+2e
2:
DenotingA0
1:= (A
1) 1(As1;1), we can rewrite this relation as
A1A0
1=A3A4+t4A2
2: (22)
2.7.g-vectors.
Theorem 2.14 ([FZ07, DWZ10, Tra11, GHKK18]) .The quantum cluster variable A~ |;itakes the
following form:
A~ |;i=X
n2Ncnzg~ |;i+!1(n)(23)
forcn2|t,c0= 1, and some g~ |;i2Msuch thatg~ |;i(eh)0for allh2F.
Note that the bases EandE=fe
i:i2Iggive natural identications of N=ZIandM=ZI.
Denote the natural projection prIuf:ZI!ZIuf.
Denition 2.15. The vector g~ |;i2ZIis called the i-th (extended) g-vector of the seed s~ |with
respect to the initial seed s. Its projection prIufg~ |;iis called the principalg-vector .
The sumP
n2Ncnz!1(n)with coecients as in (23) is called the F-polynomial of the quantum
cluster variable A~ |;i.
We note that g~ |;i=e
s~ |;iunder the identication M=ZI.BRACELETS BASES ARE THETA BASES 17
Remark 2.16.There is a multivariate polynomial F~ |;iin the variables Xk:=zek2|t[Nuf],k2Iuf,
such that the factorP
n2Ncnz!1(n)is obtained from it by setting Xk=A!1(ek)and replacing tby
td; i.e., by applying !1as in (14). The polynomial F~ |;iis called the i-thF-polynomial of the seed s~ |
with respect to the initial seed s. It is well-known that prIufg~ |;iandF~ |;ionly depend on ~ |,i, and the
submatrix ( !ij)i;j2Iuf, see [FZ07].
2.8.Cluster algebras. Theordinary quantum cluster algebra Aord
tis dened to be the sub
|t-algebra of As
tgenerated by the cluster variables together with A 1
ifori2F.
In some settings, it is desirable to not include the inverses of frozen variables. We will write Aord
t
to denote the sub |t-algebra ofAord
tgenerated only by the cluster variables A~ |;ifor all~ |and alli2I.
For each~ |, let
C~ |+:=R0he
s~ |;iji2IiMR (24)
(i.e.,C~ |+is generated by the extended g-vectors of s~ |), and let
C+
~ |:=C~ |++R0h e
s~ |;iji2FiMR: (25)
Then (A
~ |) 1(zm) is inAord
t(respectively,Aord
t) for eachm2C+
~ |\M(respectively, each m2C~ |+\M).
The elements of this form are called (quantum) cluster monomials .
For each sequence ~ |inInFas above, the subring
A~ |;t:= (A
~ |) 1(As~ |
t)
ofAs
tis called anA-cluster , or simply a cluster. The upper quantum cluster algebra Aup
tis
dened to be the intersection in As
tof all the clusters, i.e.,
Aup
t:=\
~ |A~ |;tAs
t:
Additionally, we denote
A~ |;t:= (A
~ |) 1(As~ |
t)
forAs~ |
tas in (15) and then dene
Aup
t:=\
~ |A~ |;tAs
t:
Note thatAup
tAup
t.
Similarly, for each ~ |, the subring
X~ |;t:= (X
~ |) 1(Xs~ |
t)
ofXs
tis called anX-cluster . Then we dene the quantum cluster Poisson algebra
Xup
t:=\
~ |X~ |;tXs
t:
As noted at the start of this subsection, the above denitions make sense in the classical limit as
well, and mutations may be dened as in (17) and (18) with t= 1. In this way one obtains the
corresponding classical cluster algebras Aord,Aup,Aord, andAup. Similarly,Xup:=Xup
1. We note
that dening these classical algebras does not require the injectivity assumption to hold.
Note that Theorem 2.14 implies the \Laurent phenomenon,": Aord
tAup
tandAord
tAup
t, see
[FZ02] and [BZ05].18 TRAVIS MANDEL AND FAN QIN
If we want to make clear that the algebra Aord
t,Aup
t,Xup
t, etc., under consideration was constructed
from a certain seed (or mutation equivalence class of seeds) s, we may write sin parentheses as in
Aord
t(s),Aup
t(s),Xup
t(s), etc.
Given a seed sand the corresponding principal coecients seed sprin, letAprin;up=Aup(sprin)
denote the upper cluster algebra with principal coecients, i.e., the upper cluster algebra associated
tosprin. Recall:Mprin!Mas in (6). Applying to the exponents of monomials induces an
algebra homomorphism
:Aprin;up!Aup:
Recall that if ( s;) is a compatible pair, then so is ( sprin;). When quantizing using these com-
patible pairs, also induces an algebra homomorphism (cf. [DM21, Lem. 4.1])
:Aprin;up
t!Aup
t:
2.9.Positivity. An element of |t=|[t1=D] is called non-negative if its coecients lie in Z0.
Let there be given an initial seed sand compatible . Consider the upper cluster algebra Aup
t
As
t=|t[M] as before. Given any element f2Aup
tAs
tand any sequence of non-frozen indices ~ |,
applyingA
~ |tofyields a Laurent polynomial
A
~ |(f) =X
m2Ma~ |;mzm2As~ |
t=|t[M]:
With this notation, one says that fisuniversally positive with respect to the cluster atlas , or
cluster positive for short, if a~ |;mis non-negative for each ~ |andm. Similarly for the classical setting
but with \non-negative" taking the usual meaning, i.e., a~ |;mZ0.
Now letf2Aup
t(orAup) be a nonzero cluster positive element. We say that such fisatomic
with respect to the cluster atlas , orcluster atomic for short, if it cannot be written as a sum
of two other nonzero cluster positive elements.
Next suppose that B=ffmgm2Mis a|t-module basis for a |t-algebraAt(respectively, a |-module
basis for a |-algebraA). Givenp1;:::;ps;p2M, the structure constant (p1;:::;ps;p)2|t
(respectively, |) is dened by
fp1fps=X
p2M(p1;:::;ps;p)fp:
One says thatBisstrongly positive (in the quantum or classical setting) if all of the structure
constants are non-negative.
One says that the basis Bis universally positive with respect to the cluster atlas if each element of
Bis universally positive with respect to the cluster atlas. It is further called atomic with respect to
the cluster atlas if it consists precisely of the cluster atomic elements of the algebra.
Lemma 2.17. LetBbe a basis forAup
t(orAup) which includes all the cluster monomials. Then we
have the following implications:
Bis atomic with respect to the cluster atlas
)B is strongly positive
)B is universally positive with respect to the cluster atlas.BRACELETS BASES ARE THETA BASES 19
Proof. The rst implication is straightforward because the product of any collection of universally
positive elements remains universally positive.
The second implication is also well-known in cluster theory; see the proof of [HL10, Prop. 2.2]. 
We note that one similarly denes cluster positivity, cluster atomicity, and strong positivity for
elements/bases of Xup
tandXup.
3.Cluster algebras from surfaces
We now review cluster algebras arising from marked surfaces. See [FST08, MSW11, MSW13,
FT18b] for more on these constructions in the classical setting, and see [Thu14, Mul16b] for the
quantum setting.
3.1.Denition of the skein algebras. LetSbe a compact oriented surface, possibly with boundary|
we will say Sis \closed" to mean @S=;. Let Mbe a nite collection of distinct marked points in
S. Such a pair  = ( S;M) is called a marked surface . Markings in the interior of Sare called
punctures . Starting in ยง3.2, we will assume that  is triangulable, as dened there.
Amulticurve is an immersion :C!Sof a compact unoriented 1-manifold Csuch that the
boundary of Cmaps to M, but no interior points of Cmap to@SorM. One calls two multicurves
homotopic if there is a homotopy between them whose bers are all multicurves. A curve is a
connected multicurve. A loop is a curve whose domain is homeomorphic to a circle, and an arcis a
curve whose domain is homeomorphic to a closed interval. A boundary arc is an arc in  which is
homotopic to the closure of a component of @Sn(M\@S). An arc which is not a boundary arc is
called an interior arc .
Forp2S, astrand of a multicurve :C!Snearpis a connected component of  1(D(p)),
whereD(p) is an arbitrarily small closed disk around p, or a closed half disk if p2@S. For any given
arc, we choose two strands which contain the endpoints and do not intersect in SnM, and we call
these strands the ends of the arc.
A multicurve is called transverse if all self-intersections are transverse (i.e., all strands have
dierent tangent directions at intersection points) and all interior crossings are between only two
strands | by an interior crossing we mean an intersection between strands at a point pinSnM. A
transverse multicurve is called simple if it has no interior crossings and no contractible components.
By acontractible arc , we mean an arc which has both endpoints at the same marked point p2M
and is contractible in Sn(Mnp). Similarly, a contractible loop is a loop which has no interior
crossings and is contractible in SnM.
Alink is a transverse multicurve together with a choice of ordering of the strands at each interior
crossing,9i.e., a choice of which strand is \over" and which is \under." As in [Mul16b], we require
homotopies between links to remain in the set of transverse multicurves.10Recall |t:=|[t1=D]
9[Mul16b] also chooses equivalence relations and orderings of strands at marked points. This is useful for some
computations and gives a geometric interpretation for multiplication by t1and for the tk-factor in the denition of
the superposition product. However, it is not necessary for dening the skein algebra, cf. [Mul16b, Rmk. 3.1]. So for
simplicity we view all intersections at endpoints as being at the same height.
10This transversality condition ensures that intersection points are not created nor removed under homotopy, and
so the over/under labellings of strands are also preserved. Alternatively, one could consider framed links in S[0;1] up
to ambient isotopy. These descriptions dier in that the former does not allow for certain framed Reidemeister moves,
but these moves follow later as a consequence of the skein relations, cf. [Mul16b, Rmk. 2.3 and ยง3.2].20 TRAVIS MANDEL AND FAN QIN
for some xed positive integer D. Let|Links
t() denote the free |t-module with basis given by the
homotopy equivalence classes [ C] of linksCin .
Assume for now that  has no punctures. Then the skein module Skt() is dened to be |Links
t()=R,
whereRdenotes the module of relations in |Links
t() generated by the following \skein" relations |
here and throughout, we use the notation
q=t 2
sotcan be viewed as a xed choice of square root of q 1:
Contractible arcs are equivalent to 0;
= 0
 = 0
A contractible loop is equivalent to  (q2+q 2)[;], where [;] denotes the empty link;
= (q2+q 2)
The Kauman skein relation, i.e., the following equivalence, understood to apply to links
locally inside some disk while the link is preserved outside the disk:
=q
 +q 1
Figure 3.2. The Kauman skein relation.
One makes Skt() into an associative algebra with unit [ ;] using the superposition product : ifX
andYare links such that X[Yhas transverse crossings, then [ X][Y] is, for a certain k2Z(dened
below), equal to tktimes the class of the link [ X[Y] in which strands of Xalways cross over strands
ofYat each interior crossing | if XandYare not transverse to each other, one rst replaces them
with homotopic links which are transverse. The integer kis dened as follows: for each arc i, let@1(i)
and@2(i) denote the two ends of i(for arbitrary numbering). Then given two arcs i;j, dene11
(i;j) :=X
a;b2f1;2g8
>><
>>:0 if@a(i) and@b(j) have dierent endpoints,
 1 if@a(i) is clockwise of @b(j),
1 if@a(i) is counterclockwise of @b(j).(26)
Then the exponent kis given by k=P
i;j(i;j), where the sum is over all pairs of arcs i2Xand
j2Y. See Example 3.4.
This algebra Skt() with the superposition product is called the (Kauman) skein algebra of
. We may also call this the quantum skein algebra, and we may refer to Sk1() as the classical skein
algebra. For brevity, we will often work only in the quantum setup in this section since the classical
analog following easily by setting t= 1. In the classical setting, the Kauman skein relation implies
11Here, \@a(i) is clockwise of @b(j)" means that we can obtain @a(i) from@b(j) by a clockwise rotation of @b(j)
inside the surface with their common endpoint on the boundary xed. Our denition of  diers from [Mul16b, ยง6.2]
by a sign, see Remark 2.5.BRACELETS BASES ARE THETA BASES 21
that swapping the top and bottom strands of a link preserves the corresponding element of the skein
algebra, so one may work with multicurves rather than links.
In cases with punctures, we still dene the classical skein algebra Sk() in the same way (with
t= 1) except with one more set of relations:
A simple loop around a single puncture is equivalent to 2.
= 2
For triangulable  (cf. ยง3.2 for the denition of \triangulable") this relation is essentially forced on
us by the the previous relations if we want Sk() to be an integral domain. Indeed, if we multiply a
loopLaround a puncture by an arc which intersects Lonce (or, if  is a once-punctured surface
without boundary, multiply Lby a non-contractible arc which intersects Ltwice), then the result
is 2; hence (L 2)= 0.
Remark 3.1.We note that if one attempts to dene Skt() as above for a punctured surface, mul-
tiplying a loop Laround a puncture pby an arcintersecting Lonce yields ( q+q 1), suggesting
L=q+q 1. But then doing the same for an arc which hitsLtwice yields dierent results (e.g., one
computesL=q2+q 2if both ends of are atpand both strands of pass under L), so the quantum
relations are incompatible in the punctured cases without imposing conditions on q. Thus, without
specializing t,Skt() is only dened for unpunctured surfaces. Introducing enough extra coecients
(e.g., principal coecients like in [MW13, FT18b]) would make quantization possible in general|we
consider this in ยง6.2. See [RY14] for another approach in which one adjoins variables associated to
the punctures, and see [L ^19, ยง8] for an approach in which, for each puncture, one cuts out a small
disk containing the puncture in its boundary.
Thelocalized skein algebra Skt() is the Ore localization of Skt() at the set of boundary arcs
of , cf [Mul16b, ยง5.1]. Similarly, Sk() is the localization of Sk() at the set of boundary arcs of .
For convenience, we shall often continue to include tin our notation as in the quantized setting,
even when quantization is not possible, with the understanding that one should set t= 1if necessary.
Given an element of Skt() or Sk t() represented by a link L, letLdenote the element obtained
by reversing the orderings of all crossings of L; i.e., at each crossing, we change which strand is on
top.
Lemma 3.2 ([Mul16b]) .There is an involutive |-algebra automorphism of Skt()mappingt7!t 1
andL7!Lfor all links L. Furthermore, this extends to an involutive |-algebra automorphism of
Skt().
Proof. The statement for Skt() is [Mul16b, Prop. 3.11]. The extension to Sk t() is via (xy 1) =
y 1x; cf. the discussion following [Mul16b, proof of Prop. 5.2]. 
The involution of Lemma 3.2 is called the bar involution for the skein algebra. Elements which
are invariant under the bar involution are said to be bar-invariant .
3.2.Ideal triangulations and cluster structure. An(ideal) triangulation  of  is a maximal
collection of pairwise non-homotopic simple arcs in  which do not intersect each other in the interior
ofSnM. A triangle with only two distinct sides is called self-folded , cf. Figure 3.3. We shall22 TRAVIS MANDEL AND FAN QIN
refer to the boundary of a self-folded triangle as a noose | i.e., a noose is an arc which bounds a
once-punctured monogon.
Figure 3.3. A self-folded triangle. The outer arc is called a noose. Note that the
marked point in the center must be a puncture.
A marked surface  = ( S;M) istriangulable if all the following hold (see [FST08, Section 2]):
each connected component of Scontains at least one marked point;
each boundary component of Scontains at least one marked point;
no connected component is a disk with 2 marked points or a sphere with 3 marked
points.12
We will assume from now on that  is triangulable.
Given a triangulation  of , one associates a seed
s= (N;I;E =feiji2Ig;F;! ) (27)
as follows. First, we take the index-set Ito be the set of arcs in , with Fthe subset consisting of
boundary arcs. Then N:=ZI, andE=feigi2Iis the obvious basis.
One denes !=BTas follows. First, for each arc i2, ifiis the arc inside a self-folded triangle,
leti0be the corresponding arc which bounds the self-folded triangle. For arcs i2 which are not
inside self-folded triangles, let i0=i. Then for each pair of arcs i;j2, we dene B(ei;ej) in terms
of the following sum over all triangles Tin  which are not self-folded:13
B(ei;ej) :=X
T8
>><
>>:0 ifi0andj0are not both in T;
 1 ifj0is the arc immediately counterclockwise of i0inT;
1 ifj0is the arc immediately clockwise of i0inT.
In particular, B(ei;ej)2f  2; 1;0;1;2gfor each pair of arcs i;j2. Following [FST08, Mul16b],
Bis called the signed adjacency matrix or skew-adjacency matrix. See Example 3.4.
In cases without punctures, the orientation matrix  is dened to be the matrix associated to
the pairing dened on M=Nby
(e
i;e
j) = (i;j) (28)
for  as in (26).
Lemma 3.3 ([Mul16b], Prop. 7.8) .Fora marked surface without punctures, (s;)is a compatible
pair satisfying (2)ford= 4.
12We exclude the 3-punctured sphere for technical reasons despite it admitting a nice triangulation. Nevertheless,
the structure for the associated cluster algebra is easily understood: it is associated with the quiver consisting of three
disconnected unfrozen vertices.
13Here, we view a triangle Tas an oriented circle via homotopy, with the orientation induced by that of S, and we
consider the relative positions of the arcs i0andj0on the circle.BRACELETS BASES ARE THETA BASES 23
Proof. Any internal arc xjis contained in exactly two triangles, whose remaining arcs are denoted
byxki, 1i4, see Figure 3.2. Note that the two endpoints of xjmight be the same, and some
remaining arcs might be repeated same. Denote xki+4=xkifor simplicity. Let videnote to the vertex
of the quadrilateral containing xjwhich corresponds to the intersection xki\xki+1in Figure 3.2. Note
thatxkiandxki+1can not be the same arc, because otherwise viwould become a puncture.
Letejdenote the basis vector in Ncorresponding to xj. For any arc 2, lete
be the corre-
sponding basis vector in M. By our denition of the matrix B, we get!1(ej) =P
1i4( 1)i 1e
xki.
We have to show that ( e
;!1(ej)) = 0 for any arc 2 non-homotopic to xj, and (e
xj;!1(ej)) = 4.
Let us rst consider ( e
;!1(ej)) fornot homotopic to xj. In view of (26), in order to calculate
(;xki), we compute the contribution from the strands of the pair ( ;xki) at each vertex of the
quadrilateral, where we can assume the vertices are distinct in the computation because we work
with strands. If =xkiwe may perturb xkito a homotopic arc bending into the quadrilateral when
computing . Now at any vertex vi, 1i4, the contributions to ( ;xki) and (;xki+1) are the
same, while the contributions to ( ;xki+2) and (;xki+3) are zero. We deduce that ( e
;!1(ej)) =P
1i4( 1)i 1(;xki) = 0.
Similarly, at the vertex vi,i= 1;3, the contribution to ( xj;xki) is 1 and the contribution to
(xj;xki+1) is 1, while the contributions to ( ;xki+2) and (;xki+3) are zero. We deduce that
(e
xj;!1(ej)) =P
1i4( 1)i 1(xj;xki) = 4. 
xj
xk1
xk2 xk3xk4
Figure 3.4. The arcs adjacent to an internal arc xj.
Given a triangulation  and an interior arc i2 which is not inside a self-folded triangle, note
that there is a unique quadrilateral Rin  withias a diagonal. The ip(or mutation, or Ptolemy
transform) of  at i, denotedi(), is the triangulation obtained by replacing iwith the other
diagonali0ofRwhile keeping the rest of  the same. See Figure 3.5.

0
Figure 3.5. Two triangulations of a quadrilateral related by the ip at the arc .
Example 3.4. Let  be the annulus with one marking on each boundary component as in Figure
3.6. The annulus on the left side of the gure has the triangulation  consisting of two boundary arcs24 TRAVIS MANDEL AND FAN QIN
b1;b2and two additional arcs 1;2. One checks that if we label 1;2;b1;b2as 1;2;3;4, respectively,
then the corresponding compatible pair ( s;) is that of Examples 2.3 and 2.6.
In Proposition 3.7, we will see that Sk t() can be identied with the cluster algebra associated to
this ( s;). Using the Kauman skein relation, we see [ 1][0
1] =q 2[2]2+ [b1][b2]. This equality
recovers the the mutation 1ons; compare to (22) using [ 1] =A1, [0
1] =A0
1, [2] =A2, [b1] =A3,
[b2] =A4, andq=t 2.
b1
b212
b1
b20
12
Figure 3.6. Two triangulations of an annulus with one marking on each boundary
component. The triangulations are related by the ip at 1.
Given a triangulation , let [] be the element of Skt() corresponding to the link consisting
precisely of the union of the arcs in . Let [ uf] be the element which is similarly dened but using
only the non-boundary arcs of .
For any two simple multicurves a;b, letc(a;b) be the crossing number ofaandb, i.e., the smallest
possible number of intersection points in SnMbetween all possible pairs of transverse multicurves
homotopic to aandbrespectively, not counting intersections at marked points. As in [Mul16b, ยง4.2],
we extend this denition to arbitrary a;b2Skt() by specifying that for a=P
ii[Ci],b=P
jj[Dj]
denoting the decompositions of aandbinto linear combinations of distinct simple multicurves [ Ci],
[Dj],14the crossing number c(a;b) is dened as the maximum of c(Ci;Dj) over all pairs ([ Ci];[Dj])
appearing.
Lemma 3.5 ([Mul16b], Lem. 4.11) .Letabe a simple arc in and letb2Skt()withc(a;b)1.
Then c(a;ab)c(a;b) 1.
Proof. In the unpunctured case, this is [Mul16b, Lem. 4.11]. Essentially the same argument works in
the presence of punctures. 
Corollary 3.6. For any triangulation ofand anyb2Skt(), the product [uf]kbfork0is
a linear combination of products of arcs of . Similarly for any b2Skt()with []in place of [uf].
Because it will be useful later, we recall that by [FST08, Lem. 2.13], there always exists a triangu-
lation without self-folded triangles.
The following summarizes some known results on the relationship between (quantum) skein algebras
and (quantum) cluster algebras in the unpunctured setting.
14The decompositions are deduced from skein relations. They are unique by Lemma 4.2.BRACELETS BASES ARE THETA BASES 25
Proposition 3.7 (Skein algebras and cluster algebras|unpunctured setting) .Letbe a triangulable
marked surface without punctures. Let be an ideal triangulation of and let sbe the associated
seed as in (27). Let be the corresponding skew-symmetric pairing on Mas in (28), so(s;)is a
compatible pair (Lemma 3.3). Then we have inclusions
Aord
tSkt()Aup
t (29)
and
Aord
tSkt()Aup
t (30)
along with the corresponding classical analogs of these inclusions. Furthermore, these inclusions iden-
tify simple arcs bijectively with cluster variables, boundary arcs being identied with the frozen cluster
variables. Triangulations correspond bijectively with clusters, and mutation of seeds/clusters corre-
sponds to ips of triangulations. If each component of contains at least two markings (or even
without this condition if t= 1), then the inclusions in (29) are actually isomorphisms.
Proof. In the classical setting, the relationship between ips and mutations is in [FST08] and [FG06],
and similarly for the relationship between arcs and cluster variables, cf. [FT18b, Thm. 6.1]. The
quantum analog of these relationships is due to [Mul16b].
The inclusions (29) are [Mul16b, Thm. 7.15]. The statement on the inclusions in (29) actually
being equalties is [Mul16b, Thm. 9.8] in the quantum setting with at least two markings on each
component, and this is extended to the once-marked classical setting by [CLS15, Thm. 1].
To prove (30), let  be a triangulation, and let b2Skt(). By Corollary 3.6 and the correspondence
between arcs and cluster variables, bcan be multiplied by a cluster monomial from the cluster As
t,
with no frozen variable factors, to get a linear combination of cluster monomials from this cluster. It
follows that b2As
t. Sinceband  were arbitrary, the inclusion Skt()Aup
tfollows. 
We note that the equality Sk t() =Aup
talso holds for all unpunctured surfaces (including once-
marked quantum cases) as a consequence of our later results (Theorem 9.5), and similarly, Skt() =
Aup
t(Corollary 9.8).
Lemma 3.8. The bar involutions of the skein algebras are compatible with the bar involutions of the
corresponding cluster algebras.
Proof. It suces to check this for tand for the cluster variables/arcs, and the claim is clear for these
elements. 
Extending Proposition 3.7 to the punctured setting (with t= 1) requires introducing tagged arcs.
3.3.The tagged skein algebra. In the following, we will extend arcs to tagged arcs following
[FST08, FT18b]. We use this to extend skein algebras to tagged skein algebras as outlined in [MSW13,
ยง8], and we prove some basic properties. Some results here, like Proposition 3.9, are not strictly needed
for the rest of the paper, but they make the construction more elegant and may be of independent
interest.
In the approach here, the tagged skein algebra will be understood in terms of functions on decorated
Teichm uller space. Alternatively, one may dene the tagged skein algebra similarly to how we handled
the skein algebra|using \generalized tagged multicurves" as formal generators and then modding out
by certain relations (those from the untagged setting in ยง3.1 plus the local digon relation from Figure
3.13). The fact that these approaches are equivalent is Corollary 9.9.26 TRAVIS MANDEL AND FAN QIN
3.3.1. Tagged arcs and tagged triangulations. As we saw in ยง2, it is always possible to mutate a seed
with respect to any non-frozen index. On the other hand, if iis an interior arc of  which is inside
a self-folded triangle (not the noose), then there is no way to ip i. Since ips should correspond to
mutations, this motivated [FST08] to dene tagged triangulations . Tagged triangulations consist
of tagged arcs. A tagged arc is a simple arc together with a labelling of each end of as \plain"
or \notched," subject to the following rules:
(1)does not cut out a once-punctured monogon (i.e., cannot be a noose);
(2) Endpoints of which lie in @Sare tagged plain;
(3) If both ends of lie at the same marked point, then they are tagged in the same way.
More generally, a generalized tagged arc is an arcwith each end labelled \plain" or \notched"
subject only to the condition that endpoints lying in @Sare tagged plain. Generalized tagged arcs
are not required to be simple, and they may violate Conditions (1) and/or (3) above.
Given an untagged arc which is not a noose, we can associate a tagged arc () by simply tagging
both ends as plain. If is a noose with ends at mand surrounding the puncture p, cutting out a
once-punctured monogon  , then the associated tagged arc () is represented by a path inside  
betweenmandpwhich is tagged plain at mand notched at p, cf. Figure 3.7.
m mp p
()
Figure 3.7. Left: A noose . Right: The corresponding tagged arc () with notch
atpand plain tagging at m. Here and throughout, notches are illustrated with an
hourglass/bow tie shape.
On the other hand, given a tagged arc , we can forget the tags to obtain an untagged arc .
Following [FST08], two tagged arcs 1;2are called compatible if

1and
2do not intersect in SnM;
If
1=
2up to isotopy, then at least one end of 1is tagged in the same way as the
corresponding end of 2;
If
16=
2up to isotopy but 1and2have a common endpoint o, then the ends of 1and
2atoare tagged in the same way.
Two tagged arcs 1;2are said to be the same if 
1is isotopic to 
2such that the ends are tagged
in the same way. A tagged triangulation is a maximal collection of distinct pairwise-compatible
tagged arcs.
Given a tagged triangulation  and anynon-boundary arc i2, the ipof  atiis the unique
triangulation i() = (nfig)[fi0gwhich can be obtained by replacing iwith a dierent tagged
arci0. The signed adjacency matrix Bof  is dened [FST08, Def. 9.6] to be that of the ideal
triangulation obtained as follows:
If all arcs of  have the same tagging at some p2M, we simply forget this tagging to obtain
the end of an ideal arc.BRACELETS BASES ARE THETA BASES 27
If two arcs of  have dierent taggings at some p2M, then the arc with the notch at pis
replaced with the corresponding noose as in Figure 3.7.
With these signed adjacency matrices, ips again correspond to mutations as in (8) for !=BT; cf.
[FST08, Lem. 9.7].
We note that for unpunctured surfaces, tagged arcs and untagged simple arcs are equivalent (since
notches are only allowed at punctures). We therefore might not specify in the unpunctured setting
whether our arcs are tagged or not.
3.3.2. The tagged skein algebra as functions on decorated Teichm uller space. In [FT18b], tagged arcs
are interpreted geometrically as corresponding to functions on a decorated Teichm uller space T().
Briey, points in T() correspond to the following data:
(1) a complete nite-area hyperbolic structure on SnMwith constant curvature  1, with geodesic
boundary on @SnMand cusps at M, considered up to dieomorphisms of Swhich x Mand
are homotopic to the identity, plus
(2) a choice of horocycle around each cusp (i.e., a loop perpendicular to all the geodesics through
which it passes).
Given a horocycle hof lengthlaround a cusp p, the conjugate horocycle h0aroundpis the one of
lengthl 1. Now, given a tagged arc , letl:T()!Rbe the function which, for a given hyperbolic
structure and choice of horocycles, gives the signed distance between two horocycles (negative if the
horocycles intersect) along a geodesic representative of |here, the two horocycles are those associated
to the endpoints of , and if an end of is notched, the corresponding horocycle is replaced with its
conjugate. The associated lambda length is
:=el=2:T()!R>0: (31)
Let  be an ideal triangulation of  not containing a self-folded triangle (such triangulations
always exist by [FST08, Lem. 2.13]). The corresponding lambda lengths yield a homeomorphism
T()!Rjj
>0[FT18b, Thm. 7.4] (building on ideas of Penner [Pen87, Pen04, Pen12]). Furthermore,
the lambda lengths for all other tagged arcs are Laurent polynomials of the lambda lengths associated
to arcs in  (in the case of notched arcs in once-punctured closed surfaces this seems to be new
but follows from our Example 3.17). In fact, [FT18b, Thm. 8.6] shows that this algebra of tagged
arc lambda lengths forms an ordinary cluster algebra with tagged arcs corresponding bijectively to
cluster variables, tagged triangulations corresponding bijectively to clusters, and ips corresponding
bijectively with mutations (neglecting notched arcs on once-punctured closed surfaces, which we shall
deal with shortly).
We can also understand loops15as functionsT()!R>0. The space of hyperbolic metric as in
(1) above is equivalent to
Teich() := Hom0(1();PSL 2(R))=PSL 2(R) (32)
where Hom0(1();PSL 2(R)) denotes the set of discrete and faithful representations of the the fun-
damental group 1() :=1(SnM) into PSL 2(R) such that a loop surrounding a puncture becomes
15In [FG06], loops are associated to functions on a certain moduli space Aof decorated twisted SL 2-local systems;
cf.ยง10.2 for a review of this perspective and (127) for the functions associated to loops. [FG06, Thm. 1.7(b)] identies
T() with the positive real locus of A. The interpretation of loops as functions on T() given here follows. The
functions associated to arcs are related to lambda lengths in [FG06, ยง11.3].28 TRAVIS MANDEL AND FAN QIN
parabolic, and the action of PSL 2(R) is by conjugation. So given a non-contractible loop Lin , a
pointx2T() associates to Lan element of PSL 2(R) up to conjugation. This can be represented
by an element of SL 2(R) (up to SL 2-conjugation) which we choose to have positive trace if Lis not
contractible in SnMand negative trace otherwise. This trace is the value of the function associated
toLat the point x.
The (partially compactied) tagged skein algebra Sk2() is now dened as the algebra generated
by the loops and tagged arcs, viewed as functions T()!R>0. The localized version Sk2() (also
called the tagged skein algebra) is generated by the tagged arcs, loops, and reciprocals of boundary
arcs (viewed again as functions T()!R>0).
Note that the denition in (31) above makes sense for generalized tagged arcs as well (we dene
= 0 for all contractible generalized tagged arcs ). It seems more natural to include not just loops
and tagged arcs (and inverses of boundary arcs) in the tagged arc skein algebras, but also all these
generalized tagged arcs. In fact, this would not add anything new:
Proposition 3.9. Sk2()contains all generalized tagged arcs.
This will be proved in ยง3.3.4. We note that many of the ideas used in the proof of Proposition
3.9 are sketched in ยง[MSW13, ยง8.4], though the main focus of loc. cit. is on the more complicated
principal coecients setup.
3.3.3. Covering spaces and the skein relation. Before we consider the skein relations for Sk2(), we
introduce some additional techniques.
Lemma 3.10. Simultaneously changing all tags at a puncture pinduces involutive automorphisms ip
ofSk2()andSk2().
In terms ofT(), this automorphism ipcorresponds to the self-homeomorphism which replaces
horocycles at pwith their conjugates, and ipis the induced map on Sk2() or Sk2().
Remark 3.11.By [FST08, Prop. 7.10], Sk2() for  a once-punctured closed surface admits two
distinct but isomorphic cluster structures: one with cluster variables corresponding to plain arcs and
one with cluster variables corresponding to notched arcs. These cluster structures are swapped by the
automorphism ip.
Remark 3.12.If  haskpunctures, then the automorphisms described in Remark 3.11 yield an
action of ( Z=2Z)kon Sk2(). This is interpreted in [FG06, ยง12.6] as an action on the moduli space
ASL2;of decorated twisted SL 2-local systems on . Loc. cit. uses this action to construct the
tagged bracelets basis from a dierent perspective; cf. ยง10.2. Loc. cit. also sketches an argument
implying the positivity of this tagged bracelets basis with respect to the full cluster atlas (not just
ideal triangulations), but we will avoid assuming this result.
LetS0:=SnM, and let:eS0!S0be a nite covering space. Given a point in T() (the
choice of point does not matter), we pull back the associated hyperbolic structure to get a hyperbolic
structure oneS0, and then we compactify eS0with cuspidal points to get a covering space eS!Swhich
is possibly ramied at the punctures. Let e = (eS; 1(M)). The inclusion :1(eS0),!1(S) induces
a pullback : Teich()!Teich(e), which is obviously injective when we describe the Teichm uller
spaces as in (32). Furthermore, a choice of horocycle Hfor somep2Mdetermines a horocycle forBRACELETS BASES ARE THETA BASES 29
each point in  1(p); namely, the corresponding component of  1(H). We thus obtain an inclusion
:T(),!T(e).
Now let Sk2
(e) and Sk2
() be the algebras generated by loops and generalized tagged in e and
, respectively (viewed as functions on T(e) andT(), respectively), which are always tagged plain
at puntures where is ramied. Similarly dene Sk2
(e) and Sk2
(). Then the map induces an
action on functions which gives algebra homomorphisms :Sk2
(e)!Sk2
() and
: Sk2
(e)!Sk2
(): (33)
Here, the reason we have to restrict to arcs which are tagged plain at ramied points is that if is
ramied with order katp, andHis a horocycle centered at p, then the length of the corresponding
component of  1(H) isktimes the length of H|in particular, conjugacy of horocycles around
ramied punctures is not preserved under pullback.
Note that for an element [ C]2Sk2
(e) represented by a generalized tagged multicurve C|i.e.,
a multicurve where arcs are generalized tagged arcs|it is clear from the construction that [C] =
[(C)].
The upshot is that relations in  can be understood by examining relations in a covering space e.
We apply this now to recover some skein relations for Sk2().
Lemma 3.13. When viewed as functions on T(), loops and arcs satisfy all the relations from ยง3.1.
We note that [MW13, ยง6] shows Lemma 3.13 up to some sign issues.
Proof. The (q= 1 case of the) skein relation from Figure 3.2 is the only dicult relation to check.
For this, the case of two distinct arcs crossing at a single point is [FT18b, Prop. 7.6] (originally due
to [Pen87, Prop. 2.6(a)]). An argument showing this skein relation for distinct arcs and/or loops
crossing a single point is given in [FG06, Proof of Thm. 12.2]. For distinct arcs and/or loops crossing
an arbitrary number of times, one may always pass to a covering space e where the curves in question
cross at only one point, and then the skein relation applies here, hence it holds for  as well.
It remains to consider the case of a self-intersecting curve Crepresenting [ C]2Sk2(). Let [C0] be
the element of Sk2() obtained by resolving all self-crossings of Cvia the skein relation|our goal is to
show that [C] = [C0]. Let  be an ideal triangulation for  without self-folded triangles. Since Sk2()
is an integral domain, it suces to show that []k[C] = []k[C0] for some positive integer k. Consider
the representativeP
iai[Ci] (for multicurves Ci) of []k[C] obtained by resolving all crossings of C
withkslightly perturbed copies of  via the skein relation (but not resolving self-crossings of C), then
setting all contractible arcs to 0, all contractible loops to  2, and all loops around punctures equal to
2. A representativeP
jaj[C0
j] for []k[C0] is obtained fromP
iai[Ci] by resolving all self-crossings
of the multicurves Ci, so the resulting multicurves C0
jwill have no crossings. Since the skein relations
respect homotopy of multicurves16[Thu14, Prop. 3.3], to show the equivalence betweenP
iai[Ci] andP
jaj[C0
j], it suces to show that all crossings of the multicurves Cican alternatively be removed via
homotopy.
To see this, let us pass to an s-sheeted covering space e with a lift eCofCthat no longer self-
intersects. Let e be the lifted triangulation for e. As in Corollary 3.6, [ euf]ek[eC] for suciently large
ek2Z0is a linear combination of products of arcs in e. That is, suppose we resolve all crossings of eC
16Recall that we require bers of homotopies to be multicurves, hence immersions, so the Reidemeister moves of
type RII, RIIb, RIII are allowed, but RI is not; cf. [Thu14, Fig. 2]. Loc. cit. uses the term \regular isotopy" for this.30 TRAVIS MANDEL AND FAN QIN
withekslightly perturbed copies of e, then set contractible arcs, contractible loops, and loops around
punctures equal to 0,  2, and 2, respectively, to obtain a representativeP
iai[eCi] of [euf]ek[eC]. Then
each multicurve eCiconsists of disjoint unions of arcs from e, up to homotopy. By construction, for
k=sek, the expression (P
iai[eCi]) is equal toP
iai[Ci] = []k[C] of the previous paragraph
and satises Ci=(eCi). Since the multicurves eCiare homotopic to disjoint unions of lifts of arcs
from , the multicurves Cimust be homotopic to disjoint unions of arcs from . In particular, the
self-crossings of the multicurves Cican be removed via homotopy, as desired. 
Lemma 3.14. The skein relation of Figure 3.2 (with q= 1) applies to crossings involving generalized
tagged arcs with notches as well.
Proof. By associativity, it suces to consider tagged multicurves Cwith only one or two components.
LetMCMconsist of the marked points which do not appear as ends of dierently marked strands
ofC. I.e., we can apply covering space arguments using (33) for coverings which are possibly ramied
at points of MC, but not at points of MnMC. Let us refer to such covering spaces as MC-ramied
coverings.
We may also assume that there are no non-essential crossings (crossings which can be removed
via homotopy, even including homotopies that move us outside the space of immersions) because (as
previously noted) the skein relations respect the framed Reidemeister moves, plus the relation that a
single twist is equivalent to  1. In particular, in cases where Ccontains a contractible component,
the claim becomes trivial.
Now suppose all ends of Care at distinct marked points. Then we can apply the tag changing
automorphisms of Lemma 3.10 to reduce to the plain-tagged setting, and then the claim follows from
Lemma 3.13.
SupposeCconsists of a single component. We have reduced to the case where this component is
a non-contractible generalized tagged arc with both ends at the same marked point. By taking an
MC-ramied covering, choosing a lift of Cin which the crossing under consideration still exists, and
using (33), we reduce to the case where all ends are at distinct marked points as before, and the claim
follows.
So now suppose Cconsists of two components, C1andC2. Since we have now shown that the skein
relation is satised for cases with a single component, we may assume that both components of Care
simple. We will say that a component CiofCis contractible in SnMCifCicuts out a disk in S
whose interior does not contain a point of MC(this allows for arcs with ends in MCto be viewed as
contractible in SnMC). If neither component of Cis a generalized tagged arc which is contractible
inSnMC, then we can use an MC-ramied covering space again to reduce to the case from above
where all ends are at distinct marked points.
Next suppose that just one component, say C1, is not a generalized tagged arc which is contractible
inSnMC. By passing to an MC-ramied covering, we may assume that C1is not an arc with both
ends at the same marked point. Now if C2isa generalized tagged arc which is contractible in SnMC,
then the only point which could possibly be in MnMCis the endpoint of C2, so being contractible
inSnMCimpliesC2is already contractible as an arc in , hence is trivial.
It remains to consider the case where C1andC2are both generalized tagged arcs which are
contractible in SnMCbut not in . In this case, C1andC2will each have dierently tagged ends,
and each cuts out a once-punctured monogon with the other component's endpoint as its puncture.
See Figure 3.8. It will follow from Example 3.16 below that each component here is equivalent toBRACELETS BASES ARE THETA BASES 31
Figure 3.8.
(2 +L) whereLis the loop around the two punctures, so C= (2 +L)2. The fact that we get the
same thing after applying the skein relation to the crossings follows using the computation of (39) in
ยง3.3.5. 
3.3.4. The digon relation and its applications. If no component of  is a once-punctured closed surface,
then the inclusion of the tagged arcs with notches into Sk() (the eld of fractions of Sk2()) can be
realized combinatorially by applying the digon relations from [FT18b, Def. 8.5]:
0=+ (34)
for;0;; as in Figure 3.9. Here, the endpoints of andmight coincide (cf. Example 3.15), and
by Lemma 3.10, the relation is similarly imposed for the modications obtained by simultaneously
changing all the tags at any puncture. By loc. cit., this relation is indeed satised by the associated
lambda lengths.
 0

Figure 3.9. The digon relation: 0=+.
We note that formulas for Laurent expansions of tagged arcs in terms of the the arcs of an arbitrary
tagged triangulation (even in the principal coecient setting) have been worked out in [MSW11] and
extended to loops in [MSW13]. Also cf. [Wil20] for a simplied version of this construction.
Example 3.15 ([FT18b], Lem. 8.2) .Consider a plain-tagged generalized arc cutting out a once-
punctured monogon as in Figure 3.7. Let be the plain arc from the vertex mto the puncture pin
this monogon, and let 0=(), i.e.,0is isotopic to but has a notch at p. Then0=. Indeed,
this is the special case of the digon relation where the opposite marked points coincide, making a
noose anda contractible arc (hence equivalent to 0). Applying imyields a similar relation for the
case where both ends of are notched.
Example 3.16. Letbe a non-contractible generalized tagged arc with both ends at the same
puncturepsuch that one end of is plain and the other is notched. Let 0be the same arc but with
both ends tagged plain. Let L1;L2be the two loops forming the boundary of a tubular neighborhood
ofinS. See Figure 3.10.
We can nd a triple-cover :e! with lifts and0of,0, respectively, contained in a
once-punctured digon; cf. Figure 3.11. The bounding arcs of this punctured digon are labeled and
. We apply the digon relation in e to nd0=+as in Figure 3.9.32 TRAVIS MANDEL AND FAN QIN

 0L2
L1L2
L1
Figure 3.10. A tubular neighborhood of and0in , bound by loops L1andL2.

0


Figure 3.11. A triple cover of the tubular neighborhood from Figure 3.10, along
with liftsand0ofand0, respectively. By the digon relation, we have 0=+.

 
L2 L2
L1 L1
Figure 3.12. :=() and:=().
We now apply to get0=+, where:=() and:=(), cf. Figure 3.11. By
applying the skein relation and recalling that contractible arcs are equivalent to 0, we see that is
equivalent to 0L1, and andis equivalent to 0L2. Dividing both sides by 0yields
=L1+L2: (35)
Note that we may have L1=L2(this happens in the once-punctured torus). In the case where cuts
out a once punctured monogon, one of the loops, say L2, surrounds a single puncture and is therefore
equal to 2, yielding = 2 +L1.
Proof of Proposition 3.9. We saw in ยง3.3.3 that the skein relation of Figure 3.2 applies with tagged
multicurves, so we can repeatedly apply this to reduce to the case of generalized tagged arcs which
are simple (have no crossings). Consider a simple generalized tagged arc which violates Condition
(1) but not Condition (3) from the start of ยง3.3. I.e.,cuts out a once-punctured monogon and both
ends ofhave the same tag. Such is contained in Sk2() by Example 3.15. Now consider the case
of a simple generalized tagged arc which violates Condition (3) (and possibly also Condition (1));BRACELETS BASES ARE THETA BASES 33
i.e., both ends of lie at the same puncture, but they are tagged dierently. We saw in Example 3.16
that suchcan be expressed as a sum of two loops. The claim follows. 
Example 3.17. Consider the same setup as in Example 3.16, but replace the curve having incom-
patible tags with a curve with both ends notched. We nd lifts ;0in a triple cover again and
apply the digon relation to compute 0=0+0, where this time the tagged arcs 0and0are
notched at one end and plain at the other. Applying and then using the skein relations, we nd
that() and() equalL1andL2for,L1andL2as in Example 3.16. Applying (35), we
nd
0= (L1+L2)2: (36)
This will be applied in ยงB.3 to understand the doubly-notched arcs on once-punctured closed surfaces.
In particular, in (36) we nd an expression for the doubly-notched arcs as Laurent polynomials
of plain arcs and loops. Moreover, we observe that they are Laurent polynomials in the arcs of any
tagged triangulation 0. Indeed, Lemmas 3.13 and 3.14 allow us to apply skein relations as in the
proof of Lemma 3.6 to show that is a Laurent polynomial in the arcs of 0up to re-taggings, and
then Examples 3.16 and 3.17 imply that these re-taggings of arcs of 0can themselves be expressed
as Laurent polynomials in the arcs of 0. Putting all this together, we have the following analog of
Proposition 3.7:
Proposition 3.18 (Skein algebras and cluster algebras|punctured setting) .Letbe a triangulable
surface. Let be a ideal triangulation of and let sbe the associated seed as in (27). Then
AordSk2()Aup(37)
and
AordSk2()Aup: (38)
Cluster variables are in bijection with the tagged arcs, minus the notched arcs on once-punctured closed
components. Here, frozen cluster variables correspond to the boundary arcs. Similarly, clusters are
in bijection with tagged triangulations which do not include notched arcs in once-punctured closed
components. Flips of these tagged triangulations correspond to mutations.
In (38), to see that Sk2()Aup, we can apply the proof of (30) from Proposition 3.7 to see
that at least Sk()Aup. In addition, we have seen that arcs with notches belong to Aup, and the
containment Sk2()Aupfollows by applying (34) to see that arcs with notches are in fact contained
inAup.
We note that if  has at least two boundary markings in each component, then we have Aord=Aup
by [Mul13, Thms 4.1, 10.6]. So in this case, (37) and (38) consist of isomorphisms.
Remark 3.19.In the case of a once-punctured torus, [Zho20, ยง5.3] has shown that Sk2() is not equal
toAup(actually, Zhou considers the \canonical algebra" generated by the theta functions, but our
Theorem 9.6 and Equation (161) imply that this agrees with Sk2() up to Q-scalars). Rather, loc. cit.
shows that Sk2() equals to the intersection of Aupwith the upper cluster algebra associated to the
notched arcs. It is natural to ask if the analogous statements hold for all cases with once-punctured
closed components.34 TRAVIS MANDEL AND FAN QIN
3.3.5. The local digon relation. Greg Muller has shown us a \local" version of the digon relation, cf.
Figure 3.13. To our knowledge, this relation has not previously appeared in the literature, so we
provide a proof below.
= +
Figure 3.13. The local digon relation. The relation holds even if there are additional
strands ending at the puncture (inserted into each term without interacting with the
already-pictured strands).
Proposition 3.20. Generalized tagged arcs satisfy the local digon relation of Figure 3.13.
Proof. Suppose the two strands from the left-hand side of Figure 3.13 are parts of generalized tagged
arcsand. Letpbe the puncture in the gure, and let q;rbe the markings corresponding to the
the other endpoints of and, respectively. By applying the skein relations, we may assume that 
andhave no crossings (with each other or with themselves).
Ifp;q;r are distinct, then the relation follows from the usual digon relation (34) from [FT18b].
Similarly, if q=r6=p, and if the taggings of andatq=rare the same, then the relation holds
by Example 3.15.
Now suppose =(by which we mean that the two strands are parts of the same component, not
distinct homotopic components), so p=q=r. Then we are in the situation of Example 3.16, and the
relation holds by (35).
Now suppose p=q6=r. Ifis contractible, then the left-hand side of Figure 3.13 is 0, and the
right-hand side is shown to be 0 using the skein relations. If is not contractible, then we may again
pass to a covering space :e! where the ends of are distinct and then apply the usual digon
relation of (34), followed by , to obtain the right-hand side of Figure 3.13. The case p=r6=qis
similar.
Next, suppose again that p6=q=r, but this time suppose that the taggings of andatq=r
are distinct. By applying the tag-changing automorphism ip, we may assume both ends of are plain
and both ends of are notched. Let Lbe the loop that goes around both punctures. The local digon
relation in this case claims
= 2 +L: (39)
Letbe the noose around qbased atpwhich surrounds , and letbe the arc obtained from by
notching the end at q. Then=by Example 3.15, so
=

By thep=q6=rcase of the local digon relation that we checked above, along with the skein relation,
we compute =(2 +L), so
= 2 +L, as desired.
Finally, suppose p=q=rbut6=. Ifandare both contractible, then the skein relations
imply both sides are 0. Otherwise, we may reduce to one of the above cases by taking a covering
space. BRACELETS BASES ARE THETA BASES 35
3.4.Laminations and coordinates. We next collect useful notions and results about laminations
and corresponding coordinates for any marked surface  = ( S;M) with punctures, following the
conventions in [FT18b, Yur20].
Denition 3.21 (Lamination [FT18b, All16, Yur20]) .Bylaminates , we mean any of the following
crossingless connected curves in SnM, considered up to homotopy17,
closed curves contained in Sn(@S[M);
curves whose ends belong to @SnMor spiral into punctures (with clockwise or counterclockwise
direction);
while the following curves are not allowed:
a null-homotopic closed curve
a curve whose ends belong to @SnMwhich is isotopic to an interval inside @SnM
a curve with two ends spiraling into the same puncture in the same direction without enclosing
anything else.
A laminate is said to be special if it is a loop around a single puncture or an arc retractable to an
interval on @Scontaining exactly one marked point. It is said to be bounded if it has no spiraling
end. A laminate which is not a closed (boundary-less) curve may be called an arc-laminate .
Aninteger unbounded lamination l=Pwi[li] is a nite N-weighted (formal) sum of the homo-
topy classes of non-special pairwise non-intersecting laminates li. The collection of such laminations
is denoted byXL(;Z). For use in ยง10, we dene eXL(;Z) similarly, but allowing the laminates li
to be retractable to intervals on @Scontaining exactly one marked point and allowing these special
laminates to have coecients in Zrather than just N.
Aninteger bounded lamination l=Pwi[li] is a nite Z-weighted (formal) sum of the homotopy
classes of pairwise non-intersecting bounded laminates li, such that the weight of non-special laminates
are non-negative. The collection of such laminations is denoted by AL=AL(;Z).
It is natural to generalize the above denitions to dene the bounded or unbounded laminations
with rational coecients. The corresponding sets are denoted AL(;Q) andXL(;Q).
Choose an (ideal) triangulation . For any laminate land any arc 2, we deform lso that it
intersects with transversely at a minimal number of points. Then let c(;l) denote this minimal
intersecting number between andl.
DenoteNQ=N
QforN=Ns=Zthe lattice for the seed sassociated to .
Proposition 3.22 ([FG07] ยง3.2; [All16] Prop. 5.1.3) .For any given ideal triangulation , we have
a bijection
:AL(;Q)'NQ (40)
such that any bounded lamination L=P
iwi[li]is sent to(L) =P
2(P
i1
2wic(;li))e, where
feg2is the basis in the seed s.
By [All16, Prop. 5.1.4, Thm. 5.1.5], this identication of AL(;Q) withNQrespects mutations,
so the identication is independent of seed if we view Nas the set of tropical points of A.
17Here, homotopies are in SnMand are subject to the requirement that boundaries of curve components must
always map to @Sn(@S\M).36 TRAVIS MANDEL AND FAN QIN
Denition 3.23 (Shear coordinates [FT18b, Def. 12.2][Yur20, ยง2.2]).Letlbe a laminate and an
interior arc of the (ideal) triangulation .
Ifis not contained inside a self-folded triangle, the shear coordinate b
(l) oflwith respect to
the triangulation Tand its arc is dened to be the sum of contributions from the (minimal18)
intersections of lwithas shown in Figure 3.14.
Ifis contained in a self-folded triangle, denote the corresponding noose by 0and the puncture
surrounded by 0byp. Letl(p)denote the laminate obtained from lby reversing the directions of its
spirals atpif they exist. Dene the shear coordinate b
(l) :=b
0(l(p)).

+1  1l
l
Figure 3.14. Shear coordinate contributions. We get a contribution of +1 to b
(l)
whenand the adjacent arcs crossed by lform an S-shape, and a contribution of  1
when they form a Z-shape.
One can further dene the shear coordinates for tagged triangulation. If a tagged triangulation
is given by () where  is an ideal triangulation, dene b()
(l) =b
(l). For a general tagged
triangulation 0, there exists a unique ideal triangulation  such that 0is obtained from ()
by simultaneously changing all tags at some (possibly empty) collection of punctures p1;:::;pr, see
[FT18b, Rmk. 5.13] or [MSW11, Rmk. 3.11]. Then one denes b0
(l) =b()
(p1pr)(l(p1pr)), where
(p1pr)is obtained from by changing the tags at the punctures p1;:::;prandl(p1pr)is obtained
fromlby reversing the direction of its spirals at the punctures p1;:::;pr.
Proposition 3.24 ([FT18b, Theorems 12.3 and 13.6]) .For any given tagged triangulation , we
have a bijection
b:XL(;Z)'M
2ufZe

such thatL=Pwi[l]iis sent tob(L) =P
2uf(P
iwib
(li))e
.
Let 0denote any tagged triangulation obtained from  by a ip. By [Rea14, Thm. 4.3], for any
laminatel, b(l)22Ze
agrees with b0(l)2020Ze
0under the natural identications
2ufZe
=N
s;uf=N
s0;uf=020
ufZe
0, where the identication N
s;uf=N
s0;ufis via the
piecewise-linear tropical mutation map as in (9). Thus, we may view  b:XL(;Z)!N
ufas being
well-dened independently of the choice of triangulation .
Denition 3.25.Let there be given a tagged arc . Following [Yur20, ยง2.3], we associate to an
\elementary laminate "e() as below, see Figure 3.15:
18Ifconnects to punctures, we can remove small neighborhoods of the punctures so that Candlhave only nitely
many intersections [All16, ยง5.1.2]. Then we can deform loutside the neighborhoods so that the intersection number
becomes the minimal. Finally, we count the contributions from Figures 3.14.BRACELETS BASES ARE THETA BASES 37
e() is a laminate contained in a small neighborhood of 
ifhas a boundary endpoint x2M\@S, then the corresponding endpoint of e() is a bound-
ary point located near xin the clockwise direction (clockwise when viewed as the boundary of
a disk removed from a compactication of S|i.e., the positive direction with respect to the
orientation induced by the counterclockwise orientation on S)
ifhas an endpoint at a puncture pwhich is tagged plain (resp. notched), then the corre-
sponding end of e() spirals into pclockwise (resp. counterclockwise)
For convenience, if Lis a closed loop, we dene the corresponding laminate to be e(L) :=L.
e()
e()
Figure 3.15. Elementary laminates associated to tagged arcs.
Recall from ยง2.7 the natural projection prIuf:ZI!ZIufmodding out by frozen vectors.
Proposition 3.26 ([Rea14, Prop. 5.2]) .For any interior tagged arc corresponding to a cluster
variable and any tagged triangulation , we have
 b(e()) = prIufgs([]); (41)
where sis the seed associated to , andgs([])is theg-vector associated to the cluster variable []
with respect to the initial seed s.
We next extend the denition of shear coordinates to account for boundary arcs as well as internal
arcs. For internal arcs ,b
(l) is dened as before. If is a boundary arc, then each endpoint
ofloncontributes1
2tob
(l), where the sign is positive (respectively, negative) if the triangle
containing, together with the corresponding end of l, looks like a triangle from the +1 (respectively,
 1) quadrilateral of Figure 3.14; i.e., the contribution is as in Figure 3.16. Then b
(l) is the sum of
these contributions from all endpoints of lon.
 +1
2  1
2l
l
Figure 3.16. The contribution of an end of the laminate lto the shear coordinate
b
(l) for a boundary edge .
We now dene
eb:AL(;Z)!M
21
2Ze
=1
2Ms38 TRAVIS MANDEL AND FAN QIN
via
eb(X
iwi[l]i) =X
2(X
iwib
(li))e
: (42)
We may also consider the extension to rational coecients, eb:AL(;Q)!L
2Qe
=Ms;Q.
Recall that the bilinear form !associated to sgives a linear map !1fromNs=2Zeto
Ms=2Ze
.
Lemma 3.27. For any ideal triangulation without self-folded triangles and any l2AL(;Z), we
have
!1((l)) =eb(l) (43)
Proof. Any internal arc is a diagonal of some quadrilateral as in Figure 3.14. The intersection points
at the edges of the quadrilateral contribute to the coordinate on the diagonal via!1. We see that
the contributions always sum to twice of the shear coordinate on , as desired.
Similarly, any boundary arc is contained in exactly one triangle T, and the contributions of each
intersection with Tnfgto!1((l)) andb(l) are again easily seen coincide. 
It is straightforward to check that, if `only consists of loops, then eb(l) has vanishing frozen
coordinates, i.e, we can write
!1((l)) =b(l): (44)
3.5.Dehn twists. Given an oriented closed laminate lc, we denote by tw lcthe Dehn twist of Salong
lc; see Figure 3.17.
twlclc
Figure 3.17. Dehn twist.
Theorem 3.28 ([Yur20, Thm. 2.10]) .For any given interior arc 2(foreither a tagged or
ideal triangulation), any non-special laminate l, and any closed laminate lc, there exists m02Nsuch
that, for any mm0, we have
b
(twm
lc(l)) =b
(twm0
lc(l)) + (m m0)#(l\lc)b
(lc): (45)
Remark 3.29.Note that Theorem 3.28 is easily extended to arbitrary integer unbounded laminations
l2XL(;Z) by applying the result to each component separately.
For any given tagged triangulation  = ( )2, lete() denote the collection ( e())2uf. The
corresponding shear coordinates with respect to any given tagged triangulation 0span a cone
C(b0(e())) :=X
2ufR0b0(e())M
2ufRe
= (Nuf;R):BRACELETS BASES ARE THETA BASES 39
LetL=Pr
i=1ni[li] +Ps
j=1wj[cj] denote an integer unbounded lamination where liare pair-
wise non-homotopic closed laminates and cjnon-closed laminates. Let Ldenote a tagged tri-
angulation such that e(L) contains all cjappearing. Denote Ni=P
2L
uf#(li\). Dene
twL=QtwN1Nr
Nini
li:
Proposition 3.30 ([Yur20, Proposition 2.14]) .We have
b(L)2[m0C(b(e(twm
L(L))):
4.The tagged bracelets basis
Inยง4.1-ยง4.2, we review the known construction of the bracelets in classical skein algebras Sk()
associated to (weighted) simple multicurves as in [MSW13]. We simultaneously review the construction
of quantum bracelets bases for quantum skein algebras Sk t() of unpunctured surfaces, as dened in
[Thu14]. Then in ยง4.3 we extend the classical bracelets in the punctured cases by allowing contributions
from tagged arcs (as suggested in [MSW13, ยง8]).
4.1.Weighted simple multicurves and bangles. Recall from ยง3.1 that a multicurve in  is an
immersion:C!Sof a closed unoriented 1-manifold Csuch that the boundary of Cmaps to M,
but no interior points of Cmap to@SorM. Also recall that a curve is a connected multicurve, and
that a multicurve is called simple if it has no interior crossings and no contractible components. For
convenience, we will say that a set of simple multicurves is non-intersecting if they are pairwise non-
intersecting in SnM(even if they intersect in M). Let SMulti() denote the set of simple multicurves
in  considered up to homotopy, no connected component of which is a peripheral loop, i.e., a loop
around a single puncture. Note that, for any simple multicurve C, there exists nitely many pairwise
non-homotopic and non-intersecting simple curves C1;:::;Cksuch thatCis homotopic to the union
overi= 1;:::;k ofwicopies ofCifor some integers wi1. We denote
C=k[
i=1wiCi:
The curves C1;:::;Ckare called the components of C. Note that they may share common endpoints.
The empty set;is also viewed as a simple multicurve.
We callCinternal if its components do not include boundary arcs. Let SMulti()SMulti()
denote the subset of elements which are internal.
An element of SMulti() can thus be equivalently dened as a set of pairwise non-homotopic, non-
intersecting, non-peripheral simple curves C1;:::;Ck, together with associated weights w1;:::;wk2
Z1. Similarly, a weighted simple multicurve is dened to be a collection of pairwise non-
intersecting, non-homotopic, non-peripheral simple curves C1;:::;Ckas above with integer weights
w1;:::;wk, but now we allow any wi2ZwheneverCiis a boundary arc (for other curves we still re-
quirewi0; in any case, we identify a weight-0 curve with ;). IfC=Sk
i=1wiCiandC0=Sk
i=1w0
iCi
have pairwise non-intersecting components, their union is dened to be the weighted simple multicurve
C[C0=k[
i=1(wi+w0
i)Ci:
In particular, C[;=C. The set of weighted simple multicurves on  is denoted wSMulti(). Note
that the set of internal weighted simple multicurves coincides with SMulti().40 TRAVIS MANDEL AND FAN QIN
Recall that any given link Lrepresents an element of Sk t() (where for the classical cases we take
t= 1), which is denoted by [ L], or by a slight abuse of notation, simply by L. In particular, since
simple multicurves have no interior crossings, they are canonically identied with links, and so any
simple multicurve C=Sk
i=1wiCirepresents an element [ C]2Skt(). Furthermore,
[C] =t kY
i=1[Ci]wi(46)
whereis chosen so that [ C] is bar-invariant | explicitly,
[C] =t [C1]w1[Ck]wk
for
=X
wiwj(Ci;Cj) (47)
where the sum is over all pairs of arc components Ci;CjofCwithi<j , and  is as in (26). Using
(46), we extend the denition of [ C]2Skt() to any weighted simple multicurve C=SwiCiby
allowing negative wifor boundary arcs.
Denition 4.1 (Bangles) .For any weighted simple multicurve C=Sk
i=1wiCi, the skein algebra
element [C]2Skt() is called a bangle element represented by C, or simply a bangle . Denote
hCiBang = [C]. We callhCiBang internal ifCis internal.
Let Bangt(), Bangt() and Bang
t() denote the set of bangles, the set of bangles with non-
negative weights and the set of internal bangles, respectively.
When we leave the t-subscript o the above notation, it is understood that t= 1.
Lemma 4.2 ([Thu14, Mul16b]) .Recall that tis understood to equal 1ifhas punctures. With this
understanding, the set Bangt() forms a |t-module basis for Skt(). Similarly, the set Bangt()
forms a |t-module basis for Skt().
Proof. The claims for the classical skein algebra Sk() are [Thu14, Prop. 4.10]. For the quantum
statements for unpunctured surfaces, [Mul16b, Lem. 4.1] says that Bangt() is a |t-module basis for
Skt(), and then [Mul16b, Prop. 5.3] says that Bangt() is a |t-module basis for Sk t(). Finally,
the claim for Sk() follow from that for Sk() via the same argument used to prove [Mul16b, Prop.
5.3]. 
4.2.Bracelets.
Denition 4.3 ([MSW13]) .LetLbe a non-contractible non-peripheral simple loop in . The bracelet
curve Brac wLis the homotopy class of the closed loop obtained by concatenating Lwith itself exactly
wtimes as in the right-hand part of Figure 4.18. Note that Brac wLhasw 1 self-crossings.
LethwLiBracdenote the element [Brac wL] in the classical skein algebra Sk(). It is called a bracelet
element or a bracelet .
LetSwdenote the w-elements permutation group and jSwj=w! its cardinality. [Thu14] observed
that one can associate the trivial w-elements permutation to wLand a certain non-trivial permutation
to Brac(wL), with additional multicurves Lbeing associated to the other permutations by replacingBRACELETS BASES ARE THETA BASES 41
1
5!P
2S5
Figure 4.18. A weight-5 loop viewed as a bangle (left), a band (middle), and a
bracelet (right).
wparallel strands in wLwith strands which cross as indicated by . [Thu14] further considered the
formal average of all multicurves Lcorresponding to any w-elements permutation:
BandwL=X
2Sw1
jSwjL;
see Figure 4.18. It represents the following band element.
Denition 4.4 ([Thu14]) .DenehwLiBand to be the element of the classical skein algebra Sk()
representing Band wL. That is,
hwLiBand =X
2Sw1
jSwj[L]:
It is called a band element or a band .
To extend the bracelets and bands to the quantum setting, we rst need to dene the Chebyshev
polynomials. The Chebyshev polynomials of the rst kind are the polynomials Tk(z),k2Z0,
determined by:
T0(z) = 2
T1(z) =z (48)
Tk+1(z) =zTk(z) Tk 1(z):
These satisfy
Tk(z)T`(z) =Tk+`(z) +Tjk `j(z)
and can be characterized via
Tk(z+z 1) =zk+z k(49)
(this is checked via a straightforward induction). We note that this last property implies that if
A2SL2, then
Tr(Ak) =Tk(Tr(A)):
Lemma 4.5. LetRbe any ring. Letffkgk2Z0be a sequence of elements in Rwithf0= 1. Suppose
that for each s2Z0, we havefs
1=Ps
k=0s;kfkwheres;kis the coecient of zkin the Laurent
expansion of (z+z 1)s2Z[z1]. Thenfs=Ts(f1)for alls1.
Proof. We prove this by induction. The case s= 1 is trivial. Now suppose the claim holds for s 1.
By the inductive hypothesis,
fs
1=sX
k=0s;kfk=s;0+ s 1X
k=1s;kTk(f1)!
+fs:42 TRAVIS MANDEL AND FAN QIN
Solving for fs, we ndfs=h(f1) wherehis the polynomial h(x) =xs s;0 Ps 1
k=1s;kTk(x)2Z[x].
By (49), the claim holds if R=Z[z1] andfk=zk+z kfork1, so this polynomial h(x) must
indeed beTs(x). 
TheChebyshev polynomials of the second kind are the polynomials Uk(z) dened via the
same recursion as in the denition of Tk(z), except that the initial value T0(z) = 2 is replaced with
U0(z) = 1. Fork2Z0,Uksatises
Uk(z+z 1) =zk+z(k 2)+:::+z (k 2)+z k:
Lemma 4.6 ([MSW13, Thu14]) .In the classical skein algebra Sk() , fork2Z1, we have
hkLiBrac=Tk([L])
hkLiBand =Uk([L]):
In view of Lemma 4.6 and following [MSW13, Thu14], for any weighted simple multicurve C=Sk
i=1wiCi, we dene the bracelet element hCiBracin the classical skein algebra Sk() and, for un-
punctured , in the quantum skein algebra Sk t(), via
hCiBrac:=t kY
i=1hwiCiiBrac; (50)
whereis chosen so thathCiBracis bar-invariant (i.e., as in (47)), and the factors are given as follows:
forCia simple non-peripheral loop,
hwiCiiBrac:=Twi([Ci]); (51)
forCia simple arc,hwiCiiBrac:= [Ci]wi.
Denote the subsets of bracelet elements in Sk t() by
Bract() :=fhCiBrac2Skt()jC2wSMulti()g
Bract() :=fhCiBrac2Skt()jC2SMulti()g
Brac
t() :=fhCiBrac2Skt()jC2SMulti()g
One denes the band element hCiBand and the sets Band t(),Bandt(), and Band
t() in the same
way as Brac t(), Bract(), and Brac
t(), respectively, but using Uwin place of Tw. Note that, for
any givenC2wSMulti,hCiBang,hCiBrac,hCiBand are all bar-invariant. In particular, they use the
same factor t.
We have the following analog of Lemma 4.2.
Lemma 4.7 ([Thu14, Mul16b]) .Recall that tis understood to equal 1ifhas punctures. With this
understanding, each of the sets Bract()andBandt()forms a |t-module basis for Skt(). Similarly,
each of the sets Bract()andBandt()forms a |t-module basis for Skt().
Proof. The claims for the bracelets and bands follow easily from the bangles case (Lemma 4.2) and
the denitions of TwandUw. BRACELETS BASES ARE THETA BASES 43
4.3.Tagged bracelets. Let there be given a triangulable marked surface . As we saw in Lemmas
4.2 and 4.7, we have various bases for the classical skein algebra Sk() and Sk(). In the tagged
setting Sk2(), we modify the constructions from ยง4.1-ยง4.2 to include tagged arcs. The resulting set
of \tagged bracelets" is essentially the set denoted Bin [MSW13, ยง8] except that we are working with
boundary coecients but not principal coecients (principal coecients will be considered later).
First, we dene a tagged simple multicurve Cto be a union of non-intersecting tagged arcs and
simple non-peripheral loops, considered up to homotopy, such that the tagged arcs appearing in C
are compatible (as in the denition of tagged triangulations in ยง3.3). As before, we can denote
C=[
iwiCi;
such that exactly wi-many tagged arcs or simple loops in Care isotopic to Ci. The components Ciof
Care said to be compatible .
As before,Cis called internal if its components include no boundary arcs. By allowing wi2Z
for boundary arcs CiinC, we obtain the notion of a weighted tagged simple multicurve . Let
SMulti2denote the set of tagged simple multicurves and wSMulti2the set of weighted tagged simple
multicurves.
We naturally extend the construction of previous bases to tagged cases. The bangle element hCiBang
represented by a weighted tagged simple multicurve C2wSMulti2is dened as the corresponding
element [C] in Sk2(), which is dened as
hCiBang = [C] =Y
i[Ci]wi
whereCiare the components of Cwith weights wi.
Similarly, we dene the bracelet element hCiBracsuch that
hCiBrac:=Y
ihwiCiiBrac
where the factors are dened as follows:
forLa simple loop with weight w>0,hwLiBrac:=Tw([L]);
fora tagged arc with weight w,hwiBrac:= []w.
By replacing Tw( ) byUw( ), we obtain the denition of the band element hCiBand represented by C.
Now
Brac2()
is dened to be the set of all tagged bracelets, and
Brac2()
is dened to be the subset of tagged bracelets for which all weights are non-negative (analogously to
in the denition of Brac()).
A proof that Brac2() forms a basis for Sk2() does not seem to exist in the literature yet,
although a sketch of possible approaches to proving this appeared in [MSW13, ยง8]. We shall prove
this in Theorem 9.6 by identifying the tagged bracelets with the theta bases.
Lemma 4.8. We have Brac()Brac2()andBrac()Brac2().
Proof. The containments are obvious for bracelets which do not include any nooses (arcs bounding
once-punctured monogons). One easily extends to cases with nooses using Example 3.15. 44 TRAVIS MANDEL AND FAN QIN
The following will be useful in the proof of Corollary 9.7.
Lemma 4.9. Brac2()spans Sk2().
Proof. Let [C] be a product of loops and tagged arcs in Sk2(). Thanks to Lemmas 3.13 and 3.14,
any crossings between these loops and tagged arcs can be resolved using the skein relation (Figure 3.2
withq= 1), so we may assume there are no crossings.
Now suppose some pair of tagged arcs 1;2appearing in Care not compatible. Since we have
assumed there are no crossings, it must be the case that the taggings of 1and2disagree at some
common endpoint. We can thus apply the local digon relation (Figure 3.13) to write 12as a
sum of two other arcs and(possibly using the trick of rst working on a covering space and then
projecting). This may result in new crossings, and we again resolve these with the skein relations.
The total number of arc-factors in each term is now strictly less than before. For any term which still
has incompatible arcs, these steps (digon relation followed by skein relations) can be repeated. Since
the total number of arcs decreases with each iteration, this process must terminate.
We thus express [ C] as a linear combination of elements [ Ci] with eachCia tagged simple multicurve.
Since bangles can be expressed as linear combinations of (tagged) bracelets, we see that [ C] can be
expressed as a linear combination of tagged bracelets. Since no step in this process can produce arcs
with negative weights, the tagged bracelets appearing here all lie in Brac2(), as desired. 
5.Scattering diagrams and theta functions
In this section we review the construction of the theta bases for cluster algebras, due to [GHKK18]
in the classical setting and [Man21, DM21] in the quantum setting.
5.1.The quantum torus Lie algebra. Suppose we have either a compatible pair ( s;), or just a
seedsfor which the Injectivity Assumption possibly fails. In this latter case, we replace swithsprin
as in ยง2.3 so that Assumption 2.7 holds, and then we pick a  compatible with this new seed.
Recall our notation regarding quantum torus algebras in ยง2.5. Let ~gtbe the Lie algebra over
|t=|[t1=D] given by
~gt:=M
m2M+|tzm
with bracket
[za;zb] = (t(a;b) t (a;b))za+b:
That is, ~gtis a Lie subalgebra over |tof the quantum torus algebra |t[M] with its commutator bracket
| specically, it is the Lie subalgebra spanned over |tbyzmwithm2M+. Then the quantum
torus Lie algebra gtis dened to be the Lie subalgebra of ~gt
|t|(t) generated over |tby the
elements of the form
^zm:=zm
tdjmj t djmj(52)
form2M+,das in (2). Here,jmjdenotes the index of minM+, i.e., the largest integer kfor which
1
km2M+. We call an element mprimitive ifjmj= 1. The following Lemma implies that these
elements ^zmin fact generate gtas a|t-module (not just as a |tLie subalgebra).
Lemma 5.1. For anya;b2M+, we have(tdja+bj t dja+bj)(t(a;b) t (a;b))
(tdjaj t djaj)(tdjbj t djbj)2|t.BRACELETS BASES ARE THETA BASES 45
Proof. Notice that1
d isZ-valued onM+by (3). Let =jaj;=jbj;=ja+bj. Soa=a0,b=b0
for some primitive elements a0;b02M+. Letdenote the greatest common divisor of ;. Then
divides. Denote=1
d(a0;b0). The fraction in question can be rewritten as
(td t d)(td t d)
(td t d)(td t d)
Denoteq=t2d. It suces to show that the following fraction belongs to |[q]:
(q 1)(q 1)
(q 1)(q 1):
The roots of the denominator are of the following types:
(1) an-th root of unity which is not a -th root of unity, or a -th root of unity which is not a
-th root of unity. Such roots have multiplicity 1;
(2) a-th root of unity. Such roots have multiplicity 2.
The roots of the rst kind are also roots of the factor ( q 1), and those of the second kind are
roots of both factors in the nominator. It follows that the fraction indeed belongs to |[q].
The Lie algebra gtis equipped with the obvious M+-grading, i.e., gt=L
m2M+gt
mwhere
gt
m:=|t^zm:
Here, being M+-graded means that for all a;b2M+, we have [ gt
a;gt
b]gt
a+b.
Note that gtand  satisfy the following compatibility condition:
if (a;b) = 0;then [ gt
a;gt
b] = 0: (53)
The adjoint action of the commutator algebra of |t[M] induces an action of the Lie subalgebra ~gton
|t[M], and this induces an action of the Lie algebra gton|t[M] byM-graded |t-algebra derivations:
ad^za(zb) = ^zazb zb^za=t(a;b) t (a;b)
tdjaj t djajza+b2|t[M]:
Fork2Z1, let ( gt)kgtdenote the Lie algebra ideal spanned by the summands gt
mwith
m2kM+. We dene nilpotent Lie algebras
gt
k:=gt=(gt)(k+1)(54)
and the completion
^gt:= lim  kgt
k:
By the Baker{Campbell{Hausdor formula, we can apply exp to gt
kand^gtto obtain pro-unipotent
algebraic groups Gt
kand ^Gt= lim  kGt
k, respectively. Note that ^Gtcomes with a projection to Gt
k
for eachk2Z1. The (adjoint) action of gton|t[M] byM-graded |t-derivations induces an action
of^gton|tJMKby topologically M-graded |t-derivations, hence an (adjoint) action of ^Gton|tJMK
by|t-algebra automorphisms: for g= exp(b)2^Gtanda2|tJMK, the action is Ad g(a) =gag 1=
exp([b;])(a).
Everything above makes sense in the classical t= 1 limit as well, thus yielding Lie algebras g,gk,
and^g, as well as pro-unipotent algebraic groups Gkand ^G. As a|-module, gis equal to |[M+]. The
bracket on gis given by
[za;zb] = (a;b)za+b; (55)46 TRAVIS MANDEL AND FAN QIN
i.e., [z!1(n);z!1(n0)] =!(n;n0)z!1(n+n0). It is straightforward to check that t7!1 and ^zm7!zm
djmj
determines a Lie algebra homomorphism lim t!1:gt!g, cf. [DM21, ยง2.2.4]. This induces homomor-
phisms, also denoted lim t!1, on each of the other related pairs of Lie algebras or algebraic groups,
e.g., ^gt!^g,^Gt!^G, etc. We also have lim t!1:|t[M]!|[M] viat7!1,zm7!zm, and similarly
for|tJMK!|JMK. This determines actions of ^gand ^Gon|JMKwhich intertwine the actions of ^gt
and ^Gton|tJMK. In particular, ^gacts on |JMKvia
adz!1(n)(zb) = (!1(n);b)z!1(n)+b= dhn;biz!1(n)+b: (56)
Givenm2M+, let
(gt
m)k:=Y
k2Z>0gt
km^gt; (57)
and let (Gt
m)k= exp( gt
m)k. Note that ( Gt
m)kis Abelian. We similarly dene the classical limits gk
m
andGk
m.
5.2.Quantum dilogarithms. Givenv2M+, we shall consider the quantum dilogarithm19
 Li( zv;td):=1X
k=1( 1)k 1
k(tdk t dk)zkv2(gt
v)k^gt; (58)
as well as the quantum exponential
	td(zv):= exp( Li( zv;td))2(Gt
v)k^Gt:
It is well-known (cf. [Kir95, Lem. 8]) that
	td(zv) =1Y
k=11
1 +td(2k 1)zv: (59)
We note that (	 td(zv))1can also be expressed as plethystic exponentials E(zv), see [DM21, ยง2.4.2].
Letp2M, and let:= sgn (v;p). It follows from (59) that the Adjoint action of (	 td(zv))on
zp2|t[M] is given by
Ad	td(zv)(zp) =zpj(v;p)j=dY
k=1(1 +td(2k 1)zv): (60)
Using the notation of (20), one may show (cf. [DM21, ยง2.4.1]) that (60) can be rewritten as
Ad	td(zv)(zp) =j(v;p)j=dX
k=0j(v;p)j=d
k
tdzkv+p: (61)
Recall that lim t!1sends ^zm2gttozm
djmj2g. Applying lim t!1yields analogs of all the above in the
classical limit. Let
 1
dLi( zv) := lim
t!1( Li( zv;td)) =1X
k=1( 1)k 1
dk2zkv2gk
v^g
and
	(zv)1=d:= lim
t!1	td(zv) = exp
 1
dLi( zv)
2Gk
v^G: (62)
19When dening gt, it is important that we take |containing Qso that Li( zv;td) lies in ^gt. So if |does not
contain Q, then in the construction of ^gt, one should replace |twithQt. By (60), the relevant action on |tJMKwill
still be well-dened.BRACELETS BASES ARE THETA BASES 47
In this classical limit, it is clear from either (60) or (61) that
Ad	(zv)1=d(zp) =zp(1 +zv)(v;p)=d: (63)
We note that the quantum mutations ( A
j) 1as in (17) may be expressed as
(A
j) 1(zp) = Ad 1
	td(z!1(ej))(zp): (64)
Similarly, in the classical limit we have
(A
j) 1(zp)jt=1= Ad 1
	(z!1(ej))1=d(zp) =zp(1 +z!1(ej)) hej;pi: (65)
To prove (64), it suces to check that the two descriptions agree on the cluster variables Asj;i=ze
sj;i.
Note that ( !1(ej);e
sj;i) =dij, so we indeed have Ad 1
	td(z!1(ej))(ze
sj;i) =ze
sj;ifori6=j, and by
applying (61), we see
Ad 1
	td(z!1(ej))(ze
sj;j) =ze
sj;j+ze
sj;j+!1(ej)
as in (17).
5.3.Scattering diagrams. We next review scattering diagrams, which are a key tool in dening the
theta functions. We will work in the quantum setting, but the classical setting is essentially the same,
e.g., replacing each gtwith g. Letrdenote the rank of M.
Givenv2M, let
v?:=fm2MRj(v;m) = 0g: (66)
Recall the notation  1:MR!NR, 1(v) := (v;). Let
ker() := ker( 1)MR:
Awall inMRovergtis a pair ( d;fd), where
fd2(Gt
vd)kfor some primitive vd2M+nker(), and
dis a closed, convex, ( r 1)-dimensional, rational-polyhedral cone in v?
dMR.
By a closed, convex, rational-polyhedral cone in MR, we mean an intersection of nitely many sets of
the formfm2MRjhn;mi0gfor various n2N. We suppress vdin the notation for the wall since
this primitive vector is uniquely determined by fdas long asfd6= 1. We call vdthedirection of
the wall. A wall is called incoming ifvd2d, and it is called outgoing otherwise.
Ascattering diagram DinMRovergtis a set of walls in MRovergtsuch that for each k >0,
there are only nitely many ( d;fd)2Dwithfdnot projecting to 1 in Gt
k. Given a scattering diagram
Dovergt, for eachk2Z>0, letDkDdenote the nite scattering diagram over gconsisting of the
(d;fd)2Dfor whichfdis nontrivial in the projection to Gk. We may also view Dkas a scattering
diagram over gkby taking the projections of the elements fd.
5.3.1. Path-ordered products and consistency. For convenience, we will often denote a wall ( d;fd) by
justd. Denote
Supp( D):=[
d2DdMR;48 TRAVIS MANDEL AND FAN QIN
and
Joints( D):= [
d2D@d!
[0
BB@[
d1;d22D
dimd1\d2=r 2d1\d21
CCAMR: (67)
Consider a smooth immersion : [0;1]!MRnJoints( D) with endpoints not in Supp( D) which is
transverse to each wall of Dit crosses. Let ( di;fdi),i= 1;:::;s , denote the walls of Dkcrossed by,
and say they are crossed at times 0 <1:::s<1, respectively. Dene
di:=fsgn ( 0(i);vdi)
di2Gt
k: (68)
Notice that sgn (  0(i);vdi) = sgnh 0(i);ndiiforvdi=!1(ndi) by (2). Let
k
;D:=dsd12Gt
k; (69)
and dene the path-ordered product:
;D:= lim  kk
;D2^Gt: (70)
We note that if i=i+1, then the fact that each Gk
vis abelian implies that the ambiguity in the
ordering of the walls does not aect ;D.
Two scattering diagrams DandD0areequivalent if;D=;D0for each smooth immersion
as above (assuming transversality with the walls of both DandD0). A scattering diagram Dis
consistent if each;Ddepends only on the endpoints of , or equivalently, if ;D= Id whenever 
is a closed path.
The following fundamental result on scattering diagrams is due to [KS06] in the rank 2 classical
setting, [GS11] in the arbitrary rank classical setting, and [KS14] in the general setting. See [DM21,
Thm. 2.13] for the version used here or [GHKK18, Thm. 1.12] for the classical analog.
Theorem 5.2. LetDinbe a nite scattering diagram in MRover gt(org) whose only walls are
incoming. Then there is a unique-up-to-equivalence scattering diagram D, also denoted Scat( Din),
such that Dis consistent, DDin, and DnDinconsists only of outgoing walls.
Given a compatible pair ( s;), let
DAt
in=f(e?
i;	td(z!1(ei)))ji2InFg (71)
fordas in (2). We will work with the associated consistent scattering diagram as in Theorem 5.2:
(72) DAt:= Scat( DAt
in):
Example 5.3. Recall the compatible pair ( s;) associated to the A2-quiver 1 2 as in Examples
2.2 and 2.4. That is, in terms of the basis Eand the dual basis E:=fe
1;e
2g, we have
!= 
0 1
 1 0!
and  = 
0d
 d0!
:
The associated scattering diagram DAtis illustrated in Figure 5.19 using the basis E. Note that one
outgoing wall (the diagonal wall) has been added to DAt
into make the scattering diagram consistent.BRACELETS BASES ARE THETA BASES 49
(e?
2;	td(z( 1;0)))(e?
1;	td(z(0;1)))
(R0(1; 1);	td(z( 1;1)))
Figure 5.19. The scattering diagram DAtassociated to the A2-quiver.
Example 5.4. Recall the compatible pair ( s;) from Examples 2.3 and 2.6, i.e., the compatible pair
associated to an annulus as in Example 3.4. That is, we have
B=0
BBB@0 2 1 1
2 0 1 1
 1 1 0 0
 1 1 0 01
CCCAand  =0
BBB@0 2 0 0
 2 0 0 0
0 0 0 0
0 0 0 01
CCCA:
Also,InF=f1;2gandd= 4. In terms of the dual basis to E, we have
v1:=!1(e1) = (0;2; 1; 1) andv2:=!1(e2) = ( 2;0;1;1): (73)
The associated scattering diagram DAt, intersected with Muf;R=Rhv1;v2i, is illustrated in Figure
5.20. Note that innitely many outgoing wall have been added to DAt
into make the scattering diagram
consistent. Specically, there are new outgoing walls of the form
((e?
1\e?
2) +R0u;	t4(z u))
for eachuof the form ( k; (k+ 1)) or (k+ 1; k) withk2Z1. There is also one additional outgoing
wall:
((e?
1\e?
2) +R0(1; 1);E( (t4+t 4)z( 1;1)))
whereE( (t4+t 4)z( 1;1)) is a \plethystic exponential" (see [DM21, ยง2.4.2] for some background on
plethystic exponentials, but beware that since we have d= 4, ourt4should be treated as t1of loc.
cit.). For example, as in [DM21, Eq. 30], the plethystic exponential here may be given in terms of
quantum exponentials by
E( (t4+t 4)z( 1;1)) =1Y
r=0	(t4)2r((t4)2rz2r( 1;1))	(t 4)2r((t 4)2rz2r( 1;1)):
See [DM21, Ex. 7.10] for more on this and higher Kronecker quivers.
5.4.Broken lines and theta functions. Fix a consistent scattering diagram DinMRovergt. Let
p2M, and letQbe a generic20point inMR. Abroken line with respect to Dand with ends ( p;Q)
is the data of a continuous map : ( 1;0]!MRnJoints( D), values 1<01:::`= 0,
20By \generic" we mean that Qis not contained in n?for anyn2N.50 TRAVIS MANDEL AND FAN QIN
(e?
2;	t4(zv2))(e?
1;	t4(zv1))
Figure 5.20. The scattering diagram DAtintersected with Muf;R, oriented so that
v1points up and v2points to the left.
and for each i= 0;:::;` , an associated monomial cizvi2|t[M], withci2|[t1] andvi2M, such
that:
(i)(0) =Q.
(ii) Fori= 1:::;` ,0() = vifor all2(i 1;i). Similarly, 0() = v0for all2( 1;0).
(iii)c0= 1 andv0=p.
(iv) Fori= 0;:::;` 1,(i)2Supp( D). Let
fi:=Y
(d;fd)2D
d3(i)fsgn (vd;vi)
d2^Gt: (74)
I.e.,fiis the!0 limit of the element j(i ;i+);Ddened in (70) (using a smoothing
of). Thenci+1zvi+1is a homogeneous (with respect to the topological M-grading) term of
Adfi(cizvi) other than the leading term cizvi(i.e.,bends non-trivially at the time i).
For eachp2Mand each generic Q2MR, one denes an element #p;Q2|tJMKvia:
#p;Q:=X
Ends()=(p;Q)czv2|tJMK: (75)
Here, the sum is over all broken lines with ends (p;Q), andczvdenotes the monomial attached to
the nal straight segment of , called the (nal) Laurent monomial of . We callvthe nal exponent
of. In particular, we always have
#0;Q= 1:
Broken lines and theta functions in the t= 1 setting are dened in the analogous way.
Example 5.5. Consider DAtas in Example 5.3. Figure 5.21 shows the three broken lines contributing
to#p;Qforp= v1andQas pictured. One computes that # v1;Q=zv2+zv2 v1+z v1; the three
terms here correspond to the three broken lines, going from left to right.
The following tells us that the theta functions are well-dened and form a topological basis in the
sense of [DM21, ยง2.2.2].
Proposition 5.6 ([DM21], Prop. 3.1) .For xed generic Q2MRand anyp2M,(75) gives a
well-dened element #p;Q2|tJMKof the form
#p;Q=zp 
1 +X
v2M+avzv!
: (76)BRACELETS BASES ARE THETA BASES 51
	td(zv2)	td(zv1)
	td(zv1+v2)Q
Figure 5.21. The three broken lines with ends (  v1;Q) for the scattering diagram
DAtfrom Figure 5.19.
Furthermore, the theta functions Q:=f#p;Q:p2Mgform a topological |t-module basis for AQ:=
|tJMK. Hence, Qalso forms a topological basis for the subalgebra A
QAQgenerated by Q.
The theta functions satisfy the following compatibility condition, due to [CPS22] in the classical
limit and [Man21, Thm. 2.14] in the quantum setup. It says that #p;Qfor dierent values of Qare
related by the action of path-ordered products.
Lemma 5.7. LetDbe a consistent scattering diagram in MRover gtorg. Fix two generic points
Q1;Q22MR. Letbe a smooth path in MRnJoints( D)fromQ1toQ2, transverse to each wall of D
it crosses. Then for any p2M,
#p;Q2= Ad;D(#p;Q1):
In particular, ifQ1;Q2lie in the same chamber of D, then#p;Q1=#p;Q2.
Example 5.8. Consider DAtas in Example 5.4. Up to any nite order `, there are two chambers of
DAt
`which contain the limiting wall, i.e., the diagonal wall whose direction is  !1(e1+e2) = 2e
1 2e
2.
Letpdenote the corresponding primitive vector1
2( v1 v2) =e
1 e
2:
Figure 5.22 shows a broken line contributing z kpto#kp;QforQnear the limiting wall and k2Z1.
Up to any nite order `, forQsuciently close to the limiting wall, the only two broken lines
contributing to #kp;Qwill be the straight broken line, which contributes zkp, and a broken line which
wraps around the joint as in the gure, contributing z kp| indeed, the broken line contributing z kp
always bends as much as possible towards the joint (or not at all on walls where the only allowed
bends are away from the joint), so we see that any broken line with initial monomial zkpwhich crosses
some walls of DAt
`but has dierent bends will not be able to wrap all the way around the origin to
end atQ. Thus, up to any xed nite order `and forQsuciently close to the limiting wall, we have
#kp;Qzkp+z kp(in the module zkp|[M=(`M+)].) (77)
Consider the Chebyshev polynomials of the rst kind Tkas in (48), and the characterization of Tk
in (49). It follows from (77) that
#kp;QTk(#p;Q) (in the module-projection zkp|[M=(`M+)])
forQsuciently close to the limiting wall. By Proposition 5.6, we have an expansion
#kp;Q Tk(#p;Q) =X
m2kp+`M+cm#m;Q;52 TRAVIS MANDEL AND FAN QIN
and by Lemma 5.7, this holds for all Q. Since`is arbitrary, we must in fact have
#kp;Q=Tk(#p;Q): (78)
(e?
2;	t4(zv2))(e?
1;	t4(zv1))
Q
Figure 5.22. A broken line (bold) with ends ( kp;Q) contributing a nal Laurent
monomialz kp.
5.5.Structure constants. For any genericQ1;Q22MR, Lemma 5.7 gives us a canonical isomor-
phismA
Q1 !A
Q2taking#p;Q1to#p;Q2for eachp(see Proposition 5.6 for the denition of A
Q).
It is therefore reasonable to dene an algebra Acan
t:=A
Q(thecanonical cluster algebra ) for an
arbitrary xed choice of generic Q, denoting the corresponding theta functions #p;Qsimply as#p.
Equivalently, consider the |t-module ^Acan
t=^L
p2M|t#p, where the hat indicates that we take a
completion, allowing all formal sumsP
p2Map#psuch that, for each k2Z>0, only nitely many ap
withp2MnkM+are nonzero. As modules, ^Acan
t=AQfor each genericQvia identifying #pwith
#p;Q. We use this identication to give ^Acan
tthe structure of an associative algebra, and then Acan
tis
the sub |t-algebra generated by the theta functions #p,p2M.
Alternatively, the algebra structure on ^Acan
tcan be dened by specifying the structure constants.
As in ยง2.9, givenp1;:::;ps;p2M, the structure constant (p1;:::;ps;p) is the element of |tsuch
that
#p1#ps=X
p2(Ps
i=1pi)+M(p1;:::;ps;p)#p:
The following proposition | [Man21, Prop. 2.15] in the quantum setting or [GHKK18, Prop 6.4(3)]
for the classical version | expresses the structure constants in terms of broken lines:
Proposition 5.9. For anyp1;:::;ps;p2M, the corresponding structure constant is given by
(p1;:::;ps;p)zp=X
1;:::;s
Ends(i)=(pi;Q);i=1;:::;s
v1+:::+vs=p(c1zv1)(cszvs)2|tzp; (79)
wherevidenotes the exponent attached to the last straight segment of i, andQis any generic point
ofMRwhich is suciently close top| by suciently close, we mean that Qandpshare a chamber
of the nite scattering diagram D`for some suciently large `2Z1(an explicit condition for what
is considered \suciently large" is given in Lemma 5.11).
Corollary 5.10. In the notation of Proposition 5.9, if p=p1+:::+ps, then(p1;:::;ps;p) =tk
fork=P
i<j(pi;pj).BRACELETS BASES ARE THETA BASES 53
Proof. For anyQ, the onlys-tuple of broken lines contributing to (79) in this case is the one for which
each broken line is straight|indeed, any bends would result inPvilying inp+M+. Thus, (79)
becomes(p1;:::;ps;p)zp=zp1zps, the right-hand side of which is equal to tkzpforkas in the
statement of the proposition. 
Proposition 5.9 is actually an immediate consequence of the following lemma (whose proof is es-
sentially contained in the proof of [GHKK18, Prop. 6.4(3)]):
Lemma 5.11. Letf=P
p2Mf;p#p2Acan
t. For each generic Q2MR, letQdenote the identi-
cationAcan
t !A
Q|tJMK. Letaf;Q;mdenote the coecients of the Laurent expansion of Q(f),
i.e.,
Q(f) =X
m2Maf;Q;mzm:
Then, for any p, we havef;p=af;Q;pfor all genericQsuciently close to p| by suciently
close, we mean that Qandpshare a chamber of D`for some`which is large enough to ensure that
p =2p0+ (`+ 1)M+wheneverf;p06= 0.
Proof. Let
Mf:=fp2Mjf;p6= 0g:
For anyp2M, the convergence of fwith respect to the topological structure on |tJMKensures that
p =2Mf+ (`+ 1)M+(80)
for suciently large `(cf. [DM21, ยง2.2.2]). Indeed, let suppMQ(f) denote the set of Laurent degrees
appearing in Q(f). Let max(suppMQ(f)) and max Mfdenote the subsets of s-maximal elements
(forsas in Denition 6.1) in suppMQ(f) andMfrespectively. Note that max(suppMQ(f)) and
maxMfare nite by the convergence assumption. Moreover, they coincide, see [Qin22, Def.{Lem.
4.1.1]. By [Qin17, Lem. 3.1.2], we can always choose suciently large `such that
p =2maxMf+ (`+ 1)M+= max(suppMQ(f)) + (`+ 1)M+: (81)
Note that (80) and (81) are just re-phrasings of the notion of \suciently large" from the statement
of the lemma.
Fixp2Mand suciently large `as above. Now for any generic Qand anyp02Mf, (80) ensures
that any broken line with ends ( p0;Q) and nal exponent pcannot bend on any walls in DnD`. It
follows that the coecient of zpin#p0;Qmust be the contribution from the broken lines dened with
respect to D`. In addition, if we choose Qsharing a chamber of D`withp, then the only broken
line with respect to D`ending atQand with the nal exponent pis the straight broken line with
ends (p;Q). Therefore, among all #p0;Qappearing in the theta basis expansion of f, only#p;Qhas a
nonzerozp-coecient, and the zp-coecient of #p;Qis 1. The equality f;p=af;Q;pfollows.
The following result will be used in the proof of Lemma 8.19.
Lemma 5.12. Suppose that Q(#p) =zpwheneverQis suciently close to p. Then, for any p06= 0,
the coecient (p;p0;p)vanishes.
Proof. By the assumption, for Qsuciently close to p, the Laurent expansion Q(#p#p0) equals
zpQ(#p0). By the broken line construction, the Laurent expansion Q(#p0) never has a constant54 TRAVIS MANDEL AND FAN QIN
term (for any generic Qandp06= 0), so the product zpQ(#p) has nozp-term. The claim now follows
from Lemma 5.11. 
The following important property of broken lines is an immediate consequence of [GHKK18, Thm.
1.13] in the classical setting and [DM21, Thm. 2.15] in the quantum setting.
Lemma 5.13 (Positivity of broken lines) .Up to equivalence of the scattering diagram, all broken
lines inMRwith respect to DAorDAthave positive integer coecients (i.e., coecients in Z>0or
Z>0[t1], respectively) for every attached monomial.
5.6.The cluster complex. Recall that a compatible pair ( s;) determines a scattering diagram
DAt:= Scat( DAt
in) where DAt
inis given as in (71) by
DAt
in=f(e?
i;	td(z!1(ei)))ji2InFg (82)
fordas in (2). Also recall the cone
C+
~ |:=fm2MRjhes~ |;i;mi0 for alli2InFgMR (83)
as in (25). We may also denote C+
~ |byC+
s~ |.
The following proposition is a simplied version of [DM21, Prop. 4.9]. The classical version is
essentially [GHKK18, Constr. 1.30, Thm. 4.4].
Proposition 5.14 (Chamber structure of DAt).Two conesC+
~ |andC+
~kas above coincide if and only
if they correspond to the same cluster of Aup
t. The distinct cones C+
~ |=:Cs~ |form the chambers (i.e.,
the top-dimensional cones) of a fan CinMR, called the cluster complex , such that
 C is a sub cone-complex of the cone-complex induced by the supports of the walls of DAt.
Each chamber of Chas exactly #(InF)facets. For two seeds s~ |ands~kmutation equivalent
tos, the corresponding chambers Cs~ |andCs~kinCintersect along a facet dif and only if the
clustersA~ |
tandA~k
tare related by a mutation A
jfor somej2InF, i.e., ifA
s~ |;j(A~ |
t) =A~k
t.
Furthermore, this mutation A
s~ |;jagrees with the wall-crossing automorphism associated to
crossing fromCs~ |toCs~k.
The following is essentially [DM21, Cor. 4.13], or [GHKK18, Prop. 7.1] in the classical setting.
Corollary 5.15. Considerp2Mand genericQ;Q~ |inCsandCs~ |, respectively. Suppose #p;Q2
As
t=|t[M], i.e.,#p;Qis a Laurent polynomial, not just a formal Laurent series. Then #p;Q~ |is
also a Laurent polynomial. Thus, #pdetermines an element of Aup
t. Furthermore, if p2Cs~ |\M,
then#p;Q~ |=zp, and so#p2Aup
tis a quantum cluster monomial. Conversely, all quantum cluster
monomials are quantum theta functions. In particular, Aord
tAcan
t\Aup
t.
The theta functions #pwhich lie inAup
tas in Corollary 5.15 generate and form a |t-module basis
for what one calls the middle cluster algebra Amid
t. Theg-vectors21of these theta function are the
integer points
mid= mid
R\M
21We refer to p2Mas theg-vector of#p. If#pis a cluster variable A~ |;i, then, under the identication M=ZI,
pagrees with the i-th extended g-vector of s~ |with respect to sas in Denition 2.15.BRACELETS BASES ARE THETA BASES 55
of some convex cone mid
R, cf. [GHKK18, Thm. 0.3(2-4)] and [DM21, Thm. 1.2(2)]. One says that
thefull Fock-Goncharov conjecture holds (forAt) if
Amid
t=Aup
t=Acan
t (84)
(so in particular, mid=M). Similarly in the classical setting if the Injectivity Assumption holds.
Similarly, one says that the full Fock-Goncharov conjecture holds for Aprin
tif it holds for the
(quantum) cluster algebra associated to sprin. A similar denition applying to Xtwill be given in ยง5.7.
The following is part of [GHKK18, Prop. 0.14] in the classical setting, and then the quantum analog
follows from [DM21, Thm. 1.2(5)].
Proposition 5.16. If the cluster complex Cisbig, meaning that it is not contained in a closed half-
space, then the full Fock-Goncharov conjecture holds for Aprin
tandXt. If the Injectivity Assumption
holds in addition to Cnot being contained in a half-space, then the full Fock-Goncharov conjecture
holds forAtas well.
Note that the cluster complex Ccan be dened even without knowledge of scattering diagrams,
and in fact without making the Injectivity Assumption. It is simply the fan whose maximal cones are
the conesC+
~ |as in (83) for tuples ~ |2InF.
5.7.Theta bases for Xup
t.Theta functions in XupandXup
tcan be similarly constructed using
a scattering diagram DXtand broken lines in NRwith exponents in N. See [DM21, ยง4.3] for this
construction. Very briey, the idea is to dene gtusing|t[N] in place of |t[M], then construct the
scattering diagram DXtinNRovergtas Scat( DXt
in) for
DXt
in=f(e!?
i;	t(zei))ji2InFg (85)
(ifei2ker(!) for somei2InFthen the wall for this iis left out). Rather than reviewing this in
more detail, we will use [DM21, Lem 4.6] to recover these theta functions from the theta functions for
Aprin
t| this is also the approach used for the classical setting in [GHKK18].
Consider the map
:N!MN (86)
n7!(!1(n);n):
Recall that Mprin=MN. Notice that is the restriction of !prin
1toN(identied with N0) in
(5), so (Mprin)(N). If we construct Aprin;up
t using prinfrom (7) as our compatible form, then
the mapinduces an injection :|tJNK,!|tJMprinK. A choice of seed determines inclusions of Xup
t
andAprin;up
t into|tJNKand|tJMprinK, respectively, and restricts to a map :Xup
t,!Aprin;up
t (cf.
[DM21, Lem. 4.1]) with image the degree 0 part of Aprin;up
t for the grading determined by
degree(z(m;n)) :=m !1(n):
Denition 5.17 ([DM21], Lem. 4.6) .Under the above identication of|tJNKwith a subalgebra of
|tJMprinKfor compatible form prinas in (7), the element #p;Q2|tJNKXup
tforp2Nand generic
Q2NRis dened so that22
(#p;Q) =#(p);(Q)2Aprin;up
t (87)
22Technically, (Q) is not generic in the sense of Footnote 20, but one may use a more general notion of \generic"
as in [DM21, Footnote 5].56 TRAVIS MANDEL AND FAN QIN
Note that Lemma 5.13 applies to ensure positivity of all broken lines contributing to the X-type
theta functions #p;Q,p2N.
Forp2N, one can consider not only the local coordinate expansions #(p);(Q)2|tJ(N)K, but also
#(p);Q02|tJ(N)Kfor any genericQ02Mprin
R=MRNR. LetCprinbe the cluster complex in Mprin
R.
Then forQ0a generic point in the cone of Cprinassociated to a seed sprin
~ |,#(p);Q0is the Laurent (series)
expansion of #(p)in(Xs~ |
t) (or in the appropriate completion) up to an automorphism  prin
~ |dened by
a certain linear map acting on the exponents (cf. [DM21, ยง4.7.2] for more details). Correspondingly
(applying 1), we obtain the Laurent (series) expansions of #pin the clusterXs~ |
t=|t[N] or its
completion |tJNK.
Let mid
Xdenote the set of p2Msuch that#(p);Q2(|t[N]) (as opposed to (|tJNK) for some
(equivalently, all) generic Q2Cprin, cf. [DM21, ยง4.6]. The theta functions f#pjp2mid
Xggenerate
and form a |t-basis for a subalgebra Xmid
tXcan
t\Xup
t. One says that the full Fock-Goncharov
Conjecture holds forXtifXmid
t=Xup
t=Xcan
t.
5.8.Failure of the Injectivity Assumption. So far we have assumed that ssatises Assumption
2.7, but in the classical setting this is sometimes not the case. When the Injectivity Assumption fails,
one can still construct theta functions using the procedure from [GHKK18, Constr. 7.11], which we
shall now recall in an equivalent form.
First, apply the constructions of scattering diagrams, broken lines, and theta functions to the
compatible pair ( sprin;prin) dened in ยง2.3. Recall the map
:Mprin!M; (m;n)7!m;
and the induced maps on algebras as in ยง2.6. One checks from (7) or from the compatibility condition
that
prin((0;n);(m0;n0)) = 0 (88)
for all (m0;n0)2!prin
1((N;0)), hence whenever ( m0;n0) is the direction of a scattering wall. It
follows that all scattering walls of DAprinare closed under addition by elements of (0 ;NR), and all
wall-crossing automorphisms act trivially on z(0;n)for eachn2N. From this one can show that for
eachm2M,n1;n22N, and each pair of generic points Q;Q02Mprin
RwithQ Q02(0;NR), there
is a bijection between broken lines with ends (( m;n 1);Q) and broken lines with ends (( m;n 2);Q0),
and the nal monomials of corresponding broken lines agree after applying .
Consider the cone prin;midof (m;n)2Mprinfor which#(m;n);Qis a nite Laurent polynomial for
all genericQin23the cluster complex Cprinof (sprin;prin). One sees from the above discussion that
prin;midis closed under addition by (0 ;N). Dene
mid:=(prin;mid):
Now for any m2midand any generic Q2MR, let (m;n)2 1(m) and leteQ2 1(Q), and
suppose#(m;n);eQis a Laurent polynomial (as opposed to a formal Laurent series). By construction,
this is always the case for Q2(Cprin). Then we can dene
#m;Q:=(#(m;n);eQ); (89)
23We will often write that a point is in CprinorCto mean that it is in the support of CprinorC, respectively.BRACELETS BASES ARE THETA BASES 57
and this denition is independent of the choices of n2NandeQ2 1(Q). Let
e :=fgenericeQ2Mprin
Rj#(m;n);eQis a Laurent polynomial for all ( m;n)2prin;midg;
 :=(e): (90)
That is,  is the set of points Q2MRsuch that#m;Qis well-dened for all m2mid. Note that
Cby construction.
The elements #m;Qfor dierentQ2  are related by a sort of path-ordered product. For each
Q2, let|(M)Qdenote the subring of |(M) generated over |byf#p;Qjp2midg. Givenf2|(M)Q
a rational function of elements #m;Q, we letef2|(Mprin) denote the corresponding rational function
of the lifts#(m;0);eQforeQ2 1(Q). Now for anyQ;Q02, we dene
Q;Q0:|(M)Q!|(M)Q0
f7!(Ad;DAprin(ef)):
where,is a path from a lift of Qto a lift ofQ0.
Lemma 5.18. The mapsQ;Q0are well-dened isomorphisms satisfying Q;Q0(#m;Q) =#m;Q0for all
m2mid,Q;Q02.
Proof. The independence of the choice of lifts eQ;eQ0follows from (88) and the surrounding discussion.
The independence from the choice of holds because DA;prinis consistent. We note that there may
be multiple ways to express fas a rational function of theta functions, hence multiple choices of lift
ef, but it follows from (88) that these dierent lifts all result in the same Q;Q0(f). The conditions
for being a homomrphism are now easily checked, and then invertibility follows from noting that
Q0;Q= 1
Q;Q0. Finally, we know from Lemma 5.7 that Ad ;DAprin(#p;eQ) =#p;fQ0for allp2prin;mid,
and applying yields#p;Q02|(M)Q0, as desired. 
For anym1;:::;ms2mid, one sees from the above discussion that the structure constant
(m1;:::;ms;m) dened by
#m1;Q#ms;Q=X
m2M(m1;:::;ms;m)#m;Q (91)
are independent of Q2. Indeed, we see that these structure constants are given by
(m1;:::;ms;m) =X
em2 1(m)((em1;:::;ems;em)); (92)
where the sum is over all em2 1(m), and for each i= 1;:::;s ,emiis any xed choice of lift of miby
. Here, the constants (em1;:::;ems;em) can be computed as in Proposition 5.9. In particular, (91) is
a nite sum since the theta functions that appear are positive Laurent polynomials and the structure
constants are positive.
These structure constants canonically determine an algebra structure on
Amid:=M
m2mid|#m:
There is a morphism
:Amid!Aup|[M]
X
m2midam#m7!X
m2midam#m;Q (93)58 TRAVIS MANDEL AND FAN QIN
whereQis any generic point in C+
s=(C+
sprin). [GHKK18] conjectures that is always injective, i.e.,
thatf#m;Qjm2midgis linearly independent. By [GHKK18, Thm 0.3(7)], is at least injective if
some seed mutation equivalent to shas strongly convex M.
On the other hand, even when the Injectivity Assumption possibly fails, we can dene the cluster
complexCinMRby applying to the cones of the principal coecients cluster complex CprinMprin
R.
Then forQ2C+
sandm2C\M,#m;Q2Aupis equal to the cluster monomial with extended g-vector
m. We therefore always have
Aord(Amid)Aup:
We will writeCto mean the closure of the support of C.
Proposition 5.19. If there is a linear relation
X
m2midam(#m) = 0
inAup, thenam= 0 for allm2\mid. In particular, the set f(#m)jm2\midgis linearly
independent.
This is a generalization of [GHKK18, Thm 7.20], which is the analogous result with Cin place
of the larger set C. In particular, loc. cit. showed linear independence of cluster monomials
(previously proven in [CIKLFP13]). The key to the proof of Proposition 5.19 is the following lemma:
Lemma 5.20. Letp2midandm2midnfpg. Then forQ2 suciently close to p, thezp-
coecient of #m;Qis0. On the other hand, the zp-coecient of #p;Qis nonzero for all Q2and1
for allQ2suciently close to p.
Under the Injectivity Assumption, or more generally whenever the cone M
R:=R0h!1(ei)ji2InFi
is convex, Lemma 5.20 is known and used crucially in [GHKK18] and elsewhere, e.g., in the proof of
[GHKK18, Prop 6.4(3)] (the classical case of Proposition 5.9). In that setting, no containment in mid
or is assumed because the convexity of Malready gives the niteness needed for the proof. We
note that for punctured surfaces with non-empty boundary, convexity of M
Rwas shown by [GLFS20,
Theorem 6.8].
Proof of Lemma 5.20. LetQ2. Assume p2, and writeQasQ=p+vfor somev2MR. Since
m2midandQ2,#m;Qhas only nitely many terms. In particular, there are only nitely many
broken lines 1;:::;sinMprin
Rwith ends (em;eQ) | using tildes to denote xed choices of lifts | and
nal attached exponent in  1(p). Sincem6=p, these broken lines must all bend somewhere before
attaining this nal attached exponent.
Let us rst prove that the zp-coecient of #m;Qis 0 forQsuciently near p. Ifp= 0, then the
nal attached exponent of any broken line contributing to the zp-coecient (for any Q) would lie in
 1(0) = 0Nand would therefore commute with all wall-crossings by (88). But such a broken line
could not have bent, so the z0-coecient must in fact vanish.
Assumep6= 0 from now on. Then for each of these broken lines i,i= 1;:::;s , the image under
of the nal straight segment Liwill be a line segment (Li) =fQ+tpjt2[0;Ki]gfor some nite
Ki2R>0. Note that these images under are independent of the choice of lift eQofQ, because
broken lines with ends ( em;eQ1) and (em;eQ2) foreQ1andeQ2denoting two lifts of Qare related by
translation by eQ2 eQ12(0;NR) and therefore have the same projection under . Fix a genericBRACELETS BASES ARE THETA BASES 59
K2RwithK > maxiKi. LetQ0=Q+Kp= (K+ 1)p+v. By construction, Q0is not contained
in any(Li) for anyi= 1;:::;s . Thus, there cannot be any broken lines with ends ( em;fQ0) and
nal exponent in  1(p) because the last straight segment of such a broken line could be extended to
end at a lift ofQ, but the image under of the nal straight segment will contain Q0and therefore
cannot be one of the L1;:::;Lsconsidered above. Since all walls are cones, we can rescale fQ0to nd
#m;(K+1)p+v=#m;p+1
K+1v. Thus, the zp-coecient of #m;p+1
K+1vis 0 for large K, as claimed.
For the statement regarding the zp-coecient of #p;Q, note that there is always a straight broken
line with ends ( ep;eQ) contributing zepto#ep;eQ. By Lemma 5.13 (the positivity of broken lines), other
broken lines will not cancel with this term, so the zp-coecient of #p;Qwill be nonzero. The fact that
this coecient is 1 when Qis suciently close to pfollows from essentially the same arguments used
in the previous paragraph. 
Proof of Proposition 5.19. Suppose we have a relation
X
m2midam(#m) = 0: (94)
ForQ2, let
fQ:=X
m2midam#m;Q:
By Lemma 5.18, the assumption that fQ= 0 forQ2C+
simplies that fQ= 0 for allQ2 . Let
p2\mid. By Lemma 5.20, if Q2  is suciently close to p(note thatp2 ensures that such
Qexists), then the zp-coecient of fQ(which is 0 since fQ= 0) must equal ap. Hence,ap= 0, as
desired. 
When the Injectivity Assumption fails, the full Fock-Goncharov conjecture is modied slightly
to consist of the following conditions:
:Amid!Aupis injective;
mid=M;
(Amid) =Aup.
By [GHKK18, Prop. 0.14], Proposition 5.16 can be generalized as follows:
Proposition 5.21. IfMis strongly convex for some seed mutation equivalent to s, and if the cluster
complexCis not contained in a half-space, then the full Fock-Goncharov conjecture holds.
Proposition 5.19 gives us the following without having to worry about convexity.
Proposition 5.22. IfCis dense in MR, then:Amid!Aupis injective and mid=M.
We expect (Amid) =Aupto hold in these cases as well, but without the convexity of Mwe are
not sure how to prove this.
Proof. The injectivity of in such cases is immediate by Proposition 5.19, so it remains to prove that
mid=M. The cluster complex for sprinis 1(C), and this cannot be contained in a half-space since
Cis dense. So Proposition 5.21 implies that prin;mid=Mprin, hence mid=(prin;mid) =M, as
desired. 
This density ofCholds for most cluster algebras from marked surfaces:60 TRAVIS MANDEL AND FAN QIN
Proposition 5.23 ([Yur20], Thm. 1.2) .Letbe a connected triangulable surface. If contains a
single puncture and no other markings, then the closure of the cluster complex is a half-space in MR
(and the complementary half-space is the closure of the notched-arc cluster complex). Otherwise the
cluster complex is dense in MR.
We note that [Yur20] does not have boundary arcs / frozen vectors, but the results are easily
extended to our setup because adding frozen vectors just replaces each cone in the cluster complex
withMFwhereMFis theR-span of the frozen vectors.
We also note that Proposition 5.23 is easily extended to disconnected surfaces | if  is a disjoint
union of connected triangulable surfaces, then the corresponding cluster complex is the product of the
cluster complexes for the components (this follows easily using, e.g., the constructions of ยง6.4).
Theorem 5.24. Letbe a triangulable marked surface. If no component of is closed (i.e., with
empty boundary), then the full Fock-Goncharov conjecture holds. If some components of are possibly
closed, but no component is a once-punctured closed surface, then the full Fock-Goncharov conjecture
holds forAprin
tandXt. In any case (for any triangulable ), it is at least true that is injective,
Amid=Acan, and  =MR.
In the once-punctured closed surface cases, the proofs of the above claims will depend on Theorem
9.4 (the result relating tagged bracelets to theta functions). We therefore take care to not utilize these
cases while proving Theorem 9.4.
Proof of Theorem 5.24. If every component of  has non-empty boundary, then Mis convex by
[GLFS20, Theorem 6.8], and Cis not contained in a half space (Proposition 5.23), so the full Fock-
Goncharov conjecture follows from Proposition 5.21.
Now suppose that  possibly does have some closed components. We assume for simplicity that 
is connected (the general cases easily follow). If  has at least two punctures, then Cis dense in MR
by Proposition 5.23, so the full Fock-Goncharov conjecture for Aprin
tandXtfollows from Proposition
5.16, while the claims for Afollow from Proposition 5.22.
Suppose  has only one puncture. We will see in Theorem 9.4 that the theta functions coincide with
tagged bracelets (up to scaling in the case of the once-punctured torus), and since they are elements
of Sk2(), the tagged bracelets belong to Aupby Proposition 3.18. The equality mid=Mfollows.
We next show that  =MR. We always have C, so the claim is immediate when C=MR. This
leaves only the once-punctured closed surface setting. Here, we have seen that all bracelets (hence all
theta functions by our upcoming results) are Laurent polynomials in each cluster. As before, we can
apply the automorphism of Remark 3.11 which changes all tags at the puncture, and this immediately
yields that the bracelets are Laurent polynomials for the notched triangulation clusters as well.
The injectivity of for once-punctured closed surfaces now follows from Proposition 5.19. 
We will use Theorem 5.24 to identify Acanwith its image (Acan)Aup. In particular, we will
write(#p) as simply #p.
We note that the full Fock-Goncharov conjecture is also known for AprinandXin the once-
punctured torus case by [Zho20]. On the other hand (as we previously noted in Remark 3.19), [Zho20]
also showed that Acanis aproper subalgebra ofAupin the case of the once-punctured torus, so the
full Fock-Goncharov conjecture fails for Ain this case. Interestingly, if one denes Aup;2to be the
intersection ofAupwith the clusters associated to the notched arc cluster structure, then [Zho20] ndsBRACELETS BASES ARE THETA BASES 61
that one does obtain Acan=Aup;2in this case. One naturally expects the same to be true for all
other once-punctured positive-genus surfaces.
We do not currently know how to show this, but we will see in Theorem 9.6(i) that we do always
haveAcan= Sk2() (with the caveat that in the once-punctured torus cases, one must either work
over|Qor insert an extra wall in the scattering diagram). The argument is essentially that Sk2()
is generated by tagged bracelets, and tagged bracelets will turn out to be theta functions.
5.9.Compatibility of theta bases for AandX.Recall the map !1:N!Mand the induced
map!1:|[N]!|[M]. It is well-known (cf. [FG09, Prop. 2.2]) that !1is compatible with mutations
and thus extends to a map !1:Xup!Aup. Note that, under the Injectivity Assumption, !1also
induces a map !1:bX!bAforbX:=|JNKandbA:=|JMK(still commuting with mutations).
Proposition 5.25. For eachn2mid
X, consider#n2Xup. Then#!1(n)2Aup, and we have
!1(#n) =#!1(n): (95)
Now suppose that the Injectivity Assumption holds so that #mis well-dened in bAfor allm2M.
Then (95) applies for all n2N.
In the quantum setting, if satises the compatibility condition (2)for alli2I(as opposed
to just for i2InF), then there is a |-algebra homomorphism !1:bXt!bAtforbXt:=|tJNK,
bAt:=|tJMK, determined by zn7!z!1(n)andt7!td. This morphism commutes with mutations to
induce!1:Xup
t!Aup
t. Furthermore, this !1induces!1:Xcan
t!Acan
twith!1(#n) =#!1(n).
Proof. The statements in the classical setting are an immediate consequence of Denition 5.17, Equa-
tion (89), and the easy observation that !1=. The statement in the quantum setting with d= 1
is [DM21, Thm. 1.2(8)]. The argument for general dis essentially the same, with the need for t7!td
evident in (3). The key observation is that this !1maps the scattering functions 	 t(zei) of (85) to
the scattering functions 	 td(z!1(ei)) of (82). 
5.10. Positivity and the scattering atlas. Recall the algebra Acan
tgenerated by the theta functions
as in ยง5.5, and recall that each generic Q2MRdetermines an inclusion Q:Acan
t,!|tJMK,#p7!#p;Q
as in Lemma 5.11. Given any f2Acan
t, one says that fisuniversally positive with respect to the
scattering atlas , ortheta positive24for short, if for every generic Q2MR, all nonzero coecients
of
Q(f) =X
m2Maf;m;Qzm(96)
are positive elements.
One says that nonzero f2Acan
tisatomic with respect to the scattering atlas , ortheta
atomic for short, if it is theta positive and cannot be decomposed as a sum of two other nonzero
theta positive elements.
If the Injectivity Assumption does not necessarily hold, we can still dene a similar notion as
follows. For f2Amid, we can dene af;m;Qas in (96) forQ2 . We say that fis -positive if
af;m;Q2Z0for allm2Mand allQ2. Then we say nonzero f2Amidis -atomic iffcannot
be decomposed as a sum of two other nonzero -positive elements.
24We thank Greg Muller for suggesting this shortened terminology.62 TRAVIS MANDEL AND FAN QIN
Proposition 5.26. Suppose the Injectivity Assumption holds. Then all theta functions are universally
positive with respect to the scattering atlas, and the basis of Acan
tconsisting of the theta functions is
strongly positive. Furthermore, the theta functions are precisely the atomic elements of Acan
twith
respect to the scattering atlas.
Suppose now that the Injectivity Assumption does not necessarily necessarily hold. The theta func-
tionsf#mgm2midare still -positive and a strongly positive basis. Furthermore, if mid, then
the theta functions f#mgm2midare the -atomic elements25ofAmid.
Proof. As observed in [GHKK18, DM21], the theta positivity is immediate from Lemma 5.13. Simi-
larly, the strong positivity is immediate from Lemma 5.13 and Proposition 5.9. Under the Injectivity
Assumption, the atomicity is proven in [Man17] in the classical setting and [DM21, Thm. 3.16] in the
quantum setting. In the possible absence of the Injectivity Assumption, the -positivity again follows
from Lemma 5.13 (and the denition (89)), and the strong positivity similarly follows from Lemma
5.13 combined with (92).
The atomicity arguments from the cases where the Injectivity Assumption holds can be extended to
cases where the Injectivity Assumption possibly fails by using Lemma 5.20, assuming that mid.
In these cases, let f2Amidbe an arbitrary -positive element. We wish to show that the expansion
f=P
m2midam#mhas non-negative coecients. By Lemma 5.20, if Q2 is suciently close to a
givenm, thenam=af;m;Qwhereaf;m;Qis dened as in (96) (the assumption midensures such
Qexist for all m2mid). Sinceaf;m;Qis non-negative by the denition of theta positivity, the claim
follows. 
By Proposition 5.14, universal positivity with respect to the scattering atlas implies universal
positivity with respect to the cluster atlas.26Of course, the two notions (as well as -positivity) agree
wheneverCis dense in MR.
Consider a marked surface  with an ideal triangulation . We say that an element z2Aup(s) is
universally positive with respect to the ideal triangulation atlas if, for any ideal triangulation 0,
zis a positive Laurent polynomials in the elements [ ] for arcs20. Atomicity with respect to the
ideal triangulation atlas is then dened naturally. We similarly dene positivity and atomicity with
respect to the tagged triangulation atlas . By Theorem 5.23, if  is not a once-punctured closed
surface, then the scattering atlas, cluster atlas, and tagged triangulation atlas are all equivalent. We
will see in ยงB that the tagged triangulation and scattering atlases are equivalent for once-punctured
closed surfaces as well, except in the case of the once-punctured torus.
Theorem 5.24 and Propositions 5.23 and 5.26 (plus ยงB) thus imply the following:
Corollary 5.27. Letbe any triangulable marked surface with triangulation . The theta functions
are precisely the -atomic elements of Amid(s). If no component of is a once-punctured closed
surface, then -positivity, positivity with respect to the scattering atlas, positivity with respect to the
cluster atlas, and positivity with respect to the tagged triangulation atlas are all equivalent. For general
25We note that [Man17, Examples 2] discussed theta atomicity in the case of the Markov quiver (the cluster alge-
bra associated to the once-punctured torus). The arguments there do not fully address the failure of the Injectivity
Assumption in that case, so our Lemma 5.20 and the subsequent proof of Proposition 5.26 ll a minor gap in loc. cit.
26[FG09] conjectured that the elements which are atomic with respect to the cluster atlas form a basis, but the set
of such elements was shown to be linearly dependent in [LLZ14] for all rank 2 cluster algebras which are not of nite
or ane type. It follows that universal positivity with respect to the scattering atlas is generally a strictly stronger
condition.BRACELETS BASES ARE THETA BASES 63
triangulable ,-positivity is equivalent to positivity with respect to the scattering atlas, and this is
equivalent to positivity with respect to the tagged triangulation atlas except in the case of a once-
punctured torus.
One may similarly dene universal positivity with respect to the scattering atlas, or theta positivity,
for elements ofXcan
t, using genericQ2NRand the scattering diagram DXtas in [DM21, ยง4.3].
Furthermore, [DM21] denes f2 Xcan
t Aprin;can
t (cf. ยง5.7) to be universally positive with
respect to the principal coecients scattering atlas , orprincipally positive for short, if the
nonzero coecients of
fQ=X
n2(N)Mprinaf;n;Qzn
are positive for all n2(N) (foras in (86)) and all generic Q2Mprin
R. The nonzero principally
positive elements which cannot be decomposed into sums of other nonzero principally positive elements
are said to be atomic with respect to the principal coecients scattering atlas . By [DM21,
Thm. 1.1], the theta functions in Xcan
tare precisely the atomic elements with respect to either the
scattering atlas or the principal coecients scattering atlas, so these two notions of positivity and
atomicity (i.e., with respect to the scattering atlas or the principal coecients scattering atlas) are in
fact equivalent.
The advantage of the principal coecients scattering atlas perspective is that this atlas includes
all of theX-space clusters, so this atlas contains the cluster atlas considered by Fock and Goncharov
[FG06, FG09]. Proposition 5.23 lifts to the principal coecients setting (because walls of DAprinare
parallel to ker( ) = (0;NR)), so we immediately obtain the following:
Proposition 5.28. In general, the theta functions f#ngn2NXcan
tare precisely the elements which
are atomic with respect to scattering atlas, or equivalently, the elements which are atomic with respect
to the principal coecients scattering atlas.
Now let be a triangulable marked surface, and consider the associated Xcan
t. If no component of
is a once-punctured closed surface, then positivity with respect to the principal coecients scattering
atlas (equivalently, with respect to the scattering atlas) is equivalent to positivity with respect to the
X-space cluster atlas.
We now focus on the classical setting. The set midis equal to mid
R\Mfor some convex cone
mid
RMR. Let  Rmid
Rbe a subcone, and denote  :=  R\Mand
A:=M
m2|#mAmid:
SupposeAis closed under multiplication, i.e., forms a subalgebra of Amid. This holds, for example,
if R= mid
R. It also holds if  Ris convex and either
Rclosed under addition by elements of M+, or
Rnf0gis closed under addition by elements of M+.
IfMis not strongly convex, we also require  R for  as in (90).
We say that an element f:=P
m2am#m2Aisuniversally positive with respect to the
R-atlas if
fQ:=X
m2am#m;Q=X
m2Mam;Qzm64 TRAVIS MANDEL AND FAN QIN
has non-negative integer coecients am;Q2Z0for eachm2Mand for all generic Q2 R. Here,
ifMis strongly convex, then fQ2|JMK. Otherwise, the assumption that  R ensures that
fQis dened as an element of |[M]. One now denes the notion of atomic with respect to the
R-atlas , or  R-atomic for short, in the obvious way.
Proposition 5.29. The setf#mgm2consists precisely of the R-atomic elements of A.
The argument is essentially the same as in the atomicity proofs of [Man17] and [DM21].
Proof. Letf=P
m2am#m. Under the hypotheses, the zm-coecient of fQisamwheneverQis
suciently close to m| in the case of convex M
Rthis is shown in [GHKK18], and for non-strongly
convexMwith  it holds via the same argument used in the proof of Lemma 5.20. Now, if f
is universally positive with respect to the  R-atlas, it follows that amis non-negative for each m. So
the atomic elements must be the theta functions, as desired. 
Now consider a triangulable marked surface  with ideal triangulation , and consider the untagged
bracelets basis for the untagged skein algebra Sk() Sk2()Aup(s) as in ยง4.2. As we have
noted, we will later show (cf. ยง9.1) that these bracelets are theta functions. We can take  to be the
g-vectors of these untagged bracelets. This  equals  R\Mfor some cone  R, andAis indeed
closed under multiplication since it equals Sk(). Since mid=Mand =MR(Theorem 5.24), we
have mid
R\. Furthermore, the clusters associated to generic points Q2 Rare precisely the
charts of the ideal triangulation atlas|indeed, for each arc in an ideal triangulation, [ ] is a cluster
variable in the corresponding cluster, unless is a noose bounding an arc 0, in which case[]
[0]is the
corresponding cluster variable (cf. Example 3.15). Proposition 5.29 thus yields the following:
Lemma 5.30. Assume we know that the untagged bracelets basis for Sk() consists of theta functions.
Then it consists precisely of the atomic elements of Sk() with respect to the ideal triangulation atlas.
5.11. Positivity of bracelets. The following positivity properties for bracelets are immediate con-
sequences of results in the literature.
Theorem 5.31 ([Thu14], Thm. 1) .The bases Brac() andBrac() forSk() andSk() , respectively,
are strongly positive.
Proof. The Brac()-case is [Thu14, Thm. 1]. Extending to Brac() is easy because the boundary
curves have no crossings with other curves (up to homotopy) and so multiplication by possibly negative
powers of these elements is easily understood. 
Lemma 5.32. In the classical setting, if has no punctures, then the bracelets are universally positive
with respect to the scattering atlas.
Proof. For unpunctured , the bracelets include all the cluster monomials (they are monomials in the
arcs of ideal triangulations; cf. Proposition 3.7), and Theorem 5.31 says that the classical bracelets
basis is strongly positive. So Lemma 2.17 implies that the bracelets are universally positive with
respect to the cluster atlas. The cluster and scattering atlases agree by Proposition 5.23, so the claim
follows. 
Lemma 5.33. Letbe a once-punctured closed surface. In the classical setting, the untagged bracelets
forSk() are universally positive with respect to the cluster atlas.BRACELETS BASES ARE THETA BASES 65
Proof. For once-punctured closed surfaces, the plain bracelets again include all cluster monomials (cf.
Proposition 3.18), so the argument follows as in the proof of Lemma 5.32. 
5.12. Bar-invariance of quantum theta functions. We note one more property of quantum theta
functions which will be useful to us. Let fbe an element of |t, or of a quantum torus algebra like
|t[N] or|t[M], or of a completion of such an algebra like |tJNKor|tJMK. Thenfis said to be
bar-invariant if it is invariant under the involution t7!t 1. Scattering automorphisms preserve
bar-invariance by [DM21, Thm. 2.15 and Lem. 3.4], so for any f2Acan
torXcan
t,Q(f) (dened like
in Lemma 5.11) is bar-invariant for one generic Qif and only if it is bar-invariant for all generic Q.
In this case, we say that fis bar-invariant.
Lemma 5.34 ([DM21], Thm. 1.1) .Quantum theta functions are bar-invariant.
Lemma 5.35. Leftfbe a nonzero, bar-invariant, theta positive element of Acan
torXcan
t. Thenf
is a quantum theta function if and only if limt!1(f)is a classical theta function in AcanorXcan,
respectively.
Proof. The bar-invariance and theta positivity imply that f=P
pap#pfor some bar-invariant ele-
mentsap2Z0[t1]. If this gives a theta function #p0jt=1in the classical limit, then ap0jt=1= 1,
andapjt=1= 0 forp6=p0. The only possibility is that ap0= 1 andap= 0 forp6=p0, sof=#p0as
claimed. 
6.Operations on seeds
We have seen that the classical skein algebras Sk() and quantum skein algebras Sk t() (dened
for unpunctured ) are contained in an associated (quantum) upper cluster algebras with coecients
(i.e., frozen variables) associated to the boundary arcs. From the viewpoint of cluster algebras, it is
natural to consider cluster algebras dened by seeds with other coecients. In this section, we discuss
some ways to manipulate the coecients of a cluster algebra, and we explore some general properties
of these manipulations. This will allow us, for example, to quantize skein algebras for punctured
surfaces by rst extending to principal coecients.
Additionally, we will see that operation of gluing two boundary arcs of a marked surface corresponds
to the operation of identifying two frozen indices, followed by unfreezing the new index. We will discuss
what happens to theta functions when seeds are changed in this way.
6.1.Dominance order and pointedness. Let there be given any seed s= (N;E;I;F;! ). Recall
the notation
N
s:=N:=M
k2IufZ0ek
and
M
s:=M:=!1(N):
For the purpose of the following notions (Denitions 6.2-6.3), we assume that M
sis strongly convex.
This assumption is satised, for example, when the Injectivity Assumption holds for s. Then we can
dene the dominance order on Mas the following:
Denition 6.1 (Dominance order [Qin17]) .For anym;m02M, we saym0isdominated bym,
denoted by m0sm, ifm02m+M
s.66 TRAVIS MANDEL AND FAN QIN
We also consider the quantum seed s = (N;E;I;F;!; ) | writing the compatible form  as
part of the seed data | whose compatible pair determines the positive number dgiven by (2). Recall
that the Injectivity Assumption is automatically satised by a quantum seed.
Recall the completions
|tJNK=|t[N]
|t[N]|tJNK
|tJMK=|t[M]
|t[M]|tJMK
as in ยง2.5. We sometimes denote |tJMKby|tJMsKto emphasize its dependence on s. Recall that, for
working with the classical case, it suces to evaluate t= 1.
Denition 6.2 (Degree and pointed elements [Qin17]) .Assume that a given element Z2|tJMsK
takes the form
Z=X
n2Ncn(t)zm+!1(n)(97)
for somem2Mand some coecients cn(t)2|t. Ifc06= 0, thenZis said to have degreem, denoted
by degZ=m, and itsF-function is dened as the formal Laurent series FZ:=Pcn(t)z!1(n)2
|tJMK.
If furtherc0= 1, thenZis said to be m-pointed . A setfZmjm2Mgis said to be M-pointed if
its elements Zmarem-pointed.
For anm-pointed element Z, we may refer to its degree mas theg-vector ofZand denote
g(Z) =m(this generalizes the extended g-vectors of ยง2.7). By Proposition 5.6, a theta function #m;Q
ism-pointed, i.e., has g-vectorm, and this is independent of the choice of Q.
Note thatZhas degreemif and only if mis the uniques-maximal degree for the monomial terms
ofZ.
Denition 6.3 (Support) .Assume that the Injectivity Assumption holds. The support ofZ2
|tJMsK(inIuf) is dened as
suppZ= suppIufZ=fi2Iufj9n= (ni)2ZIuf; cn(t)6= 0; ni>0g: (98)
6.2.Similar seeds. In order to change the coecients of a given seed, we recall the notion of simi-
larity following [Qin14, Qin17].
Let there be given two seeds s= (N;E;F;I;! ) and s0= (N0;E0;F0;I0;!0) (or qauntum seeds s,s0
with the Lambda matrices  and 0, which determine positive numbers dandd0respectively via (2)).
If there is a bijection fromIuf=InFtoI0
uf=I0nF0, for any vector p= (pi)i2Iufwith coordinates
pi2R, denep:= (pi0)i02I0
ufsuch thatpi=pi. I.e., we may view as identifying NwithN0
andMwithM0.
Denition 6.4 (Similar seeds [Qin17]) .The seed s0is said to be similar tosup to an identication
:Iuf'I0
uf, if they share the same principal B-matrix up to , i.e.bi;j(s) =bi;j(s0) fori;j2Iuf.
LetA(s) andA(s0) denote the (quantum) cluster algebras associated to the (quantum) seeds s
ands0respectively, where stands for ord, mid, can or up.
Denition 6.5 (Similar cluster algebras) .Ifsands0are similar, then A(s) andA(s0) are said to
besimilar or of the same type .BRACELETS BASES ARE THETA BASES 67
From now on, assume that sands0are similar up to a permutation and, moreover, MandM0
are strongly convex. We work over a ring |t=|[t1
D] such that djDandd0jD, see ยง2.5. Recall the
notation prIuf:ZI!ZIufas in ยง2.7.
Denition 6.6 (Similar pointed elements) .Anm0-pointed element Z02|tJM0
s0Kis said to be similar
to them-pointed element Z2|tJMsKin (97) if prI0
ufm0=(prIufm) andZ0takes the form27
Z0=X
ncn(td0
d)zm0+!0
1(n):
Note that the similar element Z0has the same F-function as that of Z(after replacing tbytd0
d).
Z0is thus determined by Zup to a frozen factor|more precisely, up to a shift of all exponents of Z0
by a vector in the span of f(e0
i)ji2F0g.
LetDandD0denote the scattering diagrams associated to the initial seeds sands0, respectively,
as in (71) and (72). Then they provide the following similar elements:
Lemma 6.7. If#mis anm-pointed theta function for D,m2M, then the similar pointed elements
in|tJM0Kare the theta functions #m0forD0, where prI0
ufm0=(prIufm).
Proof. Since the injectivity assumption holds, we may x a compatible  and 0if these have not been
xed already. Recall MF=N?
ufM; i.e.,MFdenotes the span of fe
iji2Fg. In general, the expo-
nents on scattering functions of Dlie inM+=!1(N+)!1(Nuf), and by (2),  2(!1(Nuf))Nuf. It
follows that all walls of Dare closed under addition by MF;R, and that all scattering automorphisms
act trivially on |t[MF]. This further implies that, for any u2MFand any genericQ;Q02MRwith
Q Q02MF;R, there is a bijection between broken lines contributing to #m+u;Q0and broken lines
contributing to #m;Qwith attached monomials on the former being obtained from the corresponding
monomials on the latter by adding uto the exponents. Hence, #m+u;Q0is obtained from #m;Qby
addinguto every exponent.
Relabeling the basis vectors of s0if necessary, we can assume that the permutation is trivial.
Now consider the quantum seed
es:= (eN:=NNF0;ItF0;eE=feeigi2ItF0;FtF0;e!;e):
Here,e!(eei;eej) is dened to equal !(ei;ej) ifi;jare both in I,!0(ei;ej) ifi;jare both in I0=IuftF0,
and 0 if one index is in Fwhile the other is in F0. Similarly, we extend  and 0tofMvia (m;e
j):= 0
forj2F0and 0(m;e
j):= 0 forj2F. Then the sum e of these extended forms is a compatible
bilinear form for essuch thate2(e!1(ek)) = (d+d0)ek,k2Iuf.
The arguments from the rst paragraph of the proof apply to this seed to show that, for Q;Q0
generic and diering by a point in fMFtF0;R, and for any u2MFtF0,#m+u;Q0can be obtained from
#m;Qby addinguto every exponent. Let prIand prI0denote the natural projections of fMontoM
andM0, respectively. These induce morphisms of the quantum torus Lie algebras prI:gt(es)!gt(s)
and prI0:gt(es)!gt(s0), as well as morphisms of |-modules prI:|tJfMK!|tJMKand prI0:|tJfMK!
|tJM0Kwhich intertwine the respective Lie algebra actions, via applying prIor prI0to the exponents
while setting prI:t7!td
d+d0and prI0:t7!td0
d+d0. Note that
prI(#em;Q) =#prI(em);prI(Q)and prI0(#em;Q) =#prI0(em);prI0(Q)
27The decomposition coecients cnforZin (97) might not be unique when Mis strongly convex but the Injectivity
Assumption fails. Nevertheless, Z0is uniquely determined by Zandm0.68 TRAVIS MANDEL AND FAN QIN
for allem2fMand genericQ2fMR. We thus see that, for any em2fMand genericQ2fMR,
#m;prI(Q)form= prI(em) is similar to every element of the form #prI0(em+u);prI0(Q0)foru2fMFtF0
andQ0 Q2MR. These elements prI0(em+u) are precisely the m02M0with prI0
ufm0=(prIufm),
so the claim follows. 
Now suppose that a classical seed ssatises the condition that Mis strongly convex, but consider
a similar seed s0which might not satisfy this convexity condition. We can still adapt Denition 6.6 for
s0. More precisely, for any m-pointed Laurent polynomial Z=P
n2Ncnzm+!1(n)2|[Ms],cn2|,
and anym0such that prI0
ufm0=(prIufm), we can construct a Laurent polynomial Z02|[Ms0] by:
Z0:=X
n2Ncnzm0+!0
1(n)(99)
=X
p2M00
@X
n2!0
1 1(p)cn1
Azm0+p:
E.g., the restriction map on theta functions (see (89)) is the special case of this construction with
Mprinin place ofMand withMin place ofM0.
We see that the t= 1 version of Lemma 6.7 holds in this setting as well by essentially the same
arguments, but with the added assumption that m2mid.
Lemma 6.8. If#mis anm-pointed theta function for D,m2midM, then the similar elements
in|[M0]as in (99) are the theta functions #m0forD0where prI0
ufm0=(prIufm).
6.3.Gluing frozen vertices. Lets= (N;I;F;E;! ) be a (classical) seed.
Letb1;b2denote two frozen vertices of the quiver associated to s(cf. Remark 2.1). We can glue
b1;b2into a single frozen vertex, which we denote by b. If this gluing results in any loops at b(i.e.,
arrows from btob), we simply remove these loops from the quiver (this happens if there were arrows
betweenb1andb2, but this will not be the case in any examples we care about).
Correspondingly, we can construct the seed s= (N;I;F;E;!) by gluing sas follows. Replace N
withN:=N=Zheb1 eb2i, replaceb1andb2inIandFwithb, takeeb2Eto be the projection of
eitherebi(i= 1;2) toN, and replace !with!given as follows: if i;j6=b, then!(ei;ej) =!(ei;ej),
and
!(ei;eb) =!(ei;eb1+eb2):
The dual lattice Mis the sublattice of Mspanned byfe
igi2Infb1;b2g[fe
b:=e
b1+e
b2g.
In general, for any equivalence relation on F, we can glue the vertices iin each equivalent class [ i]
by iterating the above gluing process. The resulting seed ssatises
!(e[i];e[j]) =X
i2[i];j2[j]!(ei;ej); (100)
where we denote [ k] =kfork2InF. In particular, the resulting seed does not depend on the order
of our gluing process. Notice that the natural embedding from MtoMsendse
[i]toP
i2[i]e
i.
As we shall see in ยง8.1, the gluing operation appears naturally on surfaces.
We dene a linear map
M:M7!M; m7!m (101)BRACELETS BASES ARE THETA BASES 69
by specifying that e
i=e
[i]. Elements M(m) will typically be denoted as just m. Ifsandsare
quantum seeds, let dandddenote the numbers determined by their respective compatible pairs. We
letMdenote the induced |-linear map from |tJMKto|tJMKsuch thatM(t) =td=d. We do NOT
require that Mrespects multiplication.
Note that sandsare similar seeds. We have the following observation:
M(!1(n)) =!1(n): (102)
Similarly, consider the principal coecients seeds sprinandsprin= (s)prinas in ยง2.3. We glue sprin
into a seed sprinby gluing two elements of I2whenever the corresponding elements in I1are glued.
LetMprindenote the induced |-linear map from |JMprinKto|JMsprinK. Note that sprinandsprin
agree except for the fact that !sprin(e[j];e[j0]) = 1 when j2F1andj0is the corresponding element of
I2, whereas!sprin(e[j];e[j0]) equals the cardinality of [ j]). We thus naturally identify |JMsprinKwith
|JMsprinK. Then, for any n2ZIuf, we have
Mprin(!sprin
1(n)) =!sprin
1(n): (103)
We deduce that for any m-pointed element Zin|JMprinK(or in|tJMprinK),Mprin(Z) is similar
toZ. In particular, using Lemma 6.7,
Mprinsends theta function for sprinto theta functions for sprin. (104)
Consequently, using (89), for all m2Mand genericQ2C+
sandQ2C+
s,
M(#m;Q) =#m;Q(105)
inAcan(s) (or inAcan
t(s) ifsandsare quantum seeds).
Remark 6.9.We note that (105) can alternatively be derived as a consequence of [DM21, Lem. 2.11].
Indeed, loc. cit. applies to relate the scattering diagrams for sands, and then it is straightforward
to apply the construction of broken lines and theta functions to reach the desired equality.
6.4.Union of seeds. Given two seeds si= (Ni;Ii;Ei;Fi;!(i)),i= 1;2, dene their union to be the
seed
s= (N1N2;I1tI2;E1tE2;F1tF2;!(1)!(2)): (106)
Similarly, for quantum seeds s1;s2with the same multiplier d, we dene their union with the additional
matrix ( s) =  12. LetAcan
t(si),Acan
t(s) denote the corresponding (quantum) canonical cluster
algebras, and similarly the corresponding ordinary, middle, and upper (quantum) cluster algebras.
For anygi2Mi,i= 1;2, let#giand#g1+g2denote the corresponding theta function in Acan
t(si) and
Acan
t(s) respectively.
Note that we can naturally view |t[Mi] as a subalgebra of |t[M1M2],i= 1;2. If si,i= 1;2,
satises that M
iis strongly convex, then we can dene |tJMiK, which can be viewed as subalgebras
of|tJM1M2K.
Lemma 6.10. (1) If s1ands2satisfy the Injectivity Assumption, then #g1#g2=#g1+g2(in both the
quantum and classical settings).
(2) Even in the possible absence of the Injectivity Assumption, if #gi2Amid(si),i= 1;2, then
#g1#g2=#g1+g2inAmid(s).70 TRAVIS MANDEL AND FAN QIN
Proof. (1) We observe that the scattering diagram for sis given by the direct sum of the scattering
diagrams for s1ands2, i.e.
D(s) =D(s1)D(s2)
:=f(dM2;R;g)j(d;g)2D(s1)g[f (M1;Rd;g)j(d;g)2D(s2)g:
For the initial scattering diagram this follows immediately from the denition (71), and then the
equality for the corresponding consistent scattering diagrams comes from the consistency of D(s1)
andD(s2), plus the fact that the two sub Lie algebras associated to s1ands2commute with each
other.
Now xp= (p1;p2)2M1M2and genericQ= (Q1;Q2)2MR=M1;RM2;R. Then the broken
lines contributing to #p;Qare given as follows: the supports are `: ( 1;0]!MRwith`= (`1;`2),
where`1and`2are the supports of broken lines for #pi;Q1and#p2;Q2, respectively. The attached
monomials are the products of the pairs of attached monomials for the corresponding segments of `1
and`2. It follows that #p;Q=#p1;Q1#p2;Q2, as desired.
(2) We rst apply statement (1) to the principal coecient seed sprin
i. Then (2) follows from
applying the projections as in (89). 
Remark 6.11.If a triangulable marked surface  contains multiple connected components, then the
seed associated to  is the union (in the above sense) of the seeds associated to the components of
. Thus, when investigating theta functions for cluster algebras from marked surfaces, Lemma 6.10
allows us to easily reduce to cases where the surface is connected.
6.5.Unfreezing. Lets0denote a (quantum) seed, and sthe (quantum) seed obtained from s0by
freezing some b2I0
uf(sob2Fbut notF0). The seeds sands0are NOT similar in our previous sense,
but the unfreezing operation will be important when we treat surfaces later.
Note that we have a natural identication Ms=Ms0inducing
i:|t[Ms] =|t[Ms0] (107)
and the natural inclusion i:M
s,!M
s0. Correspondingly, if M
sandM
s0are strongly convex, we
have the natural inclusion
i:|tJMsK,!|tJMs0K: (108)
In this case, for any m-pointed element Z2|tJMsK,i(Z) remainsm-pointed with the same F-function.
We assume for the rest of this subsection that sands0satisfy the Injectivity Assumption, or at least
thatM
s0(henceM
s) is strongly convex. Let DandD0denote the scattering diagrams associated to s
ands0respectively. For m2Ms, let#mand#0
mdenote the corresponding m-pointed theta functions
inDandD0respectively. We will present sucient conditions for i(#m) =#m.
Since i(#m) is anm-pointed element in |tJMs0K, we have a unique decomposition (convergent in
|tJMs0K, see [DM21, Rmk. 2.5],[Qin22, ยง4]):
i(#m) =X
p2m+M
s0cp#0
p: (109)
withcm= 1.
Lemma 6.12. Assume that M0is strongly convex. If the coecients cpin(109) are non-negative
in the classical ( t= 1) limit, then i(#m) =#0
m.BRACELETS BASES ARE THETA BASES 71
Proof. Let us compute the theta functions using broken lines. In terms of scattering diagrams, un-
freezing a frozen vertex results in a new initial wall, hence more broken lines, all of which still have
positive coecients. So the Laurent expansion of
#0
m i(#m) =X
p2m+M+
s0( cp#0
p)
must have non-negative coecients. Given the Laurent positivity of the theta functions #0
pjt=1and
the assumption that the coecients cpjt=1are non-negative, the only possibility is that cp= 0 for all
p2m+M+
s0. 
The following result is a special case of the application of the freezing operators in [Qin23] which
suces for our purpose. Recall that the seed sis obtained from s0by freezing the vertex b. We use
the notation supp as in (98).
Lemma 6.13. Assume that s0satises the Injectivity Assumption. If for some m2M, we have
b =2supp#0
m, then i(#m) =#0
m.
Proof. In terms of scattering diagrams, unfreezing a frozen vertex bresults a new incoming wall with
normal direction eband, correspondingly, more walls whose normal directions nsatisfyingnb6= 0 (see
the construction of consistent scattering diagrams in [GHKK18, Appx. C]). Therefore, b =2supp#0
m
implies that the broken lines appearing in #0
monly bend at those walls already appearing in D.
Consequently, we get #0
m=i(#m). 
Proposition 6.14. Lets0be a quantum seed. Consider a quantum theta function #pand a cluster
monomial#m(som2C\M) fors0such that#pand#mt-commute.28Thent#p#m=#p+mwhere
= 0(p;m)(to make the product bar-invariant).
Proof. One inductively reduces to the case where #mis a cluster variable (or possibly the inverse of
a frozen cluster variable). By changing our base seed s0, we may assume then that m=e
ifor some
i2I(or possibly e
iifi2F). The case i2Fis a simple general fact, cf. the rst paragraph from
the proof of Lemma 6.7. So we may assume i2InF.
Letsbe the seed obtained by freezing the vertex i. Thet-commutativity implies that i =2supp#p;Q
(forQin the positive chamber). So, by the positivity of theta functions, since #p+e
iis a summand of
t#p#e
i,#p+e
i;Qmust also have support outside of i. So the broken lines of #p;Qand#p+e
i;Qonly
bend at the walls that are present in D(s), and as a result are the same for s0as for s. We thus reduce
to checking the equality for s, whereiis frozen, and as noted above, the equality in this case follows
as in the rst paragraph from the proof of Lemma 6.7. 
7.Quantum tagged bracelets with coefficients
Here we apply the results of ยง6 to motivate denitions of bracelets bases for cluster algebras from
surfaces with arbitrary coecients. Even when considering punctured surfaces, coecients can be
chosen so that the Injectivity Assumption is satised. This allows for a denition and characterization
ofg-vectors. Furthermore, these cluster algebras satisfying the Injectivity Assumption can then be
quantized. In ยง7.4, we construct quantum bracelets bases for these quantized cluster algebras with
28Two elements aandbare said to t-commute if ab=tkbafor some number k.72 TRAVIS MANDEL AND FAN QIN
coecients.29For this construction, we rely heavily on our knowledge about theta functions and
bracelets in later sections.
7.1.Surface type cluster algebras. Take any tagged triangulation  of  and let sdenote
the corresponding seed ( sis said to have boundary coecients). Recall that Sk() (or Sk t() for
unpunctured ) are contained in the (quantum) upper cluster algebras Aup(orAup
t).
Recall that two seeds are similar if they share the same principal B-matrix up to relabelling vertices,
see Denition 6.4.
Denition 7.1 (Surface type cluster algebra) .Ifsis a (quantum) seed similar to s, we say the
corresponding (quantum) cluster algebra A(s) (orA
t(s)) is of type , where stands for ord, mid,
can, or up.
Recall that, by taking the similar elements as in Denition 6.6, a basis for a cluster algebra might
provide a basis for a similar cluster algebra, see Lemma 6.7. Correspondingly, we are interested in
the algebra elements of a cluster algebra of type  which are similar to the bracelet elements in
Sk()Aup(s) (or Skt()Aup
t(s)).
Denition 7.2 (Bracelet elements for similar seeds) .Assume that a (quantum) seed ssatises the
Injectivity Assumption, and we have dened a bracelet element in|JMsK(or in|tJMsK). Ifs0is a
(quantum) seed similar to swhich satises the Injectivity Assumption, then the elements in |JMs0K
(or|tJMs0K) similar to in the sense of Denition 6.6 will be called bracelet elements. If s0is a
classical seed similar to the classical seed sbut which does not satises the Injectivity Assumption,
then the elements in |[Ms0] constructed from via (99) will be called bracelet elements.
We recall that the bracelet elements constructed from in Denition 7.2 are uniquely determined
up to a frozen factor. Moreover, if is contained inAup(s) (orAup
t(s)), then the similar elements are
also contained in Aup(s0) (orAup
t(s0)), see [Qin17, Lem. 4.2.2(iii)].
Recall that for unpunctured , the seed ssatises the Injectivity Assumption, and the bracelet
elements in Sk() and Sk t() have been dened in ยง4.2. Correspondingly, we obtain the denition of
bracelet elements for all (quantum) cluster algebras of type .
Let  denote a marked surface, possibly with punctures, and  any tagged triangulation. Then
the Injectivity Assumption for the corresponding seed smight fail. In particular, one can not make
sinto a quantum seed by adding a compatible . In view of Denition 7.2, to construct bracelet
elements for cluster algebras of type , it suces to construct the bracelet elements for one seed s
similar to ssuch that ssatises the Injectivity Assumption.
We will see in ยง7.5.1 that our tagged bracelets with coecients agree with those of [MSW13].
7.2.Classical bracelets with coecients. (Tagged) bracelets for Aup(s) have been dened in
ยง4.3. In the following, we will extend the construction to Aup(s) for any seed ssimilar to s: we will
denehCis
Bracfor any weighted tagged simple multicurve C. The superscript sis often omitted when
the context is clear.
29For the quantum bracelet elements associated to notched arcs in once-punctured closed surfaces, we resort to
dening these bracelets to simply be the corresponding quantum theta functions. This is partially justied in Remark
7.3 using the DT-transformation, which will be discussed in ยงC. A more natural denition is still desirable.BRACELETS BASES ARE THETA BASES 73
7.2.1. Classical bracelets for loops with coecients. LetL=S
iwiLidenote a simple curve in  whose
components Liare simple non-peripheral loops (up to frozen variable factors, the approach here also
applies when the components Liare allowed to include arcs which do not end at punctures). In ยง10.1,
we will see that such L(viewed as a lamination e(L)) determines30an element I(L)2X(s). By
applyingp=!s
1, we recover an element I_(L)2Aup(s) which equals the bracelet hLiBracdened
inยง4.2; cf. ยง10.1 and ยง10.2, particularly Lemma 10.5.
Similarly, for the seed sprin
of the principal coecients, we dene the bracelet element
hLiprin
Brac:=(I(L)) (110)
where=!sprin

1is the map acting on exponents via N!NM,n7!(!1(n);n), cf. (86).
Since sprin
satises the Injectivity Assumption, hLiprin
Bracdetermines a bracelet element hLis
Brac, up
to frozen factors, for arbitrary seed ssimilar to s, see Denition 7.2. Correspondingly, we dene the
following particular bracelet element which is similar to hLiprin
Brac, equal tohLiprin
Bracin the case s=sprin
,
and equal tohLiBracin the case s=s:
hLis
Brac:=!s
1(I(L)):
Later, we will see that hLiprin
Bracis a theta function (Lemma 9.1) and I(L) is a theta function (Theorem
10.11). They are related to hLiBracas in Denition 5.17 and (89). Then hLis
Bracis a theta function
by Lemma 6.7 or 6.8.
7.2.2. Bracelets for arcs. A geometric characterization of cluster variables for surface type cluster
algebras with coecients is given in [FT18b, Thm. 15.6]. Here, a cluster algebra with coecients
Aup(s) is associated to a triangulable surface  equipped with a choice of multi-lamination L, i.e.,
a nite multiset of integer unbounded laminations. Each tagged arc is then represented by a
\laminated lambda length" xL() =:hiBrac, a function on a \laminated Teichm uller space." These
laminated lambda lengths, other than those associated to notched arcs on once-punctured closed
surfaces, yield the set of cluster variables for the cluster algebra. In particular, taking Lto be the set
of elementary laminations L=fe()j2ufgyields the case of principal coecients, cf. [FT18b,
Prop. 17.3].
We do not review the details of the [FT18b]-construction here since it is rather involved and not
needed for our purposes|knowing that the laminated lambda lengths are cluster variables already
suces to imply that they are theta functions. For the case of notched arcs on laminated once-
punctured closed surfaces, we can understand the associated laminated lambda lengths by working
with ak-sheeted covering space e of ,k2Z2. Sincee hask2 punctures, we know that
the laminated lambda lengths for e are cluster variables, hence theta functions. We apply this in
ยงB.3 to show that, except for once-punctured tori, notched arcs correspond to theta functions for the
once-punctured closed .
Now, for any weighted tagged arc win , we denote the corresponding bracelet element in the
cluster algebra with coecients Aup(s) byhwiBrac= (hiBrac)w.
30Actually, I(wL) is only dened if (wL)2N. However, (125) allows us to extend the denition to wLwith
2(wL)2Nby taking the elements X1=2
ikof loc. cit. to correspond to zei=221
2N. Alternatively, specifying that
I(2wL) should equal T2(I(wL)) forT2as in (48), and specifying that I(wL) should be positive, suces to uniquely
determine I(wL) from I(2wL).74 TRAVIS MANDEL AND FAN QIN
7.2.3. Arbitrary bracelets. For any weighted simple multicurve C2wSMulti(), we have C=S
iwiCi
as a union of non-homotopic weighted components Ci, each of which is a weighted loop or weighted
tagged arc. The corresponding bracelet elements of Aup(s) isQ
ihwiCiiBrac. In particular, if C=S
iwiiis a collection of weighted tagged arcs wiiwith eachicorresponding to a cluster variable,
thenhCiBracis a cluster monomial.
7.3.g-vectors. LetCdenote any weighted tagged simple multicurveS
iwiCi. When a seed ssimilar
tossatises the Injectivity Assumption, by our construction, hCiBrac has a uniques0-maximal
degree term with respect to any chosen seed s0ofAup(s) (it is pointed when Ciare not doubly-
notched arcs in a once-punctured torus, see ยงB.3). Its degree will be called the (extended) g-vector
and denoted by g(C). Let 0denote the tagged triangulation corresponding to s0(in particular, s0is
similar to s0). Lete(Ci) denote the elementary laminate of Ci, see ยง3.4. Then we have
prIufg(Ci) = b0(e(Ci)): (111)
For loops, the equality follows from (43), (126), and the construction of hCiiBrac; for tagged arcs, it
follows from Proposition 3.26.
Assume  has no self-folded triangles. For any closed non-peripehral loop L,I(L) is pointed at
 (L); cf. (126). So by (43) and Lemma 10.5, hLiBracis pointed at
g(L) = !s
1((L)): (112)
Since 2(L)2N+, we obtain
 2g(L)2M+: (113)
We sometimes consider a seed sfor which the Injectivity Assumption might fail, for example,
s=s. For anyC, letgsprin(C) denote the g-vector ofCfor the seed sprin. Then we dene the
g-vector ofCas the projection (gsprin(C)) foras in (6). Notice that (111) still holds (it can be
deduced from sprinby removing the framing vertices). In the case where s=s, (111) recovers (41).
7.4.Quantum tagged bracelets. We now extend the constructions of ยง7.2 to the quantum setting.
Letsdenote a quantum seed which is similar to sat the classical level.
7.4.1. Quantum bracelets for loops. LetL=S
iwiLidenote a collection of weighted non-peripheral
loops. When  has no punctures, the bracelet elements hLiBracin the quantum skein algebra Sk t()
Aup
t(s) has been dened in ยง4.2. We will see that it is a quantum theta function in Theorem 8.20.
For general  and quantum seed s, we apply the same construction used in ยง7.2.1 but with the
quantum element It(L) as in ยง10.4 in place of I(L). The resulting element !s
1(It(L)) will turn out to
be a theta function by ยง10.5. We dene the quantum bracelet element
hLiBrac:=!s
1(It(L)): (114)
When  has no punctures and s=s, this coincides with the above bracelet dened in the skein
algebra ( ยง4.2), see Lemmas 10.5 and 10.13.BRACELETS BASES ARE THETA BASES 75
7.4.2. Quantum bracelets for tagged arcs. Supposewiiis a weighted tagged arc in , other than a
notched arc in a once-punctured closed surface. Then in the classical setting we noted that hwiiiBrac
is a cluster monomial. We dene hwiiiBracin the quantum setting to simply be the corresponding
quantum cluster monomial.
More generally, let C=S
iwiibe a collection of pairwise-compatible weighted tagged arcs i20
for some tagged triangulation 0, with noibeing a notched arc in a once-punctured closed surface.
We know thathCiBracis a cluster monomial in the classical setting, so for the quantum setting we
simply takehCiBracto be the corresponding quantum cluster monomial.
Next, suppose  is a once-punctured closed surface other than a torus. Let C=S
iwiibe a
collection of pairwise-compatible doubly-notched arcs for some tagged triangulation. We will see that
hCiBracis a theta function in the classical setting (Theorem B.4). In the quantum setting, we dene
hCiBrac:= DT(hCiBrac)
whereCis obtained from Cby switching all taggings from notched to plain, and DT is the (quantum)
DT-transformation as in ยงC. Proposition C.5 implies that the resulting hCiBracis a quantum theta
function, and Corollary C.8 will ensure that the classical limit really is hCiBracjt=1.
Remark 7.3.It is desirable to nd a more natural and fundamental denition of quantum tagged arcs
which also applies to the once-puncture torus. To the best of authors' knowledge, there exists no
denition of quantum tagged arcs in literature. A generalization of the perfect matching formula in
[MW13, Hua22] might provide one alternative denition.
7.4.3. Arbitrary quantum bracelets. LetC=C1[C22wSMulti() where C1=S
iwiLiandC2=S
jwjj, with each Libeing a distinct homotopy-class of loop and each jbeing a distinct class of
tagged arc, none of which are notched arcs in once-punctured closed tori. Then we dene
hCiBrac:=hC1iBrachC2iBrac:
This product is bar-invariant by the Lemma 9.2, which says that hC1iBracandhC2iBraccommute.
Remark 7.4.We do not currently have a characterization of quantum bracelets which included con-
tributions of notched arcs in once-punctured closed surfaces. The covering space trick used in ยง7.2.2
is not expected to work in the quantum setting because the folding construction of ยงA does not carry
over to the quantum setting.
We also do not currently include a description of the classical bracelet elements with coecients
associated to a notched arc in a once-punctured torus. However, for ia weight-one notched arc
in a once-punctured torus, the corresponding classical theta function in the coecient-free setting is
known (cf. [Zho20, ยง5.3] and (162)), and all coecients equal 1. So, given the corresponding classical
theta function with, say, principal coecients, bar-invariance is sucient to uniquely determine the
corresponding quantum theta function.
7.5.Surface cutting. In this subsection, we prove a useful lemma which will allows us to understand
loops in punctured surfaces  by cutting along arcs to produce an unpunctured surface 0where the
loops may be easier to understand. We then apply this lemma to give an alternative characterization
of quantum bracelets associated to loops in punctured surfaces.
Fix a marked surface  = ( S;M). Letdenote any internal arc. We obtain a new surface S0by
cutting Salongso that the two copies 1;2ofbecome part of its boundary. The set M0of the76 TRAVIS MANDEL AND FAN QIN
marked points for S0is dened by
M0:= (Mnfendpoints of g)[fendpoints of 1and2g:
Let  denote any ideal triangulation containing . Then 0:= (n)[f1;2gbecomes a
triangulation for 0:= (S0;M0). Consider the corresponding seeds sands0. We see that, if is
not an edge in a self-folded triangle in , then sis obtained from s0by gluing the frozen elements
1;2as in ยง6.3, and then unfreezing the resulting frozen element 0as in ยง6.5.
Letdenote any arc or closed loop in Ssuch thatdoes not intersect . By examining the
Kauman skein relation (Figure 3.2), we see that the Laurent expansion of [ ] in the skein algebra
Sk() (or the quantum skein algebra Sk t() for unpunctured ) with respect to the triangulation 
is the same as the Laurent expansion of [ ] in the skein algebra Sk(0) (or Skt(0)) with respect to
the triangulation 0, after we identify [ 1];[2] with [].
Lemma 7.5. Let = ( S;M)denote a triangulable punctured surface, and let C=Sr
i=1Lidenote
a disjoint union of non-isotopic, non-contractible (in SnM), non-peripheral simple loops Li. There
exist non-isotopic interior arcs 1;:::;s, such that
idoes not intersect C;
we can extendf1;:::;sginto an ideal triangulation which does not have self-folded tri-
angles;
the marked surface 0obtained from by cutting along the arcs 1;:::;sis triangulable and
unpunctured.
Proof. We do this by induction on the number of punctures in . For the base case with 0 punctures,
we may takef1;:::;sgto be the empty set and apply [FST08, Lem. 2.13] to say that an ideal
triangulation without self-folded triangles exists.
Now suppose  does contain some punctures. It clearly suces to deal with the case where  is
connected, since otherwise we can just deal with each connected component separately. We further
assume that Cis non-empty since otherwise we may take f1;:::;sgto be the arcs of any ideal
triangulation without self-folded triangles.
With these assumptions, x any puncture p. Consider an arc obtained by starting at p, traveling
to a neighborhood of some component LiofC, going around parallel to Li, and then returning to p
(cf. Figure 8.26 for an illustration of a similar construction). Note that Libeing non-peripheral and
non-contractible ensures that does not bound an unpunctured or once-puntured monogon. Also,
any component cut out by contains a boundary component with a single marked point (a copy of
with a copy of the marked point p), so we do not obtain an unmarked component, an unmarked
boundary component, a sphere, or a bigon. Thus, the marked surface  obtained via cutting along
is triangulable.
The new surface  contains one less puncture than . By the inductive assumption,  admits
arcs1;:::;ssatisfying the desired conditions. It is clear that these arcs, together with , satisfy
the desired conditions for . 
LetL=SwiLidenoted a weighted simple curve in  whose components Liare simple non-
peripheral loops. We shall now use a cut-and-paste approach to construct the quantum bracelet
elementhLiBracin a quantum cluster algebra of type |specically, in the corresponding quantum
cluster algebra with principal coecients.BRACELETS BASES ARE THETA BASES 77
ForC=S
iLi, choose a collection of interior arcs 1;:::;sand triangulation  as in Lemma
7.5. Cutting along these arcs iyields an unpunctured surface 0with triangulation 0obtained by
replacing each i2 with the two copies (1)
iand(2)
iofithat appear on the boundary of 0. We
know how to associate to La bracelet element hLi0ofAup
t(s0) constructed using  as in (28) with
d= 4. LetAup
t(sprin
0) be the corresponding upper quantum cluster algebra with principal coecients,
constructed using prinas in (7) (with multiplier d0= 1). Note that the seed sprin
0is similar to s0.
We takehLi0to be the unique m0-pointed element of Aup
t(sprin
0) similar tohLi02Aup
t(s0) (as in
Denition 6.6) with m0= prIufm0.
Now note that sprin
is related to sprin
0via applying frozen vertex-gluing of ยง6.3 to each pair (1)
i;(2)
i
to obtain frozen vertices i, gluing each corresponding pair of principal coecient vertices to obtain
i0, removing all but one of the arrows between i0andias in the discussion following (102), and then
unfreezing each ias in ยง6.5. We now dene the following quantum bracelet element in Aup
t(sprin
):
hLiBrac:=iMprin(hLi0) (115)
forMprinas in ยง6.3 and ias in ยง6.5.
The fact that this construction yields the same elements as that of ยง7.4.1 (and thus is independent
of the choices of arcs 1;:::;s) follows, e.g., from Lemma 10.9. This lemma says that Itrespects
the gluing of boundary arcs used here; it is a consequence of the State Sum Property of the quantum
trace map Tr qused in the denition of It.
7.5.1. Relation to the bracelets of Musiker-Shier-Williams. We note that our (tagged) bracelets basis
agrees with the set Bdened in [MSW13] for a surface-type cluster algebra with full-rank exchange
matrix. Indeed, the elements associated to tagged arcs in either set are cluster variables (with the
exception of notched arcs in once-punctured closed surfaces, but here the corresponding elements in
either setting can be obtained by applying the digon relation in a covering space).
Now it remains to compare the elements corresponding to loops. For these we can use the surface
cutting technique of this subsection to reduce to unpunctured surfaces. In fact, as we will see in
ยง8.2-ยง8.3, we can reduce to (1) the case of a twice-marked annulus or (2) the case of an unpunctured
surface with a single boundary marking (so a single boundary component). These cases satisfy the
Injectivity Assumption even without the boundary-arc coecients:
(1) The twice-marked annulus corresponds to the Kronecker quiver; cf. Example 3.4.
(2) The compatibility condition (2) implies that ( i;) is nonzero for each non-boundary arc i.
In case (2), letting Ldenote the boundary arc, we note that ( i;L) = 0 for all interior
arcsi. So in fact  as in (26) is non-degenerate in this setting even without the boundary-arc
coecient. Compatibility then implies !jNufis non-degenerate as well.
Now, it is already known that Bcoincides with the bases of [FG06] (hence our bracelets bases) in
the coecient-free setting, cf. [MSW13, the comments preceeding Thm. 1.1]. To pass to other full-
rank coecient systems, we just need that the elements of Bfor dierent such coecient systems are
similar pointed elements. In the principal coecients setting, this follows from [MSW13, Thm. 5.1].
For other coecient systems, it is essentially by design (based on the separation formula of [FZ07])
that this holds for Bas constructed in [MSW13, ยง7].78 TRAVIS MANDEL AND FAN QIN
8.Bracelets are theta functions: unpunctured cases
In this section, unless otherwise specied, we assume that  is an unpunctured triangulable marked
surface (although some arguments do work equally well in the punctured setting). Hence, the quantum
skein algebra Sk t() can be dened, and the Injectivity Assumption holds for the corresponding seeds
with boundary coecients. Let  be an ideal triangulation of . Recall as in (50) that, for any
weighted simple multicurve C=SwiCi, we have the corresponding bracelet hCiBracin the quantum
skein algebra Sk t()Aup
t(s), which we denote by hCifor simplicity. The aim of this section is to
show thathCiis a theta function for Aup
t(s), cf. Theorem 8.20.
8.1.The gluing lemma for surfaces. In this subsection we prove a key lemma which will allow
us to prove the correspondence between bracelets and theta functions for 0by rst cutting 0along
arcs and then proving the correspondence on the cut surface .
Let  = ( S;M) be a triangulable marked surface (possibly disconnected). Let b1;b2be the closures
of two distinct components of @Sn(@S\M) | we also denote the corresponding skein algebra elements
(associated to the corresponding boundary arcs) by b1;b2. Let 0= (S0;M0) be the marked surface
obtained by gluing b1tob2(consistently with the orientation of S), identifying the markings at the
ends ofb1with the corresponding markings31at the ends of b2. For simplicity, we assume that  and
0are both unpunctured.
Let us choose a triangulation 0for 0which contains the common image bofb1andb2in 0. This
0induces a triangulation  on . Consider the (quantum) seeds s=s,s0=s0as in (27),(28).
Letsdenote the seed obtained from sby gluingb1;b2(viewed as vertices of the quiver associated to
s) into a single frozen vertex bas in ยง6.3. Note then that s0can be obtained from sby unfreezing bas
inยง6.5. Recall that we have the |-linear map Ms:|t[Ms]!|t[Ms] for the gluing process sending
ze
b1andze
b2toze
bin (101)|in fact, Msis|t-linear in this case since d=d(in general t7!td
d).
Also recall the natural identication i:|t[Ms]'|t[Ms0] for the unfreezing process as in (107).32
LetCdenote a weighted simple multicurve in  such that the sum of the weights of b1andb2is
non-negative. Note that gluing identies Cwith a simple multicurve C0in 0which does not intersect
the interior of b. We have the corresponding skein algebra elements [ C]2Skt() and [C0]2Skt(0)
respectively. Identifying [ C] and [C0] with their Laurent expansions using the triangulations  and
0, respectively, we have the following result:
Lemma 8.1. We have iMs([C]) = [C0].
Proof. LetCbe a weighted simple multicurve. By Corollary 3.6, we know that there exists a nite
collection of quantum cluster monomials [ i] represented by some simple multicurves i, 0ir,
such that the components of each iare arcs in  and such that we have the following decomposition
in Skt():
[0][C] =rX
i=1ci[i]
with coecients ci2|twhich we may assume are all nonzero. This decomposition is computed using
the skein relations which resolve the intersections between Cand0.
31If, say,b1has both ends at the same marking, then this gluing will identify the markings at the ends of b2with
each other, even if they were previously distinct.
32The composition iMsis a|t-linear map, but it does not generally preserve the multiplication of quantum torus
algebras.BRACELETS BASES ARE THETA BASES 79
Let0
idenote the simple multicurves in 0corresponding to i,i= 0;:::;r , under the gluing
process. Then the components of 0
ibelong to 0. We observe that [ i] and [0
i] are initial cluster
monomials zmi2|t[Ms] andzm0
i2|t[Ms0] respectively, such that m0
i=iMs(mi). Moreover, using
the skein relations which resolve the intersection between C0and0
0, and noticing that passing from
 to 0preserves the homotopy equivalence between curves, we still have the following decomposition
in Skt(0):
[0
0][C0] =rX
i=1cithi[0
i];
where extra factors thiappear because the -pairing for calculating products of arcs may change.
The Laurent expansion of [ C] in|t[Ms] is given by
[C] =rX
i=1ci(z m0zmi)
=rX
i=1citkizmi m0
for someki2Z. Similarly, the Laurent expansion of [ C0] in|t[Ms0] is given by
[C0] =rX
i=1cithi(z m0
0zm0
i)
=rX
i=1cithi+k0
izm0
i m0
0
for somek0
i2Z,i= 1;:::;r .
Since [C] and [C0] are bar-invariant, the coecients citkiandcithi+k0
iare bar-invariant, which
implies that tki=thi+k0
ifor eachi. Consequently, we obtain [ C0] =iMs([C]), as claimed. 
Consider the bracelet elements hCi 2 Skt() andhC0i 2 Skt(0) parametrized by CandC0
respectively. Recall our assumption that  ;0are unpunctured. We have the following result.
Lemma 8.2 (The Gluing Lemma) .If the bracelethCi2Skt()is a theta function in Aup
t(s), then
hC0iis a theta function in Aup
t(s0)as well (similarly in the classical t= 1setting).
Proof. First, Lemma 8.1 implies the equality iMs(hCi) =hC0
ii. More precisely, denote C=S
iwiCi
and, correspondingly, C0=S
iwiC0
i. Then iMssendshCii= [Ci] tohC0
ii= [C0
i] by Lemma 8.1.
Recall thathwiCiiequalshCiiwiifCiis an arc and Twi(hCii) ifCiis a loop. Moreover, hCiis a product
of the factorshwiCii. Similarly forhC0i. Thus,hCiis a|t-linear combination of weighted multicurves,
andhC0iis the corresponding |t-linear combination of the images of these weighted multicurves under
iMs. The equality now follows from the |t-linearity of iMs.
Recall that the gluing process Mssends theta function to theta functions by (105), so Ms(hCi)
is a theta function. Furthermore, since iMs(hCi) =hC0iis theta positive in the t= 1 setting by
Lemma 5.32, Lemma 6.12 ensures that iapplied toMs(hCi) yields a theta function; i.e., hC0iis a
theta function, as desired.

By the denition of (quantum) tagged bracelet elements, we have the following useful observation
as a special case of Lemma 6.10 (also cf. Remark 6.11).80 TRAVIS MANDEL AND FAN QIN
Lemma 8.3. Consider two marked surfaces (possibly with punctures) 1and2. Fori= 1;2, choose
a weighted tagged simple multicurve Cioni, endow iwith an ideal triangulation i, and let si
denote a (quantum) seed similar to si. Let sbe the union of s1ands2as in (106) or the quantum
seed analog. Let  =  1t2with triangulation  =  1t2, sosis similar to s. If the (quantum)
tagged bracelet elements hLiiare theta functions in Aup
t(si)respectively, then hL1tL2i2Aup
t(s)is a
theta function as well.
8.2.Annular loops in unpunctured surfaces. Recall that, for any given seed satisfying the in-
jectivity assumption, we use g(C) to denote the degree ( g-vector) of a tagged bracelet element hCi;
cf. Denition 6.2 and ยง7.3.
Lemma 8.4 (Loops in the twice-marked annulus) .Suppose is an annulus with one marking on
each boundary component as in Example 3.4. Let Lbe the simple loop in . ThenhkLi=#kg(L)for
eachk2Z0.
Proof. It suces to prove this in the quantum setting. Let 2be any arc in . The two tringulations
containing2are pictured in Figure 8.24, with the other arcs in these triangulations labelled 1and
3. By the skein relation (Figure 3.2), we see [ 2][L] =q[1] +q 1[3]. Recall the notation
v1:=!1(e1) = (0;2; 1; 1) andv2:=!1(e2) = ( 2;0;1;1)
as in (73). In the seed associated to the triangulation  uf=f1;2g, we have the following g-vectors
(using (9) to nd g(3) and (112) for g(L)):
g(1) = (1;0;0;0); g(2) = (0;1;0;0); g(3) = (1;0;0;0) +v2= ( 1;0;1;1)
and
g(L) = (1; 1;0;0):
So to show that L=#g(L), it suces to show that
#(0;1;0;0)#(1; 1;0;0)=q#(1;0;0;0)+q 1#( 1;0;1;1): (116)
This can be checked by computing broken lines as in Example 5.8 and Figure 5.22. Indeed, for
Qin the positive chamber, #(1;0;0;0);Qand#(0;1;0;0);Qare the monomials z(1;0;0;0)and#(0;1;0;0);Q,
respectively, while #( 1;0;1;1);Qis the mutated cluster variable z( 1;0;1;1)+z( 1;2;0;0). Noting that
(1; 1;0;0) =1
2(v1+v2), consideration of broken lines yields
#(1; 1;0;0);Q=z(1; 1;0;0)+z( 1;1;0;0)+z( 1; 1;1;1);
the broken lines contributing these three terms are illustrated in Figure 8.23. The equality (116) now
follows (referring to Example 2.6 for the -matrix).
Finally, the claim for higher kfollows from (78) and the denition of the bracelet hkLiin (51).

We note that [SZ04, Thm. 2.8] has previously shown for the classical cluster algebra of the Kro-
necker quiver (as in Example 2.3 but without the frozen vertices; i.e., the twice-marked annulus
without boundary coecients) that there is an atomic basis satisfying the Chebyshev recursion.
Lemma 8.5. IfLis a simple loop in an unpunctured surface , and if there exists an arc which
intersectsLexactly one time, then hkLi2Skt()is equal to#g(kL)for eachk2Z0.BRACELETS BASES ARE THETA BASES 81
(e?
2;	t4(zv2))(e?
1;	t4(zv1))
Q
Figure 8.23.
12
32
L2
Figure 8.24. 2L=q1+q 13.
Proof. LetULSbe a small tubular neighborhood of L, and letUSbe a small tubular
neighborhood of which is pinched at the endpoints. Then  L:=UL[Uis an annulus Acontaining
Landand with one marked point on each boundary component, cf. Figure 8.25 (in general, the two
marked points might come from the same point in ). Let b1;b2be the two boundary components
ofUL[U. The arcs ;b1;b2form part of a triangulation of . By Lemma 8.4, hkLi=#g(kL)for
eachk2Z0if we work in the cluster algebra associated to the marked annulus A. This equality
hkLi=#g(kL)extends to the full surface  by Lemma 8.2.
= [
Figure 8.25. Excising an annulus containing a bracelet. The rst component on
the right-hand side is the annulus A.

In view of Lemmas 8.4 and 8.5, we call a simple loop Lanannular loop if there exists an arc in
 which intersects Lexactly once. In this case, for any chosen marked point rin the same connected
component of SasL, we can choose so thatris at least one of its endpoints.
8.3.Non-annular loops in unpunctured surfaces. Unfortunately, not all non-contractible loops
are annular. A non-contractible loop which is not annular will be called a non-annular loop . In82 TRAVIS MANDEL AND FAN QIN
view of Lemma 8.3, let us assume  is connected. Our goal in this subsection is to prove that if L
is a non-annular loop, then the bracelets hkLiare theta functions. Since the argument is somewhat
complicated, we summarize it here.
We begin in ยง8.3.1 by cutting  down to a simpler surface  Lwith only one boundary component
and one marked point, and with Lhomotopic to the boundary (Figure 8.26).
Then in ยง8.3.2 we show that [ L] is a theta function for  L. To do this, we rst show that [ L] is
universally positive (in the quantum setting), hence a sum of s1 theta functions (a priori with
powers oftfor coecients). We also nd that [ L] times an interior arc [ ] is a sum of three theta
functions (Figure 8.27), so strong positivity of theta functions implies s3. More careful inspection
rules outs= 2;3, implying that [ L] really is a theta function.
Inยง8.3.3 we review the mapping class group   and apply results of [GHKK18, DM21] to show
that   acts equivariantly on theta functions; cf. Lemmas 8.11 and 8.12. This is applied in ยง8.3.4 to
show that [L]sis a linear combination of theta functions #kg(L)fork2Z0(Lemma 8.17), essentially
becausehkLiare the only bracelets (up to multiplication by the boundary arc) on which the mapping
class group   Lacts trivially (or even with nite orbit).
We give a partial description of [ L]ktimes an interior arc [ ] in Lemma 8.15 using the skein relations
and induction. By combining this with Lemmas 8.17 and 8.18, we deduce that, for Qsuciently near
g(L), we have #g(L);Q=zg(L)+z g(L)+ [higher order terms]. Finally, in Lemma 8.19, we use the
structure constants formula (Proposition 5.9) and the characterization of the Chebyshev polynomial
Tkin Lemma 4.5 to conclude that #kg(L)=Tk(#g(L)), hencehkLi=#kg(L).
8.3.1. Cutting out a simpler surface L.
Lemma 8.6. LetLbe a non-annular loop in a connected marked surface . Letr2Mbe a marked
point. Then there is an arc Ldisjoint from Lsuch that:
both ends of Lare atr;
The connected component S
LofSnLwhich contains Lhas positive genus and contains no
marked points in its closure except for r;
Lis homotopic to the image of Lin.
This situation is illustrated in Figure 8.26.
 LLLL
Figure 8.26. If there is not an arc intersecting Lexactly once, then we can cut
along an arc Lto simplify the picture.
Proof. Consider the compactication of SnLobtained by adding two copies L1andL2ofLto the
boundary. If SnLwere connected, then there would be paths from rtoLifor eachi= 1;2, and these
could be glued in Sto construct an arc intersecting Lexactly once. Similarly, if SnLis disconnected
but each component contains marked points, then one could nd an arc between the two components
(when glued to form S) which intersects Lexactly once.BRACELETS BASES ARE THETA BASES 83
So a non-annular loop Lmust disconnect S, and one of the resulting connected components must
have no marked points. Let ULbe a small tubular open neighborhood of L, and letbe a path from
rto@ULwhich does not intersect UL. We then construct Lby following fromrto@UL, wrapping
around this component of @UL, and then following along back tor. The fact that this Lsatises
the desired conditions is clear from the construction. 
We shall continue to use the notation Las in Lemma 8.6. We let SLdenote the closure of S
Lin
S, and let  L= (SL;frg). Note that  Lis a unpunctured triangulable marked surface.
8.3.2. A single non-annular loop with weight 1.
Lemma 8.7. [L]2Skt(L)is a theta function.
We will prove Lemma 8.7 by induction on the genus of  L. We therefore assume for the rest of
ยง8.3.2 that either  Lhas genus 1, or that Lemma 8.7 holds whenever  Lis of lower positive genus
(i.e., the induction hypothesis holds).
Lemma 8.8 (Quantum universal positivity for simple loops) .For any simple loop L02L,[L0]2
Skt(L)is universally positive with respect to the scattering atlas.
Proof. The positivity for the annular loops is known by Lemma 8.5. Non-annular loops L0in Lwhich
are not homotopic to Lexist only if the genus of  Lis larger than 1|in this case we can construct
L0inside L. Then the induction assumption for Lemma 8.7 implies that [ L0] is a theta function for
L0, hence a theta function for  Lusing the gluing lemma (Lemma 8.2). So it only remains to show
thatLis universally positive.
Note that for every isotopy class of non-boundary arc in  L, the minimal number of intersections
of a representative of the isotopy class with Lis exactly two. Let be any such non-boundary arc.
Then [][L] is a sum of three terms as in Figure 8.27 (the fourth term coming from the skein relations
is equivalent to 0 because it contains a contractible arc; the q-coecients are suppressed in the gure).
In the quantum setting, we have
[][L] =q2[1=2
L()] +q 2[ 1=2
L()] + [L][L0]: (117)
The rst two terms on the right-hand side in (117) are arcs (the motivation for the notation 1=2
L()
will become clear when we discuss Dehn twists in ยง8.3.4), which correspond to (quantum) cluster
variables, and these are universally positive by [Dav18]. The third term is the product of the frozen
variableLand a simple loop L0non-homotopic to L, which are both universally positive.
Hence, [][L] is universally positive for any interior arc . For any triangulation , we may choose
to be an interior arc in , so then [ ] is a cluster variable in sand the positivity of [ L] ins
follows from that of [ ][L]. Since this works for any triangulation , it follows that [ L] is universally
positive with respect to the cluster atlas (which equals the scattering atlas by Proposition 5.23) as
desired. 
Lemma 8.9. In(117) , we haveg() +g(L)6=g(L) +g(L0).
Proof. Consider Zacting on Sk t() via Dehn twisting by L. The elements [ L], [L], and [L0] are all
invariant under this action, but the orbit of [ ] is innite. Thus, under the induced action on g-vectors
(see ยง8.3.3), the orbit of g() +g(L) is innite while g(L) +g(L0) is xed, so these two sums cannot
be equal. 84 TRAVIS MANDEL AND FAN QIN
= + +
Figure 8.27. An arc times a loop resulting in a sum of two arcs plus the product of
an arc and a disjoint loop.
We will use the following general fact about theta functions:
Lemma 8.10. If#g1and#g2are theta functions such that prIuf(g1);prIuf(g2)6= 0, then#g1#g2is not
a cluster variable (and in the quantum setting it is not a power of ttimes a cluster variable).
Proof. By positivity, it suces to prove this in the classical setting. If g1andg2share a chamber of
C, then#g1#g2=#g1+g2is the cluster monomial zg1+g2, but this cannot be a cluster variable by our
assumption on g1;g2. Now suppose that g1andg2do not share a chamber of C. LetCbe an arbitrary
chamber ofCand letQ2Cbe generic. Then at least one giis not inC, in which case there are at
least two broken lines contributing to #gi;Q. One is the straight broken line with ends ( gi;Q). Since
the traveling direction of a broken line is bent by tangent vectors of the walls, see ยง5.4, there is also
a broken line with initial end giwhich is straight until crossing the boundary of C, where it bends
non-trivially. So then (using universal positivity) #g1;Q#g2;Qhas at least two terms, hence is not a
cluster variable (or even a cluster monomial) in the cluster associated to C. SinceCwas an arbitrary
chamber ofC, this proves the claim. 
Now, we prove Lemma 8.7 under the assumption that either  Lhas genus 1 or the induction
hypothesis holds. That is, we will show that [ L]2Skt(L) is a quantum theta function. Our
arguments are based on the decomposition of [ ][L] as in Figure 8.27 together with positivity.
Proof of Lemma 8.7. As in the proof of Lemma 8.8, we may select an arc which intersects Ltwice,
and then the product [ ][L] in the quantum skein algebra is given as in (117). The rst two terms here
are cluster variables (times q2), and the third term is also a theta function by Lemma 8.5 (because
the product of a theta function with a frozen variable is still a theta function by Lemma 6.7)33.
Since [L] is universally positive and the theta functions are atomic, Lmust be a positive linear
combination of theta functions, i.e., a sum of theta functions with coecients in Z0[t1]. So we can
write
[L] =sX
i=1tai#pi
for some collection p1;:::;ps2M(possibly with repetition) and a1;:::;as2Zwiths1. By strong
positivity, [ ] times any #piis again a positive linear combination of theta functions. By Lemma 8.10,
a theta function #pitimes the cluster variable [ ] will never be just a single cluster variable times a
power oftunless34pi= 0, i.e., unless #pi= 1. But no pihere can equal 0 since is not a term in
[][L], so the fact that [ ][L] is a sum of three theta functions (times powers of t) including two cluster
variables implies that sequals 1 or 2.
33Generally, a theta function times a frozen variable may actually be a power of ttimes a theta function (which
would still be ne for our purposes here). However, g-vectors of boundary arcs always lie in ker(), so this power of t
does not appear in the present setting.
34Lemma 8.10 would allow pi6= 0 if at least prIuf(pi) = 0, but in this case #piis a power of a frozen cluster variable
while [] is a non-frozen cluster variable, so the product [ ]#piwould be a cluster monomial but not a cluster variable.BRACELETS BASES ARE THETA BASES 85
The cases= 1 yields the claim (by bar-invariance, a1= 0 in this case), so it suces to rule out
the possibility of s= 2.
Ifs= 2, then we can write
[L] =#g(L)+#p
for somep2M| there must be a term #g(L)by the pointedness of [ L], while the bar-invariance
of bracelets and theta functions (cf. Lemma 5.34) implies that the coecient of #pis also 1. As
previously noted, we know that p6= 0 since [] is not a term in [ ][L].
Note that, since neither [ ]#g(L)nor []#pis a cluster variable (by Lemma 8.10 again), one of these
products must equal the rst two terms (the sum of the cluster variables) in (117), and the other
one must be the remaining theta function [ L][L0], which we denote by #u. So []#v=#uwithv
being either g(L) orp. Lemma 8.9 implies that v6=g(L), sov=p. Since the leading monomial in
[]#p=#uhas coecient t(g();p)= 1, we have ( g();p) = 0.
Notice that we have ( g(L);) = 0. By the above discussion, ( g();p) = 0 for any non-boundary
arc. Hence, ( ;p) = 0. Since  is compatible with the B-matrix and there is only one frozen
variable, we deduce that ker( 2) has dimension 1 and equals Zg(L), sop2Zg(L). But then #p
would be a power of a frozen cluster variable, so [ ]#vwould be a cluster monomial, not the term
#u= [L][L0]. This contradiction implies s= 1, i.e., [L] =#g(L), as desired. 
8.3.3. The mapping class group. We briey recall how mapping class groups acts on cluster algebras
arising from (possibly punctured) marked surfaces. Here, the mapping class group   of  is the
group of isotopy classes of orientation-preserving dieomorphisms S!Swhich take MtoM.
Recall that cluster mutations give isomorphisms between the skew-elds of fractions of the clusters
associated to sands0, where sands0are any two seeds related by mutations. Correspondingly, any
rational function in the cluster variables of sis sent to a rational function in the cluster variables of
s0.
Note that every element of   takes a triangulation  to another triangulation 0. Correspondingly,
we obtain a new seed s0=s0froms=s. Note that the seeds sands0are isomorphic, so we can
also view this action as an automorphism of the cluster algebra by identifying the cluster variables
ofswith those of s0(i.e., the mapping class group is contained in the cluster modular group of
[FG09]).
Thus, for2 , we have0:Acan
t(s) !Acan
t(s0),#m7!#0(m), where0:Ms!Ms0is
dened to be the linear map determined by e
s;i7!e
s0;ifor alli2I. On the other hand, let ~ |be a
sequence of elements in InFsuch that ( s)~ |=s0in the notation of ยง2.4. By [DM21, Cor. A.4] (or
[GHKK18, Thm. 1.24] in the classical setting), there is an isomorphism  ~ |:Acan
t(s) !Acan
t(s0)
given by#p7!#T~ |(p)forT~ |as in (11).
Thus, the composition   1
~ |0:#m7!#T 1
~ |0(m)is an automorphism of Acan
s. By [DM21, Prop.
4.9(2)],#T 1
~ |0(e)=#g(())for each2. So the corresponding automorphism of Sk t() maps
[] to [()] for each 2. Hence,   1
~ |0coincides with the natural action of on Skt(). We
therefore denote =  1
~ |0. We also let denote the piecewise-linear automorphism of Mgiven by
T 1
~ |0. To summarize, we have the following:
Lemma 8.11. The mapping class group  acts onMvia piecewise-linear automorphisms. Fur-
thermore, for each 2 , the action of onSkt() maps theta functions to theta functions via
#m7!#(m).86 TRAVIS MANDEL AND FAN QIN
Lemma 8.12. If(#m) =#m0, thenm0=(m). If2 xes#m1;:::;#ms, then for any collection
k1;:::;ks2Z0,must permute the theta functions #pappearing in the expansion f:=Qs
i=1#kimi=P
pcp#p. Thus,acts with nite orbit on each index pof these theta functions, in particular for
p=Ps
i=1kimi.
Proof. The rst statement follows from the fact that (#m) =#(m)in Lemma 8.11 and the fact that,
if#m=#m0, thenm=m0(a consequence of Lemma 5.19).
For the second statement of the lemma, since xes each#mi, it must x f, so we see (using the
linear independence of theta functions from Lemma 5.19 again) that must indeed permute the theta
functions appearing in the summation. Combining this with the rst statement of the lemma yields
that the elements p2Mwithcp6= 0 must be permuted. Since there are only nitely many such p, the
orbits of these elements are nite. Finally, the fact that ap6= 0 forp=Ps
i=1kimiis a consequence of
Corollary 5.10. 
Note thatsends the cluster variable [ ] for2 to [()]. Since all other elements of Sk t()
can be expressed a Laurent polynomials in the cluster variables for , we obtain the following:
Lemma 8.13. For any weighted simple multicurve C, the action of onSkt()mapshCitoh(C)i.
Recall from ยง7.3 that for unpunctured , or more generally, for a seed sof surface type satisfying
the Injectivity Assumption, every bracelet element is pointed. We write mfor them-pointed
bracelet element.
Lemma 8.14. For unpunctured , or more generally, for sof surface type with M
sstrongly convex,
if a bracelet element ghas innite orbit under the action of some 2 , thengalso has innite
orbit under the action of .
Proof. By the pointedness of the bracelets, if we expand #gin the bracelets basis35as#g=P
mcmm,
thencg= 1. Let B3gbe the set of all bracelets which contribute non-trivially to the bracelets
basis expansion of at least one element of the form k(#g),k2Z. If the orbit of the -action on#g
were nite, then Bwould be nite, but Bmust be innite since it contains k(g) for allk2Z. So
the orbit of #gmust be innite, hence the orbit of gmust be innite as well. 
8.3.4. Dehn twists and non-annular loops. Given any loop Lwith a xed choice of orientation, let
L2 denote the corresponding Dehn twist of  (denoted tw Linยง3.5). As in ยง8.3.3,Lacts on the
associated algebras and lattices. We now return to the setting of the surface  Las in ยง8.3.1{ ยง8.3.2.
Let2Skt(L) be any non-boundary arc of  L, sointersectsLtwice (after applying an isotopy
to minimize the number of intersections). Recall that, as pictured in Figure 8.27, we have (117):
[][L] =q2[1=2
L()] +q 2[ 1=2
L()] + [L][L0]
for a pair of arcs 1=2
L(L) and some non-contractible simple loop L0non-isotopic to Land disjoint
fromL| here, the notation 1=2
L(L) for the two arcs can be viewed formally, but it is chosen because,
as we shall see next, applying similar skein relations to compute [ 1=2
L()][L] yields the positive and
negative Dehn twists of byL(we assume the orientation of Lis chosen so that the signs work out
35In the surface type setting with strongly convex M
s, the bracelets still form a basis over |[MF], so this does not
aect the proof except that the coecients cmmay like in |[MF].BRACELETS BASES ARE THETA BASES 87
as indicated). Correspondingly, let us call 1=2
L(L) and 1=2
L(L) the positive arc and negative arc,
respectively in the decomposition of [ ][L].
Using the skein relations again, one computes the decomposition [ 1=2
L()][L] to nd:
[1=2
L()][L] =q2[L()] +q 2[] + [L][L1
2]
[ 1=2
L()][L] =q2[] +q 2[ 1
L()] + [L][L 1
2]
for other non-peripheral simple loops L1
2non-isotopic to Land disjoint from L. Therefore, by
repeatedly multiplying [ ] byL, one nds that
[][L]2= 2[] +q4[L()] +q 4[ 1
L()] +q2[L][L1
2] + [L][L][L0] +q 2[L][L 1
2]: (118)
Similarly, we can recursively dene arcs d
L(),d21
2Z, via the relation
[d
L()][L] =q2[d+1
2
L()] +q 2[d 1
2
L] + [L][Ld] (119)
for some non-peripheral simple loop Ldnon-isotopic to Land disjoint from L.36As before, we call
the rst two terms in the decomposition the positive arc and the negative arc respectively. We note
that, when d2Z,d
L() is indeed equal to the d-th power of the Dehn twist.
The following result partially generalizes (118).
Lemma 8.15. For anyk2Z>0, we have a decomposition into bangles:
[][L]k=X
d21
2Z
jdjk
2cd[d
L()] +X
r2Z0;s21
2Z
0rk 1
jsjk 1
2l(r;s)[L][L]r[Ls]:
where the coecients cdandl(r;s)are Laurent polynomials in qwith non-negative integer coecients.
Moreover, we have c0= k
k=2
if2divideskandc0= 0otherwise.
Proof. The rst claim follows from a straightforward induction argument using (119).
Note that the coecients cdare the combined contributions of the coecients from iterations of the
rst two terms appearing in the decomposition (119). In particular, we can calculate the coecient
c0as follows: when multiplying [ ] by [L] repeatedly ktimes, we choose either the positive arc or
the negative arc in (119) at each step ( ksteps in total). In order to nally obtain the arc [ ], the
number of times where we choose the positive arc must equal the number of times where we choose
the negative arc, and so c0counts the number of ways to choose the positive arc exactlyk
2times. The
claim about the value of c0follows. 
Lemma 8.16. LetL1;:::;Lrdenote a collection of disjoint simple loops (possibly isotopic) in L.
When decomposing the product [L]Q
i[Li]into a nite linear combination of theta functions, no theta
functions#gappearing can correspond to an internal arc.
Proof. Every internal arc has innite orbit under the action of L, butLacts trivially on the product
[L]Q
i[Li]. The claim thus follows from Lemma 8.12. 
Lemma 8.17. For eachs2Z0,[L]sis a nite linear combination of theta functions of the form
#kg(L)fork2Z0.
36We observe that Ld=Ld+1for anyd21
2Z. This observation will not be used.88 TRAVIS MANDEL AND FAN QIN
Proof. Note thatLand the boundary arc Lare the only arcs or loops in Swhich are invariant under
the action of the mapping class group of . All others have innite orbits under some Dehn twists. So
by Lemma 8.14, the only elements in Mwhich have nite orbit under the mapping class group action
are those of the form ag(L) +bg(L) fora2Zandb2Z0. Hence, the theta functions invariant
under the action of the mapping class group are of the form #ag(L)+bg(L)fora2Zandb2Z0, while
all other theta functions have innite orbits under this action. It therefore follows from Lemma 8.12
that#s
g(L)is a linear combination of theta functions of the form #ag(L)+bg(L)fora2Zandb2Z0.
On the other hand, by (113), g(L)2Muf;Q. So, since bends of broken lines are in Muf, Proposition
5.9 implies that theta functions contributing to #s
g(L)must all have g-vector inMuf;Q. Butg(L)
cannot be in Muf;Q|indeed,  is non-degenerate on Muf, and one can easily see from the denition
of  (cf. (26) and (28)) that g(L)2ker(). The claim follows. 
The following is a general lemma on theta functions which satisfy the conclusion of Lemma 8.17:
Lemma 8.18. Let#pbe a theta function such that, for all s2Z0,#s
pis a linear combination of
theta functions of the form #kpwithk2Z0. Fix`2Z1. Then for any generic Qsuciently close
top, the only broken lines in MRwith ends (p;Q)and nal exponent in Mn(p+`M+)are the straight
broken line and broken lines with nal exponents of the form  bpforb2Z1.
Proof. Ruling out exponents bpwithb0:Let us consider bp2Mwithb2Q0. For the given
`2Z1and anyQsharing a chamber of D`withp, the only broken line with respect to D`ending
atQwith the nal exponent bpis the straight broken line with initial direction bp. This broken line
contributes to #pif and only if b= 1.
So now it suces to show that the broken lines with ends ( p;Q) for genericQsuciently close to
phave nal exponent in Zp.
Ruling out exponents in MnZp:Consider any m2M. Choose`m2Z1such that
m =2p+`mM+: (120)
Then any broken line p;Q;mwith endspandQand nal exponent mwill only bend at walls of D`m.
Note that, for suciently large c2Z1,m+cpwill share a chamber of D`mwithp. Further observe
thatm+cp =2(c+ 1)p+`mM+(by adding cpto both sides of (120)), i.e., `mis suciently large for
applying Lemma 5.11 to the coecient a#c+1
p;Q;m+cp(in the notation of loc. cit.; see (81)). So take Q
sharing a chamber of D`mwithm+cp, and suppose there exists a broken line p;Q;mwith ends (p;Q)
and nal exponent m. Then Proposition 5.9 implies that the #m+cp-coecient of the theta function
decomposition of #c+1
pis nonzero because it will receive a positive contribution from any ( c+ 1)-tuple
of broken lines consisting of p;Q;mtogether with ccopies of the straight broken line with ends ( p;Q).
So by assumption, m+cpmust be in ( Z0)p, hencem2Zp.
Existence of suciently close Q:Given`as in the statement of the lemma, the set
Mp;`:= (p+M)n(p+`M+)
is nite. So we can take \suciently close" in the statement of the lemma to mean sharing a chamber
ofD`0withpfor`0= max (f`mjm2Mp;`g[f`g). The claim follows. 
We are at last ready to prove that bracelets for weighted non-annular loops are theta functions.
Lemma 8.19. LetLbe a simple non-annular loop in the unpunctured triangulable surface . Then
hkLi=#kg(L)2Skt()for eachk2Z1.BRACELETS BASES ARE THETA BASES 89
Proof. By the gluing lemma (Lemma 8.2), it suces to prove the claim for  L. Furthermore, we
already know from Lemma 8.7 that hLi=#g(L), so it remains to show that #kg(L)=Tk(#g(L)) in
Skt(L) forTkas in (48) and for any given k2. Let us denote p:=g(L).
As in Lemma 4.5, dene integers a;k2Z0fora= 0;:::;k by specifying that a;kis the coecient
ofzkpin the Laurent expansion of ( zp+z p)k. By Lemma 8.17, ( #p)k=P
0ak0
a;k#apfor some
coecients 0
a;k2Z0[t1]. By Lemma 4.5, it suces to show that 0
a;k=a;kfor alla.
(i) Let us study #p. Fix`2Z1large enough so that 0 =2kp+`M+. By Lemma 8.18, for Q
suciently close to p, the only broken lines with ends ( p;Q) and nal exponent in Mn(p+`M+)
will have the nal exponent por bpforb2Z1. Note that the zp-coecient for #pis 1. Denote the
z bp-coecient of this #p;Qbycb.
We prove that c1= 1 andcbvanishes for b>1. Note thatQis always suciently close to 0 for the
application of Proposition 5.9 (i.e. Qand 0 always share the same chamber). In particular, it follows
that the#0-coecient (i.e., the constant coecient) of #2
pis equal to 2 c1. So we begin by showing
that this#0-coecient of [ L]2equals 2.
We see from (118) that the #g()-coecient of [ ][L]2is equal to 2 (using Lemma 8.16 to ensure
that the#g()-coecient of the term [ L][L][L0] equals 0). Thus, we indeed nd that the #0-coecient
of [L]2is equal to 2 (using Lemma 5.12 and noticing that [ ] =#g()is a cluster variable). So c1= 1,
as claimed.
It remains to show cb= 0 forb2. If some such cbwere nonzero (hence positive), then Proposition
5.9 implies that the #0-coecient 0
0;b+1of#b+1
pwould be larger than the constant term 0;b+1of
(zp+z p)b+1. But Lemma 8.15 and Lemma 8.16 imply that the #g()-coecient of [ ][L]b+1must be
0;b+1, so the constant term of [ L]b+1must equal 0;b+1as well. This contradiction shows that cb= 0
forb2.
(ii) Now let us study ( #p)k. By (i), forQsuciently close to the ray through p,#p;Q=zp+z p+:::
where the remaining terms have exponents in Mn(p+`M+). Recall that `was chosen to be large
enough that 0 =2kp+`M+, soap =2kp+`M+for anya0 becausep2 M
Qby (113). Thus,
any term in #k
p;Qinvolving a contribution from a term other than zporz pmust have exponent in
kp+`M+63ap, hence cannot contribute to the structure constants 0
a;k. Thus, applying Proposition
5.9,0
a;kis indeed equal to the coecient a;kofzapin the expansion of ( zp+z p)k.
8.4.Bracelets in unpunctured surfaces. Our aim in this subsection is to prove the following:
Theorem 8.20. The bracelets basis and theta basis coincide for all unpunctured surfaces (in both
the quantum and classical settings).
Let  denote a marked surface, possibly with punctures, with an ideal triangulation . Let
C=Fs
i=1wiCidenote a tagged simple multicurve, wi>0. Denote i=wiCiand dene the
collection=f1;:::;sg.
In the following, unless otherwise specied, we will assume that  is unpunctured, in which case
we will simply take s=s.
We know from Proposition 3.7 that weighted arcs are cluster monomials, which are theta functions.
Also, weighted non-peripheral loops are theta functions by Lemmas 8.5 and 8.19. Moreover, the
quantum bracelet hCiBracis a bar-invariant element in Sk t(). Therefore, Theorem 8.20 will follow
once we prove Lemma 8.21:90 TRAVIS MANDEL AND FAN QIN
Lemma 8.21. For unpunctured , we have
t#g(1)#g(s)=#g(1)+:::+g(s): (121)
where the factor tis chosen so that the product is pointed, i.e., = P
1i<js(g(i);g(j))
To prove this, we will need some more lemmas. We begin by showing that it suces to prove a
simplied version of Lemma 8.21. The collection =1;:::;sis said to be maximal if one cannot
extendCto a weighted simple multicurve Ctws+1Cs+1with one more component Cs+1(the existence
of maximal follows, e.g., from Lemma 8.23 below).
Lemma 8.22. To prove Lemma 8.21, it suces to prove the cases where t= 1 and the collection 
is maximal. Furthermore, one may assume that this maximal includes no interior arcs.
Proof. To reduce to the t= 1 setting, note from Corollary 5.10 that the coecient of #g(1)+:::+g(s)
in the product #g(1)#g(s)is indeedt foras in Lemma 8.21. If any other theta functions
contributed to this product, strong positivity ensures that they would have coecients in Z0[t1], so
these theta functions would still contribute in the t= 1 setting. So proving Lemma 8.21 when t= 1
would rule this out.
So now x t= 1. To show that we can assume is maximal, it suces to show that if f1;f2are
theta positive and f1f2is a theta function, then each of the factors f1andf2must be theta functions.
Fori= 1;2, letfi=Psi
j=1aij#mijbe a positive linear combination of theta functions, so si1
and eachaij2Z1. By strong positivity, ifPsi
j=1aij>1 for either i= 1;2, then the sum of the
coecients in the theta function expansion of the product f1f2will also be larger than 1. Therefore,
f1f2being theta function indeed implies that both f1andf2are theta functions. In particular, a
product of bracelets being a theta function implies that any product of a subset of the bracelets is a
theta function.
The second claim follows from Lemma 8.2, the gluing lemma, because one can always cut  along
any interior arcs in to obtain a surface in which all arcs of are boundary arcs. 
Lete(i) :=wie(Ci) denote the laminate associated to i=wiCi, wheree(Ci) denotes the elemen-
tary laminate as in Denition 3.25.
Lemma 8.23. Consider possibly with punctures (in which case we work with a quantum seed s
similar to s) and a collection =f1;:::;sgconsisting of compatible weighted loops and arcs.
Let0denote the subset consisting only of weighted loops. Then for any ideal triangulation , the
following statements are true:
(i) The shear coordinate vectors b(e(i)),i20, are linearly independent.
(ii) If the only arcs in are boundary arcs, then the corresponding g-vectorsg(1);:::;g (s)are
linearly independent.
Proof. It suces to prove the cases where each ihas weight 1 since changing the weight just scales
the shear coordinates and g-vector.
(i) If this were not the case, it would mean that there is an equality
X
j2J1ajb(e(j)) =X
j2J2ajb(e(j)) (122)
for some non-empty disjoint subsets J1;J2f1;:::;sgwithj20wheneverj2J1tJ2, and some
positive integers aj2Z1,j2J1tJ2. Correspondingly, we have two unbounded integral laminationsBRACELETS BASES ARE THETA BASES 91
L1,L2, given byLi=F
j2Jiaje(j) forj= 1;2, respectively.. Then L1andL2are non-homotopic,
but they have the same shear coordinates. But, by Proposition 3.24 ([FT18b, Theorems 12.3, 13.6]),
non-homotopic L1andL2must have distinct shear coordinates. This is a contradiction.
(ii) Notice that the quantum seed ssatises the Injectivity Assumption. The g-vectors of frozen
variables are distinct elements of fe
iji2Fg, which are in particular linearly independent. The claim
follows now from (i) and the equality prIuf(i) = b(e(i)) (see (111)). 
Recall that we can also associate an intersection coordinate vector (L)2NQto an integer bounded
lamination L2AL(;Q) by (40).
Lemma 8.24. Fora possibly punctured surface and a collection of compatible weighted loops and
arcs, and for any ideal triangulation , the corresponding intersection coordinate vectors (e(1));:::
;(e(s))are linearly independent.
Proof. The proof is similar to that of Lemma 8.23 except that we work with NQinstead of ZIuf, and
we use Proposition 3.22 instead of Proposition 3.24 for seeing that distinct laminations have dierent
intersection coordinate vectors. 
Given`2Z1, letC
jdenote the connected components of MRnD`(indexed by j) andCj
the corresponding closures, called chambers . Then the chambers Cjare convex cones, and these
chambers together with their faces form a complete fan in MR, see [Rea20, Thm. 3.1] (alternatively,
for  not a once-punctured surface, D`is equivalent to Bridgeland's stability scattering diagram
[Bri17] which gives a fan structure, see [Qin22]).
The following Lemma is crucial for our proof.
Lemma 8.25. Consider possibly with punctures, and assume that the collection consists only of
weighted loops and boundary arcs (we do not require here that is maximal). Let 0be the subset
consisting of weighted loops. Let denote the cone in MRspanned by
fg(1);:::;g (s)g[f g(i)ji2n0g:
Then for any `2Z1, there exists a chamber of D`which contains both and the cluster complex
chamberC0associated to some ideal triangulation 0without self-folded triangles. Furthermore, if
0=f1;:::;kgis a set of interior ideal arcs, none of which are nooses, such that the elements of
[0are pairwise compatible, then 0may be chosen to contain 0.
Proof. Let0be the subcone spanned by fg(i)ji20g. Note that 0Muf;R:=!1(Nuf)
R
by (113). It suces to show that 0is contained in a chamber of D`, because one then extends the
result from 0toby noting that, in general, every chamber of D`includesg(Ai) for every frozen
variableAi, hence for every boundary arc.
(i) Here we consider the fan structure induced by D`on the relative interior 
0of0.
For any collection of chambers CjofD`,j2J, dene the the intersection CJ=T
j2JCj. Further
dene the restriction CJ=CJ\
0. ThenCJis still a convex cone. Note that if CJ=CJ0, then
CJ=CJ0=CJ[J0. Correspondingly, we say Jis maximal for a cone CJif whenever CJ0=CJ,
we haveJ0J. Similarly, note that J0JimpliesCJCJ0. Since cones of the form CJform a
complete fan for MR, their restrictions CJform a complete fan for 
0as well.
(ii) Suppose that 0was not contained in any CJ. Let us nd two points m() in0which are
close to each other but do not belong to a common chamber.92 TRAVIS MANDEL AND FAN QIN
Note that0and the cones CJare closed in MR. By our assumption, the relative interior 
0is
not contained in any CJ. Take any non-empty maximal cone CJin
0with maximal J, and choose a
pointmwith rational coordinates which is in 
0and on the relative boundary of CJ(the assumption
CJ6=
0ensures that such points exist). Take a point with rational coordinates in the relative
interiorC
J. Then for any >0 suciently small, the point m+() :=m+lies in the interior of
CJ, and the point m () =m lies outside CJbut still in 
0.
We claim that m ()=2Cjfor anyj2J, i.e.m () andm+() are not contained in a common
chamberCj. Forp2
0, deneJ(p) =fjjp2Cjg. ThenJ(m+()) =Jbecausem+() is an interior
point of the top dimensional cone CJandJis maximal. Dene J0=J(m ()). If our claim was
false, thenJ\J06=;. Moreover, CJisproperly contained in CJ\J0since the latter contains m ().
This contradicts our assumption that CJis maximal, so our claim holds.
(iii) Take the points m,m(), the chamber CJ, and the vector =Pig(i),i2Qas above.
We will show that some points near m+() must be contained in the same chamber as some points
nearm () and thus obtain a contradiction.
Let  denote an ideal triangulation without self-folded triangles such that  0, and let
1;:::;rbe its internal arcs. Dene the matrix ( cij) = (e(i)j)1is;1jr, where we write
e(i)jto denote the crossing number c(e(i);j). The row vectors of ( cij) are linearly independent
by Lemma 8.24. Consequently, the column rank of ( cij) iss.
LetSbe the set of i= 1;:::;s such thati20. Let us denote
m=X
i2Sbig(i) =X
i2S 
biP
jcij!0
@X
jcij1
Ag(i);
so eachbi2Q>0. Further dene wi2N>0for eachi2Sviawi=
biP
jcij
for alli2Sand for
some xed 2N>0. Then we can rewrite
m=1
X
i2Swi0
@X
jcij1
Ag(i):
Since the column rank of ( cij) equalss, its column vectors span QsoverQ. Recall the numbers
i2Qfrom Step (ii). For the vector (i
wi)1is2Qs, we can nd rational numbersdj
d2Q, where
1jr,dj2Z,d2N>0, such thati
wi=P
jcijdj
dfor anyi.
Then we have, for any D2N>0:
m() =mX
i2Sig(i)
=1
X
i2Swi0
@X
jcij1
Ag(i)
dX
i2S0
@wiX
jcijdj1
Ag(i)
=1
DX
i2Swi0
@X
jcijD1
Ag(i)
dX
i2S0
@wiX
jcijdj1
Ag(i):BRACELETS BASES ARE THETA BASES 93
Now set=d
Dwith a suciently large Dsuch thatis suciently small and D>jdjjfor allj. We
obtain
m() =1
DX
i2Swi0
@X
jcij(Ddj)1
Ag(i)
Dene weighted simple multicurves =S
j(Ddj)j. Theng() are interior points in the
chamberCassociated to  in the scattering diagram D.
Consider the composition of Dehn twists =Q
i20wi
i. For any given K2N>0, dene (K) :=
K() and(K) :=K(). Theng((K)) belong to the chamber C(K)inDassociated to ( K).
In addition, for each i2,e(i) is-invariant, so e(i)(K) =e(i)=P
jcij(Ddj).
By Theorem 3.28, (41), and Remark 3.29, there exists some K02N>0, such that, modulo frozen
coordinates ZF,
g((K+K0))g((K0)) +X
i2SKwi(e(i)(K0))g(i)
=g((K0)) +X
i2SKwi0
@X
jcij(Ddj)1
Ag(i)
=g((K0)) +KDm():
Consequently, we get
m() +1
KDg((K0))21
KDg((K+K0)) +ZFC(K+K0):
Note thatC(K+K0)must be contained in a chamber C0ofD`.
Recall that m+()2C
Jwith maximal J, and for all j2J,m ()=2Cj. By choosing Ksuciently
large, we still have m+() +1
KDg(+(K0))2C
Jand, for all j2J,m () +1
KDg( (K0))=2Cj|
hence,m() +1
KDg((K0)) are not contained in a common chamber in D`. But they are equal to
1
KDg((K+K0)) respectively, which both belong to C(K+K0)C0. This contradiction implies
that the assumption in (ii) is false, i.e., 0must be contained in a chamber of D`.
(iv) Finally, take a top dimension cone CJ=CJ\
0in
0as in step (i). We have shown that
CJ=
0. Our arguments in step (iii) show that for any interior point m+() inCJ, we can construct
a chamber C(K+K0)of the cluster complex containing a point of 
0near tom+(). Recall that
C(K+K0)is contained in a chamber C0ofD`. SoC0contains an interior point of CJ, and we deduce
CJC0. It follows that 0CJC0andC0C0for 0= (K+K0). Since the Dehn twists
act trivially upon  0, we have  00, as desired. 
Lemma 8.26. Under the assumptions of Lemma 8.25, plus the assumption that is maximal, we
have that for any m1;m22\M, the decomposition
#m1#m2=X
m2Mam#m
satisesam= 0wheneverm =2\M.
Proof. Since the elements of are non-intersecting, Dehn twists by any loop in will act trivially on
eachi2, so they will act with nite orbit on each g2by Lemma 8.12. In particular, each such
Dehn twist acts with nite orbit on m1andm2, hence on#m1#m2.94 TRAVIS MANDEL AND FAN QIN
On the other hand, for m2Mn(\M), the maximality of implies that the bracelet mwith
g-vectormhas positive crossing number with some i2, and thisiis a loop by the assumption
thatcontains no interior arcs. So by Lemma 8.14, the action of ion suchmhas innite orbit.
Thus,#mwithm =2\Mcannot appear in the theta function expansion of #m1#m2.
Lemma 8.27. Letandbe given as in Lemma 8.25 with unpunctured. For `0`1, x
genericQin a chamber of D`0which contains the cone as in Lemma 8.25. Then for each i20,
there are precisely two broken lines with ends (g(i);Q)and nal exponents in Mn(p+`M+), and
their nal attached monomials are zg(i)andz g(i). Ifiis a weighted boundary arc, then the only
broken line with ends (g(i);Q)is the straight broken line with nal attached monomial zg(i).
Proof. Foria weighted loop, the fact that #kg(i)=Tk(#g(i)) for eachk2Z1(by Lemmas 8.5
and 8.19) implies that #k
g(i)=Pk
b=0ak;b#bg(i)for someak;b2Z0(cf. [AK17, Lem. 3.18]). So by
Lemma 8.18, #g(i);Qhas the form zg(i)+P
b2Z1cbz bg(i)+:::with eachcbinZ0and with any
remaining terms having exponents in p+`M+coecients in Z0. By the Chebyshev relations, the
constant term in #k
g(i)equals 0 if kis odd and equals k
k=2
ifkis even. It follows that c1= 1 and
ck= 0 fork2, as desired.
Finally, the claim for boundary arcs follows from the fact that boundary arcs correspond to frozen
cluster variables and that all walls are parallel to MF:=Zhe
iji2Fi. 
Proof of Lemma 8.21. We know from Corollary 5.10 that the theta function expansion of the product
on the left-hand side of (121) includes the term on the right-hand side, so our goal is just to show
that there are no contributions from any other theta functions.
We apply Lemma 8.22 to assume that is maximal and includes no interior arcs, and that t= 1.
By Lemma 8.26,
#g(1)#g(s)=X
m2\Mam#m
with eacham2Z0. Take any msuch thatam6= 0. Choose `;`0as in Lemma 8.27 with `large
enough so that m g(1) ::: g(s)=2`M+. Then choose a generic Qin a chamber ofD`0which
containsas in Lemma 8.25. So by Lemma 8.27, if 1;:::;sis a tuple of broken lines with ends
(g(i);Q),i= 1;:::;s respectively, contributing to amas in Proposition 5.9, then the nal exponent
ofiisg(i) ifiis a weighted boundary arc, and it is ig(i) fori=1 ifiis a weighted loop.
By the linear independence of the g-vectors from Lemma 8.23, the sum of these nal exponents can
only lie inif eachiis non-negative. This means that
m=g(1) +:::+g(s);
as desired. 
9.Results for general cluster algebras of surface type
9.1.Bracelets are theta functions: punctured cases. Let  = ( S;M) denote a triangulable
surface, possibly with punctures. By Lemmas 6.7 and 6.8, in order to show that weighted tagged
bracelet elements are theta functions for (quantum) cluster algebras, it suces to work with any
(quantum) cluster algebra of type  with M
sstrongly convex. In view of Lemma 8.3, we can work
with connected  without loss of generality.
Let there be given any weighted simple multicurve L=SwiLi, such that Liare loops. By Lemma
7.5, we can choose internal plain arcs 1;:::;swhich do not intersect Li, such that the surface 0BRACELETS BASES ARE THETA BASES 95
obtained by cutting  along iis unpunctured, and, moreover, f1;:::;sgcan be extended to an ideal
triangulation  without self-folded triangles. Let 0denote the triangulation of 0corresponding to
. We associate to it the principal coecient seed s0=sprin
0.
Following ยง6.3, for 1is, gluing the frozen vertices (1)
i;(2)
icorresponding to i(and also
gluing the corresponding principal coecient indices to 0
iand changing !(i;0
i) to 1), we obtain a
seeds0froms0. Following ยง6.5, let sdenote the seed obtained from s0by unfreezing i. Then sis of
full-rank and is similar to s. In fact, s=sprin
.
We make s0into a quantum seed by choosing the canonical bilinear form  s0as in (7). We similarly
choose a compatible  for sas in (7) (viewing sassprin
), and this induces a compatible pair for s0. As
before, we have a |-linear map s0:|t[s0]!|t[s0] for the gluing and a |t-linear map i:|t[s0]!|t[s]
for the unfreezing.
Recall that Lrepresents a bracelet element hLiin the (quantum) upper cluster algebra Aup
t(s), see
ยง7.4.1 and (115).
Lemma 9.1. The bracelet element hLiis a theta function of Aup
t(s).
Proof. Notice that Lcan be naturally identied with a weighted simple multicurve L0in 0consist-
ing of non-intersecting weighted loops and corresponding to a bracelet element hL0iinAup
t(s0). By
construction, the corresponding bracelet elements satisfy hLi=is0hL0i, cf. (115).
Since 0is an unpunctured surface, Theorem 8.20 and Lemma 6.8 imply that hL0iis a theta function
forAup
t(s0). Thens0hL0iis a theta function for s0, see (105). So by Lemma 6.12, in order to show
thathLi=i(s0hL0i) is a theta function, it suces to show that hLiis theta positive when t= 1.
That is, we wish to show in the classical setting that in the expansion
hLi=X
g2g(L)+Mcg#g; (123)
the coecients cgalways lie in Z0. Note that it suces to check this positivity in the case where L
consists of a single weighted component, so we assume this is the case.
Suppose  is a once-punctured closed surface. Let Hdenote the hyperplane in MRwith the normal
vectorP
i2Iufei. Observe that Muf:=!1(Nuf) is contained in H. In addition, we have g(L)2Muf
by (113). We deduce that all gappearing in (123) are contained in H. Thus, for any such g, we can
take a base point Qwhich is arbitrarily close to gand belongs to a chamber of the (plain arc) cluster
complex (by Proposition 5.23).
We wish to show that the same is true when  is not a once-punctured closed surface. Suppose
cg6= 0. Theng:= prI1(g) is the extended g-vector of a tagged bracelet element g. We claim that no
component of gcan be an interior tagged arc with an end at a puncture; in particular, no component
can be an arc with a notch. It then follows from Lemma 8.25 that we can nd Qarbitrarily close to g
and contained in a chamber C0associated to an ideal triangulation 0without self-folded triangles.
To show our claim, suppose some component of gis an interior tagged arc with at least one end
at a puncture P. IfSnis connected, then there exists a loop Ldisjoint from Lwhich intersects
exactly once. If Snis not connected, then both ends of must lie at the same puncture P. Let
S1;S2be the components of Snwhich contain Land do not contain L, respectively. Since does
not cut out an unpunctured or once-punctured monogon, we can nd another arc 2S2with both
ends atPsuch thatandare not homotopic. By gluing the ends of together and moving this
glued point slightly into S1, we again construct a loop Lin  having essential intersection with 96 TRAVIS MANDEL AND FAN QIN
and no intersections with L. In either case, we have that the orbit of , hence ofg, hence ofg(by
Lemma 8.14) under the action of the Dehn twist Lis innite. Since Lacts trivially onhLi, this
situation cannot happen (the expansion (123) in these cases is nite by Theorem 5.24).
We have thus shown that for any gwithcg6= 0, we can ndQarbitrarily close to gand contained
inC0for some ideal triangulation 0without self-folded triangles. So by Lemma 5.11, to prove the
positivity of cg, it suces to show that hLiis positive in every cluster associated to such a triangulation.
This follows immediately from (110) and the description of I(L) given in (126) (in this setting, Xnin
(126) is identied with zn). 
It now follows from Lemma 6.7 or 6.8 that hLis
Bracis a theta function for arbitrary ssimilar to s,
not just for sprin
.
Lemma 9.2. Letdenote a tagged arc and La simple loop not intersecting . ThenhiBrac and
hLiBrac commute inAup
t(s). Here, if is a once-punctured torus, then we require that is not a
doubly-notched arc so that hiBrac is dened.
Proof. (i) We rst assume that has a plain tag at one of its ending.
Recall from ยง8 that one of the following two cases applies:
(1) (annular type, Figure 8.25) Lis contained in an annulus  Lwith one marked point on each
boundary component.
(2) (non-annular type, Figure 8.26) Lis contained in a marked surface  Lwith one component
and one boundary marked point, such that Lis homotopic to the boundary component.
Sincehas a plain ending, in both cases, we can further choose  Lsuch that it does not contain 
and its boundary arcs are compatible with (in the sense of ยง3.3).
Choose an ideal triangulation 0of L. Extend 0[fgto a tagged triangulation  of . Let
(s;) be a quantum seed with ssimilar to s. Since 0is an ideal triangulation, we can understand
I(L) using (125) and (126).
Now letk2 denote any vertex belonging to the support of the g(L)-pointed element hLiBrac
in the quantum torus algebra As
t. Recall that g(L) = !1((L)) where(L) denotes the intersection
coordinates (43). Since Ldoes not intersect , theecomponent of (L) is 0, hence by (2),
(e
;g(L)) =h(L);e
i= 0:
So now it suces to show that ( e
;!1(ek)) = 0, or using (2) again, that hek;e
i= 0. By
construction (114) and using the description of I(L) coming from (125) and (126)), hLiBrac in the
t= 1 setting is supported on the vertex k2 if and only if Lintersectsk. This carries over to the
quantum setting by Lemma 10.8 and [CKKO20, Thm. 1.1] (quantum universal positivity of It(L)).
SoLnot intersecting implieshek;e
i= 0, as desired.
(ii) It remains to treat a doubly-notched arc (so we now assume that  is not a once-punctured
torus). Let denote the corresponding plain arc. Let  be an ideal triangulation containing ,
and work with an initial seed ssimilar to s. Suppose that  is not a once-punctured closed surface.
Applying the automorphism DT of As
tas in ยงC, it suces to show that DT hiBracand DThLiBrac
commute. By Proposition C.7, DT hiBracandhiBracagree up to frozen components, and by Propo-
sition C.9, DThLiBrac=hLiBrac. We know from (i) that hLiBraccommutes withhiBrac. Also, it
follows from (2) that hLiBracalways commutes with frozen variables because all exponents in Laurent
expansions ofhLiBraclie in!1(Nuf). The desired commutativity follows.BRACELETS BASES ARE THETA BASES 97
Now suppose that  is a once-punctured closed surface. Applying DT 1, it suces to show that
DT 1hiBrac and DT 1hLiBrac commute. Proposition C.7 implies that DT 1hiBrac andhiBrac
agree up to frozen components. Moreover, Lemma C.11 says that DT 1hLiBracis bi-pointed at g(L)
and g(L), i.e., has the form of the right-hand side of (168). Hence, all exponents appearing in the
Laurent expansion of DT 1hLiBraclie in!1(NL) whereNLdenotes the Z-span of
feijian arc in  intersecting Lg:
SinceLdoes not intersect , it follows from (2) again that DT 1hLiBraccommutes withhiBracand
with all frozen variables. The desired commutativity follows.

LetL[Cbe a weighted tagged simple multicurve in a triangulable surface  with L=S
jwjLj
consisting of weighted loops and C=F
iwiCiconsisting of weighted tagged arcs.
Lemma 9.3. If no component of is a once-punctured closed surface or if Cdoes not contain a
doubly-notched arc, then the (quantum) bracelet element hLtCiBrac is a theta function in Aup
t(s).
Proof. By Lemma 8.3, it suces to treat connected . It also suces to work in the quantum setting.
SohCiBracis a quantum cluster monomial, and hLiBracis a quantum theta function by Lemma 9.1.
By the construction in ยง7.4.3,hLtCiBrac=hLiBrachCiBrac. The two factors here commute by Lemma
9.2, so Proposition 6.14 implies that hLtCiis a theta function. 
Once-punctured closed surfaces will be treated in ยงB.3 by working with their covering spaces (The-
orem B.4, Lemma B.6).
Theorem 9.4. LetL[Cbe a weighted tagged simple multicurve in a triangulable surface with
L=S
jwjLjconsisting of weighted loops and C=F
iwiCiconsisting of weighted tagged arcs. If
no component of Cis a notched arc in a once-punctured closed torus, then the (quantum) bracelet
elementhLtCiBrac is a theta function in Aup
t(s).
Otherwise, let wt(g(C))be the sum of the weights of all notched arcs in once-punctured closed torus
components of . Then in the coecient-free classical setting, we have
hL[CiBrac= 4wt(g(C))#g(LtC):
Proof. By Lemma 8.3, it suces to treat connected . We have seen that hLtCiis a theta function
under the assumption of Lemma 9.3.
Now suppose that  is a once-punctured closed surface and Cincludes (doubly) notched arcs. In
the classical t= 1 setting, the desired results (including the torus case) are Lemma B.6.
Finally, consider the quantum setting for  a once-punctured closed surface of genus 2 andC
consisting of notched arcs. Then hLiBracis a quantum theta function by Lemma 9.1, and hCiBracis
also a quantum theta function (see ยง7.4.2). So, as their product, hL[CiBracis theta positive. Finally,
by Lemma 5.35, hL[CiBracis a quantum theta function because it is bar-invariant by Lemma 9.2
and its classical limit is a theta function by the previous paragraph. 
9.2.Skein algebras and their atomic bases. By Theorem 8.20 combined with Theorem 5.24 and
Propositions 3.7, 5.23 and 5.26, we have the following result:
Theorem 9.5. When is unpunctured, its quantum localized skein algebra Skt() coincides with
the corresponding quantum upper cluster algebra Aup
t(s). Moreover, the quantum bracelets Bract()98 TRAVIS MANDEL AND FAN QIN
coincide with the quantum theta functions, and they form the atomic basis for Skt()with respect to
the cluster atlas.
Theorem 9.6. Letdenote a connected marked surface, possibly with punctures. Let Sk() (resp.
Sk2()) denote the (resp. tagged) classical localized skein algebra. Suppose is not a once-punctured
torus. Then the following claims are true:
(i):Amid(s)!Aup(s)is injective,Amid(s) =Acan(s), and Sk2() =(Amid(s)).
(ii) The tagged bracelets form the atomic basis for Sk2()with respect to the scattering atlas, or
equivalently, with respect to the tagged triangulation atlas.
(iii) The bracelets form the atomic basis for Sk() with respect to the ideal triangulations atlas.
Now suppose is a once-punctured torus. Then the above claims still hold if, for this case, we construct
the theta functions, AmidandAcan,, and the scattering atlas using a certain scattering diagram
D0in place of Dsprin
(recall that frozen variables are set to 1after computing the theta functions).
This D0has the form Dsprin
tf(H;fH)gforHthe hyperplane orthogonal to n0:=P
i2Iufeiand
fH2gk
m0,m0:= (0;n0), satisfying Ad hn0;mi
fH(zm) =zm(PH)jhn0;mijwherePHis a polynomial in
1 +zm0Z0[zm0]whose coecients add up to 4.
Proof. (i) By Theorem 5.24, Amid(s) =Acan(s), andis injective. Recall from ยง3.3 that Sk2() is
the subalgebra of Aup(s) generated by the tagged bracelets. By Theorem 9.4, the tagged bracelets
coincide with the theta functions, so Sk2() is in fact equal to (Amid(s)).
(ii) The claim follows from (i), Theorem 9.4, and Corollary 5.27 (the atomicity of theta functions).
(iii) Now that we know the bracelets are theta functions, this follows from Lemma 5.30.
Finally, suppose that  is a once-punctured torus. Take the scattering diagram D0from the
statement of the theorem to be Dsprin
eas in ยงB.2. We see from Lemma B.3, (155), and Theorem B.4
that this D0indeed has the desired from. Furthermore, using this D0and Lemma B.6, the arguments
from the cases where  was not a once-punctured torus now apply in this setting as well. 
Let there be given an initial seed sand somei2F. As in [Qin23], we say a Laurent polynomial
Z=Pcmzm2|[M] isregular on Ai= 0 ifhei;mi0 whenever cm6= 0. By the mutation rule,
this property for Z2Aupis independent of the choice of the initial seed s(see [Qin23, ยงA], or using
the viewpoint of valuations and tropicalization [CMMM]). Recall the sets Bract() and Brac2() of
ยง4.2 and ยง4.3, respectively.
Corollary 9.7. Letdenote a connected marked surface, possibly with punctures. Then the following
claims are true (with the same caveats for the once-punctured torus case as in Theorem 9.6).
(i)Brac2()coincides withf#mj#mis regular on Ai= 0fori2Fg.
(ii) The set Brac2()is the atomic basis for Sk2()with respect to the scattering atlas, or equiv-
alently, with respect to the tagged triangulation atlas.
(iii) The set Brac() is the atomic basis for Sk() with respect to the ideal triangulations atlas.
Proof. (i) If  has empty boundary, then this reduces to the claim that Brac2() coincides with the
set of theta functions (Theorem 9.6). So now assume that  has non-empty boundary.
Take any weighted tagged simple multicurve CtL, such thatCdenotes a union of weighted tagged
arcs andLa union of weighted simple loops. Since  has non-empty boundary, hCimust be a cluster
monomial in some tagged triangulation 0. Then the Laurent expansion of hCiins0is regular on
the frozenAi= 0 if and only if the multiplicity of the boundary arc AiinCis non-negative.BRACELETS BASES ARE THETA BASES 99
Choose  any ideal triangulation. Then the Laurent expansion of hLiinsis regular on Ai= 0
fori2Fby Corollary 3.6. Moreover, since g(L) has vanishing frozen coordinates by (44), and since
the coecient of zg(L)in#g(L);Qis nonzero for all Q, the Laurent expansion of hLiins0(or any
cluster) is not divisible by Aifor anyi2F.
Therefore,hCtLi=hCihLiis regular on Ai= 0 for frozen iif and only if Cis regular, or
equivalently, ifhCi2Sk2(). This is equivalent to hCtLi2Brac(), as desired.
(ii) We know that Brac2() forms a basis for Sk2() by Theorem 9.6, so the elements of Brac2()
are linearly independent. The fact that Brac2() spans Sk2() is Lemma 4.9.
Now take any element Z2Sk2() which is universally positive with respect to the scattering atlas
(equivalence between this and the tagged triangulation atlas is part of Corollary 5.27). Then Theorem
9.6(ii) implies we can write Zas a linear combination
Z=X
aihCiiforhCii2Brac2() andai2Z0. (124)
Since elements of Brac2() are linearly independent and Brac() spans Sk2(), thehCiiappearing
in (124) must in fact all be in Brac2(). So Brac2() is indeed an atomic basis with respect to the
scattering atlas.
(iii) The proof is similar to (ii), but using Lemma 4.7 in place of Lemma 4.9.

Corollary 9.8. Forunpunctured, Skt() =Aup
t(s). Moreover, Bract()coincides with the set
of theta functions which are regular on Ai= 0for alli2F.
Proof. This follows from Theorem 9.5 and Corollary 9.7(i) (positivity ensures that #mis regular on
Ai= 0 if and only if its t= 1 limit is). 
9.2.1. The tagged skein algebra from generators and relations. The following alternative construction
ofSk2() was suggested to us by Greg Muller. Recall that a generalized tagged multicurve is the
same as a multicurve, except that the arcs are allowed to be generalized tagged arcs. Let |2() be
the free |-module generated by homotopy equivalence classes of generalized tagged multicurves. Let
R2|2() be module of relations generated by the following (applied locally):
Contractible arcs are equivalent to 0;
Contractible loops are equivalent to  2;
Peripheral loops are equivalent to +2;
Theq= 1 case of the skein relation from Figure 3.2;
The local digon relation of Figure 3.13.
Corollary 9.9. The tagged skein algebra Sk2()from ยง3.3 can be equivalently dened as the |-algebra
|2()=R2, equipped withtas the product.
Proof. We saw in ยง3.3 that Sk2() is generated by the same elements of |2() and satises all the
relations coming from R2. We thus have a map |2()=R2!Sk2(). It remains to check that this
map has trivial kernel (i.e., we want to ensure that Sk() does not include any additional relations).
The proof of Lemma 4.9 applies to show that the bracelets span |2()=R2. So if there were a
nontrivial element in the kernel, this would correspond to a nontrivial linear combination of bracelets
inSk2() which equals 0, contradicting the claim in Corollary 9.7 that the bracelets form a basis for
Sk2(). 100 TRAVIS MANDEL AND FAN QIN
9.2.2. Thurston's Conjecture. The construction of the quantum bracelets basis in ยง4.2 applies for all
unpunctured surfaces , including those which are not triangulable. D. Thurston conjectured that
these quantum bracelets bases should be strongly positive for all (not necessarily triangulable) un-
punctured marked surfaces  [Thu14, Conj. 4.20]. We prove this for cases with non-empty boundary.
Theorem 9.10. Letbe an unpunctured marked surface, every component of which has non-empty
boundary. The quantum bracelets basis for Skt()is strongly positive.
Proof. By inserting extra marked points on the boundary components, we can form a triangulable
unpunctured marked surface 0. Note that there is a natural inclusion Skt(),!Skt(0) which takes
quantum bracelets to quantum bracelets. The quantum bracelets basis for Skt(0) coincides with the
quantum theta basis by Theorem 9.5 and Corollary 9.8, hence is strongly positive by Proposition 5.26.
Strong positivity of the quantum bracelets basis for Skt() now follows. 
10.Canonical functions on cluster Poisson varieties from surfaces
Notation 10.1.When considering the cluster Poisson algebra Xupassociated to a surface , we shall
writeXup
uffor upper cluster algebra obtained by forgetting the frozen variables. Note that Xup
ufis a
subalgebra ofXupviaNuf,!N, and this inclusion identies the theta functions in Xup
ufwith theta
functions inXup. Recall the map :AL(S;Q) !NQas in (40). Denote
A(Zt) :=AL(;Z)\ 1(N) andA0
(Zt) :=AL(;Z)\ 1(Nuf):
The skein algebras Sk() considered in ยง3 can be interpreted in terms of rational functions on
the moduli spaces of decorated, twisted, SL 2-local systems on . This perspective was developed
in [FG06], with the connection to skein relations appearing in [FG06, proof of Thm. 12.2] (also cf.
[MW13, Prop. 4.12] which extends this connection to the principal coecients setting). We shall
review this interpretation in ยง10.2.
On the other hand, [FG06, FG07] also gives a moduli-theoretic interpretation for the cluster X-
varietyXup
ufassociated to a marked surface  and uses this to construct canonical functions on Xup
uf,
parametrized byA0
(Zt)=Nufand dened in terms of traces and eigenvalues of certain monodromies.
This moduli-theoretic interpretation is extended to the quantum setup in [AK17] using the quantum
Teichm uller spaces of [CF99]. Allegretti and Kim [AK17] then consider quantizations of the canonical
functions of Fock-Goncharov, dened using the quantum trace maps of [BW11]. We shall briey
review the classical version of these constructions in ยง10.1. We review the quantization in ยง10.3
and then review some useful properties for this quantum analog in ยง10.4. The main result of this
section|Theorem 10.11, which says that the (quantum) canonical functions of [FG06, AK17] are the
(quantum) theta functions|will be proved in ยง10.5.
We shall work with the full Xuprather than justXup
uf, and so we consider bases parametrized by
N=A(Zt), extending those parameterized by A0
(Zt). See Remark 10.3 for a short summary of
how [GS19] uses \pinnings" to incorporate the frozen variables into the moduli theoretic viewpoint.
10.1. Moduli of framed PGL 2-local systems. LetM@:=@S\M; i.e., M@is the set of marked
points which are not punctures. Let ^Sdenote the surface with boundary obtained from  by viewing
punctures in Sas unmarked boundary circles. Let @0^Sdenote the punctured boundary of^S, i.e.,
@0^S:=@^SnM@:BRACELETS BASES ARE THETA BASES 101
Denition 10.2 ([FG06], Def. 1.2) .Aframed PGL 2-local system on a marked surface  = ( S;M)
is the data of a pair ( L;), whereLis a PGL 2-local system on S(i.e., a principal PGL 2-bundle with a
at connection), and is a at section of the induced (PGL 2=B)-local system (L=B)j@0^S. Here,Bis a
maximal Borel subgroup of PGL 2(e.g., the projection of the subgroup of upper triangular matrices),
so PGL 2=B=P1. The spaceXis the moduli space of framed PGL 2-local systems on .
An equivalent denition of Xcan be given as follows. Choose a hyperbolic structure with geodesic
boundary on S. LetF1() denote the preimage of the punctured boundary @0^Sin the universal cover.
Note that there is a natural action of 1(S) onF1().
Consider the data of a pair ( ; ), where:1(S)!PGL 2is a group homomorphism and
 :F1()!P1is a (1(S);)-equivariant map. That is,
 (c) =() (c)
for each21(S) andc2F1(S). By [FG06, Lem. 1.1] (also cf. [AK17, Def. 2.7]), a framed
PGL 2-local system on  is equivalent to the data of a pair ( ; ) as above, modulo the action of PGL 2
(via conjugation on and the tautological action on P1). SoXcan be interpreted as the moduli
space of these pairs ( ; ) up to this PGL 2-action.
Consider the upper cluster algebra Xup
ufassociated to sfor  an ideal triangulation of . Fock and
Goncharov [FG06, ยง9] have shown that Xup
ufnaturally contains and is birational to37the coordinate
ring  (X;OX) ofX.
In particular, each interior arc iin  determines a rational coordinate function XionX.38Briey,
the coordinate Xifor an interior arc iis geometrically characterized as follows: For Qthe quadrilateral
in  containing ias a diagonal, let Q0be the quadrilateral obtained by rotating the vertices of Q
along@Sby a small amount in the direction of the orientation (i.e., replacing the arcs with associated
elementary laminates as in Denition 3.25). The ags associated to the vertices of Q0can all be
parallel transported in Q0to the ber (L=B)jpat a vertex pof the elementary laminate e(i) and
identied in cyclic counterclockwise order with the points 1; 1;0;Xi2P1; cf. [FG06, ยง1.4; ยง9.4].
Following [AB20, Def. 9.2(ii)], we identify zejwithXjifjis not an interior arc of a self-folded
triangle; otherwise, we identify zejwithXjXkwherekis the noose containing j. The skew-symmetric
form"in [FG06, ยง12] is our!=BT. The map pof loc. cit. (which we review in ยง10.2) is our !1.
Remark 10.3 (Pinnings and frozen variables) .Following [GS19], one may incorporate frozen variables
by introducing the additional data of a pinning. A pinning of a framed PGL 2-local system (L;)2X
is a choice of lift 2(L=U)j@SnM@ofj@SnM@, whereUis the maximal unipotent subgroup of B
[GS19, Def. 2.3, Lem.-Def. 3.7]. One considers the moduli space Pof framed PGL 2-local systems
with pinning. By [GS19, Ex. 2, bottom of page 34], PGL 2=Uparametrizes pairs ( v;!) forv2A2nf0g
and!22(A2)nf0g(i.e.,!is a symplectic form on A2), modulo the Gm-action (v;!)7!(tv;t 2!).
Now consider a triangle in the ideal triangulation  with edges labeled 1 ;2;3 in counterclockwise
order, with the edge E3being a boundary edge. Let Li,i= 1;2;3, be the elements of PGL 2=B
associated to the three edges, viewed as lines in A2. LetA3= (v3;!) be the lift of L3to PGL 2=U
37Rather, [FG06, ยง9] shows that clusters associated to ideal triangulations form charts on X. The extension to
clusters associated to tagged triangulations follows via the ( Z=2Z)n-action described in [FG06, ยง12.6].
38TheXjhere are dierent from our X-variableszejin (16) when there exist self-folded triangles. We keep the
symbolXjas in most literature.102 TRAVIS MANDEL AND FAN QIN
given by the pinning. By loc. cit. and [GS19, Eq. 343], the associated frozen variable XE3is given by
XE3=!(l1;l2)
!(v;l1)!(v;l2)
forl1;l2arbitrary nonzero points in L1;L2, respectively. By [GS19, Thm. 8.11], these coordinates,
along with those associated to interior arcs as above, yield a cluster Poisson structure XsonP.
Given an integer bounded lamination `2A (Zt), one associates the following canonical function
I(`)2Xup:
(1) If`is a peripheral loop of weight wwith underlying unweighted loop `clockwise-oriented
around a puncture p, thenI(`) :=w
p, wherepis the eigenvalue of the monodromy (`)2
PGL 2whose associated eigenspace is the monodromy-invariant ag associated to the point
pby the framing data. Note: `2A (Zt) implies that wis even, so the sign ambiguity in
identifying pis irrelevant after raising to the w-th power.
Equivalently (e.g., using (125)), when expressed in the cluster associated to a xed choice
of ideal triangulation  without self-folded triangles, one has
(`) =X (`)
forthe map as in (40) associated to .
(2) If`is a non-peripheral loop of weight wand underlying unweighted loop `, then I(`) :=
Tr((`)w). As before, there is a sign-ambiguity when dening (`), but this is resolved when
applying the trace of the w-th power.
(3) If`=w`2A (Zt) for`a bounded arc-laminate, let be the ideal arc obtained by translating
the ends of `counterclockwise along @Suntil they are at points of M, so`=e(). Let  be
a tagged triangulation containing ; note then that eb(`)2we
+MFC+
s. In view of
Lemma 3.27, dene I(`) :=z (`)in the cluster associated to .
(4) If`=P
iwi`iwhere`iare the curves of `, with each homotopy class of curves appearing at
most once in the sum and wi2Z, then
I(`) :=Y
iI(wi`i):
Restricting to I:A0
(Zt)! (X;OX)Xup
ufrecovers the canonical functions of [FG07].
Given a xed choice of ideal triangulation , the monodromies (`) considered above admit the
following description in terms of the variables Xi, cf. [AK17, ยง2.2] or [FG06, Eq. 12.19]. For each
i, x a square-root X1=2
i(the choice of square-root will not matter thanks to the denition of and
the requirement that (`)2N). Let`be a component of a lamination of weight wwith underlying
unweighted curve `. Assume by possibly deforming `that it intersects each arc of  in the minimal
possible number of points (after truncating the parts spiraling around punctures). Let i1;:::;isdenote
the arcs of  which `crosses, in order, possibly with repetition. After crossing an arc ik,`enters a
triangleTof  and then turns either left or right before exiting the triangle through the next arc
ik+1(cyclically ordered). If this turn is to the left, let
Mk= 
X1=2
ikX1=2
ik
0X 1=2
ik!
=X 1=2
ik 
XikXik
0 1!
;BRACELETS BASES ARE THETA BASES 103
and if it is to the right, then let
Mk= 
X1=2
ik0
X 1=2
ikX 1=2
ik!
=X 1=2
ik 
Xik0
1 1!
:
Then
(`) =M`:=M1Ms: (125)
A straightforward induction argument reveals that for any product of matrices of the form 
XikXik
0 1!
and 
Xik0
1 1!
, the bottom-right entry will be of the form 1 +P
n2N+anXnfor some coecients
an2Z0, while the top-left entry will be of the formP
n2N+bnXnforbn2Z0. Thus, for `a
non-peripheral loop, the above description implies that
I(`) = Tr((`)w) =X (`) 
1 +X
n2N+cnXn!
(126)
for some coecients cn2Z0.
Assume there exist no self-folded triangles. It is now clear from our denitions that I(`) is ( (`))-
pointed for all `2A (Zt).
10.2. Moduli of twisted decorated SL2-local systems. We now briey review the denition of
twisted decorated SL 2-local systems on  as in [FG06, Def. 2.4] (also cf. [GS15, Def. 10.1]).
Consider a marked surface  = ( S;M). LetT0Sdenote the punctured tangent space to S, i.e.,
the complement of the 0-section in TS. For any chosen base point x2S,1(T0
xS;Z)=Z. LetO
denote a curve representing a chosen generator for 1(T0
xS;Z). A twisted SL 2-local systemLonSis
an SL 2-local system on T0Swhose monodromy around Ois Id.
Given such anL, the associated decorated ag bundle is LA:=L=UwhereUis a maximal
unipotent subgroup of SL 2(e.g., upper triangle matrices with 1's on the diagonal | one assumes that
Uis chosen to be the unipotent radical of the maximal Borel subgroup Bconsidered in Denition
10.2).
For each component Cof@0^S, let:C!T0Cdenote the canonical-up-to-isotopy section of T0SjC
given by tangent vectors to Cdirected according to the orientation induced on Cby the orientation
ofS.
Denition 10.4 ([FG09], Def. 2.4) .A twisted decorated SL 2-local system on  is a pair ( L;), where
Lis a twisted SL 2-local system on S, andis a at section of LAj(C)for each component Cof@0^S.
The moduli space of twisted decorated SL 2-local systems on  is denoted by A.
As shown in [FG06, ยง10] (and reviewed in [FG07]), Aadmits a cluster structure | more precisely,
the upper cluster algebra associated to  in ยง3.2 can be identied with the ring of global regular
functions on (at least a dense subset of) A.
Recall the setXL(;Z) of integral unbounded laminations as in Denition 3.21. As reviewed in ยง3.4
(cf. Figure 3.15), one associates an elementary laminate e() to each tagged arc , and in this way
one naturally constructs bijection between XL(;Z) and the set of tagged bracelets on  which do
not include boundary arcs. In [FG06, Def. 12.4], Fock and Goncharov dene canonical coordinates on
Aassociated to the X-laminationsXL(;Z)|as alluded to in Remark 3.12, laminates which spiral104 TRAVIS MANDEL AND FAN QIN
counterclockwise into punctures (i.e., associated to arcs with notched ends) are understood using the
(Z=2Z)k-action of [FG06, ยง12.6]. These canonical coordinates on Aare precisely the bracelets basis
elements (without boundary coecients), cf. [MW13, Prop. 4.12]|indeed, the relationship to the
skein relations was already observed in [FG06, Proof of Thm. 12.2].
In particular, if `=P
iwi`iis a weighted multicurve consisting of pairwise compatible and non-
isotopic loops `iwith weight wi, then the associated bracelets basis element can equivalently be
interpreted as the function on Agiven by
I_(`) =Y
iTr(Monowi
`i) (127)
where Mono `idenotes the monodromy of the twisted SL 2-local system around `i(or rather, the lift
of`itoT0C).
We extend I_fromXL(;Z) toeXL(;Z) as in (3.21) as follows. Let `=`0+`1for`02XL(;Z)
and`1=Pwie(i) for boundary arcs i. Then
I_(`) =I_(`0)Y
izwie
i:
Note that these factors zwie
iare just the associated boundary coecients. I.e., we extend I_so that
the elements I_(`) for`2eXL(;Z) are precisely the tagged bracelets bases with frozen variables for
boundary arcs.
Letp:A!X denote the canonical projection induced by SL 2!PGL 2. By [FG06, Prop. 9.1],
the induced map on functions p:  (X;OX)! (A;OA) can be identied with the map induced
by!1acting on exponents. One nds the following:
Lemma 10.5. Let=P
iwiibe a weighted simple multicurve consisting of pairwise compatible and
non-isotopic loops and tagged arcs iwith weights wi. Assume that none of the arcs in have any
ends at a puncture (specifying that the arcs are tagged just serves to exclude nooses). Associate to 
the integral bounded lamination `:=P
iwie(i)fore(i)the elementary laminate as in ยง3.4. Suppose
`2A (Zt), soI(`)is dened. Then
I_()zf=p(I(`)) (128)
wherezf2|[M]is some monomial with f2MF=Zhe
iji2Fi. Ifcontains no arcs, then f= 0.
We note that this is essentially [FG06, Thm. 12.2(4)] with frozen variables.
Proof. Fora combination of weighted loops, the claims are immediate from the denitions in terms
of traces of monodromies.
Forconsisting entirely of arcs, work in a cluster associated to an ideal triangulation  which
contains all the arcs of and no self-folded triangles. Then we have p(I(`)) =z!1( (`)), which by
(43) is equal to z eb(`). By Proposition 3.26, if consists only of interior arcs, then this agrees with
zgs()up to a frozen factor, and zgs()is precisely the corresponding bracelet element, i.e., I_(`),
as desired.
Now consider some iwhich is a boundary arc. Then both gs
(i) andb(e(i)) are seen to be
contained in MF, so the claim extends to cases with boundary arcs.
One extends to general by observing that adding weighted simple multicurves with pairwise-
compatible non-isotopic components corresponds to multiplication of the associated elements on either
side of (128). BRACELETS BASES ARE THETA BASES 105
10.3. Quantization: The Chekhov-Fock Algebra. The quantum upper cluster algebra Xup
qas-
sociated to  can be interpreted via the following construction of Chekhov-Fock [CF99]. Let  be an
ideal triangulation of . Let Tibe a triangle of . Then the triangle algebra Tt
Tiassociated to Tiis
the quantum torus algebra
Tt
Ti=|!Ti
t[NTi] :=|t[znjn2NTi]=hzn1zn2:=t!Ti(n1;n2)zn1+n2i
whereNTi:=Zhei1;ei2;ei3iand!(eij;ei(j+1)) := 1 forei1;ei2;ei3denoting the sides of Tiin
clockwise order.
Now dene the tensor product algebra
T:=O
TiTt
Ti:
We omit the factors 1 when describing the elements of T. Ife2 separates two triangles TiandTj,
and ifzeia=:Xia2TTiandzejb=:Xjb2TTjare the associated elements of TTiT andTTjT,
then dene
Xe:=Xia
Xjb2T:
Ifeis the arc in the center of a self-folded triangle Ti, corresponding to the vectors ei1;ei22NTi, then
Xe:=zei1+ei22TTiT:
Fore2Tia boundary arc of  with associated element zeia2Ti, we takeXe:=zeia2TiT.
Denition 10.6.TheChekhov-Fock algebra X
tis the subalgebra of Tgenerated by the elements
Xeand their inverses.
Equivalently,X
tis the quantum torus algebra Xs
tfor the seed sassociated to .
Given dierent ideal triangulations  1;2, [CF99] shows that the fraction elds X1
tand X2
tare
related by a certain isomorphism
t
12:X2
t !X1
t;
see [Liu09, Proposition 5] for a precise denition. These isomorphisms agree with the corresponding
quantum mutation maps X
~ |considered in (21) (for ~ |corresponding to a sequence of ips relating the
two triangulations).
Remark 10.7.We recall that some clusters of Xup
tmight be related only to tagged triangulations, not
ideal triangulations. D. Allegretti has suggested to us that, by interpreting tagged triangulations as
equivalence classes of signed triangulations (as dened in [BS15, ยง8]), one could associate q-deformed
canonical functions to laminations and signed (hence tagged) triangulations via essentially the same
procedure used in [AK17] for the ideal triangulations.
10.4. Quantum canonical coordinates. In [BW11, Thm. 11], Bonahon and Wong dened a \quan-
tum trace map" Trq
as a certain homomorphism from a skein algebra on  to Xt1=4
(also cf. [L ^19]
for a construction of the quantum trace map based on Muller's quantum skein algebra [Mul16b]).
Using this, [AK17, Denitions 3.1, 3.4, 3.8, and 3.11] denes quantum analogs of the Fock-Goncharov
canonical coordinates as follows:39
(1) If`is a peripheral loop, then It(`) :=z (`)foras in (40).
39[AK17] restricts to surfaces without boundary, so arc-laminates as in (3) here do not actually appear.106 TRAVIS MANDEL AND FAN QIN
(2) If`is a non-peripheral loop of weight wand underlying unweighted loop `, then It(`) :=
Tw(Trq
(`)), whereTwdenote the w-th Chebyshev polynomial of the rst kind as in (48).
Here, Trq
(`) is interpreted as applying Trq
to a certain framed link projecting to `(one with
constant elevation and vertical framing); cf. [AK17, Def. 3.4].
(3) If`=w`2A (Zt) for`a bounded arc-laminate, let be the ideal arc obtained by translating
the ends of `along@Sagainst the orientation until they are at points of M, so`=e(). Let 0
be an ideal triangulation containing . Dene It(`) to be the element given by the monomial
z (`)in the cluster associated to 0. I.e.,It(`) = t
0(z (`)).
(4) Let`=P
j2Jwj`j2A (Zt) with each laminate `jappearing at most once in the sum. Let
f`jjj2J0Jgbe the arc-laminates contributing to `, and let 0be an ideal triangulation
such that, for each j2J0, there is some j20with`j=e(j). Then
It(`) := t
0(zP
j2J0 (wj`j))Y
j2JnJ0It(wj`j): (129)
We note that the factors in the product over JnJ0commute by [AK17, Lem 3.10]. We will see in
the proof of Lemma 10.10 that these factors also commute with the factor t
0(zP
j2J0 (wj`j)).
Lemmas 10.8, 10.9, and 10.10 review the properties of Itwhich shall be useful to us.
Lemma 10.8. For all`2A (Zt),I1(`) =I(`).
Proof. This is clear for arcs and peripheral loops. The case of non-peripheral loops is part of [AK17,
Prop. 3.12]. The extension to disjoint unions / products is straightforward. 
Let  be a (not necessarily connected) marked surface with triangulation . Suppose we cut 
along some interior arcs of  to form a new surface 0with triangulation 0as in ยง7.5. It is clear
that this induces a projection glue:T0!T | ife1;e220glue together to form an edge e, then
the projection maps Xe17!XeandXe27!Xe. Note that glueis the identity on Laurent polynomials
in theX-variables which do not correspond to any of the edges being glued.
Lemma 10.9. Consider 0;0obtained from ;via cutting as above. Let `be a lamination in
A(Zt)which is disjoint from the arcs being cut, so `can also be viewed as an element `02A 0(Zt).
Then
glue(It(`0)) =It(`):
Proof. For non-peripheral loops, this is an easy consequence of the State Sum Property of the quantum
trace map [BW11, Thm. 11(1)]. The claim for weighted peripheral loops, weighted arcs, and disjoint
unions of non-isotopic laminations is then immediate from the denitions. 
Lemma 10.10. Ifhas no punctures and `2A (Zt),It(`)is bar-invariant and universally positive
with respect to the scattering atlas.
Proof. Suppose that `consists only of weighted loops. In unpunctured cases, all clusters correspond
to ideal triangulations. Let  be an arbitrary such ideal triangulation. Let 0be another surface,
with triangulation 0, which can be glued to  along boundary edges to produce a new surface e with
triangulation e such thate has no boundary components (except for punctures). Then It(`)2Xe
t
is positive (i.e., has coecients in Z0[t1]) by [CKKO20, Thm. 1.1]. So by Lemma 10.9, It(`) is
positive as an element of X
tXt0
t . Since  here is arbitrary, universal positivity with respectBRACELETS BASES ARE THETA BASES 107
to the cluster atlas follows. Universal positivity with respect to the scattering atlas then follows from
Proposition 5.28. Bar-invariance follows via a similar argument using [AK17, Thm. 1.2(4)].
One the other hand, combinations of weighted arcs are dened to be cluster monomials, hence theta
functions, so these are always bar-invariant and universally positive with respect to the scattering atlas.
By (129), we now see that It(`) for arbitrary `2A (Zt) is a product of theta positive elements, hence
the general It(`) is theta positive.
To see the bar-invariance, it remains to check that the factors It(wj`j) in (129) for `ja loop
commute with the monomial zP
j2J0 (wj`j)(this can be checked in any cluster, so we may assume
 = 0). By the theta positivity and Lemma 10.8, the exponents appearing in the Laurent expansion
ofIt(wj`j) are the same as those appearing I1(wj`j). The desired commutativity can now be deduced
from the description of (`j) in (125). 
10.5. The canonical functions are theta bases. Our goal is to prove the following:
Theorem 10.11. The elements It(`)for`2A (Zt)are precisely the quantum theta function f#njn2
NginXup
t. More precisely, It(`) =# (`)for each`.
Lemma 10.12. Theorem 10.11 holds for t= 1when is an unpunctured surface.
Proof. Note that for unpunctured surfaces, eXL(;Z) is the same as AL(;Z), see Denition 3.21.
Givenn2N, let`:= 1(n)2 A (Zt) be the corresponding integer bounded lamination. By
Lemma 10.5 and the fact that the elements I_(`) are bracelets, hence theta functions, we have that
p(I(`)) =zf#mfor somem2M,f2MF. So by Lemma 6.7 (multiplying a theta function by zf
forf2MFyields another theta function), p(I(`)) is a theta function. By Proposition 5.25, !1takes
X-type theta functions to A-type theta functions, hence p(which equals !1) takesX-type theta
functions for stoA-type theta functions for s. Since the Injectivity Assumption is satised for
unpunctured surfaces, we know that !1j (`)+Nufis injective. So since all exponents of # (`)and
I(`) lie in (`) +N(because they are (  (`))-pointed) and both map under !1to#!1( (`)), we
must have# (`)=I(`), as desired. 
Lemma 10.13. Theorem 10.11 holds when has no punctures.
Proof. By Lemma 10.10, the elements It(`) are bar-invariant and theta positive, and by Lemmas
10.8 and 10.12, they yield theta functions in the classical limit. The claim now follows from Lemma
5.35. 
Proof of Theorem 10.11. By Lemma 7.5, given an integer bounded lamination `without peripheral
loops, we can nd an ideal triangulation  of  without self-folded triangles and then cut  along
arcs of  which do not intersect `to obtain an unpunctured surface 0with induced triangulation
0. Then`corresponds to a quantum theta function in X0
tby Lemma 10.13. Notice that `does
not cross any arcs being cut/glued, so by Lemma 10.9, It(`) has the same Laurent expansion whether
viewed as an element of X
torX0
t.
Choose initial quantum seeds associated to  and 0as in ยง9.1. Similarly, the Laurent expansions
of the corresponding theta functions # (`)do not change under the gluing|otherwise their p-
projections p(# (`)) =zf`#g(`)(f`2MFis given in Lemma 10.5) in Aup
twould have dierent
F-polynomials after gluing, and we know this is not the case since these theta functions are bracelets
by Theorem 9.4. Thus, `corresponds to a theta function in Xt(s)X
t, as desired.108 TRAVIS MANDEL AND FAN QIN
To extend to cases with peripheral loops, note that for such a loop `j,(`j)2ker(!1) by [AK17, Lem
3.9]. Thus, z (`j)commutes with all wall-crossings, and all walls are closed under addition by R(`j).
It follows that for `ja peripheral loop and any n2N, we have# w(`j)#n=z w(`j)#n=#n w(`j).
The claim now follows from the denition It(`) :=z (`)and from (129). 
Appendix A.Folding of cluster structures
In this section we consider the operation of \folding" for cluster algebras, as previously considered
in [FST12, HL18], but now understood from the perspective of scattering diagrams. A relationship
between folding and scattering diagrams was previously examined in [Zho20]; our goal is to show that
a slightly weaker version of [Zho20, Thm. 2.20] applies to our more general version of folding. This
will be applied in ยงB to relate the scattering diagram for a surface  to the scattering diagram for a
covering space e.
A.1.Skew-symmetrizable cluster algebras. So far we have focused on skew-symmetric seeds
because these are sucient for understanding cluster algebras from surfaces. However, the results of
this appendix naturally apply to the more general skew-symmetrizable setup, and since these results
may be of independent interest, we choose to work with skew-symmetrizable seeds here. We begin
by reviewing the modications needed for this setup. For technical simplicity, our convention diers
from the standard one, see Remark A.1.
A (Langlands dual)40skew-symmetrizable seedsis data (N;I;E =feigi2I;F;!;fdiji2Ig),
whereN,I,E, andFare as in the skew-symmetric setup of ยง2,!is aQ-valued skew-symmetric
form onN, and the values diare positive rational numbers such that the form !dened by
!(ei;ej) =di!(ei;ej) (130)
satises!(ei;ej)2Zwheneveriandjare not both in F. We shall use the notation !1:N!MQ,
n7!!(n;) as before. Note that the integrality condition implies that !1jNufhas image in M. We
again dene the bilinear form B:=!T, i.e.,B(ei;ej) =!(ej;ei) =dj!(ej;ei). We may also view B
as the matrix ( Bij),Bij=B(ei;ej). Given a skew-symmetrizable seed sas above, a compatible form
 is aQ-valued skew-symmetric form on Msuch that, for all i2InF, we have
2(!1(ei)) =d0
iei (131)
whered0
i=di2Q>0for some xed412Q>0. Note that (131) is equivalent to  2(!
1(ei)) =ei
for alli2InF; i.e.,
2(!
1(n)) =n (132)
for alln2Nuf.
We note that the data of a skew-symmetric seed with compatible  as in ยง2 is equivalent, up to
re-scaling, to the data of a skew-symmetrizable seed with compatible  having each diequal tod=
fordas in (2).
40In (130), one would typically have a factor of djon the right-hand side of (130) rather than di. However, our
folding construction will require the equation to be as in (130). This change amounts to working with the Langlands
dual of a seed as in [FG09]. Using  !(;ei) in place of !(ei;) in (134) (i.e., taking the Langlands dual scattering
diagram) would allow us to avoid taking the Langlands dual here. See Remark A.1 for more on Langlands dual seeds.
41If the associated quiver Qis connected, then the condition d0
i=diis forced by the skew-symmetry and (131).
More generally, one could allow dierent choices of for each connected component of Q. See [Qin20, Lemma 2.1.11(1)]
(which only looks dierent from (131) because we use Minstead ofM) and [GSV05, Thm. 2.1].BRACELETS BASES ARE THETA BASES 109
We will focus mostly on the classical (as opposed to quantum) setup, so the consideration of a
compatible form  is not strictly necessary. Nevertheless, such  will exist whenever the Injectivity
Assumption is satised, and this form is still useful in understanding the classical setup, so we will
use it here for convenience and for consistency with the rest of the paper.
Now given a skew-symmetrizable seed swith compatible  as above, one may dene associated
torus algebras, dilogarithms, scattering diagrams, and theta functions almost exactly as in ยง5.42Then
the initial scattering diagram DAt
inis dened by replacing the din (71) with d0
i| that is, one denes
DAt
in=f(e?
i;	td0
i(z!1(ei)))ji2InFg: (133)
Unfortunately, the positivity results of [DM21] (and thus the proofs of most of the other main results
of [DM21]) do not extend to the quantum skew-symmetrizable setup,43and the generalized folding
arguments below also do not apply in the quantum setting.
We therefore restrict to the classical limit. By (62), the initial scattering diagram is
DA
in=f(e?
i;	(z!1(ei))1=d0
i)ji2InFg; (134)
as in (65), mutation is given by
(A
i) 1(zp) = Ad 1
	(z!1(ei))1=d0
i(zp) =zp(1 +z!1(ei)) (!1(ei);p)=d0
i=zp(1 +z!1(ei))hei;pi: (135)
Classical skew-symmetrizable cluster algebras are within the generality of [GHKK18], so the classical
limits of the results of ยง5 will all still hold as in the skew-symmetric cases.
Remark A.1.Let us recall the standard convention of a seed s, see [Qin22, ยง2.1] [Qin20, Lem. 2.1.6]. It
has symmetrizers di2Z>0and aQ-valued skew-symmetric bilinear form f;gonN(s) =L
i2IZei. In
addition, the bilinear form Bdened byB(ej;ei) =Bji=fei;ejgdjshould satisfy Bji2Zwhenever
i;jare not both in F. Denote the matrix B= (Bij). It is further a quantum seed if it is endowed with
a compatible Q-valued skew-symmetric bilinear form  on M(s) such that  2(fek;g) =d0
kdkekfor
some multipliers d0
k2Q>0for allk2InF. Denotevi=fei;g=P
j2IBji1
dje
j. The corresponding
quantum scattering diagram D(s) has the initial walls ( e?
i;	td0
i(zvi)).
LetDdenote the least common multiple of fdiji2Ig. The Langlands dual seed s_has the basis
vectorse_
i:=diei, the symmetrizers d_
i:=D
di, and the bilinear form f;g_:=1
Df;g. Then we have
d_
ife_
i;e_
jg_=1
difdiei;djejg=Bji:
Notice that ( e_
j)=1
dje
jandvi=d_
ife_
i;g_=1
dife_
i;g.
Our basis vector eiis identied with the above e_
i. The matrix B, the bilinear forms B, , and
multipliers d0
iin our convention coincide with those above. The symbols diand!in our convention
could be identied with d_
iandf;g_, or with1
diandf;gabove. In either case, !1(P
i2Iniei) =
!
1(P
i2Inidiei) in our convention coincides with fP
i2Iniei;gabove. The walls (( ei)?;	td0
i(z!1(ei)))
in our convention coincide with the initial walls of D(s) as dened in this remark.
42The elements ^ zmof (52) are generalized as ^ zm:=zm
tj2(m)j t j2(m)j. Here, for n2NQ,jnj:=1
DjDnjfor
D2Z1such thatDn2NandjDnjis the index in N, so in particular, j2(!1(ei))j=d0
i. The elements ^ zmgenerate
the sub Lie algebra gt, and the classical limit from gttogis dened such that ^ zm7!1
jmjzm.
43It is known that quantum positivity fails in some skew-symmetrizable cases, cf. [CFMM20, ยง2.4.1] and [Nak22,
ยง5.3] for counterexamples motivated by the non-positivity of quantum greed bases [LLRZ14, ยง3].110 TRAVIS MANDEL AND FAN QIN
A.2.Covering of seeds. Fix a skew-symmetrizable seed s= (N;I;E;F;!;fdigi2I). Let  be a
partition of I, and for each i2I, let iIdenote the part of the partition containing i. We assume
that  satises the following:
(1) For each i2Iandi02i, we havedi=di0;
(2) For each i;j2Iand alli02i,
X
j02j!(ei;ej0) =X
j02j!(ei0;ej0): (136)
We note that Condition (1) implies that (136) is equivalent to the equation obtained by
replacing each !by!.
(3) Each  iis contained either entirely in InFor entirely in F.
Example A.2. Consider a nite group  acting on I, so the orbits of  yield a partition of I, also
denoted . Assume that Conditions (1) and (3) are satised for this partition. Suppose that for all
g2 andi;j2Iwe have!(egi;egj) =!(ei;ej). Then Condition (2) will be satised as well. In
our examples of primary interest (i.e., covering spaces),  will be a group of deck transformations.
We note that in the quiver folding considered in [Zho20], one imposes the stronger condition that
!(eg1i;eg2j) =!(ei;ej) for allg1;g22.
We dene a new skew-symmetrizable seed sas follows: let Ibe a set indexing the components
of the partition . Let N=ZIwith the natural basis E=feiji2Ig. LetFIbe the indices
corresponding to subsets of F. For eachi2I, let
di:=di
jij:
Dene!by
!(ei;ej) :=X
j02j!(ei;ej0) =1
jijX
i02i
j02j!(ei0;ej0) =diX
i02i
j02j!(ei0;ej0): (137)
Equivalently, one denes
!(ei;ej) =X
i02i
j02j!(ei0;ej0): (138)
Following [HL18, Def. 2.4], one says that sis acovering ofs. We will also say that sis a covering
of a seed sif just the data N;I;E;F, and!associated to sis as above (so !may dier by some Q>0
re-scaling, and the di's by the inverse re-scaling, but this re-scaling has no eect in the classical setup).
We say the partition  realizes sas a covering of s. Being an unfolding will require the additional
condition that composite mutations of sare also coverings of the corresponding mutations of s, cf.
ยงA.5.
Example A.3. Letsbe any seed, possibly not satisfying the Injectivity Assumption, and let  be
a partition of Isatisfying the conditions (1)-(3) above, thus realizing sis a covering of some s. Then
we extend  to a partition of Iprin=ItIsatisfying (1)-(3) by taking the partition of each copy of I
to be the same as for the original . This extension of  thus realizes sprinas a covering of sprin.BRACELETS BASES ARE THETA BASES 111
Assume now that ssatises the Injectivity Assumption. Fix a compatible form  and let d0
i=di
for some xed 2Q>0as in (131). Our goal is to show that the scattering diagram DA(s) is naturally
contained in a \slice" of the scattering diagram DA(s).
We consider the embedding :N ,!Ndened by
:ei7!X
i02iei0:
LetM:= Hom(N;Z), and let:M!Mbe the projection dual to . It follows that
(e
i) =e
i: (139)
We have the following diagram
NN Q
NN Q!
!
!
!
Consider the bilinear pairing !onNgiven by
(!)(n1;n2) :=!((n1);(n2))
and similarly for !. We see from (138) that
!=!;
We similarly see from the second expression for !in (137) that
!(ei;ej) =1
jij(!)(ei;ej);
so
!1(ei) =1
jij(!)(ei;);
or equivalently,
jij!1(ei) =(!1((ei))): (140)
Similarly, the rst expression for !in (137) implies
!1(ei) =(!1(ei)) (141)
for eachi2I.
We also consider the inclusion
:MR!MR; e
i7!1
jijX
i02ie
i0 (142)
with dual
:NR!NR; ei7!1
jijei:
Note thatis a section for the projection , i.e.,
= IdMR: (143)112 TRAVIS MANDEL AND FAN QIN
We have the following diagram:
NN
MRMR
!1 !1


Note thatandare compatible with the dual pairings, i.e, for n2Nandm2MR, we have
hn;mi=h(n);(m)i: (144)
Let 1(Z) denote the preimage of any subset ZMRinMR. Note that  1(Z) may be viewed as
the intersection of ZMRwith(MR). By (144), for each i2I, we have
 1(e?
i) =e?
i: (145)
We also note that for all i;j2Iand eachj02j,
!((ei);ej0) = di
dj! 
ej0;X
i02iei0!
;
and by (136) this is the same for each j02j. Hence,!1has image in (MR). Since= IdMR
by (143), we have =, i.e.,restricts to the identity on (MR). Hence
((!1((ei)))) =!1((ei)); (146)
so by (140) we have
jij(!1(ei)) =!1((ei)): (147)
By (131), the compatible form  on Msatises
2(!1(ei)) =d0
iei
fori2InF,d0
i=difor some xed 2Q>0. We claim then that  := is a compatible form for
swithd0
i=di=d0
i
jij. Indeed, for any  i2InF, j2I, we have
()(e
j;!1(ei)) = ((e
j);(!1(ei)))
=1
jij((e
j);!1((ei))) (by (147))
=d0
i
jijh(ei);(e
j)i (by (131))
=d0
ihei;e
ji (by (144))
as desired. In particular, the compatibility implies that the seed ssatises the Injectivity Assumption.
A.3.Restriction of scattering diagrams. Now, recall from (134) that the initial scattering dia-
gram for sis
Ds
in=f(e?
i;	(z!1(ei))1=d0
i)ji2InFg: (148)
Similarly the initial scattering diagram for sis
Ds
in=f(e?
i;	(z!1(ei))1=d0
i)ji2InFg
=f( 1(e?
i);	(z(!1(ei)))1=d0
i)ji2InFg (by (141) and (145))
f( 1(e?
i);	(z(!1(ei)))1=d0
i)ji2InFg (149)BRACELETS BASES ARE THETA BASES 113
where the \" in the last line denotes equivalence of scattering diagrams | here, for each  i2InF,
we factor the corresponding wall on the left-hand side of the equivalence into jij-many walls on the
right-hand side which are identical to each other.
As usual, one may consider the corresponding consistent scattering diagrams DsandDs, respec-
tively. We note that the walls of Ds
inmay be obtained from those of Ds
inby applying  1to the
supports and to the attached group elements. Our goal now is to extend this operation on Dsto
construct a scattering diagram Dswhich is closely related to (and often equivalent to) Ds.
A.3.1. The support of Ds.Viewed as a cone complex, the cones of the nite scattering diagram Ds
k
are dened to be the non-empty cones of the form  1() fora cone in Ds
k. The codimension-one
(inMR) such cones will be the supports of the walls of Ds
k. Note that the codimension of a cone
might change when applying  1.
On the other hand, walls of Ds
kare always contained in v?for somev2M+. By Lemma A.4
below, we have  1(v?) = (v)?wheneverv2M+. Notice that (M+) =M+by (141), so in
particular, ( v)?has codimension-one for v2M+. Thus, 1of any wall or higher-codimension
cone in Ds
kwill have codimension at least one in MR.
Lemma A.4. For anym2Mandv2M+, we have ((m);v) =(m;v).
Proof. It suces to check the equality for m=e
jandv=!1(ei). We have
((e
j);!1(ei)) =1
jjj0
@X
j02je
j0;!1(ei)1
A
=1
jjjd0
jj;i:
By (141), we have
(e
j;!1(ei)) = (e
j;!1(ei)) =d0
jj;i:
The claim follows from d0
j=dj
jjj. 
A.3.2. The invariant Lie sub algebra. It is clear that gives a morphism gs!gsas|-modules (via
action on the exponents). Furthermore, it is evident from (141) that maps gk
stogk
s, hence gives
a map ( gs)k!(gs)kon the level of modules (notation as in (54)). However, it is not generally true
that these maps of modules respect the Lie brackets as required to give a map of Lie algebras.
To get a map of Lie algebras, rst note (as in Example A.2) that we may view the partition  as
the set of orbits in Iunder the action of a nite group which we also denote  (abusing notation). Let
g
sdenote the sub Lie algebra of gsconsisting of the -invariant elements (under the induced action
of  on gs).
Lemma A.5. The restriction :g
s!gsofrespects the Lie brackets and thus gives a well-dened
morphism of Lie algebras.
Note then that also induces Lie algebra morphisms : (g
s)k!(gs)kand:^g
s!^gs.
Proof. Note that the -invariant elements of |[M]gsare spanned by those of the formP
u02uzu0
foru2M, udenoting the orbit of uunder the action of  on M. Recall that the Lie brackets on114 TRAVIS MANDEL AND FAN QIN
gsis the Poisson bracket fzu;zvg= (u;v)zu+v, and similarly on gsusing the compatible form .
Note that(u0) =(u) =:ufor eachu02u. We have
 (X
u02uzu0;X
v02vzv0)!
=0
@X
u02u;v02v (u0;v0)zu0+v01
A
=X
u02u;v02v(u0;v0)zu+v
=  X
u02uu0;X
v02vv0!
zu+v
and(
 X
u02uzu0!
; X
v02vzv0!)
=(X
u02uz(u0);X
v02vz(v0))
=X
u02u;v02v ((u0);(v0))zu+v
=  
 X
u02uu0!
; X
v02vv0!!
zu+v
So it suces to check that
 X
u02uu0;X
v02vv0!
=  
 X
u02uu0!
; X
v02vv0!!
(150)
SinceP
u02uu0is -invariant, it must lie in the -invariant part of M, i.e., in(MQ)\M, so it
equals(u0) for someu02MQ. Similarly,P
v02vv0=(v0) for somev02MQ. We now see that
both sides of (150) are equal to
((u0);(v0))
where for the right-hand side we use (143). This proves the claim. 
Recall that g
sandgsact on |JMKand|JMKrespectively as in (56). By Lemma A.4, these
actions are compatible with the maps ,; that is, for g2g
sandm2M\ 1(M), we have
((g):zm) =g:(zm).
A.3.3. Scattering functions for Ds.Letd= 1(d) be the support of a wall in Ds
kas in ยงA.3.1. We
dene the scattering function fd2(gs)kof the the wall ( d;fd)2Ds
kas follows:
We identify MRwith its image (MR)MR. Letbe a path in MRcrossing dtransversely at time
and intersecting no other codimension-one cells of Ds
k. Then we dene fdso that the path-ordered
product;Dsagrees with (e), whereeis a small generic perturbation of () inMRwith the same
endpoints as , but which crosses the walls of Ds
ktransversely while avoiding joints. That is,
fd=(e)sgn ( 0();vd)(151)
wherevdis the primitive element of M+with dv?
d. We note that for =T
idithe smallest
cone of Ds
kcontaining d,fdis(f) wherefis the scattering function attached to the cone in the
perspective on consistent scattering diagrams considered in [Mou19, ยง2.3].
To see that this is well-dened, let f(di;fdi)gibe the walls crossed by e. Note that for each i,
we have(vdi)2M+:=!1(N+) because(M+) =M+as an easy consequence of (141). NowBRACELETS BASES ARE THETA BASES 115
notice that (d)div?
di, so by Lemma A.4, we have d(vdi)?. Hence, all the vectors (vdi)
are parallel to the element vd2M+. Since multiplication in Gs
krespects the M-grading, and since
maps degree- melements to degree- (m) elements, it follows that fdlies inGk
vdforv?
dd, as
desired.
From now on, we assume that the action of the nite group  respects the bilinear form !jNuf, i.e.,
!(ei;ej) =!(gei;gej) for allg2 andi;j2InF(cf. Example A.2). In this case, we say shas
-symmetry. This assumption will be satised in ยงB where  consists of deck transformations.
Lemma A.6. Assume that shas-symmetry. Let be any smooth path in MRwith endpoints in
(MR)which avoids the joints of Ds
k. Then;Ds2(g
s)k.
Proof. Consider the natural induced actions of  on paths in MR, on scattering diagrams over gs
kin
MR, and on the unipotent group Gs
k. Note (using the -symmetry assumption) that for any g2
and any path 0, we have
g0;gDs
k=g0;Ds
k: (152)
Now take0:=g 1. Then (152) becomes
;gDs
k=g0:Ds
k: (153)
Since Ds
kis consistent over gs
k, and since the endpoints of and0are the same, we can replace 0in
(153) with . Furthermore, we note that the scattering diagram Ds
kis invariant under the -action
(using the -symmetry assumption again). Thus, (153) becomes
;Ds
k=g:Ds
k:
Since this holds for all g2, the claim follows. 
Theorem A.7. Assume that shas-symmetry. Then there is a well-dened, unique-up-to-equivalence
scattering diagram DsinMRsuch that the walls of the nite sub scattering diagram Ds
kare as de-
scribed above, up to equivalence. Furthermore, Dsis consistent. Up to equivalence preserving the
positivity of the walls, DsDs.
Proof. We showed the well-denedness above. The uniqueness statement is automatic since every wall
dlies in Ds
kfor allkgreater than or equal to some kd.
For consistency, it suces to check consistency of Ds
kfor eachk. By construction, for any generic
closed loop MR, the path-ordered Ds
kis equal to(Ds
k
0) for some perturbation 0of() inMR,
and the consistency of Dsensures that Ds
k
0= 1. Here we use Lemmas A.5 and A.6 to ensure that the
action ofon the path-ordered products is via homomorphism.
Finally, we see from (148) and (149) that, up to equivalence, the incoming walls of Dsinclude all
the incoming walls of Ds. The claim that DsDsfollows. 
The following general result will not be used in this paper.
Corollary A.8. Assume that shas-symmetry. Then  1(mid
R(s))mid
R(s).
Proof. LetQ2C+
sand letQ02C+
sbe a generic point (with respect to Ds) very near (Q). For any
m2 1(M), any broken line   in (MR) with ends ( m;Q) and nal monomial c zm with respect to
Dscan be deformed in MRto a broken line  0with ends ( (m);Q0) and nal monomial c z(m ). If
(m)2mid(s), then#Ds
(m);Q0is a nite Laurent polynomial (writing the relevant scattering diagram116 TRAVIS MANDEL AND FAN QIN
in the exponent for clarity), so #Ds
m;Qmust be as well (because we just saw that any broken line
contributing to #Ds
m;Qalso yields a broken line contributing to #Ds
(m);Q0).
Since DsDsas positive scattering diagrams by Theorem A.7, we similarly have that every broken
line contributing to #Ds
m;Qmust also contribute to #Ds
m;Q, so niteness of #Ds
m;Qimplies niteness of #Ds
m;Q.
Putting all this together, we see that (m)2mid(s) impliesm2mid(s). The claim follows. 
Lemma A.9. Supposem=(m). FixQ;Q02MRgeneric and sharing chambers of Ds
kwith(Q),
(Q0), respectively, for some generic Q;Q02MR. If#Ds
m;Q(#Ds
m;Q)(modulom+kM+), then
#Ds
m;Q0(#Ds
m;Q0)(modulom+kM+).
Proof. This follows from Lemma 5.7 and the fact that, by construction, Ds
k
=(Ds
k) for any paths
;fromQtoQ0andQtoQ0, respectively. 
A.4.Examples of covering.
Example A.10. Consider the seed sgiven such that I=f1;2;3g,di= 1 for alli, and!is given by
!(ei;ej) =0
B@0 1 1
 1 0 1
1 1 01
CA
Letsprindenote the corresponding principal coecient seed with framing vertices j0for eachj2I
such that!(i;j0) =ij. Choose the compatible form  given by
 = 
0 Id 3
 Id3 !!
so (!prin)T= Id 6.
Choose  such that  i=f1;2;3gand i0=f10;20;30g. Then the corresponding seed sprinhas an
unfrozen vertex 1 and a frozen vertex 10. Its skew-symmetric bilinear form in the basis e
1and
e
10is given by
!= 
0 3
 3 0!
and we have d1=d10=1
3. It is compatible with the matrix  given by
 = 
01
3
 1
30!
:
Identifyiwithi+ 3 for simplicity (i.e., assume Iis cyclically ordered). The walls dforDsprinare
the three initial walls ( e?
i;	(zvi)) wherevi:=!prin
1(ei) =e
i+1 e
i 1+e
i0, and the three non-initial
walls ( di;	(zui)) for di= (e?
i+1\e?
i 1) +R0( ui) and
ui:=vi+1+vi 1=e
i 1 e
i+1+e
(i+1)0+e
(i 1)0:
Form= P3
i=1e
i, one can compute that
#m=zm3Y
i=1(1 +zvi+zvi+vi 1):
The space MRis spanned by e
1= 1(1
3P
ie
i) ande
10= 1(1
3P
ie
i0). The only wall of
Dsprin(up to equivalence) is ( d;fd) where d=e?
1=Re
10, andfd= 	(zvd)3forvd=e
10. SoBRACELETS BASES ARE THETA BASES 117
form= 3e
1,Dsprinhas the theta function #m=zm(1 +zvd)3. On the other hand, the unique
wall ( d0;fd0) ofDsprinhasd0=dbut a dierent scattering function fd0, see (151). In particular, for
m= 3e
1,Dsprinhas the theta function
#m=zm(1 +zvd+z2vd)3:
Remark A.11 .In Example A.10, the group  could be constructed from the cyclic permutation
i7!i+ 1 andi07!(i+ 1)0. It would be interesting to know if one can generalize Example A.10,
and Theorem A.7 more broadly, to drop the -symmetry assumption (which was only needed for the
proof of Lemma A.6).
A.5.Folding. Suppose that sis a covering of s(not necessarily satisfying the -symmetry assump-
tion). We would like for a mutation jofsto naturally correspond to a mutation ^ j:=Q
j02jj0
ofs, but in general, either of the following might fail to be true:
(1) the mutations j0,j02j, should commute with each other; i.e., we require !(ej1;ej2) = 0
for allj1;j22j. This allows for the denition of composite mutations ^ j:=Q
j02jj0.
(2) The composite mutation ^ j(s) should be a covering of j(s).
We say the covering sis -mutable if conditions (1) and (2) above hold for all  j2I. Given a
sequence  ~ |= (j1;:::; jk) of elements of I, dene ^~ |= ^jk^j2^j1. Ifsis totally -
mutable|i.e., for any sequence  ~ |, ^~ |(s) is a -mutable covering of ~ |(s)|then we say that the
covering sis anunfolding ofs, or that sis afolding ofs.
As in [FST12, ยง4] and [HL18], Conditions (1) and (2) above hold whenever the following is true:
For alli2I,j2InF, andj02j, if!(ei;ej)>0, then!(ei;ej0)0. (154)
The condition (1) above|i.e., that !(ei;ei0) = 0 whenever i02i2InF|follows easily from (154)
combined with (136). Using (8), additional computations reveal that (154) implies Condition (2)
above as well (cf. [HL18, Lem. 2.5]; note that our conditions !(ei;ei0) = 0 when i02iand our (154)
correspond to the conditions of having no  -loops nor  -2-cycles in loc. cit., respectively). So the
covering swill be an unfolding whenever (154) holds for all seeds ^ ~ |(s) as above (dened recursively
after checking (154) for the shorter sequences of composite mutations).
Proposition A.12. Suppose sis a folding of s. Then the projection maps elements of Aup
stoAup
s.
Proof. By construction, every cluster A~ |(s)ofAup
sisof a corresponding cluster A^~ |(s)ofAup
s.
Furthermore, one checks that ^A
j=A
j|indeed, this is clear from
^j(zp) =0
@Y
j02jAd 1
	(z!1(ei))1=d0
i(zp)1
A
(cf. (135)) and
j(zp) =Y
j02jAd 1
	(z(!1(ej)))1=d0
j(z(p))
(cf. the factorization of Ds
inin (149)). Thus, fbeing a universal Laurent polynomial for the clusters
ofsimplies(f) is a universal Laurent polynomial for the clusters of s. 
We assume from now on that shas -symmetry.
Lemma A.13. Suppose sis a folding of s, and assume that shas-symmetry. Then DsandDs
agree up to equivalence on the cluster complex Csand on the opposite complex  Cs.118 TRAVIS MANDEL AND FAN QIN
Proof. Recall that the complexes Csare generated by the chambers by C
sby mutations. It suces
to show that, for any non-initial wall dv?ofDs, the associated cone  1(d) does not intersect
the chambers C
sat codimension 1. By Lemma A.4,  1(d) is contained in ( v)?. Notice that
the hyperplane ( v)?intersects the chamber C
sat codimension 1 if and only if vis parallel to
!1(ek) for somek2InF. So there must exists some  ksuch thatvis a linear combination of ek0
fork02k. But such a non-initial wall ddoes not exist since !(ek;ek0) = 0 for all k02k; see the
order-by-order inductive construction of Dsin [GHKK18, ยงC]. 
Corollary A.14. Suppose sis a folding of s, and assume that shas-symmetry. Then Ds=Ds(up
to equivalence) when sadmits a green-to-red sequence (meaning that C+
sandC 
sare both contained
in the cluster complex of s, cf. [Mul16a, ยง4.4]; or, equivalently, sis injective-reachable [Qin17] ).
Proof. A scattering diagram Dis uniquely determined by the path-ordered product D
 ;+from the
positive chamber to the negative chamber; cf. [KS14, Thm. 2.1.6], or see [GHKK18, Thm. 1.17] for
this result in the present context. When sadmits a green-to-red sequence, there exists a path from
C+
stoC 
scontained entirely within the cluster complex of s. Since DsandDsagree on the cluster
complex by Lemma A.13, it follows that they agree everywhere. 
LetCdenote the interior of the closure of the cluster complex Cs. Similarly, let Cdenote the
interior of the closure of the opposite complex  Cs.
Lemma A.15. Letsbe a folding of s, and assume that shas-symmetry. Then DsandDsagree
up to equivalence on Cand on C.
Proof. It suces to work up to arbitrary nite order k. As in Theorem A.7, we may assume by taking
equivalent scattering diagrams that DsDsand that both scattering diagrams have only positive
walls. Suppose there is some non-trivial wall d2Ds
knDs
kwhich intersectsC. Choose generic points
x;x02Cson either side of dso that a line segment 0fromxtox0crosses no walls of Ds
kother than
d(and possibly walls parallel to d). ThenDs
k06=Ds
k0. On the other hand, since Csis path-connected,
we can nd a path fromxtox0contained entirely within Cs. ThenDs
k0=Ds
k0by Lemma A.13.
This contradicts the consistency of DsandDs, so the result for Cfollows. A similar argument yields
the result for C. 
Remark A.16 .In general, DsandDsmay dier. We will see that this is indeed the case for the
once-punctured torus. A natural question is whether this folding construction correctly relates the
associated stability scattering diagrams of [Bri17]. We leave this question to future work [CMQ23].
Remark A.17 .We note that Dscan equivalently be constructed as the unique-up-to-equivalence
consistent scattering in MRwithDs
 ;+=(Ds
 ;+). This is the approach used in [Zho20, ยง2].
Lemma A.18. Ifsis an unfolding of s, then sprinis an unfolding of sprin.
Proof. Let us denote Iprin=I1tI2withFI1,Fprin=FtI2as in ยง2.3. We already noted in
Example A.3 that sprinis a covering of sprin. By the assumption that sis an unfolding of s, we see that
Condition (154) holds for i2I1;j2I1nF, and all ^~ |(sprin) (the extension to principal coecients
does not aect the restriction of !to the original lattice N, even under sequences of mutations).
To extend (154) to i2I2, rst recall that the sign coherence of c-vectors [GHKK18, Cor. 5.5]
says that for j2I1nF,!prin(ei;ej) (hence also !prin(ej;ei)) is either non-negative for all i2I2orBRACELETS BASES ARE THETA BASES 119
non-positive for all i2I2. Then (136) implies that !prin(ej;ei) and!prin(ej0;ei) have the same sign
for allj02jand alli2I2. In particular, for each i2I2andj02j, we have that !prin(ei;ej) and
!prin(ei;ej0) have the same sign; i.e., (154) holds, as desired. 
Appendix B.Once-punctured closed surfaces
B.1.Covering spaces and scattering diagrams. Fix  = ( S;M) an arbitrary triangulable marked
surface. Let :eS!Sbe a nites: 1 oriented cover44ofSfors2Z1. We consider the covering
marked surface e = (eS;fM) withfM:= 1M. Note that any tagged triangulation  of Slifts to a
tagged triangulation e ofeSwhose arcs are the components  1() for2. Let  be the group of
deck transformations of the covering . Note that  acts on e, thus determining a partition  of e.
Lemma B.1. The partition realizes seas an unfolding of s. The map : Sk2(e)!Sk2()
induced by as in (139) is[C]7![(C)]for any tagged simple multicurve C. That is,coincides
with the map of(33).
Proof. Note that each arc in  lifts to sarcs ine related by the action of . Furthermore, triangles
in  lift to triangles in e with the same orientations. The conditions for being a covering now follow
easily from the denition of the signed adjacency matrix B=!Tinยง3.2 and ยง3.3. Flipping an arc of
 will correspond to ipping all lifts of that arc in e, and since the tagged triangulation for  was
arbitrary, the folding conditions of ยงA.5 are satised.45
The claim regarding is clear for arcs in e. Since the map [ C]7![(C)] is an algebra homomor-
phism and since every [ C] is a Laurent polynomial in the arcs of e, the claim for general skeins [ C]
follows. 
Recall from ยง5.8 that all walls of principal coecients scattering diagrams are closed under addition
by (0;NR), so the scattering diagrams can be completely understood in terms of their projections via
: (m;n)7!m(keeping the scattering functions the same). We work with these projections via 
throughout ยงB.
B.2.Unfolding and scattering diagrams for once-punctured closed surfaces. By Lemma
A.18, sebeing an unfolding of simplies that sprin
eis an unfolding of sprin
. When no component of
Sis a once-punctured closed surface, sprin
admits a green-to-red sequence by Proposition 5.23, and so
Dsprin
=Dsprin
eby Corollary A.14. On the other hand, if  is a once-punctured closed surface, then
Proposition 5.23 and Lemma A.15 imply that Dsprin
andDsprin
eagree except possibly on the half-space
Hwhich forms the boundary of Cand C.
Lemma B.2. Letbe a marked surface with tagged triangulation , and letn0=P
i2ei(i.e.,
n0= (1;1;:::; 1)). Then!1(N)n?
0.
44Note that we do not consider the more general covers of SnMas in ยง3.3.3 (i.e., covers ramied at punctures).
Such coverings spaces do yield seed coverings in the sense of ยงA.2, but if  contains once-punctured digons or monogons,
then the folding condition (154) may fail in the covering space of the punctured digon or monogon; cf. Footnote 45.
We note that this is not a problem for once-punctured closed surfaces since they do not contain punctured monogons or
digons|i.e., covering spaces of SnM(as opposed to just of S) do yield unfoldings for once-punctured closed surfaces.
45Alternatively, the folding condition (154) is satised because if !(ei;ej)>0 and!(ei;ej0)<0 for some j02j,
then the two contributing triangles would necessarily map to a once-punctured digon in . But since digons are simply
connected, the two triangles in e should have also formed a digon, contradicting the supposed values of !. Here we use
that eSis a covering space of the unpunctured surface S.120 TRAVIS MANDEL AND FAN QIN
Ifis a once-punctured closed surface, then n?
0is the hyperplane Hforming the boundary of Cand
 C. Thus, for any scattering diagram in MRover the associated gand any wall (d;f)withdH,
we have that gk
!prin
1(n0)3fis central inbg.
Here, the notation gk
mis as in the classical limit of (57).
Proof. For eachi2, each triangle of  containing icontributes +1 to !(ei;ej) for onejand 1 to
!(ei;ej0) for some other j0(possiblej=j0). Thus,P
j2!(ei;ej) = 0 for all i2; i.e.,!1(ei)2n?
0
for alli2I, so the claim !1(N)n?
0follows.
Now suppose  is a once-punctured closed surface. The hyperplane His generated by the g-vectors
of loops, and by (113), these lie in !1(NQ), hence in n?
0. The claim H=n?
0follows.
For the centrality claim, note that
prin(!prin
1((n;0));!prin
1(n0)) =hn0;!prin
1((n;0))i=!(n;n0) = 0:
The centrality now follows from the denition of the Lie bracket in (55). 
Note thatn02ker!1implies!prin
1(n0) = (0;n0). Let us denote m0:= (0;n0)2Mprin.
Lemma B.3. Ifis a once-punctured closed surface, then, up to equivalence, Dsprin
e=Dsprin
t
f(H;fH)gforHthe bounding hyperplane as above and fH2gk
m0.
Proof. The only part of this claim which we did not see above is that, up to equivalence, there is
only one wall in H, and the support is all of H. The fact that Dsprin
eandDsprin
are both consistent
andgk
m0is central implies that Dsprin
enDsprin
must be consistent. Since we know that any walls of
Dsprin
enDsprin
must have support in H, the only possibility (up to equivalence) which is consistent is
indeed where there is a single wall whose support is all of H. 
B.3.Bracelets and theta functions for once-punctured closed surfaces. ForfHas in Lemma
B.3 and any m2M, the wall-crossing automorphism associated to crossing Hfrom the side containing
mto the other side will act on zmvia
Ad hn0;mi
fH(zm) =zm(PH)jhn0;mij(155)
for somePH21 +zm0Z0Jzm0K. Fixm2 C\M. Let#m;Qdenote the theta function constructed
with respect to Dsprin
, and let#m;Qbe the theta function constructed using using Dsprin
e=Dsprin
t
f(H;fH)g. Then for any generic Q2C , we have
#m;Q=#m;QP hn0;mi
H: (156)
On the other hand, consider Q0contained in a chamber of  Cwhich contains m, say a chamber
corresponding to a triangulation consisting of doubly-notched arcs. Let em2() 1(m) and let
eQ0be in the chamber of eC(the cluster complex for e) associated to  1()|i.e., the chamber
containing(Q0) foras in ยงA.2. Then#m;Q0=zmand#em;eQ0=zem(to see this, it suces to work
with the initial seed sin the coecient-free setting and apply the tag-change automorphism iP). So
#m;Q0=(#em;eQ0). We thus know from Lemma A.9 that #m;Q=(#em;eQ). Since#emis given by
the appropriate (laminated) lambda length in e for principal coecients [FT18b], Lemma B.1 (theBRACELETS BASES ARE THETA BASES 121
agreement of and) implies that #m;Qis given by the desired (laminated) lambda length;46i.e.,
by the bracelet element hCmiBracwithg-vectorm(see ยง7.2.2). We have thus found that
hCmiBrac=#mP hn0;mi
H: (157)
It remains to understand this factor PH. Let us set our principal coecients equal to 1 (i.e., apply
the map: (m;n)7!m), soPHbecomes a constant cH2Z1equal to the sum of the coecients of
PH. To compute cH, x a doubly-plain arc in  with corresponding doubly-nothced arc , and let
mbe theg-vector of. By Example 3.17, = (L1+L2)2whereL1andL2are the two loops
forming the boundary for a tubular neighborhood of .
For genusg2,L1andL2are distinct, and we compute
#m# m== (L1+L2)2= 4 +h2L1iBrac+ 2hL1tL2iBrac+h2L2iBrac: (158)
Since#m# m=cH#m# m, and since the theta function expansion of #m# mhas non-negative integer
coecients, all coecients on the right-hand side of (158) should be divisible by cH2Z1. Since
two of the coecients are equal to 1, it must be the case that cH= 1. Hence, PH= 1 as well, so
hCmiBrac=#meven in the principal coecient setup.
On the other hand, for g= 1,L1andL2are isotopic, so we have [ L1] = [L2] =: [L]. So in this case
we have
#m# m== (2[L])2= 8 + 2h2LiBrac: (159)
We compare this with the description of the theta function for this case in [Zho20, ยง5.3]. Fix a
triangulationf1;2;3gof  with=1, and letAidenote the cluster variable associated to i;
i.e.,#g(i)=Ai.. Theng() = g(), and Zhou nds that
# g()=(A2
1+A2
2+A2
3)2
A1A2
2A2
3:
Thus,
#g()# g()=1
A2
2A2
3 
A4
1+A4
2+A4
3+ 2A2
1A2
2+ 2A2
2A2
3+ 2A2
1A2
3
: (160)
Note that the constant coecient of the above expression is 2. On the other hand, the constant
coecient for = 8 + 2h2LiBracas in (159) is 8. So, given that =#g()and=cH# g(), it
follows that we must have cH= 4. That is,
= 4# g(): (161)
As a further check, we note that #g(L)(denoted#1 2in [Zho20, ยง5.3]) is shown in loc. cit. to equal
A2
1+A2
2+A2
3
A2A3: (162)
46For computing laminated Lambda lengths in [FT18b], we need to consider opened surfaces 0,e0associated to
 and e, which are constructed by replacing the punctures by holes. We then naturally extend to a covering map
between the opened surfaces. Choose a multi-lamination Lon  corresponding to the principal coecients and denote
eL:= 1(L). By using the covering map , a point in the laminated Teichm uller space T(;L) is naturally sent to
a point inT(e;eL) (see [FT18b, Denition 10.8, Remark 14.8, Denition 15.1]). Fix a lift L0ofLon 0and lift eLto
 1(L0) on e0. Then the laminated lambda length of a tagged arc eone is the same as that of (e) on  (see [FT18b,
Denition 15.3]).122 TRAVIS MANDEL AND FAN QIN
So by (160), we have
#2
g(L)=#g()# g(): (163)
We know from (159) that #2
g(L)= [L]2=1
4# g(), and comparing this with (163) recovers (161)
again.
To summarize, we have found the following:
Theorem B.4. LethCiBrac be any bracelet consisting of weighted doubly-notched arcs in the once-
punctured closed surface of genusg. Letmbe theg-vector ofhCiBrac andn0:= (1;1;:::; 1),
m0= (0;n0)2MN. Forg2,
hCiBrac=#m
in either the principal coecient or coecient-free setting. For g= 1,
hCiBrac= 4hn0; mi#m
in the coecient-free setting. In the principal coecients setting with g= 1,
hCiBrac=Phn0; mi
H#m
for some polynomial PH21 +zm0Z0[zm0]whose coecients add up to 4.
Remark B.5.Working out as in (159) in the principal coecients setting should suce to
determinePH. In fact, Min Huang has used the perfect matching approach of [MSW11] to compute
theF-polynomial of in comparison to that of [Zho20, ยง5.3] for us, and his computation indicates
thatPHshould equal (1 + zm0)2; i.e., the scattering function fHshould equal 	( zm0)2.
We denote [ a]+:= maxf0;ag. The following result allows us to generalize Theorem B.4 to general
tagged bracelets.
Lemma B.6. LetCdenote a collection of tagged arcs and La collection of loops, such that C[Lis
a tagged simple multicurve. Then at t= 1we have
(i) If is not a once-punctured torus, then hC[LiBrac=#g(C)+g(L)(including in the principal
coecients setting).
(ii) If is a once-punctured torus, then hC[LiBrac=(g(C) +g(L))#g(C)+g(L), where(m) :=
4[ hm;n0i]+.
Proof. For convenience, in Case (i) above, let (m) := 1 for all m2M. Now recall in general that
hC[LiBrac=hCiBrachLiBrac, see ยง7.2.3. In addition, we have hLiBrac=#g(L)by Lemma 9.1 and
hCiBrac=(g(C))#g(C)by Theorem B.4.
Choose ans: 1 covering :e! (s2) such that each component of Llifts tosdisjoint loops
ine, and x a lift eC[eLofC[L. This way, (heC[eLiBrac) =hC[LiBrac. Now, the bracelet
heC[eLiBracfore is a theta function (Lemma 9.3). Applying to the factorization of theta functionsBRACELETS BASES ARE THETA BASES 123
heC[eLiBrac=heCiBracheLiBracand using Theorem B.4, we obtain
#g(eC[eL)=(heC[eLiBrac)
=(heCiBrac)(heLiBrac)
=(g(C))#g(C)heLiBrac
=(g(C))#g(C)hLiBrac
=(g(C))#g(C)#g(L):
Applying (156) to the left hand side, we obtain
(g(C) +g(L))#g(C)+g(L)=(g(C))#g(C)#g(L):
The desired claims follows from (g(C)+g(L)) =(g(C)) andheC[eLiBrac=hC[LiBrac(by Lemma
B.1). 
Appendix C.Donaldson-Thomas transformation
Consider the consistent (quantum) scattering diagram D=Dsassociated to any initial (quantum)
seeds. Let +denote the collection of seeds s~ |mutation-equivalent to s. Recall that the corresponding
conesC+
~ |as in (25) are chambers of Dand form a fanC+:=C, see Proposition 5.14.
Now dene the seed s by replacing each basis element eiofEswith ei. Similarly construct
s 
~ |for each~ |. Let  denote the collection of these seeds. The corresponding cones C 
~ |= C+
~ |
again are chambers of Dwith wall-crossings corresponding to mutations, and these chambers form a
fanC , see [GHKK18, Construction 1.3]. When C 
s=C+
s coincides with some C+
s~ |,sis said to be
injective-reachable [Qin17] or, equivalently, one says there exists a green to red sequence [Mul16a]. In
the following, we do NOT assume this condition holds.
For any two seeds s1;s2in +[ , we let ps2;s1=pdenote the action Ad ;Dssuch thatis a
generic path from a generic point in Cs1to a generic point in Cs2.
Fix a generic basepoint Q2C+. We assume that all theta functions are Laurent polynomials
with respect toQ. By (79) and the positivity of broken lines, this condition is equivalently to # fi;Q
being Laurent polynomials (recall fi:=e
i). Since ps;s (z fi) =# fi;Q,ps;s acts on the skew-eld
of fractions As
t(t= 1 for the classical case). Let =sdenote the automorphism of Mssendingm
to m, and also the induced action on As
tsendingzmtoz m. Building on [GS18] [KQW22], one
denes the Donaldson-Thomas transformation associated to sas the composition
DTs=ps;s s: (164)
This construction is a natural generalization of the twist endomorphism of DT-type for injective-
reachable seeds in [Qin20] [KQW22, ยง5.1].
Remark C.1.The automorphism can be understood as follows. Let sopdenote the opposite seed,
whose basis vectors are the same as that of sbut it has the inverse bilinear form  !. The opposite
scattering diagram Dsopwas considered in [Qin22, ยงA.2] (and the quantum version in [DM21, ยง2.3.3]).
Then, for any broken line with ends ( m;Q) and attaching monomials cizviinDs, there is a broken
line with ends ( m; Q) and attaching monomials ciz viinDsop. It follows that, for any generic
base pointQand anym2M, we have
(#m;Q) =#sop
 m; Q: (165)124 TRAVIS MANDEL AND FAN QIN
Remark C.2.The inverse of DTscan be constructed as follows, assuming that all theta functions
are Laurent polynomials with respect to generic base points  QinC . By (79), the positivity of
broken lines, and Lemma C.3, this condition is equivalently to #fi; Qbeing Laurent polynomials.
Since ps ;s(zfi) =#fi; Q,ps ;sacts on the skew-eld of fractions As
t. Then we obtain the inverse of
DTs:
(DTs) 1= (s) 1ps ;s=sps ;s: (166)
The tropical mutation Tkinยง2.4 provides an isomorphism between scattering diagrams DsandDsk,
see [GHKK18, Construction 1.3] and [DM21, ยงA]. Moreover, its action on the exponents of Laurent
monomials gives us Tk(#s
m;Q) =#sk
Tk(m);Tk(Q)[DM21, Prop. A.3]. Recall that we have the mutation
birational map k:As
t!Ask
tas in (17). We have k(#s
m;Q) =#sk
Tk(m);Q0forQandQ0generic base
points in the positive chambers of DandDskrespectively ([GHKK18][Qin22, Thm. A.1.4]).
Denote sk=s0. We will often omit the superscript s, and we replace the superscript s0by0.
Recall that we have #m;Q=zmif bothmand the generic point Qare contained in some Cs~ |.
Lemma C.3. We have#m;Q=zmif bothmand the generic point Qare contained in some Cs 
~ |.
Proof. By applying the tropical mutations Tk, it suces to verify the claim for C . The statement
may be proved similar to that for C+. Alternatively, using (165), we have #m;Q=(#sop
 m; Q) =
(z m) =zm. 
In particular, for m2C+\Mand genericQ2C+, we have
DTs(#m;Q) = DTs(zm) =ps;s (z m) =ps;s (# m; Q) =# m;Q: (167)
Lemma C.4. For anyk2InF, we havekDTs= DTskk.
Proof. The mutation ksends the initial cluster variables #fito
k(#fi) =#0
f0
i; i6=k
k(#fk) = (t#0P
i[bik]+f0
i+t#0P
j[ bjk]+f0
j)(#f0
k) 1;
where:= (fk;P
i[bik]+fi) and:= (fk;P
j[ bjk]+fj)
Notice that T 1
k( f0
k) = fk+P
i[bik]+fiis contained in the chamber C(sk) . We have#T 1
k( f0
k); Q0=
zT 1
k( f0
k)for a generic point  Q02C(sk) by Lemma C.3. A generic path from Q0to a generic
base point QinC only crosses the k-th chamber. Applying p, we get
#T 1
k( f0
k); Q=p(#T 1
k( f0
k); Q0)
=zfk P
i[bik]+fi+zfk P
j[ bjk]+fj
= (z fk) 1(tz P
i[bik]+fi+tz P
j[ bjk]+fj):
In fact, this is the k-th mutation at the opposite seed sop. Using Lemma C.3, we rewrite it as a
relation between theta functions:
# fk#T 1
k( f0
k)=t# P
i[bik]+fi+t# P
j[ bjk]+fj;
By a similar computation (or by applying k), we have the following relation in D0:
#0
Tk( fk)#0
 f0
k=t#0
 P
i[bik]+f0
i+t#0
 P
j[ bjk]+f0
j:BRACELETS BASES ARE THETA BASES 125
Notice that k(# Pmifi) =#0
 Pmif0
iformi0,mk= 0. In addition, k(#T 1
k( f0
k)) =#0
 f0
k.
Combining with DT( #fi) =# fiand DT0(#0
f0
i) =#0
 f0
i,8i, it is straightforward to check the following
relation
kDT(#fi) = DT0k(#fi);8i:
Notice that #fi;Q=zfi,8i;generate the fraction eld As
t. The desired claim follows. 
We often identify the fraction eld As
twith Aks
tby the mutation k. Then, by Lemma C.4, the
DT-transformation DTsis identied with DTks, so we simply denote these by DT. From this point
of view, DT is independent of the choice of the initial seed.
By Lemma C.4, DT sends cluster monomials for sto cluster monomials for s . By applying
sequences of mutations, we extend this to s~ |ands 
~ |.In combination with (167), we have the following:
Proposition C.5. DTmaps the cluster monomials of s~ |to the cluster monomials of s 
~ |. In particular,
form2Cs,DTs(#m) =# m.
More generally, one expects the following:
Conjecture C.6.DT sends theta functions to theta functions.
Conjecture C.6 is known to be true for injective-reachable seeds, see [KQW22].
Let us now consider a triangulable connected marked surface . Following [BQ15], given a tagged
arcin , dene the tagged rotation ofto be the tagged arc obtained as follows:
Change the taggings of any ends of at punctures;
For any end of not at a puncture, slide the end along @S, against the orientation (i.e.
counterclockwise in Denition 3.25), until reaching the next marked point.
Proposition C.7. Assume that is not a doubly-notched arc in a once-punctured closed surface.
Ifis not a once-punctured torus, then DT(hiBrac)agrees withhiBrac up to adding some xed
element of Ms;Fto each exponent (i.e, up to a frozen monomial factor times a power of t). If is
a once-punctured torus, then in the coecient-free classical setting, hiBrac = 4 DT(hiBrac)(and
hiBrac= (PH) DT(hiBrac)in the classical principal coecients setting for PHas in Theorem B.4).
Proof. There exists a tagged triangulation 0which can be obtained from  by a sequence of ips ~ |
and which contains . By applying mutations along the sequence ~ |, it suces to verify the claim for the
triangulation 0and the initial seed s~ |. Theng() becomes a basis vector f0
iand b0() becomes
 f0
i, see Denition 3.23. So using (41), the rst claim follows from the equality DT( #f0
i) =# f0
i. The
claim for the once-punctured torus follows similarly using Theorem B.4. 
As a consequence, we have the following result.
Corollary C.8. Suppose we are in the coecient-free classical setting. If is a closed punctured
surface but not a once-punctured torus, then DTcoincides withQ
P2MiP. Ifis a once-punctured
torus, then DTcoincides with iPwhereis dened by :zm7!4 hm;n0izmforn0as in Lemma
B.2. In either case, DTis an involution.
Proposition C.9. When is not a once-punctured closed surface, DTis a permutation on the theta
functions. In addition, we have DThLi=hLifor any simple loop L. Moreover, if is closed and has
at least two punctures, then DTis involutive up to frozen variables.126 TRAVIS MANDEL AND FAN QIN
Proof. We've seen that DT is invertible (166). The rst claim holds by [KQW22, Thm. 6.1.1] since
Proposition 5.23 implies these cases are injective-reachable.
For the claim regarding hLi, note that it suces to work in the setting of principal coecients. It
is known thathLiis bi-pointed at g(L) and g(L), meaning that
hLi=zg(L)+0
@X
m2[g(L)+M+]\[ g(L) M+]cmzm1
A+z g(L)(168)
for some coecients cm; cf. [FG06, Thm. 12.2.1] (a consequence of (125)). It follows that the theta
function DThLi=ps;s (shLi) is also pointed with lowest degree g(L), so it must coincide with hLi.
Now suppose  is a closed surface. We have shown that for any m2M, we have (DT)2#m=#m0
for somem0. By Proposition C.8, #m0coincides with #mwhen we evaluate tand the frozen variables
to 1, since DT =Q
P2MiPis involutive in this setting. It follows that m02m+MF.
Lemma C.10. Ifis a once-punctured closed surface, then at the classical limit t= 1,DT is
involutive up to frozen variables. In addition, we have DThLi=hLifor any simple loop L. Moreover,
DTis a permutation on the theta functions.
We conjecture that the claims hold at the quantum level as well.
Proof. It suces to work with principal coecients. Choose any 1 <d2N. As in ยงB, let:e!
denote ad: 1 covering space of . Choose ideal triangulations , e as before and let es,sdenote the
associated seeds of principal coecients.
For anyi2e, denotem=de
iandem=(m). Then#mand#emare bracelets associated to
plain arcs and ( m)# mand# emare associated to the corresponding doubly notched arcs, where
the constant ( m) equalsPd
H(forPHas in Theorem B.4) when  is a once-punctured torus and
it equals to 1 otherwise. Since mlies in a chamber of C, we have(#em) =#mby Lemma A.13.
Moreover, our ndings in ยงB.3 imply(# em) =( m)# m. Combining with DTs(#m) =# mand
DTes(#em) =# em(Proposition C.5), we deduce that
DTes=DTs
where(zm) =( m) hm;n0izm. In particular, (#m) =( m)1#m. Using this and the fact
that DTesis involutive up to frozen variables (Proposition C.9), we compute
(DTs)2(#m) = DTs(# m) =1
( m)DTs((# em))
=1
( m) 1(DTes(# em))
=1
( m) 1(#em+f) for some f2MF
=1
( m) 1#m+f=#m+f:
So DTsis indeed involutive up to frozen variables
For any simple loop L, denote 1(L) =[1jdLj, whereLjare connected components of  1(L).
ThenhLji=hLiby the construction of bracelets and Lemma B.1. Using Proposition C.9, we have
DTshLid= DTs(Y
jhLji) = 1(DTes(Y
jhLji)) = 1(Y
jhLji) = 1(hLid) =hLid:BRACELETS BASES ARE THETA BASES 127
It follows that DT sends hLitohLi.
Combining the above results with the relationship between the classical tagged bracelets and theta
functions given in Lemma B.6, we deduce that DT sends theta functions to theta functions. 
The following observation is used in the proof of Lemma 9.2.
Lemma C.11. Assume that is a once-punctured closed surface. Take any initial triangulation 
and let sdenote a seed similar to sand satisfying the Injectivity Assumption. Then DT 1hLiis
bi-pointed with highest Laurent degree g(L)and the lowest Laurent degree  g(L)(in the ordering of
Denition 6.1); i.e., it has the form of the right-hand side of (168) .
Proof. LetQdenote any generic point in C+. We have DT 1hLi=s(ps ;s(#g(L);Q)) =s(#g(L); Q).
Now since#g(L); Qis a bar-invariant positive g(L)-pointed Laurent polynomial, DT 1hLimust be a
bar-invariant positive Laurent polynomial with lowest Laurent degree  g(L) with coecient 1.
Let us decompose DT 1hLiinto a convergent sum DT 1hLi=P
mcm#m. By Lemma C.10, its
classical limit at t= 1 is DT 1hLi=hLi. Ifm0is maximal out of the terms with cm6= 0, then the
coecient of zm0in DT 1hLiiscm0. Since DT 1hLiis positive, we must have cm0jt=12Z1, hence
m0=g(L) andcm0jt=1= 1. Bar-invariance then implies cm0= 1. Therefore, the decomposition must
take the form DT 1hLi=hLi+P
msg(L)cm#m. In particular, DT 1hLihas the highest Laurent
degreeg(L) with coecient 1. 
References
[AB20] Dylan Allegretti and Tom Bridgeland, The monodromy of meromorphic projective structures , Transactions
of the American Mathematical Society 373(2020), no. 9, 6321{6367, arXiv:1802.02505.
[AK17] Dylan G. L. Allegretti and Hyun Kyu Kim, A duality map for quantum cluster varieties from surfaces ,
Advances in Mathematics 306(2017), 1164{1208, arXiv:1509.01567.
[All16] Dylan Gregory Lucasi Allegretti, The geometry of cluster varieties from surfaces , Ph.D. thesis, Yale
University, 2016, arXiv:1606.07788.
[Bou20a] Pierrick Bousseau, Quantum mirrors of log Calabi-Yau surfaces and higher-genus curve counting , Compos.
Math. 156(2020), no. 2, 360{411, arXiv:1808.07336.
[Bou20b] Pierrick Bousseau, Strong positivity for the skein algebras of the 4-punctured sphere and of the 1-punctured
torus , arXiv:2009.02266.
[BQ15] Thomas Br ustle and Yu Qiu, Tagged mapping class groups: Auslander{Reiten translation , Mathematische
Zeitschrift 279(2015), no. 3, 1103{1120, arXiv:1212.0007.
[Bri17] Tom Bridgeland, Scattering diagrams, Hall algebras and stability conditions , Algebraic Geometry 4(2017),
no. 5, 523{561, arXiv:1603.00416.
[BS15] Tom Bridgeland and Ivan Smith, Quadratic dierentials as stability conditions , Publ. Math. Inst. Hautes
Etudes Sci. 121(2015), 155{278, arXiv:1302.7030.
[BW11] Francis Bonahon and Helen Wong, Quantum traces for representations of surface groups in SL2(C), Geom.
Topol. 15(2011), no. 3, 1569{1615, arXiv:1003.5250.
[BZ05] Arkady Berenstein and Andrei Zelevinsky, Quantum cluster algebras , Adv. Math. 195 (2005), no. 2,
405{455, arXiv:math/0404446.
[BZ14] Arkady Berenstein and Andrei Zelevinsky, Triangular bases in quantum cluster algebras , International
Mathematics Research Notices 2014 (2014), no. 6, 1651{1688, arXiv:1206.3586.
[CF99] L. O. Chekhov and V. V. Fock, Quantum Teichm uller spaces , Teoret. Mat. Fiz. 120(1999), no. 3, 511{528,
arXiv:math/9908165.
[CFMM20] Man-Wai Mandy Cheung, Juan Bosco Fr as-Medina, and Timothy Magee, Quantization of deformed clus-
ter Poisson varieties , arXiv:2007.02479.128 TRAVIS MANDEL AND FAN QIN
[CIKLFP13] Giovanni Cerulli Irelli, Bernhard Keller, Daniel Labardini-Fragoso, and Pierre-Guy Plamondon, Linear in-
dependence of cluster monomials for skew-symmetric cluster algebras , Compos. Math. 149(2013), no. 10,
1753{1764, arXiv:1203.1307.
[CKKO20] So Young Cho, Hyuna Kim, Hyun Kyu Kim, and Doeun Oh, Laurent positivity of quantized canonical
bases for quantum cluster varieties from surfaces , Communications in Mathematical Physics 373(2020),
no. 2, 655{705, arXiv:1710.06217.
[CLS15] Ilke Canakci, Kyungyong Lee, and Ralf Schier, On cluster algebras from unpunctured surfaces with one
marked point , Proc. Amer. Math. Soc. Ser. B 2(2015), 35{49, arXiv:1407.5060.
[CMMM] Man-Wai Cheung, Timothy Magee, Travis Mandel, and Greg Muller, Tropical theta functions and cluster
varieties , (in preparation).
[CMQ23] Qiyue Chen, Travis Mandel, and Fan Qin, A comparison between scattering diagrams , in preparation.
[CPS22] Michael Carl, Max Pumperla, and Bernd Siebert, A tropical view on Landau-Ginzburg models ,
arXiv:2205.07753.
[C  T19] _Ilke C  anak c and Pavel Tumarkin, Bases for cluster algebras from orbifolds with one marked point , Algebr.
Comb. 2(2019), no. 3, 355{365, arXiv:1711.00446.
[Dav18] Ben Davison, Positivity for quantum cluster algebras , Ann. of Math. (2) 187 (2018), no. 1, 157{219,
arXiv:1601.07918.
[DM21] Ben Davison and Travis Mandel, Strong positivity for quantum theta bases of quantum cluster algebras ,
Inventiones mathematicae (2021), 1{119, arXiv:1910.12915.
[Dup11] Gr egoire Dupont, Generic variables in acyclic cluster algebras , Journal of Pure and Applied Algebra 215
(2011), no. 4, 628{641, arXiv:0811.2909.
[DWZ10] Harm Derksen, Jerzy Weyman, and Andrei Zelevinsky, Quivers with potentials and their representations
II: Applications to cluster algebras , J. Amer. Math. Soc. 23(2010), no. 3, 749{790, arXiv:0904.0676.
[FG00] Charles Frohman and R azvan Gelca, Skein modules and the noncommutative torus , Transactions of the
American Mathematical Society 352(2000), no. 10, 4877{4888, arXiv:9806107.
[FG06] Vladimir V. Fock and Alexander B. Goncharov, Moduli spaces of local systems and higher Teichm uller
theory , Publ. Math. Inst. Hautes Etudes Sci. 103(2006), no. 1, 1{211, arXiv:math/0311149.
[FG07] V. V. Fock and A. Goncharov, Dual Teichm uller and lamination spaces , Handbook of Teichm uller the-
ory. Vol. I, IRMA Lect. Math. Theor. Phys., vol. 11, Eur. Math. Soc., Z urich, 2007, pp. 647{684,
arXiv:math/0510312.
[FG09] V. Fock and A. Goncharov, Cluster ensembles, quantization and the dilogarithm , Ann. Sci. Ec. Norm. Sup.
(4)42(2009), no. 6, 865{930, arXiv:math/0311245.
[FST08] Sergey Fomin, Michael Shapiro, and Dylan Thurston, Cluster algebras and triangulated surfaces. I. Cluster
complexes , Acta Math. 201(2008), no. 1, 83{146, arXiv:math/0608367.
[FST12] Anna Felikson, Michael Shapiro, and Pavel Tumarkin, Cluster algebras of nite mutation type via unfold-
ings, International Mathematics Research Notices 2012 (2012), no. 8, 1768{1804, arXiv:1006.4276.
[FT17] Anna Felikson and Pavel Tumarkin, Bases for cluster algebras from orbifolds , Adv. Math. 318 (2017),
191{232, arXiv:1511.08023.
[FT18a] S. Fomin and D. Thurston, Cluster algebras and triangulated surfaces Part II: Lambda lengths , Mem.
Amer. Math. Soc. 255 (2018), no. 1223, v+97, Available from: https://doi.org/10.1090/memo/1223 ,
MR 3852257
[FT18b] Sergey Fomin and Dylan Thurston, Cluster algebras and triangulated surfaces Part II: Lambda lengths ,
vol. 255, American Mathematical Society, 2018, arXiv:1210.5569.
[FZ02] Sergey Fomin and Andrei Zelevinsky, Cluster algebras. I. Foundations , J. Amer. Math. Soc. 15(2002),
no. 2, 497{529 (electronic), arXiv:math/0104151.
[FZ07] Sergey Fomin and Andrei Zelevinsky, Cluster algebras IV: Coecients , Compositio Mathematica 143
(2007), 112{164, arXiv:math/0602259.
[GHK15] Mark Gross, Paul Hacking, and Sean Keel, Birational geometry of cluster algebras , Algebraic Geometry
2(2015), no. 2, 137{175, arXiv:1309.2573.
[GHKK18] Mark Gross, Paul Hacking, Sean Keel, and Maxim Kontsevich, Canonical bases for cluster algebras ,
Journal of the American Mathematical Society 31(2018), no. 2, 497{608, arXiv:1411.1394.BRACELETS BASES ARE THETA BASES 129
[GLFS20] Christof Gei, Daniel Labardini-Fragoso, and Jan Schr oer, Generic Caldero-Chapoton functions with co-
ecients and applications to surface cluster algebras , arXiv:2007.05483.
[GLS12] Christof Gei, Bernard Leclerc, and Jan Schr oer, Generic bases for cluster algebras and the Chamber
Ansatz , J. Amer. Math. Soc. 25(2012), no. 1, 21{76, arXiv:1004.2781v3.
[GS11] Mark Gross and Bernd Siebert, From real ane geometry to complex geometry , Ann. of Math. (2) 174
(2011), no. 3, 1301{1428, arXiv:math/0703822.
[GS15] Alexander Goncharov and Linhui Shen, Geometry of canonical bases and mirror symmetry , Invent. Math.
202(2015), no. 2, 487{633, arXiv:1309.5922.
[GS18] Alexander Goncharov and Linhui Shen, Donaldson-Thomas transformations of moduli spaces of G-local
systems , Adv. Math. 327(2018), 225{348, arXiv:1602.06479.
[GS19] Alexander Goncharov and Linhui Shen, Quantum geometry of moduli spaces of local systems and repre-
sentation theory , arXiv:1904.10491.
[GSV03] Michael Gekhtman, Michael Shapiro, and Alek Vainshtein, Cluster algebras and Poisson geometry , Mosc.
Math. J. 3(2003), no. 3, 899{934, 1199, fDedicated to Vladimir Igorevich Arnold on the occasion of his
65th birthdayg, arXiv:math/0208033.
[GSV05] Michael Gekhtman, Michael Shapiro, and Alek Vainshtein, Cluster algebras and Weil-Petersson forms ,
Duke Math. J. 127(2005), no. 2, 291{311, arXiv:math/0309138.
[HL10] David Hernandez and Bernard Leclerc, Cluster algebras and quantum ane algebras , Duke Math. J. 154
(2010), no. 2, 265{341, arXiv:0903.1452.
[HL18] Min Huang and Fang Li, Unfolding of sign-skew-symmetric cluster algebras and its applications to posi-
tivity and f-polynomials , Advances in Mathematics 340(2018), 221{283, arXiv:1609.05981.
[Hua22] Min Huang, An expansion formula for quantum cluster algebras from unpunctured triangulated sur-
faces , Selecta Mathematica 28(2022), no. 2, 1{58, Available from: https://doi.org/10.1007/
s00029-021-00750-2 .
[Kas91] M. Kashiwara, On crystal bases of the Q-analogue of universal enveloping algebras , Duke Math. J. 63
(1991), no. 2, 465{516, Available from: http://dx.doi.org/10.1215/S0012-7094-91-06321-0 ,
[Kir95] Anatol N. Kirillov, Dilogarithm identities , no. 118, 1995, Quantum eld theory, integrable models and
beyond (Kyoto, 1994), pp. 61{142, arXiv:hep-th/9408113.
[KQW22] Yoshiyuki Kimura, Fan Qin, and Qiaoling Wei, Twist automorphisms and Poisson structures ,
arXiv:2201.10284.
[KS06] Maxim Kontsevich and Yan Soibelman, Ane structures and non-Archimedean analytic spaces , The
unity of mathematics, Progr. Math., vol. 244, Birkh auser Boston, Boston, MA, 2006, pp. 321{385,
arXiv:math/0406564.
[KS14] Maxim Kontsevich and Yan Soibelman, Wall-crossing structures in Donaldson-Thomas invariants, inte-
grable systems and mirror symmetry , Homological mirror symmetry and tropical geometry, Lect. Notes
Unione Mat. Ital., vol. 15, Springer, Cham, 2014, pp. 197{308, arXiv:1303.3253.
[L^19] Thang T. Q. L^ e, Quantum Teichm uller spaces and quantum trace map , J. Inst. Math. Jussieu 18(2019),
no. 2, 249{291, arXiv:1511.06054.
[Le19] Ian Le, Cluster structures on higher Teichm uller spaces for classical groups , Forum Math. Sigma 7(2019),
Paper No. e13, 165, arXiv:1603.03523.
[Liu09] Xiaobo Liu, The quantum Teichm uller space as a noncommutative algebraic object , Journal of Knot
Theory and its Ramications 18(2009), no. 05, 705{726, arXiv:0408361.
[LLRZ14] Kyungyong Lee, Li Li, Dylan Rupel, and Andrei Zelevinsky, Greedy bases in rank 2 quantum cluster
algebras , Proc. Natl. Acad. Sci. USA 111(2014), no. 27, 9712{9716, arXiv:1405.2311.
[LLZ14] Kyungyong Lee, Li Li, and Andrei Zelevinsky, Positivity and tameness in rank 2 cluster algebras , J.
Algebraic Combin. 40(2014), no. 3, 823{840, arXiv:1303.5806.
[Lus90] G. Lusztig, Canonical bases arising from quantized enveloping algebras , J. Amer. Math. Soc. 3(1990),
no. 2, 447{498, Available from: https://doi.org/10.2307/1990961 .
[Lus91] G. Lusztig, Quivers, perverse sheaves, and quantized enveloping algebras , J. Amer. Math. Soc. 4(1991),
no. 2, 365{421, Available from: https://doi.org/10.2307/2939279 .130 TRAVIS MANDEL AND FAN QIN
[Lus94] G. Lusztig, Total positivity in reductive groups , Lie theory and geometry, Progr. Math., vol. 123, Birkh auser
Boston, Boston, MA, 1994, pp. 531{568, Available from: https://doi.org/10.1007/978-1-4612-0261-5_
20.
[Lus00] G. Lusztig, Semicanonical bases arising from enveloping algebras , Adv. Math. 151(2000), no. 2, 129{139,
Available from: https://doi.org/10.1006/aima.1999.1873 .
[Man17] Travis Mandel, Theta bases are atomic , Compos. Math. 153(2017), no. 6, 1217{1219, arXiv:1605.03202.
[Man21] Travis Mandel, Scattering diagrams, theta functions, and rened tropical curve counts , Journal of the
London Mathematical Society 104(2021), no. 5, 2299{2334, arXiv:1503.06183.
[Mou19] Lang Mou, Scattering diagrams of quivers with potentials and mutations , arXiv::1910.13714.
[MSW11] Gregg Musiker, Ralf Schier, and Lauren Williams, Positivity for cluster algebras from surfaces , Adv.
Math. 227(2011), no. 6, 2241{2308, arXiv:0906.0748.
[MSW13] Gregg Musiker, Ralf Schier, and Lauren Williams, Bases for cluster algebras from surfaces , Compositio
Mathematica 149(2013), no. 02, 217{263, arXiv:arXiv:1110.4364.
[Mul13] Greg Muller, Locally acyclic cluster algebras , Adv. Math. 233(2013), 207{247, arXiv:1111.4468.
[Mul16a] Greg Muller, The existence of a maximal green sequence is not invariant under quiver mutation , Electron.
J. Combin. 23(2016), no. 2, Paper 2.47, 23, arXiv:1503.04675.
[Mul16b] Greg Muller, Skein and cluster algebras of marked surfaces , Quantum topology 7(2016), no. 3, 435{503,
arXiv:1204.0020.
[MW13] Gregg Musiker and Lauren Williams, Matrix formulae and skein relations for cluster algebras from sur-
faces , International Mathematics Research Notices 2013 (2013), no. 13, 2891{2944, arXiv:1108.3382.
[Nak22] Tomoki Nakanishi, Pentagon relation in quantum cluster scattering diagrams , arXiv:2202.01588.
[Pen87] R. C. Penner, The decorated Teichm uller space of punctured surfaces , Comm. Math. Phys. 113 (1987),
no. 2, 299{339, Available from: http://projecteuclid.org/euclid.cmp/1104160216 .
[Pen04] R. C. Penner, Decorated Teichm uller theory of bordered surfaces , Comm. Anal. Geom. 12(2004), no. 4,
793{820, arXiv:math/0210326.
[Pen12] Robert C. Penner, Decorated Teichm uller theory , QGM Master Class Series, European Mathematical
Society (EMS), Z urich, 2012, With a foreword by Yuri I. Manin, Available from: https://doi.org/10.
4171/075 .
[Pla13] Pierre-Guy Plamondon, Generic bases for cluster algebras from the cluster category , International Math-
ematics Research Notices 2013 (2013), no. 10, 2368{2420, arXiv:1111.4431.
[Qin14] Fan Qin, t-analog of q-characters, bases of quantum cluster algebras, and a correction technique , Interna-
tional Mathematics Research Notices 2014 (2014), no. 22, 6175{6232, arXiv:1207.6604,
[Qin17] Fan Qin, Triangular bases in quantum cluster algebras and monoidal categorication conjectures , Duke
Mathematical Journal 166(2017), no. 12, 2337{2442, arXiv:1501.04085.
[Qin20] Fan Qin, Dual canonical bases and quantum cluster algebras , arXiv:2003.13674.
[Qin22] Fan Qin, Bases for upper cluster algebras and tropical points , Journal of the European Mathematical
Society (2022), arXiv:1902.09507.
[Qin23] Fan Qin, Bases for strata of algebraic groups via operations in cluster theory , in preparation (2023).
[Que22] Hoel Queelec, Gl2 foam functoriality and skein positivity , arXiv:2209.08794.
[QW18] Hoel Queelec and Paul Wedrich, Extremal weight projectors , Math. Res. Lett. 25(2018), no. 6, 1911{
1936, arXiv:1701.02316.
[QW21] Hoel Queelec and Paul Wedrich, Khovanov homology and categorication of skein modules , Quantum
Topol. 12(2021), no. 1, 129{209, arXiv:1806.03416.
[Rea14] Nathan Reading, Universal geometric cluster algebras from surfaces , Transactions of the American Math-
ematical Society 366(2014), no. 12, 6647{6685, arXiv:1209.4095.
[Rea20] Nathan Reading, Scattering fans , International Mathematics Research Notices 2020 (2020), no. 23, 9640{
9673, arXiv:1712.06968.
[RY14] Julien Roger and Tian Yang, The skein algebra of arcs and links and the decorated Teichm uller space ,
Journal of Dierential Geometry 96(2014), no. 1, 95{140, arXiv:1110.2748.
[SSW23] Linhui Shen, Zhe Sun, and Daping Weng, The punctured SLnskein algebra and quantization of ASLn;^S
moduli space , in preparation (2023).BRACELETS BASES ARE THETA BASES 131
[SZ04] Paul Sherman and Andrei Zelevinsky, Positivity and canonical bases in rank 2 cluster algebras of nite
and ane types , Mosc. Math. J. 4(2004), no. 4, 947{974, 982, arXiv:math/0307082.
[Thu14] Dylan Paul Thurston, Positive basis for surface skein algebras , Proc. Natl. Acad. Sci. USA 111 (2014),
no. 27, 9725{9732, arXiv:1310.1959.
[Tra11] Thao Tran, F-polynomials in quantum cluster algebras , Algebr. Represent. Theory 14(2011), no. 6, 1025{
1061, arXiv:0904.3291v1.
[Wil20] Jon Wilson, Surface cluster algebra expansion formulae via loop graphs , arXiv:2006.13218.
[Yur20] Toshiya Yurikusa, Density of g-vector cones from triangulated surfaces , International Mathematics Re-
search Notices 2020 (2020), no. 21, 8081{8119, arXiv:1904.12479.
[Zho20] Yan Zhou, Cluster structures and subfans in scattering diagrams , SIGMA. Symmetry, Integrability and
Geometry: Methods and Applications 16(2020), 013, arXiv:1901.04166.
Department of Mathematics, University of Oklahoma, Norman, OK 73019, USA
Email address :tmandel@ou.edu
School of Mathematical Sciences, Shanghai Jiao Tong University, China
Email address :qin.fan.math@gmail.com