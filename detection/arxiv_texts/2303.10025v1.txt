Optimizing the Marketing of Flexibility for a
Virtual Battery in Day-Ahead and Balancing
Markets: A Rolling Horizon Case Study
E. Finhold C. G artner R. Grindel T. Heller
N. Leith auser E. R oger F. Schirra
Fraunhofer Institute for Industrial Mathematics ITWM
67663 Kaiserslautern
Germany
Abstract
Industrial electricity consumers with exible demand can prot by ad-
justing their load to short-term prices and by providing balancing services
to the grid. Markets which support this kind of short-term position ad-
justment are the day-ahead market and balancing markets. We propose a
formulation for a combined optimization model that computes an optimal
distribution of exibility between the balancing and day-ahead markets.
The optimal solution also includes the specic bids for the day-ahead and
balancing markets. Besides the expected prots of each market and their
individual bidding languages, our model also takes their dierent roles in
a continuous marketing of exibility into account. To prevent overrat-
ing short-term prots we introduce a variable penalty term that adds a
cost to unfavorable load schedules. We evaluate the optimization model
in a rolling horizon case study based on the setting of a virtual battery
at TRIMET SE, which is derived from a exible aluminum electrolysis
process. For such a battery we compute a daily optimal split of exibility
and trading decisions based on data in the period 04/2021 - 03/2022. We
show that the optimal split is more protable than using only one market
or a xed split between the markets.
Keywords: Flexibility Marketing, Day-Ahead Market, Balancing Markets,
Bidding Strategies, Linear Programming, Virtual Battery
1 Introduction
Regenerative electricity production in Germany has increased considerably over
the last two decades. With this transformation away from schedulable fossil fuels
1arXiv:2303.10025v1  [math.OC]  17 Mar 2023to mostly volatile regenerative power sources, electricity production becomes
more uncertain. As a consequence, the consumption of electricity is also bound
to change: it has to become more exible in order to cope with the uncertainty
in renewable energy production. Electricity consumers should consume more if
there is an oversupply of (renewable) energy and less if energy is scarce. This
exibility in energy consumption is referred to as a virtual battery , as instead of
physically storing energy, a similar eect is achieved by shifting the demand.
Since electricity prices are not constant, neither within a day nor over the course
of several days, a exible consumer can arbitrage trade the dierence between
times with higher prices against those with lower prices. Usually, these price
dierences reect the uctuations in the availability of electricity. Thus, con-
sumers who schedule consumption based on prices can simultaneously reduce
their own costs and support the shift to renewable energy sources. The general
term for this approach of minimizing electricity costs is demand side manage-
ment (DSM). For a general introduction to DSM, we refer to the surveys by
Zhang and Grossmann (cf. [27]), Siano (cf. [24]), and Gelazanskas and Gamage
(cf. [15]). Applications of DSM can be found in several kind of industries, such
as steel production and aluminium electrolysis (cf. [23]).
The day-ahead market is of particular importance for marketing exibility or
closing short-term positions (cf. [3]). Trading decisions for day-ahead markets
can either be specied by an amount for a given hour, e.g. as in [8, 17, 18], or
by exploiting a more complex bidding language, e.g. by using piece-wise linear
bidding functions (cf. [5, 12]). Next to the day-ahead market, balancing mar-
kets allow pre-qualied providers another prot opportunity (cf. [1]). Optimal
bidding on balancing markets requires an adaptation to specic market designs,
such as price limits or minimum bid quantities. These design parameters have
been changed several times since November 2020 for the German balancing
markets. A bidding model and evaluation on the period from January 2014 to
December 2016 can be found in [21]. For a more recent evaluation of a bidding
optimization model on the period from April 2021 to November 2021, see [14].
In this article, we focus on the period from April 2021 to March 2022. Note
that the price limit of 9.999,99 e/MWh was removed during this period, and
thus, we consider a period in which the market design changes. Information
concerning balancing markets is published at [2].
Due to this complexity, it is non-trivial for market participants to decide how to
optimally market exibility on a particular energy market. Obviously, it is even
harder to decide how to spread exibility across multiple markets, especially in
advance. An overview over several studies on prots obtained in dierent energy
markets with dierent market and price assumptions can be found in [16]. Note
that combining the bidding over more than one market typically results in higher
prots.
Optimization models for bidding across multiple markets are often formulated
as multi-stage optimization problems (cf. [6{8,19,22]). Thereby, dierent com-
binations of markets are studied, e.g. day-ahead market and intraday market
2(e.g. [5,19]), day-ahead market and balancing markets (e.g. [8,23]) and all three
of these markets (e.g. [17, 20]). The intraday market is often modeled as if it
were a single auction and, thus, structurally identical to the day-ahead market.
Here, we neglect the intraday market and focus on the combined bidding on the
day-ahead market and the balancing markets, since these markets only need a
single trading decision. In contrast to the multi-stage approach, the trading on
multiple markets can also be modeled as simultaneous decision as in [17,20]. In
this article, we are interested in a split of exibility between markets, and thus,
follow the simultaneous approach for our optimization model.
When bidding on multiple energy markets, a key aspect is to avoid myopic
prot realizations that are less protable in the long run. For this, we introduce
a rolling horizon framework which is based on price forecasts and additional
constraints in the optimization problem. In [18], dierent lookahead horizons
were tested for day-ahead trading, whereas Corinaldesi et al. (cf. [9]) evaluated
their trading decisions on the day-ahead and intraday market in a rolling horizon
setting. In this article, we present a mathematical optimization model for a
cross-market situation considering the day-ahead and the balancing market in a
rolling-horizon setting. The model returns the locally optimal split of exibility
capacities for the dierent markets, together with the concrete bids to place on
the markets. Yet, the model design ensures that the solutions are also protable
long-term. Note that in this approach, we execute only one optimization run
per day where we x all decision variables and hence do not follow a multi-
stage approach that uses the realizations of one auction for the bidding in a
later auction (as e.g. in [22]). One particular advantage of this strategy is that
it allows to split the exibility budgets among separate nancial management
departments specialised in dierent markets.
Our setting is inspired by the situation at TRIMET Aluminium SE, where the
production processes have been redesigned such that the aluminium ovens can
act as a large virtual battery with positive and negative capacity. In general, our
approach can be transferred to common batteries. Note however that we implic-
itly assume a very large storage capacity with respect to the hourly exibility
and that we do not take (un)charging cycles into account. Trading decisions on
single or multiple markets have already been discussed and described in various
contexts, for example for exibility aggregators (e.g. [5,22]), for energy storage
owners (e.g. [19]) and for energy intensive chemical plants (e.g. [26]). In [23], be-
sides a model for combined bidding strategies for the primary balancing market
and the day-ahead market, the authors provide a case study for energy intense
processes in the aluminium production at TRIMET Aluminium SE. While the
general idea is similar to our approach in principal, the authors focus on a dif-
ferent balancing market (primary instead of secondary balancing market) than
we do. Also, the market regulations have changed signicantly in the last years.
Pure day-ahead trading decisions for this setting at TRIMET Aluminium SE
have also been discussed earlier by the authors of this work for single days in [13]
and in a rolling horizon context in [18].
Another purpose of our study is to assess the prot opportunities of demand
3side management in general. We consider the problem of using exibility prof-
itably on the day-ahead and balancing markets. We distinctly put our focus on
optimizing the prots of a single provider of exibility. The exibility we mar-
ket stems from a exibilized industrial process. We therefore consider not only
forecasts that predict prices or prot opportunities in electricity markets, but
also technical constraints such as battery size and production eciency losses.
Our key results are:
â€¢We adapt our optimization to the market design in the 2021-2022 period
and capture the intricacies of the balancing market by modelling both the
power and the reserve part of the auction.
â€¢We evaluate this optimization strategy by computing cumulative prots
in the rolling horizon period from April 2021 to March 2022. This rolling
horizon setting plays a major role in real-world applications. Therefore,
we put a special focus on it in the numerical evaluations.
â€¢We show that our methods perform well in a quickly changing market
and illustrate the rising value of exibility in periods with high prices
and volatility. Besides that, we see that the day-ahead market and the
balancing markets fulll dierent roles in the rolling horizon context.
The remainder of the article is structured as follows. In Section 2, we discuss
for which trading decisions our model can provide suitable decision support and
explain the rolling horizon setting for our case. In Section 3, we give a brief
description of the considered markets, namely, the balancing markets and the
day-ahead market. Here, we also provide an explanation on how to compute
the required input data for our model. In Section 4, we introduce our decision
support model for cross-market trading where we consider trading strategies for
the balancing markets and the day-ahead market. Numerical results are then
presented in Section 5. Finally, we conclude in Section 6 with a short outlook
on future research.
2 Decision framework
In the following, we describe our setting. First, we give an overview of the
electricity markets considered for trading and when the trading decisions are
made in the respective markets. We then briey describe the rolling horizon ,
which is an essential component for practical usage.
2.1 Trading decisions
German electricity trading takes place on several independent markets. On the
one hand, there is the futures and derivatives market, which can be used to
build up positions at an early stage. Here, trading decisions take place up to
4today delivery day
3:00 p.m.12:00 p.m. 9:00 a.m.day-ahead  
60 min auctionday-ahead  
results  
energy 
delivery
12:57 p.m.intraday  
continuous  
intraday  
continuous  
closure
11:55 a.m.
9:30 a.m.reserve capacity  
daily auction  reserve  
capacity
results  
12:00 p.m.
11:00 a.m.
intraday  
continuous  
openingreserve energy  
4h auction  reserve  
energy  
results  
11:15 a.m.Figure 1: Auctions and trading time horizons for the German short-term elec-
tricity markets.
six years before delivery of the electricity. Consequently, they are based on
predictions that cannot include any information about the situation close to
delivery. Therefore, in addition to this long-term market, there are markets for
short-term adjustment of existing positions, when more recent data is available.
These include: The day-ahead market (DA), where trading decisions can be
made one day before delivery, the intraday market (ID), which allows trading
from the previous day up to ve minutes before delivery, and the balancing
energy market (secondary reserve or automatic Frequency Restoration Reserves
(aFRR)), which is used if a grid imbalance occurs despite the adjustment of po-
sitions beforehand. It consists of a reserve capacity and a reserve energy market
that are denoted by SRC market and SRE market, respectively. Obviously,
short-term markets play a crucial role in promoting exibility. Therefore, we
concentrate on trading decisions on these markets in the following.
The time horizons of decisions on the short-term markets is shown in Figure
1, exemplary for a product with delivery starting at 12 p.m. Because the data
used in this article is from the years 2021 and 2022, all times are expressed in a
way they t into the market description of that period. The rst decision to be
made today, i.e. the day before delivery, is the one regarding volume and pricing
of oers on the SRC market; they must be submitted before 9 a.m. Results are
published half an hour later. Then, the next auction that takes place is the day-
ahead auction at 12 p.m. Here, results are published 57 minutes later. These
auction times are independent of the product that is considered. In contrast to
this, order books for SRE bids close one hour before delivery and their results
are published 15 minutes later. Consequently, this could take place today or on
the delivery day itself, depending on the considered product. Note that on the
SRE market, only six products are sold, each covering four hours of the day.
The corresponding auction is always conducted one hour before the delivery
period starts. Finally, the continuous intraday market starts at 3 p.m. and
5remains open until 5 minutes prior to delivery of each product. In the gure,
this is depicted in grey, because we do not consider this market further in this
article. This is due to the fact that trading on the intraday market requires
either a person or an algorithm to monitor prices and to react to them. Not
every company that would have access to the intraday market in theory can use
it in practice due to these requirements. Therefore, we concentrate on a setting
in which exibility is split between the day-ahead and aFRR markets, that is
relevant for smaller companies. As a result of both considered markets, traders
must decide the level of exibility they want to provide across all three markets
before the end of the SRC bid collection period.
2.2 The rolling horizon
Computing an optimal bidding strategy for a single day might lead to unsta-
ble plans and shortsighted decisions. Instead, each day we compute a bidding
strategy for a longer look-ahead period. However, the strategy will only be exe-
cuted for the rst day of the period and recomputed on the following day when
more recent forecasts become available. Like this. we get a setting in which the
bidding strategy adapts each day to new information about the price forecasts.
To describe the rolling horizon setting in more detail, we denote the points in
time at which decisions have to be made by t0;t1;:::. LetTbe the number of
days in our planning horizon. At t0, an optimal schedule for the entire planning
horizon is computed and executed for the following day. At the next time t1, the
procedure is repeated. Regardless of whether new price forecasts are available,
a new optimal schedule is computed for the entire planning horizon. Thus, at
each point in time, a schedule covering Tdays is computed and the rst day of
the schedule is executed. A schematic representation of the rolling horizon can
be seen in Figure 2.
In this article, we propose a hybrid approach where we consider the balancing
market only for the next day, while the day-ahead market is considered over
a longer period. For a more detailed discussion of the length of the horizon
considered for bidding in the day-ahead market, we refer to [18]. Note that
since in general price forecasts change over time, the resulting trading schedule
in a rolling horizon framework is usually not optimal, although the bidding
problem is solved optimally every day.
3 Markets and their data
In the following, we describe the considered markets on which we want to market
the exibility. For each market, we describe the required input data.
6t0 t1 t2
Look-ahead horizont3:::t0t1t2:::...Execution / planning time points
Figure 2: Schematic representation of the rolling horizon setting with a look-
ahead horizon of two time points. On the x-axis, we denote the time points for
which a plan is executed or computed. On the y-axis, we denote the time points
where a part of a computed plan is executed and a new plan is computed. The
solid green part depicts the planning horizon at the given point in time whereas
the blue striped part depicts the execution horizon at the given point in time.
3.1 The balancing markets
In Germany, the electricity grid has to maintain a electric frequency of 50Hz
in order to keep the electricity system stable. Transmission system operators
are responsible to maintain these 50Hz by using balancing energy when the
frequency moves away from its set value. This balancing energy is sold on three
markets, namely the primary reserve market, the secondary reserve market and
the tertiary reserve market. The main dierence between the markets is the time
span within which the respective products can be activated: Primary reserve
products need to be available within 5 seconds after being requested, secondary
reserve products take over after 30 seconds, and nally tertiary reserve products
cover the range of 12.5 minutes up to 60 minutes after the demand request. To
be able to handle frequency uctuations on both directions, all three markets
oer the possibility to buy and sell products with positive or negative balancing
energy.
In the following paragraphs, we present the secondary reserve markets in more
detail. On both markets - SRC and SRE- pre-qualied reserve energy providers
are allowed to trade. For this pre-qualication, certain criteria need to be ful-
lled. These contain elements as admission to EPEX, forecasting electricity
input every day, or having a minimum capacity of 5 MW and ensure that all
basic necessities for oering aFRR energy are fullled. After that, a second
pre-qualication process has to be passed where data about the power plant is
7transmitted to the transmission system operators. Then, a market participant
is allowed to oer electricity products on the aFRR market.
All aFRR products can provide either positive or negative reserve energy and
consist of 4h-blocks, during which the promised electricity needs to be available.
Furthermore, as mentioned above, it needs to be available within 30 seconds
after the demand request. After that, activating all balancing energy may take
up to 4.5 minutes; then, all demanded energy needs to be fully powered and
has to be available for 15 minutes in total. We denote the set of 4h block
products on the balancing markets as I. It consists of intervals Ik= [ak;bk)
spanning the time period of block Ik, whereas the corresponding index set is
given byK=f1;:::; 6gand the products are indexed in their natural order, i.e.
I1= [0;4);:::;I 6= [20;0). In the following, we reference product Ikbykif the
meaning is obvious through the context.
Regarding regulations in the aFRR market, the minimum bidding amount was
5 MW until July 2018; since then, this has been reduced to 1 MW. Nonetheless,
this change comes with the restriction that, when 1 MW to 4 MW are oered
on the market, then only one oer per product Ik2Iis allowed. All oers are
collected daily and consist of an electricity amount, whether positive or negative
reserve energy is oered, and two prices: One price belongs to the SRC market
and represents the remuneration for holding electricity available. The other
price belongs to the SRE market and is paid for actually activated electricity.
If a market participant's SRC market price was too high and the oer is not
awarded, its SRE market price is nonetheless placed in the merit order curve of
the SRE market. Consequently, also those market participants are allowed to
oer electricity on the SRE market that did not make it in the SRC market.
3.1.1 The reserve capacity market
On the SRC market, remuneration for oered electricity is determined by a
pay-as-bid method. All oers are collected in a merit order based on their
SRC prices. The merit order is used to determine which oers are awarded.
When an oer is awarded, its price is paid to the market participant for holding
electricity available, independent of whether it will be used or not.
To depict this procedure in our model, we dene bidding scenarios on the auction
of the SRC market. Each bidding scenario iis described by a price level pSRC
i
ine/MW and a volume vSRC
iin MW. In order to keep the model linear, we
restrict the possible bidding prices to the discrete set of the mentioned price
levels. Consequently, we consider NSRCbidding scenarios that are in total
ordered by increasing price levels, i.e. pSRC
ipSRC
i+1for alli= 1;:::;NSRC 1.
Corresponding to these bidding scenarios, we denote by qSRC
ithe probability
that exactly the rst ibids are awarded. Since the price levels are ordered
increasingly, price level pSRC
iis the highest accepted price level. Consequently,
qSRC
0denotes the probability of no accepted price level. Note that this approach
can also be found in [17]. The calibration of all introduced parameters are based
8on historical data. In order to obtain the probabilities qSRC
k;ithat a bid pSRC
i
for product kis accepted on the SRC market, we use the time series of daily
marginal prices per product k. In the following, we describe how to obtain said
probabilities for a xed day. Let the marginal accepted price for product kat
daydbe denoted as SRC
d;k. To get an estimate of the short-term distribution of
the marginal prices and to strip ourselves from the assumption of stationarity of
the time series, the calibration period is restricted to the time interval of 30 days
before the considered day. Consequently, we obtain an empirical distribution
function for each day das
^Fd(p) =1
30d 1X
j=d 311SRC
j;k<p; (1)
where the summation goes over the amount of times during the 30 day interval
that the marginal accepted price was lower than a threshold p. Consequently,
theqSRC
ifor a daydcan be computed by
qSRC
k;0=^Fd(pSRC
1);
qSRC
k;1=^Fd(pSRC
2) ^Fd(pSRC
1);
qSRC
k;2=^Fd(pSRC
3) ^Fd(pSRC
2);
...
qSRC
k;N= 1 ^Fd(pNSRC):
For illustration purposes, we show in Figure 3 the increasingly ordered cumu-
lative probabilities for dierent price levels. For example, the rst bar in the
bar chart describes the rst product of 01/04/2021. There, the price 0 has a
probability of zero of being the highest accepted bid. In the shown period, the
price level of 225 is the highest price level with a probability strictly greater
than zero. Over the course of a day, a pattern can be observed. Although the
calculated probability of an acceptance of price 0 is higher for later products
on the day, the highest accepted price is also higher. We will use these price
probabilities later on as input for the daily optimization runs.
3.1.2 The reserve energy market
Following the same market design as the SRC market, the SRE market is also
based on the pay-as-bid system in combination with a merit order. The only
dierence is that the oers' SRE market prices are used instead of SRC market
prices. Furthermore, next to the aFRR bids, so-called free bids can be entered
or adapted for the SRE market until gate closure. Free bids are placed by
market participants that did not bid on the SRC market or whose bids were not
accepted, but who still want to participate in the SRE market.
92021-04-01 2021-04-02 2021-04-03 2021-04-04 2021-04-05 2021-04-06 2021-04-07 2021-04-08 2021-04-09 2021-04-10 2021-04-11 2021-04-12
Date0.00.20.40.60.81.0Activation probabilitiesActivation probabilities of different price levels
0
10
25
50
75
100
125
150
175
200
225Figure 3: Probabilities for dierent price levels over time, where each price level
is associated with one color.
On the SRC market, the price for holding energy available is determined for
every market participant through the procedure described above. In contrast
to this, the demanded quantity of an oer depends on the actual amount of
aFRR energy that is needed. This can change from second to second. Con-
sequently, the amount that is paid for is the aggregated time during which
electricity was actually activated times the price. This activation amount in
MW is denoted by Sk(t) for product Ikand for every second tof the product
time interval. Furthermore, we dene 	 k(p) as the sum of oered capacity in
MW at the SRE market for product k, aggregated over all oers with an ask
price of at most p. This contains the amount of capacity available for product Ik
up to a threshold price p. With this, we are able to dene the SRC activation
duration for a given product Ikand a price level pas
Lk(p) =Z
Ik1Sk(t)	k(p)dt: (2)
In Figure 4, an example for the activation duration and its computation is given.
Whenever the blue lines lies above the red line in that gure, the considered bid
is activated. Note that the considered price levels for the SRE market are not
necessarily the same as the price levels for the SRC market.
Now, the expected activation duration k;iof SRE activation for a given price
oerpiand a product kis dened by
k;i:=E[Lk(pi)]: (3)
10Volume [MW]
Time of given product [h]0 1 2 3 4
Figure 4: Schematic representation of the computation of the activation du-
ration for the positive SRE market. On the x-axis, the 4h of one product
are shown. On the y-axis, we denote the oered and demand volumes on the
SRE market. The horizontal lines represent the cumulative volume of bids on
the SRE market, which are ordered by their corresponding prices. The red line
is the bid of the considered price level, whereas the blue line is a schematic
representation of the activation function.
In order to calculate the expected activation duration k;i, we rst compute the
SRE activation duration Lk(pi) as in (2) for the given price levels p1;:::;pNSRE
for every day in the data set and use then the seven-day average as the expected
value.
3.2 The day-ahead market
Here we focus on the German day-ahead market on the European Power Ex-
change (EPEX SPOT SE). The day-ahead market is still the most important
electricity market for spot products, as can be seen from the volumes traded on
this market (cf. [3]). This market is conducted through an auction where each
hour of the following day is traded as a single hourly product. All participants,
both buyers and sellers, pay a single market clearing price with an additional
spread. The auction design allows for complex bids, but the strategy we focus
on is simply to bid high/low enough to be accepted at all reasonable market
clearing prices. For the detailed rules of the market we refer to [3].
For the price forecasts, we use the forecasting model from Wagner et al. (cf. [25]).
The model is based on a simple dense neural network (DNN) with an embedding
layer to process calendar data. The underlying data is the date and time of the
price to be predicted and the corresponding forecast of wind and solar input.
The DNN is trained daily on the ve years preceding the two weeks we want
112021-05-03 2021-05-05 2021-05-07 2021-05-09 2021-05-11 2021-05-13 2021-05-15 2021-05-17
Date50
25
0255075100Price [ /MWh]
Day-Ahead Forecast Figure 5: Realized day-ahead prices (red) and daily day-ahead forecasts (blue)
for a two week time period at the start of May 2021.
to forecast, with the above data as input and the day-ahead prices as output.
We obtain the data from the ENTSO-E transparency platform (cf. [1]). As
the data for wind and solar are only available for the next day, but we are
forecasting for two weeks, we make two separate forecasts. First, we forecast
the next 24 hours using the ENTSO-E renewables data. Then we forecast the
next 13 days without this data using a DNN model trained only on calendar
information. This results in a day-ahead price forecast for the next two weeks.
For an example of the forecasted prices see Figure 5. Note that every forecast
gets more opaque over time. So the solid blue line represents the rst 24 hours
of each forecast.
4 The cross-market optimization problem
In this section we give a detailed description of our cross-market optimization
problem. Note that we are considering a rolling horizon approach as described
in Section 2.2. This requires us to solve an optimization problem every day. We
now describe this optimization problem for the two-market setting, where we
aim for a combined bidding strategy on the German balancing markets and the
German day-ahead market. The solution obtained is not only a distribution of
exibility between these markets, but also a precise bidding strategy for each of
the markets.
The variables are introduced in the following. A complete formulation of the
optimization problem can be found in Appendix A. We begin by introducing
some general notation. We denote the number of hours considered for cross-
market trading by Tand the number of hours considered for the total look-ahead
12period byT. This is done to allow a longer view of the day-ahead market and
a penalty term, which we will introduce later. Notation regarding products sets
was already introduced in Section 3.
Furthermore, the expected prot on each market is denoted by fSRC(orfSRE,
fDA). We introduce decision variables mifori2fDA;aFRRg, which denotes
the exibility allocated to the respective market. For better readibility, we
introduce variables mifori2fSRC;SREgas well and set
maFRR=mSRC=mSRE: (4)
Furthermore, we add a penalty term regarding battery usage, which we denote
byfPT.
The objective function The objective function of our cross-market model is
given as the sum of the expected prots in the single markets minus the penalty
term, i.e.
maxfSRC+fSRE+fDA fPT: (5)
In the following, we describe the expected prot of each of the markets in
more detail and formulate corresponding market constraints, as well as linking
constraints among the decision variables of all markets.
Reserve capacity market constraints As described in Section 3.1.1, for a
given day we compute NSRCbidding scenarios that are given by price levels pSRC
i
withpSRC
ipSRC
i+1for alli= 1;:::;NSRC 1 and the corresponding acceptance
probabilities qSRC
i. Given these, the expected prot of product kis dened as
fSRC
k:=NSRCX
i=1qSRC
k;i0
@iX
j=1mSRC
k;jpSRC
j1
A; (6)
wheremSRC
k;idenotes the oered volume at price level pSRC
iand for product k.
The total available volume for product kis bounded by the distributed exibil-
itymSRC
kwhich again is bounded by the allocated exibility mSRC. Thus, the
constraints
NSRCX
i=1mSRC
k;imSRC8k2K (7)
mSRC
kmSRC8k2K (8)
are added. Recall, the total expected prot of the SRC market is denoted by the
variablefSRCand is dened as the sum of expected prots over all products in
K, i.e.
fSRC=X
k2KfSRC
k: (9)
13Reserve energy market constraints In Section 3.1.2 we described how to
compute the expected activation duration k;ifor a given price level piand
a product k. We consider NSREdierent price levels. As said before, the
considered price levels of the SRE market do not need to be the same as the
considered price levels on the SRC market. Now, given these values, the expected
prot on the SRC market of product kis dened as
fSRE
k:=NSREX
i=1pSRE
imSRE
k;ik;i; (10)
and the total expected prot of the SRC market is the sum of expected prots
over all products, i.e. we add the constraint
fSRE=X
k2KfSRE
k: (11)
Day-ahead market constraints In order to compute the expected day-
ahead prot, recall that the total exibility distributed to the day-ahead market
is denoted by mDA. Since we consider only products that are traded at the
auction for hourly products, we introduce a decision variable mDA
tfor every
hourt= 0;:::;T. Furthermore, we introduce a decision variable mDA
kfor each
4-hour block Ik2I. We link them by the constraints
 mDA
kmDA
tmDA
k8Ik2I;t2Ik; (12)
 mDAmDA
kmDA8k2K: (13)
Consequently, mDA
tdenotes the amount of MW that is oered on the day-ahead
market during hour t(where a negative amount translates to a buying bid).
The constraints ensure that this amount cannot be higher than the maximally
allocated exibility for this market.
Given hourly price forecasts [ pt] fort= 0;:::;T, we dene the expected prot
on the day-ahead market as
fDA:=T
TTX
t=0ptmDA
t; (14)
whereptdenotes the price for the hourly product at hour t. Note that we
downscale the prot made on the day-ahead market to the considered time
period for the cross-market trading in order to obtain prots that are comparable
to the balancing market prots. Recall Section 3.2 on how the forecasts are
computed.
Battery capacity constraints We denote the minimum (respectively, max-
imum) battery capacity by min(respectively, max). At each point in time t,
14the battery level has to lie in the interval [ min;max]. The initial battery level
is denoted by 0. In total, we obtain the following battery capacity constraints.
min0+minft;TgX
t0=0mSRC
t0+tX
t0=0mDA
t0max8t= 0;:::;T; (15)
whereTdenotes the hours of the rst day whereas Tdenotes the number of
hours of the whole considered period. Note that these constraints ensure that
the battery level remains in the total capacity interval at every hour and link
the exibility given to each market in one constraint. Furthermore, it should
be noted that the distributed exibility to the balancing markets is considered
in this constraint by mSRC
t. Again, the usage of mSRC
trepresents a conservative
estimate, as this actually equals the maximum amount of energy that could
possibly be discharged from the battery through the SRE market.
For a short-term consideration, we could leave the objective function as max fSRC+
fSRE+fDA. However, in a medium or long term setting, this will often result
in a short-sighted exploitation of the battery capacity. This is especially un-
desirable if the production eciency (as in our application use case) suers
signicantly from a deviation of the battery from its central position.
In order to prevent discharging strategies, the next two paragraphs introduce
constraints that counteract this, namely a penalty for high absolute battery
deviations and the constraint to obtain a balanced battery level at the end of the
look-ahead period. Note that we cannot control future battery levels precisely,
as the future state depends on the realisations of bids on the balancing markets
and is also being overturned by interim scheduling updates. Hence we can only
make assumptions about the expected battery states.
Penalty term constraints A high eciency cost parameter will prevent
trading strategies that results in very high or very low battery levels since any
deviation from the nominal baseline is penalized. For this, we denote the (ex-
pected) battery level at time point tbytand dene it as
t:=X
Ik2I:akt0
@NSREX
i=1mSRE
k;ik;i1
A+tX
t0=0mDA
t0 (16)
Due to constraints (15) on the battery capacity, the expected battery level
always lies in the interval [ min;max]. We now dene the technical cost penalty
term as
fPT=T
TTX
t=0cpjtj; (17)
15wherecpdenotes the penalty coecient . We will later evaluate strategies with
respect to dierent penalty coecients. Note that a higher penalty coecient
yields strategies that balance the battery in shorter periods. Here, we considered
a linear formulation in order to obtain a linear program. However, one might
consider a quadratic penalty term in order to penalize higher (or lower) battery
levels more. Furthermore, note that we again use a scaled approach similar to
the day-ahead prot function.
Battery balance constraints As pointed out before, we compute day-ahead
strategies over the longer period T. In order to prevent selling all remaining
energy in the battery at the end of T(as this would maximize the prot), we
require that the expected battery level at the last time point is zero, i.e.
T= 0: (18)
Flexibility constraints It is necessary to globally restrict the exibility dis-
tributed to the dierent markets such that it cannot exceed the total exibility
available. This is ensured by the constraint
mDA+maFRRm; (19)
wheremdenotes the total available exibility that represents the maximum
charging or discharging amount of electricity.
This concludes our discussion of the constraints. A full formulation of the
problem can be found in Appendix A.
5 Numerical case study
In this section, we give a brief description of our case study setting. At TRIMET
Aluminium SE, the aluminium production process was exibilized such that the
process now functions as a virtual battery (cf. [10,11]).
The production of aluminium typically involves electrolytic reduction, which is
a very energy intensive process. In this process, aluminium is extracted from
alumina by passing an electric current through a mixture of alumina and cryolite
held in reduction cells. The process has traditionally been run at a constant
high current, as any change in current can potentially lead to cell damage. More
details about the aluminium production process can be found in [10,11].
TRIMET Aluminium SE, based in Essen, Germany, has developed a pilot set of
reduction cells equipped with heat exchangers. These devices enable a more ex-
ible energy schedule, as they allow the energy input to be adjusted within certain
time and energy constraints while keeping the risk of cell damage reasonably
low. This set-up can act as a virtual battery , as a surplus or shortage of energy
can be stored in the cells and balanced within a given time (cf. [10, 23]). This
16allows the company to take advantage of price spreads on dierent energy mar-
kets. A more detailed explanation of the virtual battery can be found in [10,11].
For the proposed model, the virtual battery has a capacity of 1000 MWh and
a total exibility of 10 MW per hour, i.e. we could sell or buy energy for 100
consecutive hours. Note that the parameter choices of the virtual battery are
inspired by the setting at TRIMET Aluminium SE, but do not reect their real
parameter values.
As described in constraints (16) and (17), we dene dierent bidding strate-
gies by two parameters, the exibility distribution ( mDA;maFRR) between day-
ahead market and balancing market and the penalty coecient cp. If these two
parameters can be adjusted between dierent runs during the rolling horizon
computation, we simply denote this with free . For example, the strategy that
has a xed distribution of 4 MW to the day-ahead market and 6 MW to the
balancing markets with a xed penalty coecient of 0 is denoted ((4,6) j0),
whereas the strategy that can adjust both the exibility distribution and the
penalty coecient over time is denoted ( freejfree ).
2021-05 2021-07 2021-09 2021-11 2022-01 2022-03
Date0.00.51.01.52.02.53.03.5Total cumulative profit [ ]
1e6 Total cumulative profit over time for different strategies
(Free | 0)
(Free | 2.5)
(Free | 5)
(Free | 7.5)
(Free | 10)
(Free | 12.5)
(Free | 15)
(Free | 17.5)
(Free | 20)
(Free | 22.5)
(Free | 25)
(Free | Free)
Figure 6: Cumulative realized prots for dierent ( freej){strategies. The
(freejfree ){strategy is shown in red and obtains a prot of approximately
3.551.222 e. The ( freej15){strategy, which obtains the highest prot of all
free strategies with a xed penalty coecient, is shown in black. All other
strategies are colored with a lower opacity.
A high penalty coecient keeps the battery utilization within a narrower range,
i.e. by penalizing very large deviations from a balanced battery level. In the
following, we will not only examine strategies with a xed coecient, but also
a strategy that adjusts this coecient on a daily basis according to the current
market situation. To do this, we clustered various price and volatility metrics on
the day-ahead and balancing markets and now choose the coecient according
to the cluster it belongs to. Our strategy is to choose a low coecient when
17volatility tends to be low, in order to have the possibility of realising prots over
a longer period of time, corresponding to a higher utilization of the battery.
We observe very similar cumulative prots for all considered strategies as shown
in Figure 6. What is striking is that, depending on the obtained prot, the
period can be divided into two sub-periods. For the whole period, the ( free
jfree ){strategy (colored red) achieves the highest total prot of 3.551.222 e,
although it is only about 1% higher than the ( freej15){strategy (colored
black). An overview over all prots obtained by the dierent bidding strategies
can be found in Table 1 in the Appendix. The ( freejfree ){strategy shows
minor dierences from the ( freej15){strategy, tending to keep the battery at
a slightly lower level. Around the turn of the year, we see a small drop in prot,
indicating that we are buying energy over several consecutive days. We can see
this more clearly in Figure 7, which shows battery levels over time. This eect is
more obvious at lower penalty coecients. It is interesting to note the steeper
curve starting in October 2021, indicating increased prot opportunities. In
Figure 11, we see that the average allocation of exibility in the rst period
is similar, but not identical to that in the second period. The higher prots
in the second period go hand in hand with higher price-bids in the positive
SRE market. While the average bid in the rst period is 130 e/MWh, it then
more than doubles to 287 e/MWh in the second period. In comparison to xed
strategies, i.e. strategies that market the same exibility distribution every day,
we see that all strategies that allow a daily adjusted split outperforms these
xed strategies, as shown in Figure 13 and Table 1.
2021-05 2021-07 2021-09 2021-11 2022-01 2022-03
Date1000
800
600
400
200
0Battery level [MWh]Battery level over time for different strategies
(Free | 0)
(Free | 2.5)
(Free | 5)
(Free | 7.5)
(Free | 10)
(Free | 12.5)
(Free | 15)
(Free | 17.5)
(Free | 20)
(Free | 22.5)
(Free | 25)
(Free | Free)
Figure 7: The battery level over time for dierent ( freej){strategies. The
best (in terms of total cumulative prot) strategy with xed penalty coecient
is shown in black, whereas the ( freejfree ){strategy is shown in red. Overall,
we observe a trend to discharge the battery towards the end of 2021. The
high spike around new years eve is due to an unusual high demand of negative
SRE energy.
18Figure 7 depicts the eects of the dierent penalty terms on the trading de-
cisions. Starting with an battery level of 0 MWh, the strategies with a low
penalty term instantly start to heavily discharge the battery. Although that
yields a high prot at rst, being close to the minimum limits the possibilities
of trading. With an increasing penalty term, the discharging eect reduces. For
the highest penalties, the battery level stays close to zero - at least for the rst
half. Thereafter, the electricity prices start to increase strongly and thus also
prot margins. None of the penalties suces to prevent the battery from dis-
charging in all the strategies. At the end of 2021, even the ( freej25){strategy
reaches a minimum of around -600 MWh. The rest of the gure depicts the
more volatile prices in the beginning of 2022. The prices in the rst two months
of 2022 start to relax, accompanied with an overall increase of battery levels
for the strategies. At the end of February, the reverse is true and the battery
levels start to fall again. The jump around new years is due to an unusual high
demand on the negative SRE market, see e.g. Figure 12 in the appendix. The
best performing strategies { ( freejfree ) and ( freej15) { are located neither
at the top nor at the bottom of the range of realized battery levels. This hints
at the conclusion that a well calibrated penalty term should be high enough so
that it does not allow for complete discharge, while being low enough such that
trading is not restricted too much.
Day-ahead market Pos. SRC market Pos. SRE market Neg. SRC market Neg. SRE market Total Profit
Market10000
0100002000030000Daily profit [ ]
Distribution of daily profits of the (free | free)-strategy
Figure 8: Distribution of the realized daily prots of the ( freejfree )-strategy.
Note that while the day-ahead market prots are mainly negative, i.e. energy
is bought, the main prot contribution comes from the positive SRE market.
Since we allow both positive and negative price bids on the negative SRE market,
the daily prot can be both negative and positive, unlike the other balancing
markets where the prots are non-negative.
In order to gain an intuition about realized prots of the best-performing ( free
jfree ){strategy, its daily prots are displayed in a box-plot in Figure 8. Several
key values are presented there: For one, each box represents the daily prots that
19were in between the 25% quantile and the 75% quantile for the corresponding
market. The black line in the middle of the blue box indicates the 50% quantile,
which represents the value that lies in the middle of all observed and ordered
daily prots. Consequently, each box contains 50% (which equals 75% - 25%) of
all observed prots over the considered time horizon for the respective market.
The vertical lines above and below each box mark the distance of the 25%
quantile (respectively the 75% quantile) to 1.5 times the distance between the
25% quantile and the 75% quantile. The so-called `whiskers' at their end are
then either determined by this length or by the furthest data point available
in the corresponding direction. In Figure 8, it becomes clear that the day-
ahead market is mainly used to buy electricity, because most of its prots are
negative. In comparison to that, the positive SRE market is the market yielding
the highest prots and is per denition used to sell electricity, while the negative
SRC market is used to rell the battery. Both SRC markets, as well as the
negative SRE market, do not yield prots that are of much signicance, nor
do they show much variability in the attained values. Consequently, the total
prot's volatility is mainly inuenced by day-ahead and positive SRE market
volatility. Furthermore, as the quantiles of the total daily prot are well above
zero, it must hold true that the overall usage of positive SRE is generally high,
as it is the only market contributing strongly to positive daily prots.
Day-ahead market Pos. SRC market Pos. SRE market Neg. SRC market Neg. SRE market
Market6000
4000
2000
02000400060008000Error [ ]
Distribution of error of profits of the (free | free)-strategy
Figure 9: Dierence of expected daily prot minus realized daily prot for
dierent markets. We see that the error is highest for the positive SRE market,
which is also the market with the highest share of the total prot.
When speaking of daily realized prots, one also has to consider the expected
daily prots as shown in Figure 9. Albeit being the market with the highest daily
prots, the positive SRE market is also the market with the highest dierence
between expected and realized prot. We see that the median dierence is
almost zero, which means the forecast for the SRE market is roughly equally
often too big as too small. Since the obtained prot of the other balancing
20markets is signicantly lower, the dierence does not have too much impact. We
see that the day-ahead forecasts perform really well with a small shift towards
too optimistic expected prots. Overall, our trading strategy could be improved
by using better forecasts, in particular for the SRE markets.
2021-09-01 2021-09-02 2021-09-03 2021-09-04 2021-09-05 2021-09-06 2021-09-07 2021-09-08
Date0246810Flexibility  [MW]Flexibility Distribution
00_04 04_08 08_12 12_16 16_20 20_24
Product0246810Mean Flexibility Distribution
Day-Ahead
AFRR
Figure 10: Flexibility distributed to the aFRR and day-ahead markets for the
(freejfree ){strategy. The left panel shows the rst seven days of 09/2021, the
right panel shows the mean distributed exibility per product over the complete
evaluation period.
00_04 04_08 08_12 12_16 16_20 20_24
Product0246810Flexibility  [MW]Mean Flexibility Distribution: April-September
00_04 04_08 08_12 12_16 16_20 20_24
Product0246810Mean Flexibility Distribution: October-March
Day-Ahead
AFRR
Figure 11: Flexibility distributed to the reserve markets and day-ahead market
for the ( freejfree ){strategy split between the rst, i.e. from 04/2021 to
11/2021, and second, i.e. from 12/2021 to 03/2021, of the evaluation period.
We observed a steeper cumulative prot curve during the second period which
indicates a structural change of market prices. The gure shows that this also
changes the bidding strategy.
We show in Figure 10 the daily split of exibility of the ( freejfree ){strategy.
In the left panel the distribution per 4h-block is shown for the rst seven days
of September 2021. Note that the split is not always trivial, i.e. the strategy
distributes exibility to both markets in the same 4h-block. This is due to
the fact that the strategy does not solely allocate the exibility to the market
with the highest expected prot, but also takes the penalty term into account.
The right panel of Figure 10 shows the mean distribution of exibility over the
21whole period considered. It is striking, that the balancing markets are strongly
preferred over the day-ahead market. However, in the rst four hours of the day,
the strategy allocates the available exibility mostly to the day-ahead market.
From 4 a.m. to 8 a.m. a quarter of the exibility is still oered on the day-ahead
market. This ts with the result that the day-ahead market is mainly used for
buying, as these hours usually exhibit the lowest prices. For all other 4h-blocks,
the balancing markets are strongly favored.
Overall, we see that all strategies that adjust the exibility distributed to the
dierent markets outperform all strategies with a xed exibility split. By
also adjusting the penalty coecient on a daily basis, the prot can be further
increased. However, our adjustment provides only a slight increase, but the
potential of a daily adjusted penalty coecient becomes obvious.
6 Conclusion
In this article, we propose a solution to the optimization problem of distributing
exibility between the day-ahead market and the aFRR market in the setting
of a virtual battery. We consider the case where a decision on the exibility
distribution has to be made before the rst market closes in order to guarantee
real-life applicability of our solution. In this setting, we only solve one optimiza-
tion problem only per day which takes both markets into account, in contrast
to other approaches that solve the problem in a multistage setting. The result-
ing exibility distribution cannot be changed afterwards. We present dierent
trading strategies for these markets that are reached by optimizing over various
exibility distributions between the markets plus a penalty coecient.
A numerical study over the period from April 2021 to March 2022 shows that a
daily adjusted split of the available exibility yields signicantly higher prots
than a strategy that tries to market the same split of exibility every day on the
day-ahead and the secondary balancing markets. Furthermore, we introduce a
penalty coecient that determines how much deviations from the base battery
line are penalized. Our proposed ( freejfree ){strategy, which can adjust
both the exibility and the penalty coecient on a daily basis, outperforms all
other strategies considered in terms of total prots. By adjusting the penalty
coecient between daily optimization runs, we obtain a desired property of
the resulting plan, i.e. maximum prot. While we have presented a penalty
approach that depends on the volatility measures of the considered markets, one
can extend this by considering, for example, the best choices of the coecient
over the last few days, the current battery level, and other external factors such
as solar and wind forecasts. This is part of future research. Furthermore, nding
an appropriate adjustment of the penalty coecient is a crucial task that also
allows further improvement.
Another market that oers exibility is the continuous intraday market. There-
fore, a further possible extension of the model is the inclusion of this market.
22The intraday market diers from the others in that buyers and sellers of electric-
ity meet directly. This means that they place bids which are collected in an order
book and when two orders for a product match, i.e. the selling price is lower
than or equal to the buying price, a trade is executed. Our proposed method of
incorporating the intraday market is through an algorithm that tracks the order
book and trades arbitrage between dierent products. The prot generated by
this algorithm is then used as a time series to forecast prots for cross-market
optimization. Diculties arise in calibrating the algorithm to produce results
that reect possible outcomes in a real-world scenario. In addition, the intraday
market is much more volatile for participants than the other markets, making
quality forecasting more dicult.
Acknowledgement
This work has partially been supported by the German Federal Ministry for
Economics and Climate Action in grant 01186724/1 (FlexEuro: Wirtschaftliche
Optimierung exibler stromintensiver Industrieprozesse).
References
[1] ENTSO-E Transparency Platform. Available at: https://transparency.
entsoe.eu/ . (Accessed: 27 February 2023).
[2] Regelleistung.net Internetplattform zur Vergabe von Regelleistung. Avail-
able at: https://www.regelleistung.net/ext/ . (Accessed: 15 March
2023).
[3] EPEX Spot SE. Available at: https://www.epexspot.com/en , 2023. (Ac-
cessed: 27 February 2023).
[4] Mirjam Ambrosius, Veronika Grimm, Christian S olch, and Gregor Z ottl.
Investment incentives for exible demand options under dierent market
designs. Energy Policy , 118:372{389, 2018.
[5] Xiaolin Ay on, Mar a A. Moreno, and Julio Usaola. Aggregators' optimal
bidding strategy in sequential day-ahead and intraday electricity spot mar-
kets. Energies , 10(4):450, 2017.
[6] Markus Bohlayer, Markus Fleschutz, Marco Braun, and Gregor Z ottl.
Demand side management and the participation in consecutive energy
markets-a multistage stochastic optimization approach. In 2018 15th In-
ternational Conference on the European Energy Market (EEM) , pages 1{5.
IEEE, 2018.
23[7] Markus Bohlayer, Markus Fleschutz, Marco Braun, and Gregor Z ottl.
Energy-intense production-inventory planning with participation in sequen-
tial energy markets. Applied Energy , 258:113954, 2020.
[8] Trine K. Boomsma, Nina Juul, and Stein-Erik Fleten. Bidding in sequential
electricity markets: The nordic case. European Journal of Operational
Research , 238(3):797{809, 2014.
[9] Carlo Corinaldesi, Daniel Schwabeneder, Georg Lettner, and Hans Auer. A
rolling horizon approach for real-time trading and portfolio optimization of
end-user exibilities. Sustainable Energy, Grids and Networks , 24:100392,
2020.
[10] N. Depree, R. D ussel, P. Patel, and T. Reek. The `Virtual Battery' -
Operating an Aluminium Smelter with Flexible Energy Input , pages 571{
576. Springer International Publishing, Cham, 2016.
[11] Roman D ussel, Albert Mulder, and Louis Bugnion. Transformation of a
potline from conventional to a full exible production unit. In Light Metals
2019, pages 533{541. Springer, 2019.
[12] Eduardo Faria and Stein-Erik Fleten. Day-ahead market bidding for a
nordic hydropower producer: taking the elbas market into account. Com-
putational Management Science , 8(1-2):75{101, 2011.
[13] Elisabeth Finhold, Till Heller, Sven O. Krumke, and Neele Leith auser. A
bicriteria almost equal minimum cost ow model for day-ahead trading. In
International Conference on Operations Research . Springer, 2023.
[14] Christoph G artner, Elias R oger, and Till Heller. An optimal bidding
model to market exibility on the balancing electricity markets. Energy ,
2004:2965, 2022.
[15] Linas Gelazanskas and Kelum A. A. Gamage. Demand side management in
smart grid: A review and proposals for future direction. Sustainable Cities
and Society , 11:22{30, 2014.
[16] Gro Klboe and Olav B. Fosso. Optimal bidding in sequential physical
markets|a literature review and framework discussion. In 2013 IEEE
Grenoble Conference , pages 1{6. IEEE, 2013.
[17] Emil Kraft, Marianna Russo, Dogan Keles, and Valentin Bertsch. Stochas-
tic optimization of trading strategies in sequential electricity markets. Eu-
ropean Journal of Operational Research , 2022.
[18] Neele Leith auser, Till Heller, Elisabeth Finhold, and Florian Schirra. Op-
timal trading of exible power consumption on the day-ahead market. In
International Conference on Operations Research , pages 175{181. Springer,
2022.
24[19] Nils L ohndorf and David Wozabal. The value of coordination in multimar-
ket bidding of grid energy storage. Operations Research , 2022.
[20] Niklas Nolzen, Alissa Ganter, Nils Baumg artner, Ludger Leenders, and
Andr e Bardow. Where to market exibility? optimal participation of in-
dustrial energy systems in balancing-power, day-ahead, and continuous in-
traday electricity markets, 2022.
[21] Fabian Ocker, Karl-Martin Ehrhart, and Marion Ott. Bidding strategies
in austrian and german balancing power auctions. Wiley Interdisciplinary
Reviews: Energy and Environment , 7(6):e303, 2018.
[22] Stig . Ottesen, Asgeir Tomasgard, and Stein-Erik Fleten. Multi mar-
ket bidding strategies for demand side exibility aggregators in electricity
markets. Energy , 149:120{134, 2018.
[23] Pascal Sch afer, Hermann Graf Westerholt, Artur M Schweidtmann,
Svetlina Ilieva, and Alexander Mitsos. Model-based bidding strategies on
the primary balancing market for energy-intense processes. Computers &
Chemical Engineering , 120:4{14, 2019.
[24] Pierluigi Siano. Demand response and smart grids|a survey. Renewable
and sustainable energy reviews , 30:461{478, 2014.
[25] Andreas Wagner, Enislay Ramentol, Florian Schirra, and Hendrik Michaeli.
Short- and long-term forecasting of electricity prices using embedding of
calendar information in neural networks. Journal of Commodity Markets ,
page 100246, 2022.
[26] Dionysios P. Xenos, Izzati Mohd Noor, Mitra Matloubi, Matteo Cicciotti,
Trond Haugen, and Nina F. Thornhill. Demand-side management and
optimal operation of industrial electricity consumers: An example of an
energy-intensive chemical plant. Applied Energy , 182:418{433, 2016.
[27] Qi Zhang and Ignacio E. Grossmann. Enterprise-wide optimization for
industrial demand side management: Fundamentals, advances, and per-
spectives. Chemical Engineering Research and Design , 116:114{131, 2016.
25A Two market problem formulation
Here we give a full formulation of the two market optimization problem.
maxfSRC+fSRE+fDA fPT
s.t.fSRC=X
k2KNX
i=1qSRC
k;i iX
j=1mSRC
k;jpSRC
j!
fSRE=X
k2KNSREX
i=1pSRE
imSRE
k;ik;i
fDA=T
TTX
t=0ptmDA
t
fPT=T
TTX
t=0cpjtj
min0+minft;TgX
t0=0mSRC
t0+tX
t0=0mDA
t0max8t0= 0;:::;T
t=X
Ik2I:akt0
@NSREX
i=1mSRE
k;ik;i1
A+tX
t0=0mDA
t08t= 0;:::;T
T= 0
maFRR=mSRC=mSRE
mDA+maFRRm
 mDA
kmDA
tmDA
k 8k2K;t2Ik
 mDAmDA
kmDA8k2K
NSRCX
i=1mSRC;k
imSRC8k2K
mSRC
kmSRC8k2K
26B Retrieval times on the SRE markets
Figure 12: Retrieval times of the positive reserve energy market for price level
of 95 e/MWh. We observe an oscillating pattern of retrieval times in the
time period from Nov 2021 - Jan 2022, where a signicantly low demand during
Christmas/New Year season in 2021 becomes apparent. Here the x-axis is based
on a 4h-scaling as the product structure of the market in that time period would
suggest.
27C Total prots of dierent bidding strategies
Flexibility DA [MW] Flexibility aFFR [MW] Penalty coecient Prot [ e]
free free free 3.551.222
free free 15.0 3.537.889
free free 12.5 3.536.887
free free 10.0 3.523.781
free free 17.5 3.476.709
free free 20.0 3.435.494
free free 7.5 3.433.082
free free 22.5 3.390.784
free free 25.0 3.360.793
free free 5.0 3.252.534
free free 2.5 3.020.029
free free 0.0 2.865.539
4.0 6.0 - 2.500.469
5.0 5.0 - 2.452.831
3.0 7.0 - 2.439.196
6.0 4.0 - 2.348.071
7.0 3.0 - 2.244.507
8.0 2.0 - 2.104.400
2.0 8.0 - 2.010.676
9.0 1.0 - 1.947.897
10.0 0.0 - 1.775.500
1.0 9.0 - 1.129.863
0.0 10.0 - 115.723
Table 1: Overview over total obtained prots at the end of the considered period
for the dierent bidding strategies, ordered by the prot in ascending order.
28D Evaluation of (xed j0)-strategies for dier-
ent exibility splits
2021-05 2021-07 2021-09 2021-11 2022-01 2022-030.00.51.01.52.02.5Total cumulative profit [ ]
1e6 Different fixed strategies
((0.0, 10.0) | 0)
((1.0, 9.0) | 0)
((2.0, 8.0) | 0)
((3.0, 7.0) | 0)
((4.0, 6.0) | 0)
((5.0, 5.0) | 0)
((6.0, 4.0) | 0)
((7.0, 3.0) | 0)
((8.0, 2.0) | 0)
((9.0, 1.0) | 0)
((10.0, 0.0) | 0)
2021-05 2021-07 2021-09 2021-11 2022-01 2022-03
Date1000
800
600
400
200
0200Battery level [MWh]
Figure 13: Evaluation for dierent (xed j0)-strategies. In terms of total cumu-
lative prot, the xed split of 4 MW on the day-ahead market and 6 MW on the
balancing markets outperforms all other strategies. Note that strategies with a
high distributed amount of exibility to balancing markets do not perform that
well, since at one point in time, they simply have no opportunity to sell energy
due to the battery size constraints. Besides that, we see that the battery usages
of all strategies are similar to each other.
29